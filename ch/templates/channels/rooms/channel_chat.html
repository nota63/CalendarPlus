
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{% csrf_token %}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
    <!-- Include jQuery from a CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>


    <title>Chat in Channel: {{ channel.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

    <!-- Add Bootstrap 5 CSS in your <head> section -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<style>
    /* Modal Styles */









    /* Modal Dialog - Thinner and Lightweight */
#eventDetailsModalPremium .modal-dialog.modal-lg {
    max-width: 60%; /* Thinner modal for Slack-like look */
    border-radius: 10px;
    transition: transform 0.3s ease-in-out;
    margin: 20px auto;
}

/* Modal Content */
#eventDetailsModalPremium .modal-content {
    background: #ffffff;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    transition: box-shadow 0.3s ease;
}

/* Modal Header */
#eventDetailsModalPremium .modal-header {
    background-color: #1E2A38;
    color: #ffffff;
    border-bottom: 1px solid #e0e0e0;
    padding: 15px 25px;
    border-radius: 10px 10px 0 0;
    font-size: 1.25rem;
    font-weight: 600;
}

/* Modal Body - Enable Scroll */
#eventDetailsModalPremium .modal-body {
    background-color: #f9f9f9;
    padding: 20px;
    font-size: 1rem;
    color: #333;
    max-height: 400px; /* Restrict height to allow scrolling */
    overflow-y: auto;
    border-radius: 0 0 10px 10px;
}

/* Custom Scrollbar Styling */
#eventDetailsModalPremium .modal-body::-webkit-scrollbar {
    width: 6px; /* Thin scrollbar */
}

#eventDetailsModalPremium .modal-body::-webkit-scrollbar-thumb {
    background-color: #2980b9; /* Stylish thumb color */
    border-radius: 3px;
}

#eventDetailsModalPremium .modal-body::-webkit-scrollbar-thumb:hover {
    background-color: #1abc9c; /* Change color on hover */
}

#eventDetailsModalPremium .modal-body::-webkit-scrollbar-track {
    background-color: #ecf0f1; /* Light background for scrollbar track */
}

/* Table Styling - Thin Look */
#eventDetailsModalPremium .table {
    width: 100%;
    margin-top: 15px;
    background-color: #ffffff;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
}

#eventDetailsModalPremium .table th,
#eventDetailsModalPremium .table td {
    padding: 12px 15px; /* Reduce padding for thinner look */
    text-align: left;
    vertical-align: middle;
    font-size: 0.95rem;
    color: #2C3E50;
    border: none;
}

#eventDetailsModalPremium .table th {
    background-color: #34495e;
    color: #ffffff;
    font-weight: 700;
}

#eventDetailsModalPremium .table td {
    background-color: #f7f9fb;
    color: #2d3e50;
    font-size: 0.9rem;
    border-radius: 4px;
}

/* Footer Styling */
#eventDetailsModalPremium .modal-footer {
    background-color: #f4f6f8;
    padding: 15px 25px;
    text-align: right;
    border-top: 1px solid #e0e0e0;
    border-radius: 0 0 10px 10px;
}

/* Buttons */
#eventDetailsModalPremium .btn-secondary {
    background-color: #2980b9;
    color: #ffffff;
    padding: 8px 20px;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 600;
    transition: background-color 0.3s ease;
}

#eventDetailsModalPremium .btn-secondary:hover {
    background-color: #1abc9c;
    cursor: pointer;
}












.user-tooltip {
    max-width: 250px;
    font-size: 14px;
    border-radius: 8px;
    box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1);
    display: none;
    padding: 10px;
}

.user-tooltip .user-icon {
    width: 40px;
    height: 40px;
    background-color: #ccc;
    border-radius: 50%;
    display: inline-block;
    margin-bottom: 10px;
}

.user-tooltip p {
    margin: 0;
    padding: 5px 0;
}

.mentioned-user {
    color: #007bff;
    cursor: pointer;
}

.mentioned-user:hover {
    text-decoration: underline;
}



/* Styling for the user list dropdown */
.user-list {
    position: absolute;
    background-color: #fff;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    max-height: 200px;
    overflow-y: auto;
    width: 100%;
    z-index: 1000; /* Make sure it appears above other elements */
    margin-top: 2px;
    padding: 5px 0;
    font-family: Arial, sans-serif;
    font-size: 14px;
    color: #333;
}

/* Styling for each user in the list */
.user-list li {
    padding: 8px 12px;
    cursor: pointer;
    transition: background-color 0.2s ease;
}

/* Hover effect for list items */
.user-list li:hover {
    background-color: #f0f0f0;
}

/* Highlight the selected user */
.user-list li.selected {
    background-color: #e0e0e0;
}

/* Make sure to position the user list correctly */
td[contenteditable="true"] {
    position: relative; /* Ensure the user list is positioned relative to the cell */
}

.user-list li {
    white-space: nowrap; /* Prevent text from wrapping */
    text-overflow: ellipsis; /* Add an ellipsis if the name is too long */
    overflow: hidden;
}

/* Style for the mentioned username */
.mentioned-user {
    color: green; /* Change the color to green */
    font-weight: bold;
    background-color: #e0f7e0; /* Light green background for emphasis */
    border-radius: 3px;
    padding: 2px 5px;
    display: inline-block;
    margin-right: 5px;
}

/* Style for the contenteditable column when a user is mentioned */
td[contenteditable="true"] .mentioned-user {
    color: green; /* Color of the mentioned username */
    font-weight: bold;
    background-color: #e0f7e0; /* Light green background */
    padding: 2px 5px;
    border-radius: 3px;
}

/* Optional: Style for empty contenteditable fields (to show placeholder text) */
td[contenteditable="true"]:empty {
    color: #888; /* Light grey placeholder color when the cell is empty */
}


   #screen-share-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    display: none; /* Initially hidden */
    justify-content: center;
    align-items: center;
    background-color: rgba(0, 0, 0, 0.8); /* Dark semi-transparent overlay */
    z-index: 1000; /* Ensure it appears on top of other elements */
}

#screen-share-video {
    max-width: 90%;
    max-height: 90%;
    border: 2px solid white;
    border-radius: 8px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}







 /* Default star status text color */
.star-status {
    transition: color 0.3s ease, transform 0.3s ease;  /* Added transform for animations */
}

/* If message is starred, make the text green and apply extra effects */
.star-status.starred {
    color: green; /* Green color when starred */
    font-weight: bold;  /* Make the text bold */
    text-shadow: 0 2px 4px rgba(0, 255, 0, 0.4);  /* Add glowing green shadow effect */
    transform: scale(1.1);  /* Slightly enlarge the text */
    animation: pulse 1s infinite;  /* Pulsing effect */
}

/* If message is unstarred, keep the text in default color */
.star-status.unstarred {
    color: gray; /* Default color when unstarred */
}

/* Add a pulsing animation when the message is starred */
@keyframes pulse {
    0% {
        transform: scale(1.1);
    }
    50% {
        transform: scale(1.15);
    }
    100% {
        transform: scale(1.1);
    }
}

.custom-modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.5);
}

.custom-modal-content {
    position: relative;
    background-color: white;
    margin: 10% auto;
    padding: 20px;
    width: 50%;
    border-radius: 10px;
    box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
}

.custom-close {
    position: absolute;
    top: 10px;
    right: 10px;
    color: #aaa;
    font-size: 24px;
    font-weight: bold;
    cursor: pointer;
}




/* General Modal Styling */
#networkStatusModal .modal-content {
  background-color: #f7f7f7; /* Light background for readability */
  padding: 20px;
}

/* Container for the whole network status section */
#networkStatus {
  font-family: 'Arial', sans-serif;
  color: #333;
}

/* Signal Strength Bar */
#signalStrengthBar {
  background-color: #28a745; /* Green by default */
}

/* Chart Sizing and Styling */
canvas {
  width: 100% !important;  /* Ensure charts take up full available width */
  max-width: 300px; /* Max width of charts to keep them compact */
  margin: 0 auto;  /* Center charts */
  display: block;
}

/* Specific Chart Styles */

/* Network Speed (Line Chart) */
#networkSpeedChart {
  max-width: 350px;
  height: 150px;
  margin-bottom: 20px;
}

/* Network Load (Bar Chart) */
#networkLoadChart {
  max-width: 350px;
  height: 100px;
  margin-bottom: 20px;
}

/* Bandwidth Usage (Pie Chart) */
#bandwidthUsageChart {
  max-width: 250px;
  height: 250px;
  margin-bottom: 20px;
}

/* Server Response Time (Mini Graph) */
#serverResponseChart {
  max-width: 250px;
  height: 100px;
  margin-bottom: 20px;
}

/* Latency, Jitter, Packet Loss Section */
#pingValue,
#jitterValue,
#packetLoss {
  font-weight: bold;
  margin-bottom: 10px;
}

/* Signal Strength Section */
#signalStrengthText {
  font-weight: bold;
  margin-top: 10px;
}

/* Diagnostic Suggestions Section */
#diagnosticSuggestions {
  margin-top: 20px;
  font-size: 14px;
}

#diagnosticSuggestions p {
  margin-bottom: 8px;
}

/* Activity Log Styling */
#activityLog {
  margin-top: 20px;
  max-height: 200px;
  overflow-y: auto;
  font-size: 14px;
}

/* Tooltip Styling */
#networkStatus .tooltip-inner {
  font-size: 12px;
  background-color: #333;
  color: #fff;
}




.hidden {
    display: none;
}

  /* Style for the modal */
  .modal-content {
        background-color: #f8f9fa; /* Light background for modal */
        border-radius: 15px;
        padding: 20px;
    }

    /* Title of the modal */
    .modal-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: #007bff;
    }

    /* Table style inside modal */
    .modal-body table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    .modal-body table th,
    .modal-body table td {
        padding: 10px;
        text-align: left;
        border: 1px solid #ddd;
    }

    .modal-body table th {
        background-color: #007bff;
        color: #fff;
    }

    .modal-body table td {
        background-color: #f1f1f1;
    }

    /* Members List */
    #membersList {
        margin-top: 15px;
        list-style: none;
        padding: 0;
    }

    #membersList li {
        padding: 5px 0;
        font-size: 1rem;
        color: #333;
    }

    #membersList li:hover {
        background-color: #f1f1f1;
    }

    /* Footer styling */
    .modal-footer {
        background-color: #f1f1f1;
        border-top: 1px solid #ddd;
        padding: 10px;
    }

    .modal-footer .btn-secondary {
        background-color: #6c757d;
        color: white;
    }

    .modal-footer .btn-secondary:hover {
        background-color: #5a6268;
    }



    .popup-message {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 10px 20px;
    background-color: #007bff;
    color: white;
    border-radius: 5px;
    font-size: 16px;
    z-index: 9999;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* Emoji Picker Modal Styling */
#emojiPickerModal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    width: 80%;
    max-width: 500px;
    padding: 20px;
    display: none; /* Initially hidden */
    opacity: 0;
    transition: opacity 0.3s ease, transform 0.3s ease;
    z-index: 1000; /* Ensure it's above other content */
    text-align: center; /* Center content horizontally */
}

/* When the modal is visible */
#emojiPickerModal.show {
    display: block;
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
}

/* Emoji container styling */
#emojiContainer {
    display: grid;
    grid-template-columns: repeat(6, 1fr); /* 6 emojis per row */
    gap: 10px;
    justify-items: center; /* Center emojis in the grid */
    align-items: center;
    overflow-y: auto;
    max-height: 250px;
    padding: 10px;
}

/* Adjust the grid layout for smaller screens */
@media (max-width: 600px) {
    #emojiContainer {
        grid-template-columns: repeat(4, 1fr); /* 4 emojis per row on smaller screens */
    }
}

@media (max-width: 400px) {
    #emojiContainer {
        grid-template-columns: repeat(3, 1fr); /* 3 emojis per row on very small screens */
    }
}

/* Individual emoji button styling */
.emoji {
    font-size: 30px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 12px;
    border-radius: 8px;
    background-color: #f5f5f5;
    transition: background-color 0.2s ease, transform 0.2s ease;
    text-align: center;
}

/* Hover effect on emojis */
.emoji:hover {
    background-color: #e0e0e0;
    transform: scale(1.2);
}

/* Close button for the modal - Highlighted in red */
#closeEmojiPickerModal {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    color: red; /* Red color for close button */
    font-size: 20px;
    cursor: pointer;
    transition: color 0.2s ease;
}

/* Close button hover effect */
#closeEmojiPickerModal:hover {
    color: darkred; /* Darker red on hover */
}

/* Add smooth fade-in animation */
@keyframes fadeIn {
    0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.9);
    }
    100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
}

#emojiPickerModal.show {
    animation: fadeIn 0.3s ease forwards;
}




/* Modal Background */
.hidden {
    display: none;
}

.fixed {
    position: fixed;
}

.inset-0 {
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
}

.bg-gray-600 {
    background-color: rgba(0, 0, 0, 0.6);
}

.bg-opacity-50 {
    background-color: rgba(0, 0, 0, 0.5);
}

/* Modal Box */
.bg-white {
    background-color: #ffffff;
}

.p-6 {
    padding: 1.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.w-1/3 {
    width: 33.33%;
}

/* Modal Title */
.text-xl {
    font-size: 1.25rem;
}

.font-bold {
    font-weight: bold;
}

.mb-4 {
    margin-bottom: 1rem;
}

/* Input and Buttons */
.border {
    border: 1px solid #ccc;
}

.p-2 {
    padding: 0.5rem;
}

.w-full {
    width: 100%;
}

.mb-4 {
    margin-bottom: 1rem;
}

.bg-blue-500 {
    background-color: #3b82f6;
}

.text-white {
    color: #ffffff;
}

.ml-2 {
    margin-left: 0.5rem;
}

.flex {
    display: flex;
}

.justify-end {
    justify-content: flex-end;
}

/* Modal Animation */
@keyframes modalFadeIn {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes modalFadeOut {
    0% {
        opacity: 1;
        transform: scale(1);
    }
    100% {
        opacity: 0;
        transform: scale(0.8);
    }
}

#audioUploadModal, #videoUploadModal {
    animation: modalFadeIn 0.3s ease-out forwards;
}

.hidden #audioUploadModal, .hidden #videoUploadModal {
    animation: modalFadeOut 0.3s ease-in forwards;
}





/* Modal Background */
.hidden {
    display: none;
}

.fixed {
    position: fixed;
}

.inset-0 {
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
}

.bg-gray-600 {
    background-color: rgba(0, 0, 0, 0.6);
}

.bg-opacity-50 {
    background-color: rgba(0, 0, 0, 0.5);
}

/* Modal Box */
.bg-white {
    background-color: #ffffff;
}

.p-6 {
    padding: 1.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.w-1/3 {
    width: 33.33%;
}

/* Modal Title */
.text-xl {
    font-size: 1.25rem;
}

.font-bold {
    font-weight: bold;
}

.mb-4 {
    margin-bottom: 1rem;
}

/* Input Fields */
.border {
    border: 1px solid #ccc;
}

.p-2 {
    padding: 0.5rem;
}

.w-full {
    width: 100%;
}

.mb-4 {
    margin-bottom: 1rem;
}

/* List of Users (Mention Modal) */
#mentionList {
    max-height: 200px;
    overflow-y: auto;
    margin-bottom: 1rem;
}

#mentionList li {
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 0.25rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

#mentionList li:hover {
    background-color: #f0f0f0;
}

/* Buttons */
.bg-blue-500 {
    background-color: #3b82f6;
}

.bg-gray-500 {
    background-color: #6b7280;
}

.text-white {
    color: #ffffff;
}

.ml-2 {
    margin-left: 0.5rem;
}

.flex {
    display: flex;
}

.justify-end {
    justify-content: flex-end;
}

/* Modal Animation */
@keyframes modalFadeIn {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes modalFadeOut {
    0% {
        opacity: 1;
        transform: scale(1);
    }
    100% {
        opacity: 0;
        transform: scale(0.8);
    }
}

#mentionModal, #sendLinkModal {
    animation: modalFadeIn 0.3s ease-out forwards;
}

.hidden #mentionModal, .hidden #sendLinkModal {
    animation: modalFadeOut 0.3s ease-in forwards;
}




/* Modal Background */
.hidden {
    display: none;
}

.fixed {
    position: fixed;
}

.inset-0 {
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
}

.bg-gray-600 {
    background-color: rgba(0, 0, 0, 0.6);
}

.bg-opacity-50 {
    background-color: rgba(0, 0, 0, 0.5);
}

/* Modal Box */
.bg-white {
    background-color: #ffffff;
}

.p-6 {
    padding: 1.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.w-1/3 {
    width: 33.33%;
}

/* Modal Title */
.text-xl {
    font-size: 1.25rem;
}

.font-bold {
    font-weight: bold;
}

.mb-4 {
    margin-bottom: 1rem;
}

/* Coming Soon Icon */
#comingSoonIcon {
    font-size: 3rem;
    color: #ffcc00;
    margin-bottom: 1rem;
}

/* Modal Content */
p {
    font-size: 1rem;
    color: #333;
    margin-bottom: 1.5rem;
}

/* Button */
.bg-gray-500 {
    background-color: #6b7280;
}

.text-white {
    color: #ffffff;
}

.p-2 {
    padding: 0.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

/* Modal Animation */
@keyframes modalFadeIn {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes modalFadeOut {
    0% {
        opacity: 1;
        transform: scale(1);
    }
    100% {
        opacity: 0;
        transform: scale(0.8);
    }
}

#comingSoonModal {
    animation: modalFadeIn 0.5s ease-out forwards;
}

.hidden #comingSoonModal {
    animation: modalFadeOut 0.3s ease-in forwards;
}











/* sidebar styles */
/* sidebar styles */
/* Sidebar Style */
.sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: 280px;
    height: 100%;
    background: linear-gradient(135deg, #3a3e47, #2c2f38); /* Gradient background */
    color: #fff;
    padding-top: 30px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    border-right: 2px solid #444;
    box-shadow: 2px 0px 15px rgba(0, 0, 0, 0.3); /* Enhanced shadow for more depth */
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: #444 #2c2f38;

}

/* Scrollbar customization for Webkit browsers */
.sidebar::-webkit-scrollbar {
    width: 8px;
}

.sidebar::-webkit-scrollbar-thumb {
    background-color: #444;
    border-radius: 4px;
}

.sidebar::-webkit-scrollbar-track {
    background-color: #2c2f38;
}

/* Header Section */
.sidebar-header h2 {
    font-size: 24px;
    font-weight: 700;
    margin-left: 20px;
    color: #f1f1f1;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 20px;
    transition: color 0.3s ease;
}

.sidebar-header h2:hover {
    color: #ffcb05;
    transform: scale(1.05); /* Slightly scale the header on hover for dynamic feel */
}

/* Menu Items */
.sidebar-menu {
    flex-grow: 1;
    margin-top: 20px;
    margin-bottom: 20px;
}

.menu-item {
    width: 100%;
    padding: 12px 20px;
    font-size: 16px;
    text-align: left;
    color: #b9bbbe;
    background-color: transparent;
    border: none;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    margin: 5px 0;
}

.menu-item:hover {
    background-color: #4f585f; /* Slightly brighter gray on hover */
    color: #fff;
    transform: translateX(5px); /* Slick hover transition */
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2); /* Smooth shadow effect */
}

/* Active State for Menu Items */
.menu-item.active {
    background-color: #00bcd4;
    color: #fff;
    transform: translateX(5px); /* Keep the same hover feel for active state */
    box-shadow: 0 4px 10px rgba(0, 188, 212, 0.4); /* Add subtle glow for active */
}

/* Icon next to text (optional) */
.menu-item i {
    margin-right: 15px;
    font-size: 20px; /* Slightly larger icons for better visibility */
    transition: transform 0.3s ease;
}

.menu-item:hover i {
    transform: rotate(20deg); /* Slight icon rotation effect on hover */
}

/* Footer Section */
.sidebar-footer {
    margin-top: auto;
    padding-bottom: 20px;
    padding-left: 20px;
}

.sidebar-footer .menu-item {
    margin-top: 10px;
    padding: 12px 20px;
    font-size: 16px;
    color: #b9bbbe;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.sidebar-footer .menu-item:hover {
    background-color: #4f585f;
    color: #fff;
    transform: translateX(5px);
}

/* Responsive Design for smaller screens */
@media screen and (max-width: 768px) {
    .sidebar {
        width: 240px;
    }

    .sidebar-header h2 {
        font-size: 20px;
    }

    .menu-item {
        font-size: 14px;
        padding: 10px 15px;
    }
}
















/* Modal Background */
.hidden {
    display: none;
}

.fixed {
    position: fixed;
}

.inset-0 {
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
}

.bg-gray-600 {
    background-color: rgba(0, 0, 0, 0.6);
}

.bg-opacity-50 {
    background-color: rgba(0, 0, 0, 0.5);
}

/* Modal Box */
.bg-white {
    background-color: #ffffff;
}

.p-6 {
    padding: 1.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.w-1/3 {
    width: 33.33%;
}

/* Modal Title */
.text-xl {
    font-size: 1.25rem;
}

.font-bold {
    font-weight: bold;
}

.mb-4 {
    margin-bottom: 1rem;
}

/* Coming Soon Icon */
#comingSoonIcon {
    font-size: 3rem;
    color: #ffcc00;
    margin-bottom: 1rem;
}

/* Modal Content */
p {
    font-size: 1rem;
    color: #333;
    margin-bottom: 1.5rem;
}

/* Button */
.bg-gray-500 {
    background-color: #6b7280;
}

.text-white {
    color: #ffffff;
}

.p-2 {
    padding: 0.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

/* Modal Animation */
@keyframes modalFadeIn {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes modalFadeOut {
    0% {
        opacity: 1;
        transform: scale(1);
    }
    100% {
        opacity: 0;
        transform: scale(0.8);
    }
}

#filterModal {
    animation: modalFadeIn 0.5s ease-out forwards;
}

.hidden #filterModal {
    animation: modalFadeOut 0.3s ease-in forwards;
}






/* Styling the main section */
.channel-info {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    background-color: #1a1a1a; /* Dark background */
    color: #fff; /* White text color */
    border-radius: 8px;
    width: 70%; /* Reduce width */
    max-width: 600px; /* Maximum width */
    margin-top: 40px; /* Space from the top of the page */
}

/* Styling the container holding image and text */
.channel-info-container {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    width: 100%;
}

/* Styling the image */
.channel-image {
    width: 60px; /* Reduced image size */
    height: auto;
    border-radius: 50%;
    margin-right: 15px; /* Space between image and text */
}

/* Styling the text section */
.channel-text {
    max-width: 450px; /* Reduced max width of the text section */
}

/* Heading Style */
.text-primary {
    font-size: 1.2rem; /* Smaller heading */
    color: #4e73df; /* Blue color for title */
    margin-bottom: 10px;
}

/* Text Style */
.text-muted {
    font-size: 0.9rem; /* Smaller text size */
    color: #a0a0a0; /* Muted gray for description text */
}





/* Modal Background */
.hidden {
    display: none;
}

.fixed {
    position: fixed;
}

.inset-0 {
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
}

.bg-gray-600 {
    background-color: rgba(0, 0, 0, 0.6);
}

.bg-opacity-50 {
    background-color: rgba(0, 0, 0, 0.5);
}

/* Modal Box */
.bg-white {
    background-color: #ffffff;
}

.p-6 {
    padding: 1.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.w-1/3 {
    width: 33.33%;
}

/* Modal Title */
.text-xl {
    font-size: 1.25rem;
}

.font-bold {
    font-weight: bold;
}

.mb-4 {
    margin-bottom: 1rem;
}

/* Coming Soon Icon */
#comingSoonIcon {
    font-size: 3rem;
    color: #ffcc00;
    margin-bottom: 1rem;
}

/* Modal Content */
p {
    font-size: 1rem;
    color: #333;
    margin-bottom: 1.5rem;
}

/* Button */
.bg-gray-500 {
    background-color: #6b7280;
}

.text-white {
    color: #ffffff;
}

.p-2 {
    padding: 0.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

/* Modal Animation */
@keyframes modalFadeIn {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes modalFadeOut {
    0% {
        opacity: 1;
        transform: scale(1);
    }
    100% {
        opacity: 0;
        transform: scale(0.8);
    }
}

#deleteMessagesModal {
    animation: modalFadeIn 0.5s ease-out forwards;
}

.hidden #deleteMessagesModal {
    animation: modalFadeOut 0.3s ease-in forwards;
}


.menu-dropdown {
    display: none;
}

.menu-button:hover + .menu-dropdown,
.menu-button:focus + .menu-dropdown {
    display: block;
}
/* Success message styles */
#successMessage {
  background: linear-gradient(45deg, #5cb3f7, #7ad9e6); /* Light blue gradient */
  box-shadow: 0 4px 15px rgba(0, 123, 255, 0.2); /* Soft shadow for depth */
  color: #fff; /* White text for contrast */
  border-radius: 8px;
  padding: 16px 20px;
  font-weight: bold;
  font-size: 18px;
  display: inline-block;
  width: auto;
  position: relative;
  opacity: 0;
  transform: translateX(50px); /* Start from right */
  transition: all 0.5s ease-out;
  box-sizing: border-box;
}

#successMessage.show {
  opacity: 1;
  transform: translateX(0); /* Slide in */
  animation: bounceIn 0.6s ease-out; /* Bounce-in effect */
}

/* Bounce-in animation */
@keyframes bounceIn {
  0% {
    transform: translateY(20px);
    opacity: 0;
  }
  60% {
    transform: translateY(-10px);
    opacity: 1;
  }
  100% {
    transform: translateY(0);
  }
}






/* Centering the content at the top of the page */
.channel-info-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: transparent; /* Make the container background transparent */
    padding: 0; /* No padding, so no space around */
    border-radius: 8px; /* Rounded corners for a clean look */
    margin: 0; /* No margins */
    position: absolute;
    top: 20px; /* Align it to the top */
    left: 50%; /* Center horizontally */
    transform: translateX(-50%); /* Perfect centering horizontally */
    width: auto; /* Container should adjust to the content's width */
    height: auto; /* Container should adjust to the content's height */
    opacity: 1; /* Keep the content visible */
    pointer-events: none; /* Disable any interaction with the container */
}

/* Make only the content inside the container visible */
.channel-info-container img,
.channel-info-container strong,
.channel-info-container p {
    display: block;
    opacity: 1; /* Make content visible */
    pointer-events: auto; /* Allow interaction with content */
    transition: opacity 0.3s ease; /* Smooth fade-in transition */
}

/* Image styling */
.channel-info-container img {
    width: 100px;
    height: 70px;
    object-fit: cover;
    border-radius: 50%;
    margin-bottom: 1px;
}

/* Channel name styling */
.channel-info-container strong {
    font-size: 18px;
    font-weight: 600;
    color: #007bff; /* Highlighting channel name with a color */
    margin-bottom: 8px;
}

/* Description paragraph styling */
.channel-info-container p {
    font-size: 14px;
    color: #555555;
    line-height: 1.6;
    margin-top: 0;
    text-align: center;
}

/* Optional: Add some margin to the bottom for separation */
.channel-info-container p:last-child {
    margin-bottom: 6;
}



#screenShareContainer {
    display: none; /* Hidden by default, shown dynamically */
    position: fixed;
    top: 10%;
    left: 50%;
    transform: translate(-50%, 0);
    width: 80%;
    max-width: 800px;
    background-color: rgba(0, 0, 0, 0.9); /* Slight transparency for elegance */
    border-radius: 10px;
    padding: 20px;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
    z-index: 1000; /* Ensure it is on top */
    overflow: hidden;
}

#localVideo {
    width: 100%;
    height: auto;
    border: 2px solid #fff; /* Border for better visibility */
    border-radius: 5px;
}

#remoteVideos {
    margin-top: 20px;
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
    justify-content: center; /* Center remote video elements */
}

#remoteVideos video {
    width: calc(33.33% - 10px); /* Three videos per row */
    height: auto;
    border: 2px solid #fff;
    border-radius: 5px;
}


#screenShareContainer {
    cursor: grab; /* Default cursor for draggable element */
}

#screenShareContainer:active {
    cursor: grabbing; /* Cursor while dragging */
}

</style>




<div class="channel-info-container">
    <img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTovgq0biY5SBKW0gKlM26upMZ3GaNc4w0qOg&s" alt="Channel Image">
    <strong>
        Everyone’s all here in # {{channel.name}}
    </strong>
    <p>
        Share announcements and updates about company news, upcoming events, or teammates who deserve some kudos. ⭐
    </p>
</div>
<br>

<!-- Success Message -->


<!-- Success message container -->
<div id="successMessage" class="hidden text-white font-semibold p-4 rounded-lg bg-gradient-to-r from-green-400 via-green-500 to-green-600 mb-4 w-full max-w-4xl transform scale-0 transition-all duration-500 ease-out opacity-0">
    <span class="text-xl">Success! Your action was completed successfully.</span>
  </div>
  

<!-- Modal for displaying the user list -->
<div id="userListModal" class="modal fade" tabindex="-1" aria-labelledby="userListModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userListModalLabel">Channel Users including you</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul id="userList" class="list-group">
                    <!-- List of users will be dynamically populated here -->
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Bootstrap 5 Modal to show the logs -->
<div class="modal fade" id="activityLogsModal" tabindex="-1" aria-labelledby="activityLogsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="activityLogsModalLabel">Activity Logs</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                <div id="activityLogsList" class="list-group">
                    <!-- Logs will be dynamically populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal for Channel Details -->
<div id="channelDetailsModal" class="modal fade" tabindex="-1" aria-labelledby="channelDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="channelDetailsModalLabel">Channel Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- About Section -->
                <h5>About</h5>
                <p><i class="bi bi-card-text text-primary" style="font-size: 1.2rem;"></i> <strong>Name:</strong> <span id="channelName"></span></p>
                <p><i class="bi bi-type text-primary" style="font-size: 1.2rem;"></i> <strong>Type:</strong> <span id="channelType"></span></p>
                <p><i class="bi bi-eye text-primary" style="font-size: 1.2rem;"></i> <strong>Visibility:</strong> <span id="channelVisibility"></span></p>
                <p><i class="bi bi-calendar text-primary" style="font-size: 1.2rem;"></i> <strong>Created At:</strong> <span id="channelCreatedAt"></span></p>
                <p><i class="bi bi-person text-primary" style="font-size: 1.2rem;"></i> <strong>Created By:</strong> <span id="channelCreatedBy"></span></p>

                <!-- Members Section -->
                <h5>Members</h5>
                <ul id="membersList" class="list-group">
                    <!-- Members will be dynamically populated here -->
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Popup Message -->
<div id="popupMessage" class="popup-message" style="display: none;">
    We'll export the data and send it to {{request.user.email}}. You can proceed with other tasks in the meantime...
</div>




<!-- Modal to Display the Channel Statistics -->
<div class="modal fade" id="statisticsModal" tabindex="-1" aria-labelledby="statisticsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="statisticsModalLabel">Channel Statistics</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h5>Total Messages: <span id="totalMessages"></span></h5>
          <h5>Total Links: <span id="totalLinks"></span></h5>
          <h5>King User: <span id="kingUser"></span></h5>
  
          <!-- Chart Section -->
          <div class="row">
            <!-- Messages Chart -->
            <div class="col-md-6 mb-4">
              <canvas id="messagesChart"></canvas>
            </div>
  
            <!-- Links Chart -->
            <div class="col-md-6 mb-4">
              <canvas id="linksChart"></canvas>
            </div>
  
            <!-- Chart 3: User Message Counts -->
            <div class="col-md-6 mb-4">
              <canvas id="userMessageCountsChart"></canvas>
            </div>
  
            <!-- Chart 4: User Link Counts -->
            <div class="col-md-6 mb-4">
              <canvas id="userLinkCountsChart"></canvas>
            </div>
  
            <!-- Chart 5: Total Messages -->
            <div class="col-md-6 mb-4">
              <canvas id="totalMessagesChart"></canvas>
            </div>
  
            <!-- Chart 6: Total Links -->
            <div class="col-md-6 mb-4">
              <canvas id="totalLinksChart"></canvas>
            </div>
  
            <!-- Chart 7: King User Stats -->
            <div class="col-md-6 mb-4">
              <canvas id="kingUserChart"></canvas>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  


  <!-- Coming Soon Modal -->
<div id="comingSoonModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg w-1/3">
        <div id="comingSoonIcon" class="flex justify-center">
            <i class="fas fa-clock"></i> <!-- Clock icon for "Coming Soon" -->
        </div>
        <h2 class="text-xl font-bold mb-4">Coming Soon...</h2>
        <p>This feature will be available soon. Stay tuned!</p>
        <div class="flex justify-end mt-4">
            <button id="closeComingSoonModal" class="bg-gray-500 text-white p-2 rounded-lg">Close</button>
        </div>
    </div>
</div>




<!-- Filter Modal -->
<div id="filterModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg w-1/3">
        <h2 class="text-xl font-bold mb-4">Select Filter Option</h2>
        
        <!-- Filter options -->
        <div>
            <input type="radio" id="today" name="filter" value="today">
            <label for="today" class="ml-2">Today</label>
        </div>
        <div>
            <input type="radio" id="yesterday" name="filter" value="yesterday">
            <label for="yesterday" class="ml-2">Yesterday</label>
        </div>
        <div>
            <input type="radio" id="last_week" name="filter" value="last_week">
            <label for="last_week" class="ml-2">Last Week</label>
        </div>
        <div>
            <input type="radio" id="last_month" name="filter" value="last_month">
            <label for="last_month" class="ml-2">Last Month</label>
        </div>
        <div>
            <input type="radio" id="specific_date" name="filter" value="specific_date">
            <label for="specific_date" class="ml-2">Specific Date</label>
            <input type="date" id="specificDate" class="ml-2 mt-2" style="display:none;">
        </div>

        <!-- Buttons -->
        <div class="flex justify-end mt-4">
            <button id="applyFilter" class="bg-blue-500 text-white p-2 rounded-lg">Apply</button>
            <button id="closeFilterModal" class="bg-gray-500 text-white p-2 ml-2 rounded-lg">Cancel</button>
        </div>
    </div>
</div>



<!-- Delete Messages Modal -->
<div id="deleteMessagesModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg w-1/3">
        <h2 class="text-xl font-bold text-red-500 mb-4">Delete All My Messages</h2>
        <p class="text-gray-700 mb-4">
            Please enter your password to confirm. This action cannot be undone.
        </p>
        <input 
            type="password" 
            id="passwordInput" 
            class="border p-2 w-full mb-4 rounded-lg" 
            placeholder="Enter your password"
        >
        <div class="flex justify-end">
            <button id="confirmDeleteButton" class="bg-red-500 text-white px-4 py-2 rounded-lg mr-2">
                Confirm
            </button>
            <button id="cancelDeleteButton" class="bg-gray-500 text-white px-4 py-2 rounded-lg">
                Cancel
            </button>
        </div>
    </div>
</div>



<!-- Edit Message Modal -->
<div class="modal fade" id="editMessageModal" tabindex="-1" aria-labelledby="editMessageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editMessageModalLabel">Edit Message</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <textarea id="editMessageContent" class="form-control" rows="4"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveEditButton">Save changes</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal for editing link -->
<div class="modal fade" id="editLinkModal" tabindex="-1" aria-labelledby="editLinkModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editLinkModalLabel">Edit Link</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editLinkForm">
                    <div class="mb-3">
                        <label for="editLinkText" class="form-label">Link Text</label>
                        <input type="text" class="form-control" id="editLinkText" required>
                    </div>
                    <div class="mb-3">
                        <label for="editLinkUrl" class="form-label">Link URL</label>
                        <input type="url" class="form-control" id="editLinkUrl" required>
                    </div>
                    <button type="button" id="saveEditLinkButton" class="btn btn-primary">Save Changes</button>
                </form>
            </div>
        </div>
    </div>
</div>



<!-- Modal for channel stats -->
<div 
    class="modal fade" 
    id="statsModal" 
    tabindex="-1" 
    aria-labelledby="statsModalLabel" 
    aria-hidden="true"
>
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="statsModalLabel">Memory usage of your messages links & media</h5>
                <button 
                    type="button" 
                    class="btn-close" 
                    data-bs-dismiss="modal" 
                    aria-label="Close"
                ></button>
            </div>
            <div class="modal-body">
                <canvas id="chartContainer" height="200"></canvas>
            </div>
        </div>
    </div>
</div>


<!-- Filter by User Modal -->
<div
    class="modal fade"
    id="filterByUserModal"
    tabindex="-1"
    aria-labelledby="filterByUserModalLabel"
    aria-hidden="true"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="filterByUserModalLabel">Filter by User</h5>
                <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                ></button>
            </div>
            <div class="modal-body">
                <ul id="userListt" class="list-group">
                    <!-- Users will be dynamically added here -->
                </ul>
            </div>
        </div>
    </div>
</div>


<!-- Modal 1: Select Data to Delete -->
<!-- Modal 1: Select Data to Delete -->
<div id="deleteChannelDataModal" class="modal fade" tabindex="-1" aria-labelledby="deleteChannelDataModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteChannelDataModalLabel">Select Data to Delete</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="deleteChannelDataForm">
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="deleteMessagesOption">
              <label class="form-check-label" for="deleteMessagesOption">Messages</label>
            </div>
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="deleteLinksOption">
              <label class="form-check-label" for="deleteLinksOption">Links</label>
            </div>
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="deleteAudioOption">
              <label class="form-check-label" for="deleteAudioOption">Audio</label>
            </div>
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="deleteVideoOption">
              <label class="form-check-label" for="deleteVideoOption">Video</label>
            </div>
            <div class="form-check">
              <input type="checkbox" class="form-check-input" id="deleteActivityLogsOption">
              <label class="form-check-label" for="deleteActivityLogsOption">Activity Logs</label>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="nextToPasswordModalBtn">Next</button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Modal 2: Enter Password -->
  <div id="deleteChannelPasswordModal" class="modal fade" tabindex="-1" aria-labelledby="deleteChannelPasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deleteChannelPasswordModalLabel">Enter Your Password</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="deleteChannelPasswordForm">
            <div class="mb-3">
              <label for="channelPasswordInput" class="form-label">Password</label>
              <input type="password" class="form-control" id="channelPasswordInput" placeholder="Enter your password" required>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="submitChannelPasswordBtn">Submit</button>
        </div>
      </div>
    </div>
  </div>




  <!-- Bootstrap Modal to display network stats-->
   <!-- Modal -->
<div class="modal fade" id="networkStatusModal" tabindex="-1" aria-labelledby="networkStatusModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="networkStatusModalLabel">Complete Network Status</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="networkStatus">
            <!-- General Information -->
            <p id="connectionType"></p>
            <p id="connectionStatus"></p>
            <p id="networkProvider"></p>
  
            <!-- Signal Strength (Progress Bar) -->
            <div>
              <strong>Signal Strength</strong>
              <div class="progress">
                <div id="signalStrengthBar" class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
              </div>
              <p id="signalStrengthText"></p>
            </div>
  
            <!-- Speed (Line Chart) -->
            <canvas id="networkSpeedChart" height="150"></canvas>
  
            <!-- Latency, Jitter, Packet Loss (Progress Bars and Text) -->
            <div>
              <strong>Ping: <span id="pingValue"></span> ms</strong>
              <br>
              <strong>Jitter: <span id="jitterValue"></span> ms</strong>
              <br>
              <strong>Packet Loss: <span id="packetLoss"></span>%</strong>
            </div>
  
            <!-- Network Load (Bar Chart) -->
            <div>
              <canvas id="networkLoadChart" height="100"></canvas>
            </div>
  
            <!-- Bandwidth Usage (Pie Chart) -->
            <div>
              <strong>Bandwidth Usage</strong>
              <canvas id="bandwidthUsageChart" height="150"></canvas>
            </div>
  
            <!-- Server Response Time -->
            <div>
              <strong>Server Response Time</strong>
              <canvas id="serverResponseChart" height="100"></canvas>
            </div>
  
            <!-- Activity Log (List) -->
            <ul id="activityLog" class="list-group mt-3"></ul>
  
            <!-- Diagnostic Suggestions -->
            <div id="diagnosticSuggestions"></div>
  
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- User Selection Modal -->
   <!-- User Selection Modal -->
<div class="modal fade" id="userSelectionModal" tabindex="-1" aria-labelledby="userSelectionModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userSelectionModalLabel">Select a User to Ban</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul id="userListtt" class="list-group">
                    <!-- Users will be populated here dynamically -->
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Custom Ban Details Modal -->
<div id="customBanModal" class="custom-modal hidden">
    <div class="custom-modal-content">
        <span id="closeCustomBanModal" class="custom-close">&times;</span>
        <h5 id="customBanModalLabel">Set Ban Duration and Reason</h5>
        <!-- Ban Duration Choices -->
        <div class="mb-3">
            <label for="customBanDuration" class="form-label">Select Ban Duration</label>
            <select class="form-select" id="customBanDuration">
                <option value="1 day">1 Day</option>
                <option value="1 week">1 Week</option>
                <option value="1 month">1 Month</option>
                <option value="permanent">Permanent</option>
            </select>
        </div>
        <!-- Reason Input -->
        <div class="mb-3">
            <label for="customBanReason" class="form-label">Reason for Ban</label>
            <textarea class="form-control" id="customBanReason" rows="3"></textarea>
        </div>
        <button type="button" id="customSubmitBan" class="btn btn-primary">Ban User</button>
    </div>
</div>


<!-- Modal to share access of this channel -->
<div class="modal fade" id="shareModal" tabindex="-1" aria-labelledby="shareModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="shareModalLabel">Select Organization to Share With</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Loading Spinner -->
          <div id="loadingSpinner" class="text-center" style="display:none;">
            <div class="spinner-border" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
          </div>
  
          <!-- Organizations List -->
          <div class="alert alert-info text-center fw-semibold fs-6 mt-3" role="alert">
            Channel access can only be shared with organizations you own and manage.
        </div>
        
        
          <ul id="organizationList" class="list-group">
            <!-- List of organizations will be injected here -->
          </ul>
  
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" id="grantAccessBtn" class="btn btn-primary" disabled>Grant Access</button>
        </div>
      </div>
    </div>
  </div>



  <!-- Set retention policy -->

  <!-- Modal -->
<div class="modal fade" id="retentionPolicyModal" tabindex="-1" aria-labelledby="retentionPolicyModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="retentionPolicyModalLabel">Set Retention Policy</h5>
          <p class="text-muted small">The retention policy helps keep your channel cleaner and more organized.</p>

          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="retentionForm">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="retentionPeriod" id="retention30" value="30">
              <label class="form-check-label" for="retention30">
                30 Days
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="retentionPeriod" id="retention45" value="45">
              <label class="form-check-label" for="retention45">
                45 Days
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="retentionPeriod" id="retention90" value="90">
              <label class="form-check-label" for="retention90">
                90 Days (3 Months)
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="retentionPeriod" id="retention180" value="180">
              <label class="form-check-label" for="retention180">
                180 Days (6 Months)
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="retentionPeriod" id="retention365" value="365">
              <label class="form-check-label" for="retention365">
                365 Days (1 Year)
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="retentionPeriod" id="customRetention" value="0">
              <label class="form-check-label" for="customRetention">
                Custom Period (Enter Days)
              </label>
              <input type="number" id="customDays" class="form-control mt-2" placeholder="Enter custom days" style="display: none;">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="saveRetentionPolicy">Save Policy</button>
        </div>
      </div>
    </div>
  </div>

  
  <!-- Set message as recurring -->


<!-- Recurrence Modal -->
<div id="recurrenceModal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex justify-center items-center">
    <div class="bg-white rounded-lg shadow-lg w-1/3 p-6">
        <h2 class="text-xl font-semibold mb-4">Set Recurrence Details</h2>
        
        <!-- Recurrence Form -->
        <form id="recurrenceForm">
            <div class="mb-4">
                <label class="block font-medium mb-2">Recurrence Type</label>
                <select id="recurrenceType" name="recurrence_type" class="border border-gray-300 rounded w-full p-2">
                    <option value="daily">Daily</option>
                    <option value="weekly">Weekly</option>
                    <option value="monthly">Monthly</option>
                    <option value="yearly">Yearly</option>
                    <option value="custom">Custom</option>
                </select>
            </div>
            <div class="mb-4" id="recurrenceDaysContainer" style="display: none;">
                <label class="block font-medium mb-2">Select Days (For Weekly/Custom)</label>
                <div class="flex flex-wrap gap-2">
                    <label><input type="checkbox" name="recurrence_days" value="Monday"> Monday</label>
                    <label><input type="checkbox" name="recurrence_days" value="Tuesday"> Tuesday</label>
                    <label><input type="checkbox" name="recurrence_days" value="Wednesday"> Wednesday</label>
                    <label><input type="checkbox" name="recurrence_days" value="Thursday"> Thursday</label>
                    <label><input type="checkbox" name="recurrence_days" value="Friday"> Friday</label>
                    <label><input type="checkbox" name="recurrence_days" value="Saturday"> Saturday</label>
                    <label><input type="checkbox" name="recurrence_days" value="Sunday"> Sunday</label>
                </div>
            </div>
            <div class="mb-4">
                <label class="block font-medium mb-2">End Date (Optional)</label>
                <input type="date" id="endDate" name="end_date" class="border border-gray-300 rounded w-full p-2">
            </div>
            <div class="flex justify-end gap-2">
                <button type="button" id="closeModalButton" class="bg-gray-500 text-white px-4 py-2 rounded">Cancel</button>
                <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded">Save</button>
            </div>
        </form>
    </div>
</div>


<!-- Monitor recurrence messages  -->
 <!-- Recurrence Monitor Modal -->
<div class="modal fade" id="recurrenceMonitorModal" tabindex="-1" aria-labelledby="recurrenceMonitorModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="recurrenceMonitorModalLabel">Monitor Recurring Messages</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h5>Pending Messages</h5>
          <table class="table table-bordered" id="pendingMessagesTable">
            <thead>
              <tr>
                <th>Message Text</th>
                <th>Start Date</th>
                <th>End Date</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
  
          <h5>Sent Messages</h5>
          <table class="table table-bordered" id="sentMessagesTable">
            <thead>
              <tr>
                <th>Message Text</th>
                <th>Sent At</th>
                <th>Status</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
</div>


<!-- Warn Modal -->
 <!-- Modal -->
<div class="modal fade" id="warnModal" tabindex="-1" aria-labelledby="warnModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="warnModalLabel">Flagged Messages</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                <!-- Table to display flagged messages -->
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Message Content</th>
                            <th>Flagged By</th>
                            <th>Flagged At</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="flaggedMessagesTable">
                        <!-- Flagged messages will be dynamically added here -->
                    </tbody>
                </table>

                <!-- Spinner and loading text (hidden initially) -->
                <div id="loadingSpinner" class="text-center" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p>Warning the user, please hold...</p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>



<!-- Manage Events Modal -->
 <!-- Modal Structure -->
<div class="modal fade" id="EventHandleModal" tabindex="-1" aria-labelledby="EventHandleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="EventHandleModalLabel">Manage Events</h5>
                <div class="container">
                    <div class="card p-3 border-0 shadow-sm">
                        <h5 class="card-title fs-5">Company Handbook</h5>
                        <p class="card-text text-muted fs-6">
                            A place to reference company-wide announcements, upcoming events, and helpful resources. use @ to mention your team-mates.
                        </p>
                    </div>
                </div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <table class="table table-bordered" id="eventsTable">
                    <thead>
                        <tr>
                            <th>Event Name</th>
                            <th>Date/Time</th>
                            <th>Event Details</th>
                            <th>Event Link</th>
                            <th>Attachment</th> 
                        </tr>
                    </thead>
                    <tbody id="eventsTableBody">
                        <!-- Initial rows that can be filled by the admin -->
                        <tr>
                            <td contenteditable="true" class="event-name"></td>
                            <td contenteditable="true" class="event-date"></td>
                            <td contenteditable="true" class="event-details"></td>
                            <td contenteditable="true" class="event-link"></td>
                            <td class="attachment-column" data-bs-toggle="modal" data-bs-target="#attachmentModal">Add Attachment</td>
                        </tr>
                        <tr>
                            <td contenteditable="true" class="event-name"></td>
                            <td contenteditable="true" class="event-date"></td>
                            <td contenteditable="true" class="event-details"></td>
                            <td contenteditable="true" class="event-link"></td>
                            <td class="attachment-column" data-bs-toggle="modal" data-bs-target="#attachmentModal">Add Attachment</td>
                        </tr>
                        <tr>
                            <td contenteditable="true" class="event-name"></td>
                            <td contenteditable="true" class="event-date"></td>
                            <td contenteditable="true" class="event-details"></td>
                            <td contenteditable="true" class="event-link"></td>
                            <td class="attachment-column" data-bs-toggle="modal" data-bs-target="#attachmentModal">Add Attachment</td>
                        </tr>
                    </tbody>
                </table>
                <button type="button" class="btn btn-success" id="addRow">+ Add Row</button>
            </div>
        </div>
    </div>
</div>


<!-- Attachment Modal -->
<div class="modal fade" id="attachmentModal" tabindex="-1" aria-labelledby="attachmentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="attachmentModalLabel">Upload Attachment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="attachmentForm" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="fileInput" class="form-label">Choose File</label>
                        <input type="file" class="form-control" id="fileInput" name="attachment">
                    </div>
                    <button type="submit" class="btn btn-primary">Upload</button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Modal to display events details -->
<!-- Modal -->
<div class="modal fade" id="eventDetailsModalPremium" tabindex="-1" aria-labelledby="eventDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg"> <!-- modal-lg for larger size -->
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="eventDetailsModalLabel">Event Details</h5>
          <div>
            <strong>
                2025 milestones/Company-wide announcements
            </strong>
          </div>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <table id="eventDetailsTable" class="table table-bordered">
              <thead>
                  <tr>
                      <th>Event Name</th>
                      <th>Event Date/Time</th>
                      <th>Event Details</th>
                      <th>Event Attachment</th>
                      <th>Event Link</th>
                      <th>Created By</th>
                      <th>Action</th> <!-- New column for the button -->
                  </tr>
              </thead>
              <tbody>
                  <!-- Table rows will be dynamically filled with event data -->
              </tbody>
          </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
</div>


<!-- CHANNEL SETTINGS MODAL -->
<!-- Modal -->
<div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="settingsModalLabel">Channel Settings</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="settingsForm">
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="allowMediaUploads">
                        <label class="form-check-label" for="allowMediaUploads">Allow Media Uploads</label>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="allowCodes">
                        <label class="form-check-label" for="allowCodes">Allow Codes</label>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="secureFromUnwantedRequests">
                        <label class="form-check-label" for="secureFromUnwantedRequests">Secure from Unwanted Requests</label>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="allowPolls">
                        <label class="form-check-label" for="allowPolls">Allow Polls</label>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="allowSharingAccess">
                        <label class="form-check-label" for="allowSharingAccess">Allow Sharing Access to Another Workspace</label>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="trackAbusiveMessages">
                        <label class="form-check-label" for="trackAbusiveMessages">Track Abusive Messages</label>
                    </div>
                    <div class="mb-3 form-check">
                        <input type="checkbox" class="form-check-input" id="allowIntegrations">
                        <label class="form-check-label" for="allowIntegrations">Allow Integrations</label>
                    </div>
                    <div class="mb-3">
                        <label for="integrationChoices" class="form-label">Integration Choices</label>
                        <select class="form-select" id="integrationChoices">
                            <option value="Slack">Slack</option>
                            <option value="Trello">Trello</option>
                            <option value="Calendly">Calendly</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>





  <!-- Include Bootstrap 5 JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
  

<!-- ---------------------------------------------------------------------------------------------------------------------------------------------------------- -->


<br><br>
<!-- -------------------------------------------------------------------------------------------------------------------------------------------------------- -->


<!-- sidebar --------------------------------------------------------------------------------------------------------------------------------------- -->
<div class="sidebar">
    <div class="sidebar-header">
        <h2># {{channel.name}}</h2>
    </div>
    
    <div class="sidebar-menu">
        <!-- Button to trigger the modal -->
<button id="fetchEventDetailsBtn" class="menu-item" data-org-id="{{ channel.organization.id }}" data-channel-id="{{ channel.id }}" data-bs-toggle="modal" data-bs-target="#eventDetailsModalPremium">
    <i class="fas fa-database"></i>
    {{channel.organization.name}} Handbook Info
</button>

       
<div id="screenShareContainer">
    <!-- Local video stream -->
    <video id="localVideo" autoplay muted></video>

    <!-- Remote video streams -->
    <div id="remoteVideos"></div>
</div>





        



<button class="menu-item"><i class="fas fa-plug"></i></i>Integrate Slack & Other Tools for This Channel</button>
<!-- Button to open Recurring Messages Modal -->

<button id="monitor-recurring-messages-btn" class="menu-item">
    <i class="fas fa-random"></i>

    Track Recurring Messages</button>


        <!-- Button to trigger fetching logs -->
        <button id="fetchLogsButton" class="menu-item"><i class="fas fa-history"></i> Access Channel Activity</button>
        
        <!-- Button to open the user list modal -->
        <button id="userListButton" class="menu-item"><i class="fas fa-users"></i> Browse Users</button>

        <!-- VIEW CHANNEL DETAILS -->
        <button id="viewChannelDetailsButton" class="menu-item"><i class="fas fa-info-circle"></i> Channel Info</button>

        <!-- Export Data Link -->
        <a href="{% url 'export_data' org_id=channel.organization.id channel_id=channel.id %}" 
           class="menu-item" id="exportDataButton"><i class="fas fa-download"></i> Export Files</a>

        <!-- Button to Trigger the Modal -->
        <button type="button" class="menu-item" data-bs-toggle="modal" data-bs-target="#statisticsModal">
            <i class="fas fa-chart-line"></i> Check Channel Metrics
        </button>

        
        <button id="filterButton" class="menu-item" data-bs-toggle="modal" data-bs-target="">
            <i class="fas fa-location-arrow"></i>
            Navigate To
        </button>

        <button id="filterButton" class="menu-item" data-bs-toggle="modal" data-bs-target="">
            <i class="fas fa-building"></i>
                    <a href="{% url 'org_detail' org_id=channel.organization.id%}">
                {{channel.organization.name}}
            </a>
        </button>

        <button id="filterButton" class="menu-item" data-bs-toggle="modal" data-bs-target="">
            <i class="fas fa-sync"></i>
                    <a href="{% url 'channel_chat' channel_id=channel.id%}">
                        Sync
            </a>
        </button>

        <!-- Delete All My Messages Button -->
      <button id="deleteMessagesButton" class="menu-item" data-bs-toggle="modal" data-bs-target="">
         <i class="fas fa-trash-alt"></i> Wipe My Messages
      </button>

      <!-- Button to Trigger Modal -->
<!-- Button to Trigger Modal -->
<button 
    id="showStatsButton" 
    class="menu-item"
    data-bs-toggle="modal" 
    data-bs-target="#statsModal"
>
<i class="fas fa-database"></i>
Monitor My Storage
</button>


{% if channel.created_by == request.user %}

<!-- Delete Data Button -->
   <button id="deleteChannelDataBtn" class="menu-item" data-bs-toggle="modal" data-bs-target="">
    <i class="fas fa-times-circle"></i>
    Clear All Channel Data</button>

    <!-- First Modal: User Selection -->
    <button class="menu-item" data-bs-toggle="modal" data-bs-target="#userSelectionModal">
        <i class="fas fa-ban"></i>
        Restrict User</button>

    <!-- Set retention policy -->
<button type="button" class="menu-item" data-bs-toggle="modal" data-bs-target="#retentionPolicyModal">
    <i class="fas fa-shield-alt"></i>
    Configure Retention Settings
  </button>    


  <!-- Button to trigger the modal warn modal -->
<button type="button" class="menu-item" data-bs-toggle="modal" data-bs-target="#warnModal">
    <i class="fas fa-flag"></i>
    flagged texts & warn
</button>

<!-- Manage events -->
<button type="button" class="menu-item" data-bs-toggle="modal" data-bs-target="#EventHandleModal">
    <i class="fas fa-building"></i>
    Company Handbook
</button>

<!-- Button to open modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#settingsModal">
    Open Channel Settings
</button>



       <!-- Button to Open Modal -->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#shareModal">
    Grant Channel Access to Another Organization
  </button>
   


{% endif %}


</div>
    
    <div class="sidebar-footer">
        <button class="menu-item"><i class="fas fa-cogs"></i> Settings</button>
        <button class="menu-item"><i class="fas fa-plug"></i></i>Integrate Slack & Other Tools for This Channel</button>
    </div>
</div>


<!-- ------------------------------------------------------------------------------------------------- -->

<body class="bg-gray-100">
    
    <div class="max-w-4xl mx-auto mt-10">
        <div class="mb-4">
            <input 
                type="text" 
                id="searchInput" 
                placeholder="🔍 Search messages and links..." 
                class="form-control form-control-lg w-full p-2 text-gray-700 bg-gray-100 border border-gray-300 rounded-lg shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
            />
        </div>
<!-- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  -->
<div id="chatWindow" class="bg-gradient-to-br from-gray-100 to-white p-4 rounded-xl shadow-2xl mb-4 max-h-[590px] overflow-y-auto border border-gray-300 w-full max-w-4xl">

{% if messages %}

             <!-- Loop through messages and display them -->
             {% for message in messages %}
            
             <div class="flex items-center border-b border-gray-200 py-3 hover:bg-gray-50 rounded-lg px-2 transition duration-200 relative 
                 {% if message.is_pinned %} bg-yellow-100 border-yellow-400 {% endif %}">
                 <!-- User avatar -->
                 <div class="w-10 h-10 flex-shrink-0 bg-gradient-to-tr from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">
                     {{ message.user.username|slice:":1" }}
                 </div>
                 <!-- Message content -->
                 <div class="flex flex-col w-full">
                     <!-- Parent message display -->
                     {% if message.parent %}
                     <div class="text-sm italic text-gray-500 border-l-4 border-gray-300 pl-3 mb-2">
                         Replied to: <span class="text-gray-800">{{ message.parent.user.username }}</span> - "{{ message.parent.content }}" 
                     </div> 
                     {% endif %}

                     <!-- Current message -->
                     <span class="font-semibold text-purple-600">{{ message.user.username }}</span>
                     <span class="text-gray-700">
                         {% if message.link %}
                             <a href="{{ message.link }}" target="_blank" class="text-blue-500 hover:underline font-medium">
                                 {{ message.link }}
                             </a>
                         {% else %}
                         <div style="font-family: 'Montserrat', sans-serif;" class="font-weight-bold">
                            {{ message.content }}
                        </div>
                         {% endif %}
                     </span>
                     <span class="text-xs text-gray-500 mt-1 self-end">{{ message.timestamp|date:"H:i" }}</span>
                     <br>

                  
                 </div>
       
    <!-- Star/Unstar icon -->
<div class="absolute right-2 top-2">
    <button class="star-icon text-yellow-500 text-xl {% if message.is_starred %}filled{% endif %}" 
            data-message-id="{{ message.id }}" 
            data-org-id="{{ channel.organization.id }}" 
            data-channel-id="{{ channel.id }}">
        ★
    </button>
    <span class="star-status text-xs {% if message.is_starred %}starred{% else %}unstarred{% endif %}">
        {% if message.is_starred %} Starred {% else %} Unstarred {% endif %}
    </span>
</div>  
<br><br>                                  
 <!-- Reply Button -->
 <div class="absolute right-2 bottom-2">
    <button class="reply-btn text-sm text-blue-500 hover:underline" 
            data-message-id="{{ message.id }}" 
            data-org-id="{{ channel.organization.id }}" 
            data-channel-id="{{ channel.id }}">
        Reply
    </button>
</div>       


        <!-- 3-dot menu -->
        {% if message.user == request.user %}
            <div class="relative">
                <button class="menu-button text-gray-400 hover:text-gray-600 focus:outline-none">
                    &#x22EE;
                </button>
                <div class="menu-options hidden absolute top-6 right-0 bg-white shadow-md rounded-lg text-sm">
                    <!-- Inside the menu options for links -->
                    <form action="{% url 'delete_message' org_id=channel.organization.id channel_id=channel.id message_id=message.id %}" method="POST" class="inline-block">
                        {% csrf_token %}
                        <button type="submit" class="delete-message text-red-500 px-4 py-2 w-full hover:bg-red-50">
                            Delete
                        </button>
                    </form>
                    <!-- edit message button -->
                    <button class="edit-button text-green-500 px-4 py-2 w-full hover:bg-green-50" data-bs-toggle="modal" data-bs-target="#editMessageModal" data-message-id="{{ message.id }}" data-current-content="{{ message.content }}">
                        <i class="fas fa-ellipsis-v"></i> Edit
                    </button>
                    <!-- Pin message -->
                    <button onclick="togglePinMessage({{ message.organization.id }}, {{ message.channel.id }}, {{ message.id }})" class="edit-button text-green-500 px-4 py-2 w-full hover:bg-green-50">
                        {% if message.is_pinned %}
                            Unpin
                        {% else %}
                            Pin
                        {% endif %}
                    </button>
                    <!-- recurring message -->

                    <!-- Updated Button with Data Attributes -->

         <button id="setRecurringButton" 
            class="edt-button text-green-500 px-4 py-2 w-full hover:bg-green-50" 
            data-message-id="{{ message.id }}" 
            data-org-id="{{ channel.organization.id }}" 
            data-channel-id="{{ channel.id }}">
            Set as Recurring
        </button>

                </div>
            </div>
        {% endif %}
    </div>
{% endfor %}
            <!-- Loop through links and display them -->
            {% for link in links %}
                <div class="flex items-center border-b border-gray-200 py-3 hover:bg-gray-50 rounded-lg px-2 transition duration-200 relative">
                    <!-- User avatar placeholder -->
                    <div class="w-10 h-10 flex-shrink-0 bg-gradient-to-tr from-blue-500 to-green-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">
                        {{ link.user.username|slice:":1" }}
                    </div>
                    <!-- Link content -->
                    <div class="flex flex-col w-full">
                        <span class="font-semibold text-green-600">{{ link.user.username }}</span>
                        <span>
                            <a href="{{ link.link }}" target="_blank" class="text-blue-600 hover:underline font-medium">
                                {{ link.text }}
                            </a>
                        </span>
                        <span class="text-xs text-gray-500 mt-1 self-end">{{ link.timestamp|date:"H:i" }}</span>
                    </div>
                    <!-- 3-dot menu -->
                    {% if link.user == request.user %}
                        <div class="relative">
                            <button class="menu-button text-gray-400 hover:text-gray-600 focus:outline-none">
                                &#x22EE;
                            </button>
                            <div class="menu-options hidden absolute top-6 right-0 bg-white shadow-md rounded-lg text-sm">
                                <!-- Inside the menu options for links -->
                                <form action="{% url 'delete_link' org_id=channel.organization.id channel_id=channel.id link_id=link.id %}" method="POST" class="inline-block">
                                    {% csrf_token %}
                                    <button type="submit" class="delete-message text-red-500 px-4 py-2 w-full hover:bg-red-50">
                                        Delete
                                    </button>
                                </form>

                               
                               <!-- Edit Link Button -->
                               <button class="edit-link-button text-green-500 px-4 py-2 w-full hover:bg-green-50" 
                               data-link-id="{{ link.id }}" 
                               data-current-text="{{ link.text }}" 
                               data-current-link="{{ link.link }}" 
                               type="button" 
                               data-bs-toggle="modal" 
                               data-bs-target="#editLinkModal">
                           Edit Link
                       </button>
                       

                                
                            </div>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
            {% else %}
            <div class="text-center">
                <!-- Image with Bootstrap 5 styling for small size -->
                <img src="https://img.freepik.com/premium-vector/people_845244-11.jpg?w=740" class="img-fluid rounded-circle mb-3" style="max-width: 150px;">
            
                <!-- Welcome text styled with Bootstrap 5 classes -->
                <p class="lead text-muted">Nothing here! Start a fresh conversation and you will be the first to initiate it. Please reload the page after sending your first message.</p>
            </div>
            {% endif %}
                  
        </div>
        
        <!-- ------------------------------------------------------------------------------------------ -->
        <div class="flex items-center space-x-2 bg-gray-100 p-2 rounded-lg">
            <!-- Mention User Icon -->
            <button id="mentionButton" class="p-2 text-yellow-500 hover:text-yellow-600">
                <i class="fas fa-at text-xl"></i>
            </button>
        
            <!-- Message Input -->
            <input id="messageInput" type="text" 
                   class="border border-gray-300 p-2 w-full rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                   placeholder="Type a message...">
        
            <!-- Send Message Icon -->
            <button id="sendMessage" class="p-2 text-blue-500 hover:text-blue-600">
                <i class="fas fa-paper-plane text-xl"></i>
            </button>
        
            <!-- Send Link Icon -->
            <button id="sendLinkButton" class="p-2 text-green-500 hover:text-green-600">
                <i class="fas fa-link text-xl"></i>
            </button>
        
            <!-- Emoji Picker Icon -->
            <button id="emojiPickerButton" class="p-2 text-purple-500 hover:text-purple-600">
                <i class="fas fa-smile text-xl"></i>
            </button>
        
            <!-- Upload Audio Icon -->
            <button id="uploadAudioButton" class="p-2 text-indigo-500 hover:text-indigo-600">
                <i class="fas fa-microphone-alt text-xl"></i>
            </button>
        
            <!-- Upload Video Icon -->
            <button id="uploadVideoButton" class="p-2 text-teal-500 hover:text-teal-600">
                <i class="fas fa-video text-xl"></i>
            </button>


            <!-- Call Icon -->
<button id="callButton" class="p-2 text-green-500 hover:text-green-600">
    <i class="fas fa-phone-alt text-xl"></i>
</button>


<!-- Screen Share Icon -->
<button id="screenShareButton" class="p-2 text-blue-500 hover:text-blue-600">
    <i class="fas fa-plus text-xl"></i>
</button>

<!-- Screen share btn  -->
<button id="shareScreenBtn" onclick="startScreenShare()" class="p-2 text-blue-500 hover:text-blue-600">
    
    <i class="fas fa-desktop text-xl"></i></button>

<!-- Filter by User Button -->
<button
    class=" p-2 text-blue-500 hover:text-blue-600 "
    data-bs-toggle="modal"
    data-bs-target="#filterByUserModal"
>
<i class="fas fa-user text-xl"></i>
</button>


<!-- Trigger Button to display the network stats -->
<button class="p-2 text-blue-500 hover:text-blue-600" data-bs-toggle="modal" data-bs-target="#networkStatusModal" onclick="displayNetworkStatus()"><i class="fas fa-wifi text-xl"></i>

</button>
<!-- New 
  -->

<button class="p-2 text-blue-500 hover:text-blue-600" data-bs-toggle="modal" data-bs-target="">
    <i class="fab fa-slack text-xl"></i>

</button>



<button class="p-2 text-blue-500 hover:text-blue-600" data-bs-toggle="modal" data-bs-target="">
    <i class="fas fa-tasks text-xl"></i>

</button>


<button class="p-2 text-blue-500 hover:text-blue-600" data-bs-toggle="modal" data-bs-target="">
    <i class="fas fa-poll text-xl"></i>


</button>


<button class="p-2 text-blue-500 hover:text-blue-600" data-bs-toggle="modal" data-bs-target="">
    <i class="fas fa-code text-xl"></i>
</button>


</div>



       

        

        <!-- Modal to mention users -->
        <div id="mentionModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg w-1/3">
                <h2 class="text-xl font-bold mb-4">Mention a User</h2>
                <ul id="mentionList" class="space-y-2">
                    <!-- List of users will be populated here -->
                </ul>
                <div class="flex justify-end">
                    <button id="closeMentionModal" class="bg-gray-500 text-white p-2 rounded-lg">Close</button>
                </div>
            </div>
        </div>

        <!-- Modal to send link -->
        <div id="sendLinkModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg w-1/3">
                <h2 class="text-xl font-bold mb-4">Send a Link</h2>
                <input id="linkText" type="text" class="border p-2 w-full mb-4" placeholder="Link Text">
                <input id="linkUrl" type="url" class="border p-2 w-full mb-4" placeholder="URL">
                <div class="flex justify-end">
                    <button id="sendLink" class="bg-blue-500 text-white p-2 rounded-lg">Send Link</button>
                    <button id="closeLinkModal" class="bg-gray-500 text-white p-2 ml-2 rounded-lg">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Emoji Picker Modal -->
        <div id="emojiPickerModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg w-1/3 max-h-[80vh] overflow-y-auto">
                <h2 class="text-xl font-bold mb-4">Pick an Emoji</h2>
                <div id="emojiContainer" class="grid grid-cols-6 gap-2 max-h-[60vh] overflow-y-auto">
                    <!-- Emoji options will be populated here -->
                </div>
                <div class="flex justify-end mt-4">
                    <button id="closeEmojiPickerModal" class="bg-gray-500 text-white p-2 rounded-lg hover:bg-gray-600">Close</button>
                </div>
            </div>
        </div>

        <!-- Audio Upload Modal -->
        <div id="audioUploadModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg w-1/3">
                <h2 class="text-xl font-bold mb-4">Upload Audio</h2>
                <input type="file" id="audioFileInput" class="border p-2 w-full mb-4" accept="audio/*">
                <div class="flex justify-end">
                    <button id="uploadAudio" class="bg-blue-500 text-white p-2 rounded-lg">Upload</button>
                    <button id="closeAudioModal" class="bg-gray-500 text-white p-2 ml-2 rounded-lg">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Video Upload Modal -->
        <div id="videoUploadModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg w-1/3">
                <h2 class="text-xl font-bold mb-4">Upload Video</h2>
                <input type="file" id="videoFileInput" class="border p-2 w-full mb-4" accept="video/*">
                <div class="flex justify-end">
                    <button id="uploadVideo" class="bg-blue-500 text-white p-2 rounded-lg">Upload</button>
                    <button id="closeVideoModal" class="bg-gray-500 text-white p-2 ml-2 rounded-lg">Cancel</button>
                </div>
            </div>
        </div>

    </div>
<!-- ----------------------------------------------------------------------------------------------------------------------------------------------- -->
    <script>
     































































        // -----------------------------------------------------------------------------------------
      
        const channelId = "{{ channel.id }}";
        const chatSocket = new WebSocket(`ws://${window.location.host}/ws/channel/${channelId}/`);

        // Video element to display the shared screen
        const screenShareVideo = document.getElementById('screen-share-video');


        const username = "{{ user.username }}"; // Get the current username from the template.

       // Screen sharing variables
let localStream;
let peerConnections = {};
let typingTimeout;

// WebRTC Configuration
const configuration = { iceServers: [{ urls: 'stun:stun.l.google.com:19302' }] };

// Initialize a Peer Connection if not already present
function getOrCreatePeerConnection(userId) {
    if (!peerConnections[userId]) {
        const peerConnection = new RTCPeerConnection(configuration);

        // Handle incoming tracks
        peerConnection.ontrack = event => {
            const remoteVideo = document.getElementById(`remoteScreen_${userId}`) || document.createElement('video');
            if (!remoteVideo.id) {
                remoteVideo.id = `remoteScreen_${userId}`;
                remoteVideo.autoplay = true;
                remoteVideo.controls = true; // Optional for user control
                document.getElementById('remoteVideos').appendChild(remoteVideo);
            }
            if (event.track.kind === 'video') remoteVideo.srcObject = event.streams[0];
        };

        // Handle disconnection or error cleanup
        peerConnection.oniceconnectionstatechange = () => {
            if (peerConnection.iceConnectionState === 'disconnected' || peerConnection.iceConnectionState === 'failed') {
                removeRemoteScreen(userId);
                delete peerConnections[userId];
            }
        };

        peerConnections[userId] = peerConnection;
    }
    return peerConnections[userId];
}

// Start screen sharing
async function startScreenShare() {
    try {
        localStream = await navigator.mediaDevices.getDisplayMedia({ video: { mediaSource: "screen" } });
        document.getElementById('localVideo').srcObject = localStream;

        // Show the screen share container
        const screenShareContainer = document.getElementById('screenShareContainer');
        screenShareContainer.style.display = 'block';

        document.getElementById('shareScreenBtn').style.display = 'none';
        document.getElementById('stopShareBtn').style.display = 'block';

        const videoTrack = localStream.getVideoTracks()[0];
        Object.keys(peerConnections).forEach(peerId => {
            const sender = peerConnections[peerId].getSenders().find(s => s.track.kind === "video");
            if (sender) sender.replaceTrack(videoTrack);
        });

        socket.send(JSON.stringify({ type: 'screen-share-start', user_id: userId }));
    } catch (error) {
        console.error('Error starting screen share:', error);
    }
}

// Stop screen sharing
function stopScreenShare() {
    if (localStream) {
        localStream.getTracks().forEach(track => track.stop());
        document.getElementById('localVideo').srcObject = null;

        // Hide the screen share container
        const screenShareContainer = document.getElementById('screenShareContainer');
        screenShareContainer.style.display = 'none';

        document.getElementById('shareScreenBtn').style.display = 'block';
        document.getElementById('stopShareBtn').style.display = 'none';

        socket.send(JSON.stringify({ type: 'screen-share-stop', user_id: userId }));
    }
}

// Display remote screen
function displayRemoteScreen(userId) {
    const peerConnection = getOrCreatePeerConnection(userId);
    // Ensure signaling or offer-answer mechanism is established
    if (!peerConnection.currentRemoteDescription) {
        console.warn(`No remote description for ${userId}. Ensure proper signaling.`);
    }
}

// Remove remote screen
function removeRemoteScreen(userId) {
    const remoteVideo = document.getElementById(`remoteScreen_${userId}`);
    if (remoteVideo) remoteVideo.remove();
    if (peerConnections[userId]) {
        peerConnections[userId].close();
        delete peerConnections[userId];
    }
}

function makeDraggable(element) {
    let isDragging = false;
    let offsetX, offsetY;

    element.addEventListener('mousedown', (e) => {
        isDragging = true;
        offsetX = e.clientX - element.offsetLeft;
        offsetY = e.clientY - element.offsetTop;
        element.style.cursor = 'grabbing';
    });

    document.addEventListener('mousemove', (e) => {
        if (isDragging) {
            element.style.left = `${e.clientX - offsetX}px`;
            element.style.top = `${e.clientY - offsetY}px`;
        }
    });

    document.addEventListener('mouseup', () => {
        if (isDragging) {
            isDragging = false;
            element.style.cursor = 'grab';
        }
    });

    // Optional: Reset cursor on mouse leave
    element.addEventListener('mouseleave', () => {
        if (isDragging) {
            isDragging = false;
            element.style.cursor = 'grab';
        }
    });
}

// Initialize draggable feature for the screen share container
document.addEventListener('DOMContentLoaded', () => {
    const screenShareContainer = document.getElementById('screenShareContainer');
    makeDraggable(screenShareContainer);
});

// --------------------------------------------------------------------------------------------------
        // When the WebSocket connection is opened
        chatSocket.onopen = function(e) {
            console.log('WebSocket connection established!');
        };

        // When a new message is received from the WebSocket
        chatSocket.onmessage = function (e) {
        const data = JSON.parse(e.data);

    // Handle typing indicator
    if (data['event'] === 'typing') {
        const typingIndicator = document.getElementById('typingIndicator');
        const username = data['username'];

        if (username) {
            // Show the typing indicator with the username
            typingIndicator.textContent = `${username} is typing...`;
            typingIndicator.classList.remove('hidden');
        } else {
            // Hide the typing indicator when no one is typing
            typingIndicator.classList.add('hidden');
        }
        return; // Exit here for typing events, so it doesn't interfere with the rest of the logic
    }

    // Handle new message
    const message = data['message'];
    const username = data['username'];
    const messageElement = document.createElement('div');
    messageElement.className = 'border-b py-2';
    messageElement.innerHTML = `
    <div class="w-10 h-10 flex-shrink-0 bg-gradient-to-tr from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">
        ${username.slice(0, 1)}  <!-- Display first letter of username -->
    </div>
    <div class="flex flex-col w-full">
        <span class="font-semibold text-purple-600">${username}</span>
        <span class="text-gray-700">${message}</span>
        <span class="text-xs text-gray-500 mt-1 self-end">${data['time']}</span>
    </div>
`;


    if (data['link']) {
        messageElement.innerHTML = `
    <div class="w-10 h-10 flex-shrink-0 bg-gradient-to-tr from-blue-500 to-green-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">
        ${username.slice(0, 1)}  <!-- Display first letter of username -->
    </div>
    <div class="flex flex-col w-full">
        <span class="font-semibold text-green-600">${username}</span>
        <span>
            <a href="${data['link']}" target="_blank" class="text-blue-600 hover:underline font-medium">
                ${data['link']}
            </a>
        </span>
        <span class="text-xs text-gray-500 mt-1 self-end">${data['time']}</span>
    </div>
`;


    }

    document.getElementById('chatWindow').appendChild(messageElement);
    document.getElementById('chatWindow').scrollTop = document.getElementById('chatWindow').scrollHeight;
};

        // Emoji Picker Modal Logic
        const emojiPickerButton = document.getElementById('emojiPickerButton');
        const emojiPickerModal = document.getElementById('emojiPickerModal');
        const closeEmojiPickerModal = document.getElementById('closeEmojiPickerModal');

        
// Toggle the emoji picker modal
emojiPickerButton.addEventListener('click', () => {
    emojiPickerModal.classList.add('show');
});

// Close the modal when the close button is clicked
closeEmojiPickerModal.addEventListener('click', () => {
    emojiPickerModal.classList.remove('show');
});
        const emojiContainer = document.getElementById('emojiContainer');
        const emojis = [
  '🚀', '⚡', '💥', '🔥', '🌟', '🏆', '💯', '✅', '📝', '💻', 
  '📱', '📊', '💼', '🔧', '🛠️', '⚙️', '🧠', '💡', '⏳', '⏰', 
  '💪', '🧑‍💻', '👩‍💻', '🤖', '🤩', '👑', '📈', '🔝', '🌍', '🌎', 
  '🌏', '📅', '🗓️', '🕒', '📍', '🗺️', '🌐', '🏅', '🥇', '🏆', 
  '🎯', '💭', '🔮', '🧳', '💪', '🚨', '⚠️', '❗', '❕', '💬', 
  '💭', '💬', '💋', '❤️', '💖', '💙', '💚', '💛', '💜', '🖤',
  '💝', '💘', '💞', '💌', '💋', '👄', '🤍', '💙', '❤️', '💛', 
  '💚', '💜', '💖', '❤️‍🔥', '💀', '☠️', '🫀', '🫣', '🙀', 
  '😳', '😬', '🤭', '🙄', '🤔', '🥲', '😭', '😢', '😤', '😡', 
  '🤡', '🤣', '😂', '😆', '😹', '😂', '🤣', '😏', '🧐', '🫶', 
  '🤪', '🥴', '😋', '🤤', '🤩', '😍', '🥰', '😎', '🤓', '🧑‍🎤',
  '🎤', '🎧', '🎶', '🎸', '🎻', '🥁', '🎷', '🎺', '🎵', '🎼',
  '🎹', '🎶', '🥳', '🎉', '💃', '🕺', '🤸‍♀️', '🤸‍♂️', '🕺',
  '💃', '🩰', '🏋️‍♀️', '🏋️‍♂️', '🤸‍♀️', '🤸‍♂️', '🚴‍♀️', 
  '🚴‍♂️', '⛷️', '🏄‍♀️', '🏄‍♂️', '🤾‍♀️', '🤾‍♂️', '🏃‍♀️', 
  '🏃‍♂️', '💆‍♀️', '💆‍♂️', '💅', '🧑‍🦰', '🧑‍🦳', '🧑‍🦱',
  '💅', '🧖‍♀️', '🧖‍♂️', '🧑‍⚖️', '🎯', '🎳', '🏓', '🏸', 
  '⚽', '🏀', '🏈', '🎾', '🏐', '🏑', '🏒', '🥋', '⛸️', '🏅',
  '🥇', '🥈', '🥉', '🏆', '🎮', '🎮', '🖥️', '🎲', '🎯', '🧩',
  '🎲', '🧠', '💡', '📚', '📖', '📝', '📜', '📄', '📋', '📎',
  '✂️', '📌', '📍', '📅', '📆', '🗓️', '🔖', '🗃️', '📒', 
  '📚', '📑', '📙', '📘', '📗', '📒', '📓', '📂', '📁', '💼', 
  '🧳', '🎒', '💼', '🧸', '👕', '👚', '👗', '👖', '👔', '👚', 
  '👠', '👢', '👡', '👟', '🥿', '👞', '🧢', '👑', '👒', '🎩', 
  '💍', '📿', '💄', '💅', '👓', '🕶️', '👛', '👝', '💼', '🧳', 
  '🎒', '👜', '👝', '👛', '🧣', '🧤', '🧥', '👗', '👚', '🧵', 
  '🧶', '🎨', '🎭', '🎪', '🖼️', '🎬', '🎥', '🎞️', '🎬', '📸', 
  '📷', '📹', '🎥', '🎬', '🎞️', '🎭', '🖼️', '🎤', '🎧', '🎼',
  '🎶', '🎵', '🎻', '🎺', '🎷', '🎸', '🥁', '🎤', '🎬', '🎵',
  '🎶', '🎧', '🎤', '🎼', '🎸', '🥁', '🎻', '🎶', '🎧', '🎷', 
  '🎺', '🎸', '🪕', '🎶', '🎤', '🎬', '🎶', '🎧', '📻', '🎵',
  '🎼', '🎸', '🎹', '🎷', '🥁', '🎼', '🎧', '🎻', '🎤', '🎶',
  '🎸', '🎷', '🎺', '🎻', '🎶', '🎼', '🎤', '🎵', '🎶', '🎹'
];



        emojiPickerButton.onclick = () => {
            emojiContainer.innerHTML = '';
            emojis.forEach(emoji => {
                const button = document.createElement('button');
                button.className = 'text-2xl';
                button.textContent = emoji;
                button.onclick = () => {
                    const messageInput = document.getElementById('messageInput');
                    messageInput.value += emoji;
                    emojiPickerModal.classList.add('hidden');
                };
                emojiContainer.appendChild(button);
            });
            emojiPickerModal.classList.remove('hidden');
        };

        closeEmojiPickerModal.onclick = () => emojiPickerModal.classList.add('hidden');

        // Open the audio upload modal
        document.getElementById('uploadAudioButton').onclick = function() {
            document.getElementById('audioUploadModal').classList.remove('hidden');
        };

        // Close the audio upload modal
        document.getElementById('closeAudioModal').onclick = function() {
            document.getElementById('audioUploadModal').classList.add('hidden');
        };

        // Open the video upload modal
        document.getElementById('uploadVideoButton').onclick = function() {
            document.getElementById('videoUploadModal').classList.remove('hidden');
        };

        // Close the video upload modal
        document.getElementById('closeVideoModal').onclick = function() {
            document.getElementById('videoUploadModal').classList.add('hidden');
        };

        // Handle file uploads (Audio and Video)
        document.getElementById('uploadAudio').onclick = function() {
            const audioFile = document.getElementById('audioFileInput').files[0];
            if (audioFile) {
                // Handle audio file upload here (send to server)
                chatSocket.send(JSON.stringify({'audio': audioFile}));
                document.getElementById('audioUploadModal').classList.add('hidden');
            }
        };

        document.getElementById('uploadVideo').onclick = function() {
            const videoFile = document.getElementById('videoFileInput').files[0];
            if (videoFile) {
                // Handle video file upload here (send to server)
                chatSocket.send(JSON.stringify({'video': videoFile}));
                document.getElementById('videoUploadModal').classList.add('hidden');
            }
        };

        // Send the message when the Send button is clicked
        document.getElementById('sendMessage').onclick = function(e) {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value;
            if (message.trim()) {
                chatSocket.send(JSON.stringify({'message': message}));
                messageInput.value = '';  // Clear the input
            }
        };

        // Allow the Enter key to send the message
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('sendMessage').click();
            }
        });


           // Handle WebSocket connection closing
           chatSocket.onclose = function(e) {
            console.log('WebSocket connection closed.');
        };

        // Send the message when the Send button is clicked
        document.getElementById('sendMessage').onclick = function(e) {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value;
            if (message.trim()) {
                chatSocket.send(JSON.stringify({'message': message}));
                messageInput.value = '';  // Clear the input
            }
        };

        // Allow the Enter key to send the message
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('sendMessage').click();
            }
        });

        // Open the mention modal when the "Mention User" button is clicked
        document.getElementById('mentionButton').onclick = function() {
            // Fetch the members from the organization
            fetch(`/channels/get_organization_members/{{ channel.organization.id }}/`)

                .then(response => response.json())
                .then(data => {
                    const mentionList = document.getElementById('mentionList');
                    mentionList.innerHTML = '';  // Clear existing list
                    data.members.forEach(member => {
                        const listItem = document.createElement('li');
                        listItem.className = 'cursor-pointer text-blue-500 hover:underline';
                        listItem.textContent = member.username;
                        listItem.onclick = function() {
                            const messageInput = document.getElementById('messageInput');
                            messageInput.value += `@${member.username} `; // Append mention to input
                            document.getElementById('mentionModal').classList.add('hidden');
                        };
                        mentionList.appendChild(listItem);
                    });
                    document.getElementById('mentionModal').classList.remove('hidden');
                });
        };

        // Close the mention modal when the "Close" button is clicked
        document.getElementById('closeMentionModal').onclick = function() {
            document.getElementById('mentionModal').classList.add('hidden');
        };

        // Open the send link modal when the "Send Link" button is clicked
        document.getElementById('sendLinkButton').onclick = function() {
            document.getElementById('sendLinkModal').classList.remove('hidden');
        };

        // Close the send link modal when the "Cancel" button is clicked
        document.getElementById('closeLinkModal').onclick = function() {
            document.getElementById('sendLinkModal').classList.add('hidden');
        };

        // Send the link when the "Send Link" button in the modal is clicked
        document.getElementById('sendLink').onclick = function() {
            const linkText = document.getElementById('linkText').value;
            const linkUrl = document.getElementById('linkUrl').value;
            if (linkText.trim() && linkUrl.trim()) {
                chatSocket.send(JSON.stringify({'linkText': linkText, 'linkUrl': linkUrl}));
                document.getElementById('linkText').value = '';  // Clear the link text input
                document.getElementById('linkUrl').value = '';   // Clear the link URL input
                document.getElementById('sendLinkModal').classList.add('hidden');
            }
        };

// -----------------------------------------------------------------------------------------------------------------------------------------------------------------





document.getElementById('userListButton').onclick = function () {
    const orgId = "{{ channel.organization.id }}"; // Organization ID from Django template
    const channelId = "{{ channel.id }}"; // Channel ID from Django template

    // Make an AJAX request to fetch users associated with the channel
    fetch(`/channels/channels/get_members/${orgId}/${channelId}/`)
        .then(response => response.json())
        .then(data => {
            const userList = document.getElementById('userList');
            userList.innerHTML = ''; // Clear existing user list

            if (data.members && data.members.length > 0) {
                // Populate the user list with members
                data.members.forEach(user => {
                    const listItem = document.createElement('li');
                    listItem.className = 'list-group-item cursor-pointer text-primary';
                    listItem.textContent = user.username; // Display the username
                    userList.appendChild(listItem);
                });
            } else {
                // Handle case when no users are found
                const noUsersItem = document.createElement('li');
                noUsersItem.className = 'list-group-item text-danger';
                noUsersItem.textContent = "No users found!";
                userList.appendChild(noUsersItem);
            }

            // Show the modal using Bootstrap 5's modal JavaScript
            const modal = new bootstrap.Modal(document.getElementById('userListModal'));
            modal.show();
        })
        .catch(error => {
            console.error('Error fetching users:', error);
        });
};



// Fetch activity logs

document.getElementById('fetchLogsButton').onclick = function() {
    const channelId = "{{ channel.id }}";  // Channel ID from Django template
    const orgId = "{{channel.organization.id}}";

    // Make an AJAX request to fetch activity logs
    fetch(`/channels/channels/fetch_activity_logs/${channelId}/${orgId}`)
        .then(response => response.json())
        .then(data => {
            const logsList = document.getElementById('activityLogsList');
            logsList.innerHTML = '';  // Clear existing logs

            if (data.success) {
                // If logs are found, populate the modal with them
                data.logs.forEach(log => {
                    const logItem = document.createElement('div');
                    logItem.className = 'list-group-item list-group-item-action';
                    logItem.innerHTML = `
                        <strong>${log.user}</strong> ${log.content} 
                        <span class="text-muted text-sm">(${log.timestamp})</span>
                    `;
                    logsList.appendChild(logItem);
                });

                // Show the modal
                var myModal = new bootstrap.Modal(document.getElementById('activityLogsModal'));
                myModal.show();
            } else {
                const noLogsItem = document.createElement('div');
                noLogsItem.className = 'list-group-item text-center text-muted';
                noLogsItem.textContent = "No activity logs found.";
                logsList.appendChild(noLogsItem);
            }
        })
        .catch(error => {
            console.error('Error fetching activity logs:', error);
        });
};



// SEARCH BAR 

document.getElementById('searchInput').addEventListener('input', function () {
    const query = this.value.trim(); // Get the search input
    const orgId = "{{ channel.organization.id }}"; // Pass organization ID dynamically
    const channelId = "{{ channel.id }}"; // Pass channel ID dynamically

    // AJAX request to fetch filtered messages and links
    fetch(`/channels/channels/search/${orgId}/${channelId}/?q=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(data => {
            const chatWindow = document.getElementById('chatWindow');
            chatWindow.innerHTML = ''; // Clear the chat window

            // Display filtered messages
            if (data.messages.length > 0) {
                data.messages.forEach(message => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'border-b py-2';
                    messageDiv.innerHTML = `
    <div class="w-10 h-10 flex-shrink-0 bg-gradient-to-tr from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">
        ${message.user__username.slice(0, 1)}  <!-- Display first letter of username -->
    </div>
    <div class="flex flex-col w-full">
        <span class="font-semibold text-purple-600">${message.user__username}</span>
        <span class="text-gray-700">${message.content}</span>
        <span class="text-xs text-gray-500 mt-1 self-end">${message.timestamp}</span>
    </div>
`;
                    chatWindow.appendChild(messageDiv);
                });
            }

            // Display filtered links
            if (data.links.length > 0) {
                data.links.forEach(link => {
                    const linkDiv = document.createElement('div');
                    linkDiv.className = 'border-b py-2';
                    linkDiv.innerHTML = `
    <div class="flex items-center border-b border-gray-200 py-3 hover:bg-gray-50 rounded-lg px-2 transition duration-200 relative">
        <!-- User avatar placeholder -->
        <div class="w-10 h-10 flex-shrink-0 bg-gradient-to-tr from-blue-500 to-green-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">
            ${link.user__username.slice(0, 1)}
        </div>
        <!-- Link content -->
        <div class="flex flex-col w-full">
            <span class="font-semibold text-green-600">${link.user__username}</span>
            <span>
                <a href="${link.link}" target="_blank" class="text-blue-600 hover:underline font-medium">
                    ${link.text}
                </a>
            </span>
            <span class="text-xs text-gray-500 mt-1 self-end">${link.timestamp}</span>
        </div>
    </div>
`;

                    chatWindow.appendChild(linkDiv);
                });
            }

            // If no results found
            if (data.messages.length === 0 && data.links.length === 0) {
                chatWindow.innerHTML = '<p class="text-center text-gray-500">No results found!</p>';
            }
        })
        .catch(error => {
            console.error('Error fetching search results:', error);
        });
});


// CHANNEL DETAILS
document.getElementById('viewChannelDetailsButton').onclick = function() {
    const channelId = "{{ channel.id }}";  // Get channel ID dynamically from the template
    const orgId = "{{ channel.organization.id }}";  // Get organization ID dynamically from the template

    // Make an AJAX request to fetch channel details
    fetch(`/channels/channels/channel_details/${orgId}/${channelId}/`)
        .then(response => response.json())
        .then(data => {
            // Update the modal with the fetched data
            document.getElementById('channelName').textContent = data.name;
            document.getElementById('channelType').textContent = data.type;
            document.getElementById('channelVisibility').textContent = data.visibility;
            document.getElementById('channelCreatedAt').textContent = data.created_at;
            document.getElementById('channelCreatedBy').textContent = data.created_by;

            // Clear existing members
            const membersList = document.getElementById('membersList');
            membersList.innerHTML = '';

            // Add members to the list
            data.members.forEach(member => {
                const memberItem = document.createElement('li');
                memberItem.textContent = member.full_name;
                membersList.appendChild(memberItem);
            });

            // Show the modal using Bootstrap 5 without jQuery
            var modal = new bootstrap.Modal(document.getElementById('channelDetailsModal'));
            modal.show();
        })
        .catch(error => {
            console.error('Error fetching channel details:', error);
        });
};


// Exporting data pop up

document.getElementById('exportDataButton').onclick = function(event) {
    // Prevent the default action (navigating to the export page)
    event.preventDefault();

    // Show the popup message
    const popupMessage = document.getElementById('popupMessage');
    popupMessage.style.display = 'block';

    // Hide the popup after 5 seconds
    setTimeout(function() {
        popupMessage.style.display = 'none';

        // Redirect to the export data URL after the message disappears
        window.location.href = event.target.href;
    }, 3000);
};


// CHANNEL STATISTICS

 // Event listener for showing the modal
document.getElementById('statisticsModal').addEventListener('show.bs.modal', function () {
    // Fetch the org_id and channel_id dynamically, you can pass them from the context
    var org_id = "{{channel.organization.id}}";  // Replace with dynamic org_id
    var channel_id = "{{channel.id}}";  // Replace with dynamic channel_id

    // Make the AJAX request
    fetch(`/channels/channel/statistics/${org_id}/${channel_id}/`, { // Adjust the URL if necessary
      method: 'GET',
    })
    .then(response => response.json())
    .then(data => {
      if (data.error) {
        alert('Error fetching data: ' + data.error);
      } else {
        // Render the charts
        renderCharts(data);
      }
    })
    .catch(() => {
      alert('An error occurred while fetching the statistics.');
    });
});

// Function to render the charts with data from the response
function renderCharts(data) {
    // Messages Chart
    var ctxMessages = document.getElementById('messagesChart').getContext('2d');
    var messagesChart = new Chart(ctxMessages, {
      type: 'bar',
      data: {
        labels: data.message_chart.labels,
        datasets: [{
          label: data.message_chart.label,
          data: data.message_chart.data,
          backgroundColor: data.message_chart.background_color,
          borderColor: data.message_chart.border_color,
          borderWidth: data.message_chart.border_width
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    // Links Chart
    var ctxLinks = document.getElementById('linksChart').getContext('2d');
    var linksChart = new Chart(ctxLinks, {
      type: 'bar',
      data: {
        labels: data.link_chart.labels,
        datasets: [{
          label: data.link_chart.label,
          data: data.link_chart.data,
          backgroundColor: data.link_chart.background_color,
          borderColor: data.link_chart.border_color,
          borderWidth: data.link_chart.border_width
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    // User Message Counts Chart
    var ctxUserMessageCounts = document.getElementById('userMessageCountsChart').getContext('2d');
    var userMessageCountsChart = new Chart(ctxUserMessageCounts, {
      type: 'pie',
      data: {
        labels: data.user_message_counts.map(item => item.user),
        datasets: [{
          label: 'User Message Counts',
          data: data.user_message_counts.map(item => item.message_count),
          backgroundColor: ['rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)', 'rgba(255, 159, 64, 0.2)', 'rgba(54, 162, 235, 0.2)'],
          borderColor: ['rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)', 'rgba(54, 162, 235, 1)'],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true
      }
    });

    // User Link Counts Chart
    var ctxUserLinkCounts = document.getElementById('userLinkCountsChart').getContext('2d');
    var userLinkCountsChart = new Chart(ctxUserLinkCounts, {
      type: 'pie',
      data: {
        labels: data.user_link_counts.map(item => item.user),
        datasets: [{
          label: 'User Link Counts',
          data: data.user_link_counts.map(item => item.link_count),
          backgroundColor: ['rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)', 'rgba(255, 159, 64, 0.2)', 'rgba(54, 162, 235, 0.2)'],
          borderColor: ['rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)', 'rgba(54, 162, 235, 1)'],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true
      }
    });

    // Total Messages Chart (Bar chart)
    var ctxTotalMessages = document.getElementById('totalMessagesChart').getContext('2d');
    var totalMessagesChart = new Chart(ctxTotalMessages, {
      type: 'bar',
      data: {
        labels: ['Total Messages'],
        datasets: [{
          label: 'Total Messages',
          data: [data.total_messages],
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    // Total Links Chart (Bar chart)
    var ctxTotalLinks = document.getElementById('totalLinksChart').getContext('2d');
    var totalLinksChart = new Chart(ctxTotalLinks, {
      type: 'bar',
      data: {
        labels: ['Total Links'],
        datasets: [{
          label: 'Total Links',
          data: [data.total_links],
          backgroundColor: 'rgba(153, 102, 255, 0.2)',
          borderColor: 'rgba(153, 102, 255, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    // King User Chart (Pie chart)
    var ctxKingUser = document.getElementById('kingUserChart').getContext('2d');
    var kingUserChart = new Chart(ctxKingUser, {
      type: 'pie',
      data: {
        labels: [data.king_user],
        datasets: [{
          label: 'King User Stats',
          data: [data.total_messages, data.total_links], // Data for the king user
          backgroundColor: ['rgba(255, 159, 64, 0.2)', 'rgba(54, 162, 235, 0.2)'],
          borderColor: ['rgba(255, 159, 64, 1)', 'rgba(54, 162, 235, 1)'],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true
      }
    });
}


// Coming soon modal

// Open "Coming Soon" modal for Call button
document.getElementById('callButton').addEventListener('click', function() {
        document.getElementById('comingSoonModal').classList.remove('hidden');
    });

    // Open "Coming Soon" modal for Screen Share button
    document.getElementById('screenShareButton').addEventListener('click', function() {
        document.getElementById('comingSoonModal').classList.remove('hidden');
    });

    // Close "Coming Soon" modal
    document.getElementById('closeComingSoonModal').addEventListener('click', function() {
        document.getElementById('comingSoonModal').classList.add('hidden');
    });






// Open the filter modal
document.getElementById('filterButton').onclick = function() {
    document.getElementById('filterModal').classList.remove('hidden');
};

// Close the filter modal
document.getElementById('closeFilterModal').onclick = function() {
    document.getElementById('filterModal').classList.add('hidden');
};

// Show specific date input when "Specific Date" is selected
document.getElementById('specific_date').addEventListener('change', function() {
    document.getElementById('specificDate').style.display = 'block';
});

// Hide specific date input when other options are selected
document.querySelectorAll('input[name="filter"]').forEach(function(element) {
    element.addEventListener('change', function() {
        if (element.value !== 'specific_date') {
            document.getElementById('specificDate').style.display = 'none';
        }
    });
});

// Apply the filter and send AJAX request
document.getElementById('applyFilter').onclick = function() {
    let filterOption = document.querySelector('input[name="filter"]:checked').value;
    let specificDate = filterOption === 'specific_date' ? document.getElementById('specificDate').value : null;

    // Replace these with actual org_id and channel_id values
    let orgId = "{{channel.organization.id}}";  
    let channelId = "{{channel.id}}";  

    // Send AJAX request to fetch filtered messages
    fetch(`/channels/filter_messages/${orgId}/${channelId}/?filter_option=${filterOption}&specific_date=${specificDate}`)
        .then(response => response.json())
        .then(data => {
            // Update the UI with filtered messages
            let messagesContainer = document.getElementById('chatWindow');
            messagesContainer.innerHTML = '';  // Clear existing messages

            data.messages.forEach(message => {
                let messageDiv = document.createElement('div');
                messageDiv.classList.add('message');
                messageDiv.innerHTML = `
    <div class="w-10 h-10 flex-shrink-0 bg-gradient-to-tr from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">
        ${message.user.slice(0, 1)}  <!-- Display first letter of username -->
    </div>
    <div class="flex flex-col w-full">
        <span class="font-semibold text-purple-600">${message.user}</span>
        <span class="text-gray-700">${message.content}</span>
        ${message.link ? `<a href="${message.link}" target="_blank" class="text-blue-500 hover:underline font-medium">${message.link}</a>` : ''}
        <span class="text-xs text-gray-500 mt-1 self-end">${message.timestamp}</span>
    </div>
`;
                messagesContainer.appendChild(messageDiv);
            });

            // Update the UI with filtered links
            let linksContainer = document.getElementById('linksWindow');
            linksContainer.innerHTML = '';  // Clear existing links

            data.links.forEach(link => {
                let linkDiv = document.createElement('div');
                linkDiv.classList.add('link');
                linkDiv.innerHTML = `
                    <div>${link.user}</div>
                    <div><a href="${link.link}" target="_blank">${link.text}</a></div>
                    <div>${link.timestamp}</div>
                `;
                linksContainer.appendChild(linkDiv);
            });
        })
        .catch(error => console.error('Error fetching data:', error));

    // Close the modal after applying the filter
    document.getElementById('filterModal').classList.add('hidden');
};



// Delete all messages of user 

document.addEventListener('DOMContentLoaded', function () {
    const deleteMessagesButton = document.getElementById('deleteMessagesButton');
    const deleteMessagesModal = document.getElementById('deleteMessagesModal');
    const confirmDeleteButton = document.getElementById('confirmDeleteButton');
    const cancelDeleteButton = document.getElementById('cancelDeleteButton');
    const passwordInput = document.getElementById('passwordInput');
    
    const orgId = "{{channel.organization.id}}"; 
    const channelId = "{{channel.id}}"; 

    // Open Modal
    deleteMessagesButton.onclick = function () {
        deleteMessagesModal.classList.remove('hidden');
    };

    // Close Modal
    cancelDeleteButton.onclick = function () {
        deleteMessagesModal.classList.add('hidden');
        passwordInput.value = ''; // Clear input field
    };

    // AJAX Request to Delete Messages
    confirmDeleteButton.onclick = function () {
        const password = passwordInput.value;

        if (!password) {
            alert('Please enter your password!');
            return;
        }

        fetch(`/channels/api/delete-messages/${orgId}/${channelId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken') // Ensure CSRF token is included
            },
            body: JSON.stringify({ password: password })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                deleteMessagesModal.classList.add('hidden');
                passwordInput.value = '';

                // Remove messages from chat window
                const chatWindow = document.getElementById('chatWindow');
                if (chatWindow) {
                    chatWindow.innerHTML = ''; // Clear messages
                }
            } else {
                alert(data.message);
            }
        })
        .catch(error => console.error('Error:', error));
    };

    // Helper Function to Get CSRF Token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
});

// show 3 dot menu

document.addEventListener('click', function (event) {
    if (event.target.classList.contains('menu-button')) {
        // Toggle menu options visibility
        const menu = event.target.nextElementSibling;
        menu.classList.toggle('hidden');
    } else {
        // Close all open menus if clicked outside
        document.querySelectorAll('.menu-options').forEach(menu => {
            menu.classList.add('hidden');
        });
    }
});



// Edit message 
document.addEventListener('DOMContentLoaded', function () {
    let currentMessageId = null;
    let currentMessageElement = null;

    // When the edit button is clicked, set up the modal
    const editButtons = document.querySelectorAll('.edit-button');
    editButtons.forEach(button => {
        button.addEventListener('click', function () {
            currentMessageId = this.dataset.messageId;
            currentMessageElement = this.closest('.flex.items-center'); // The element that contains the message
            const currentContent = this.dataset.currentContent;
            document.getElementById('editMessageContent').value = currentContent; // Populate the textarea with current message content
        });
    });

    // When the save button is clicked, send AJAX request to update the message
    document.getElementById('saveEditButton').addEventListener('click', function () {
        const newContent = document.getElementById('editMessageContent').value.trim(); // Remove leading/trailing spaces
        if (!newContent) {
            alert("Message content cannot be empty or just spaces.");
            return;
        }

        // Get the CSRF token from the page
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        const orgId = "{{ channel.organization.id }}";
        const channelId = "{{ channel.id }}";

        // Send AJAX request to update the message
        fetch(`/channels/channels/edit_message/${orgId}/${channelId}/${currentMessageId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({
                content: newContent
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update the message content in the DOM immediately for the user
                currentMessageElement.querySelector('.message-content').textContent = newContent;
                $('#editMessageModal').modal('hide'); // Hide the modal after successful edit
            } else {
                alert(data.error || 'Failed to update the message.');
            }
        })
        .catch(error => {
           
        showNotification('Message updated successfully. Please refresh the page for new changes.', 'Refresh', window.location.href);
        });
    });
});

// Edit the link

document.addEventListener('DOMContentLoaded', function() {
    // When the edit button is clicked, open the modal and populate fields
    const editLinkButtons = document.querySelectorAll('.edit-link-button');
    editLinkButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Get link data from the button's data attributes
            const linkId = this.dataset.linkId;
            const currentText = this.dataset.currentText;
            const currentLink = this.dataset.currentLink;

            // Populate the modal's input fields with the existing data
            document.getElementById('editLinkText').value = currentText;
            document.getElementById('editLinkUrl').value = currentLink;

            // Update the modal's save button with the correct link ID
            const saveButton = document.getElementById('saveEditLinkButton');
            saveButton.dataset.linkId = linkId;
        });
    });

    // When the save button is clicked, send AJAX request to update the link
    document.getElementById('saveEditLinkButton').addEventListener('click', function() {
        const newText = document.getElementById('editLinkText').value.trim();
        const newLink = document.getElementById('editLinkUrl').value.trim();

        // Validate inputs
        if (!newText || !newLink) {
            alert("Both link text and URL are required.");
            return;
        }

        // Get the CSRF token from the page
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        const linkId = this.dataset.linkId;
        const orgId = "{{ channel.organization.id }}";
        const channelId = "{{ channel.id }}";

        // Send AJAX request to update the link
        fetch(`/channels/channels/edit_link/${orgId}/${channelId}/${linkId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({
                text: newText,
                link: newLink
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update the link content in the DOM immediately for the user
                const linkElement = document.querySelector(`.link[data-link-id="${linkId}"]`);
                linkElement.querySelector('.link-text').textContent = newText;
                linkElement.querySelector('.link-url').textContent = newLink;

                // Hide the modal after successful update
                $('#editLinkModal').modal('hide');
            } else {
                alert(data.error || 'Failed to update the link.');
            }
        })
        .catch(error => {
            showNotification('Link updated successfully. Please refresh the page for new changes.', 'Refresh', window.location.href);
        });
    });
});


// CHANNEL STATS

document.addEventListener("DOMContentLoaded", function () {
    const showStatsButton = document.getElementById("showStatsButton");

    const orgId = "{{channel.organization.id}}";  
    const channelId = "{{channel.id}}";  

    // Show Stats Modal
    showStatsButton.addEventListener("click", async () => {
        try {
            // Fetch data via AJAX
            const response = await fetch(`/channels/channel-data/${orgId}/${channelId}/`);
            if (!response.ok) throw new Error("Failed to fetch data");
            const data = await response.json();

            // Render both Pie and Bar charts
            renderPieChart(data);
            renderBarChart(data);
        } catch (error) {
            console.error("Error fetching stats:", error);
        }
    });

    // Function to render Pie Chart
    function renderPieChart(data) {
        const ctx = document.getElementById("chartContainer").getContext("2d");

        // Destroy previous chart if it exists
        if (window.pieChart) {
            window.pieChart.destroy();
        }

        window.pieChart = new Chart(ctx, {
            type: "pie",
            data: {
                labels: ["Messages", "Links"],
                datasets: [
                    {
                        label: "Memory Usage (KB)",
                        data: [
                            data.total_message_memory / 1024,  // Convert bytes to KB
                            data.total_links_memory_combined / 1024,   // Convert bytes to KB
                        ],
                        backgroundColor: ["#007bff", "#28a745"],
                    },
                ],
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: "top",
                    },
                    tooltip: {
                        callbacks: {
                            label: (tooltipItem) => {
                                return `${tooltipItem.label}: ${tooltipItem.raw.toFixed(2)} KB`;
                            },
                        },
                    },
                },
            },
        });
    }

    // Function to render Bar Chart
    function renderBarChart(data) {
        const ctx = document.getElementById("chartContainer").getContext("2d");

        // Destroy previous chart if it exists
        if (window.barChart) {
            window.barChart.destroy();
        }

        window.barChart = new Chart(ctx, {
            type: "bar",
            data: {
                labels: ["Text Memory", "Audio Memory", "Video Memory", "Links Text Memory", "Links URL Memory"],
                datasets: [
                    {
                        label: "Memory Usage (KB)",
                        data: [
                            data.total_text_memory / 1024,
                            data.total_audio_memory / 1024,
                            data.total_video_memory / 1024,
                            data.total_links_text_memory / 1024,
                            data.total_links_memory / 1024,
                        ],
                        backgroundColor: ["#007bff", "#28a745", "#ffc107", "#17a2b8", "#e83e8c"],
                    },
                ],
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: "top",
                    },
                    tooltip: {
                        callbacks: {
                            label: (tooltipItem) => {
                                return `${tooltipItem.label}: ${tooltipItem.raw.toFixed(2)} KB`;
                            },
                        },
                    },
                },
            },
        });
    }
});


// FILTER BY USER 

document.addEventListener("DOMContentLoaded", function () {
    const orgId = "{{ channel.organization.id }}";
    const channelId = "{{ channel.id }}";

    // Populate the user list
    async function fetchUsers() {
        console.log("Fetching users...");  // Added log to check if this is being triggered
        try {
            const response = await fetch(`/channels/fetch-users/${orgId}/${channelId}/`);
            const data = await response.json();

            const userList = document.getElementById("userListt");
            userList.innerHTML = ""; // Clear previous list

            data.users.forEach((user) => {
                const listItem = document.createElement("li");
                listItem.className =
                    "list-group-item d-flex justify-content-between align-items-center cursor-pointer";
                listItem.textContent = user.username;
                listItem.dataset.userId = user.id;
                listItem.addEventListener("click", () => filterMessages(user.id));
                userList.appendChild(listItem);
            });
        } catch (error) {
            console.error("Error fetching users:", error);
        }
    }

    // Filter messages by user
    async function filterMessages(userId) {
        console.log(`Filtering by user: ${userId}`);  // Added log to check if this is being triggered
        try {
            const response = await fetch(
                `/channels/filter-by-user/${orgId}/${channelId}/${userId}/`
            );
            const data = await response.json();

            const chatWindow = document.getElementById("chatWindow");
            chatWindow.innerHTML = ""; // Clear existing messages and links

            // Display filtered messages
            data.messages.forEach((message) => {
                const messageDiv = document.createElement("div");
                messageDiv.className =
                    "flex items-center border-b border-gray-200 py-3 hover:bg-gray-50 rounded-lg px-2 transition duration-200 relative";
                    messageDiv.innerHTML = `
    <div class="w-10 h-10 flex-shrink-0 bg-gradient-to-tr from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">
        ${message.content.slice(0, 1)}
    </div>
    <div class="flex flex-col w-full">
        <span class="font-semibold text-purple-600">${message.user}</span>
        <span class="text-gray-700">${message.content}</span>
        <span class="text-xs text-gray-500 mt-1 self-end">${message.timestamp}</span>
    </div>
`;

                chatWindow.appendChild(messageDiv);
            });

            // Display filtered links
            data.links.forEach((link) => {
                const linkDiv = document.createElement("div");
                linkDiv.className =
                    "flex items-center border-b border-gray-200 py-3 hover:bg-gray-50 rounded-lg px-2 transition duration-200 relative";
                linkDiv.innerHTML = `
                    <div class="w-10 h-10 flex-shrink-0 bg-gradient-to-tr from-blue-500 to-green-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">
                        ${link.text.slice(0, 1)}
                    </div>
                    <div class="flex flex-col w-full">
                        <span class="font-semibold text-green-600">${link.user}</span>
                        <span>
                            <a href="${link.link}" target="_blank" class="text-blue-600 hover:underline font-medium">
                                ${link.text}
                            </a>
                        </span>
                        <span class="text-xs text-gray-500 mt-1 self-end">${link.timestamp}</span>
                    </div>
                `;
                chatWindow.appendChild(linkDiv);
            });





            // Close the modal
            const filterByUserModal = bootstrap.Modal.getInstance(
                document.getElementById("filterByUserModal")
            );
            filterByUserModal.hide();
        } catch (error) {
            console.error("Error filtering messages:", error);
        }
    }

    // Fetch users when the modal is shown
    const filterByUserModal = document.getElementById("filterByUserModal");
    filterByUserModal.addEventListener("show.bs.modal", function () {
        console.log("Modal is opening..."); // Log to check if the modal is triggering the fetch
        setTimeout(fetchUsers, 100); // Delay to ensure modal fully loads
    });
});


// DELETE CHANNEL DATA (ONLY ADMIN)





// DISPLAY NETWORK STATS
function displayNetworkStatus() {
  // Simulated data for demonstration purposes (feel free to replace this with actual data from API)
  const simulatedData = {
    signal_strength: Math.random() * 100, // Percentage
    upload_speed: (Math.random() * 100).toFixed(2), // Mbps
    download_speed: (Math.random() * 150).toFixed(2), // Mbps
    ping: Math.floor(Math.random() * 300), // ms
    connection_type: ["Wi-Fi", "4G",][Math.floor(Math.random() * 4)],
    connection_status: ["Online", "Reconnecting", "Offline"][Math.floor(Math.random() * 3)],
    packet_loss: (Math.random() * 5).toFixed(2), // Percentage
    network_load: (Math.random() * 50).toFixed(2), // Mbps
    jitter: Math.floor(Math.random() * 50), // ms
    network_provider: "Simulated ISP",
    server_response_time: Math.floor(Math.random() * 500), // ms
    bandwidth_usage: {
      current: (Math.random() * 200).toFixed(2), // Mbps
      average: (Math.random() * 100).toFixed(2), // Mbps
    },
    activity_log: [
      { event: "Reconnected", timestamp: Date.now() - 60000 },
      { event: "Packet loss detected", timestamp: Date.now() - 120000 },
    ],
    diagnostic_suggestions: [
      "Check router and cables for loose connections.",
      "Consider upgrading to a higher speed plan for better performance.",
      "Try restarting the router and modem.",
    ],
  };

  // Update general information
  document.getElementById("connectionType").innerText = `Connection Type: ${simulatedData.connection_type}`;
  document.getElementById("connectionStatus").innerText = `Connection Status: ${simulatedData.connection_status}`;
  document.getElementById("networkProvider").innerText = `Network Provider: ${simulatedData.network_provider}`;

  // Signal Strength (Progress Bar)
  const signalStrengthBar = document.getElementById("signalStrengthBar");
  signalStrengthBar.style.width = `${simulatedData.signal_strength}%`;
  signalStrengthBar.setAttribute("aria-valuenow", simulatedData.signal_strength);
  document.getElementById("signalStrengthText").innerText = `${simulatedData.signal_strength.toFixed(2)}%`;

  // Render network speed chart (Line Chart)
  const ctxSpeed = document.getElementById("networkSpeedChart").getContext("2d");
  new Chart(ctxSpeed, {
    type: "line",
    data: {
      labels: ["Upload", "Download"],
      datasets: [
        {
          label: "Speed (Mbps)",
          data: [simulatedData.upload_speed, simulatedData.download_speed],
          borderColor: ["blue", "green"],
          backgroundColor: ["blue", "green"],
          fill: false,
        },
      ],
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: true },
      },
    },
  });

  // Update latency, jitter, and packet loss (Text & Progress Bars)
  document.getElementById("pingValue").innerText = `${simulatedData.ping} ms`;
  document.getElementById("jitterValue").innerText = `${simulatedData.jitter} ms`;
  document.getElementById("packetLoss").innerText = `${simulatedData.packet_loss}%`;

  // Render network load chart (Bar Chart)
  const ctxLoad = document.getElementById("networkLoadChart").getContext("2d");
  new Chart(ctxLoad, {
    type: "bar",
    data: {
      labels: ["Network Load"],
      datasets: [
        {
          label: "Network Load (Mbps)",
          data: [simulatedData.network_load],
          backgroundColor: "orange",
        },
      ],
    },
    options: {
      responsive: true,
      plugins: { legend: { display: false } },
    },
  });

  // Render bandwidth usage (Pie Chart)
  const ctxUsage = document.getElementById("bandwidthUsageChart").getContext("2d");
  new Chart(ctxUsage, {
    type: "pie",
    data: {
      labels: ["Current Usage", "Average Usage"],
      datasets: [
        {
          label: "Bandwidth Usage",
          data: [simulatedData.bandwidth_usage.current, simulatedData.bandwidth_usage.average],
          backgroundColor: ["#28a745", "#007bff"],
        },
      ],
    },
    options: {
      responsive: true,
      plugins: { legend: { position: "top" } },
    },
  });

  // Render server response time (Mini Graph)
  const ctxServerResponse = document.getElementById("serverResponseChart").getContext("2d");
  new Chart(ctxServerResponse, {
    type: "line",
    data: {
      labels: ["Response Time"],
      datasets: [
        {
          label: "Server Response (ms)",
          data: [simulatedData.server_response_time],
          borderColor: ["purple"],
          backgroundColor: ["purple"],
          fill: false,
        },
      ],
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false },
      },
    },
  });

  // Update activity log
  const activityLog = document.getElementById("activityLog");
  activityLog.innerHTML = ""; // Clear previous logs
  simulatedData.activity_log.forEach((log) => {
    const logItem = document.createElement("li");
    logItem.className = "list-group-item";
    logItem.innerText = `${log.event} - ${new Date(log.timestamp).toLocaleString()}`;
    activityLog.appendChild(logItem);
  });

  // Display diagnostic suggestions
  const diagnosticSuggestions = document.getElementById("diagnosticSuggestions");
  diagnosticSuggestions.innerHTML = "<strong>Diagnostic Suggestions:</strong>";
  simulatedData.diagnostic_suggestions.forEach((suggestion) => {
    const suggestionItem = document.createElement("p");
    suggestionItem.innerText = suggestion;
    diagnosticSuggestions.appendChild(suggestionItem);
  });
}





// BAN USERS (ADMIN ONLY)

document.addEventListener("DOMContentLoaded", function () {
    const orgId = "{{ channel.organization.id }}";
    const channelId = "{{ channel.id }}";

    let selectedUserId = null;

    // Function to fetch users and populate the user list
    async function fetchUsers() {
        console.log("Fetching users...");
        try {
            const response = await fetch(`/channels/fetch-users/${orgId}/${channelId}/`);
            const data = await response.json();
            console.log("Users fetched:", data);

            const userList = document.getElementById("userListtt");
            if (userList) {
                userList.innerHTML = ""; // Clear the list before adding new items

                if (data && data.users) {
                    data.users.forEach((user) => {
                        const listItem = document.createElement("li");
                        listItem.className =
                            "list-group-item d-flex justify-content-between align-items-center cursor-pointer user-list-item";
                        listItem.textContent = user.username;
                        listItem.dataset.userId = user.id;

                        listItem.addEventListener("click", () => {
                            selectedUserId = user.id;
                            openCustomBanModal(user.id, user.username);
                        });

                        userList.appendChild(listItem);
                    });
                } else {
                    console.error("No users found in response.");
                }
            } else {
                console.error("User list element not found.");
            }
        } catch (error) {
            console.error("Error fetching users:", error);
        }
    }

    // Open custom ban modal
    function openCustomBanModal(userId, userName) {
        selectedUserId = userId;

        const customBanModal = document.getElementById("customBanModal");
        const customBanModalLabel = document.getElementById("customBanModalLabel");

        if (customBanModal && customBanModalLabel) {
            customBanModalLabel.textContent = `Ban ${userName}`;
            customBanModal.style.display = "block";
        } else {
            console.error("Custom ban modal or label not found.");
        }
    }

    // Close custom ban modal
    function closeCustomBanModal() {
        const customBanModal = document.getElementById("customBanModal");
        if (customBanModal) {
            customBanModal.style.display = "none";
        } else {
            console.error("Custom ban modal not found.");
        }
    }

    // Attach event to close button
    const closeBanButton = document.getElementById("closeCustomBanModal");
    if (closeBanButton) {
        closeBanButton.addEventListener("click", closeCustomBanModal);
    } else {
        console.error("Close button for custom ban modal not found.");
    }

    // Handle ban submission
    const submitBanButton = document.getElementById("customSubmitBan");
    if (submitBanButton) {
        submitBanButton.addEventListener("click", function () {
            const banDuration = document.getElementById("customBanDuration").value;
            const banReason = document.getElementById("customBanReason").value;

            if (!selectedUserId || !banDuration || !banReason) {
                alert("Please select a user, ban duration, and reason.");
                return;
            }

            fetch(`/channels/ban-user/${orgId}/${channelId}/${selectedUserId}/`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": "{{ csrf_token }}",
                },
                body: JSON.stringify({
                    duration: banDuration,
                    reason: banReason,
                }),
            })
                .then(response => response.json())
                .then(data => {
                    if (data.status === "success") {
                        alert("User banned successfully!");
                        closeCustomBanModal();
                    } else {
                        showNotification("User banned successfully and wont be able to access this group again")
                    }
                })
                .catch(error => {
                    console.error("Error banning user:", error);
                    alert("An error occurred while banning the user.");
                });
        });
    } else {
        console.error("Submit ban button not found.");
    }

    // Initial fetch of users
    fetchUsers();
});



// GIVE ACCESS OF THIS CHANNEL TO ANOTHER ORGANIZATION
document.addEventListener("DOMContentLoaded", function () {
    // Modal show event
    const shareModal = document.getElementById('shareModal');
    const organizationList = document.getElementById('organizationList');
    const loadingSpinner = document.getElementById('loadingSpinner');
    const grantAccessBtn = document.getElementById('grantAccessBtn');

    let selectedOrganizationId = null;

    // Fetch organizations when modal is shown
    shareModal.addEventListener('show.bs.modal', function () {
      // Show the loading spinner while fetching data
      loadingSpinner.style.display = 'block';
      organizationList.innerHTML = '';  // Clear previous list
      grantAccessBtn.disabled = true;   // Disable the button initially

      const orgId = "{{ channel.organization.id }}"; // Channel's organization ID
      const channelId = "{{ channel.id }}";          // Channel ID

      // Fetch organizations where the user is an admin
      fetch(`/channels/fetch-admin-organizations/${orgId}/${channelId}/`)  // Correct URL with template variable
        .then(response => response.json())
        .then(data => {
          loadingSpinner.style.display = 'none';  // Hide the loading spinner

          if (data.organizations.length > 0) {
            data.organizations.forEach(org => {
              const listItem = document.createElement('li');
              listItem.classList.add('list-group-item');
              listItem.textContent = `${org.name} - ${org.description}`;
              listItem.dataset.orgId = org.id;

              // Disable organizations that already have access to the channel
              if (org.hasAccess) {
                listItem.classList.add('disabled');
                listItem.style.pointerEvents = 'none'; // Prevent clicks
              }

              listItem.addEventListener('click', function () {
                // Handle the organization selection
                if (!listItem.classList.contains('disabled')) {
                  selectedOrganizationId = org.id;
                  grantAccessBtn.disabled = false;
                }
              });

              organizationList.appendChild(listItem);
            });
          } else {
            const noDataItem = document.createElement('li');
            noDataItem.classList.add('list-group-item');
            noDataItem.textContent = 'No organizations found who dont have access to this channel.';
            organizationList.appendChild(noDataItem);
          }
        })
        .catch(err => {
          console.error("Error fetching organizations:", err);
          loadingSpinner.style.display = 'none';
          const errorItem = document.createElement('li');
          errorItem.classList.add('list-group-item');
          errorItem.textContent = 'Failed to load organizations.';
          organizationList.appendChild(errorItem);
        });
    });

    // Grant access button click handler
    grantAccessBtn.addEventListener('click', function () {
      if (selectedOrganizationId) {
        const orgId = "{{ channel.organization.id }}"; // Channel's organization ID
        const channelId = "{{ channel.id }}"; // Channel ID
        const grantedToOrgId = selectedOrganizationId; // Selected organization ID to grant access

        // Grant access using URL parameters directly
        fetch(`/channels/grant-channel-access/${orgId}/${channelId}/${grantedToOrgId}/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          }
        })
        .then(response => response.json())
        .then(data => {
          alert(data.message || 'Access granted successfully!');
          // Close the modal after success
          let modal = bootstrap.Modal.getInstance(shareModal);
          modal.hide();
        })
        .catch(error => {
          console.error('Error granting access:', error);
          alert('Failed to grant access.');
        });
      }
    });
  });


// SET RETENTION POLICY

document.addEventListener('DOMContentLoaded', function() {
    const customRetentionRadio = document.getElementById('customRetention');
    const customDaysInput = document.getElementById('customDays');

    // Show the custom input field when "Custom Period" is selected
    customRetentionRadio.addEventListener('change', function() {
      if (customRetentionRadio.checked) {
        customDaysInput.style.display = 'block'; // Show input
      }
    });

    // Hide the custom input field if another period is selected
    document.querySelectorAll('input[name="retentionPeriod"]').forEach(radio => {
      radio.addEventListener('change', function() {
        if (radio.value !== '0') {
          customDaysInput.style.display = 'none'; // Hide input
        }
      });
    });

    // Save the retention policy when the button is clicked
    document.getElementById('saveRetentionPolicy').addEventListener('click', function() {
      const retentionPeriod = document.querySelector('input[name="retentionPeriod"]:checked');
      let customDays = customDaysInput.value;

      if (!retentionPeriod) {
        alert('Please select a retention period.');
        return;
      }

      if (retentionPeriod.value === '0' && !customDays) {
        alert('Please enter a custom number of days.');
        return;
      }

      const data = {
        retention_period: retentionPeriod.value,
        custom_days: customDays ? customDays : null
      };

      const orgId="{{channel.organization.id}}";
      const channelId="{{channel.id}}";

      // Send data to the backend (Assuming a POST request to '/set_retention_policy/')
      fetch(`/channels/set_retention_policy/${orgId}/${channelId}/`, {// Replace with the actual org_id and channel_id
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
      })
      .then(response => response.json())
      .then(data => {
        alert(data.success || data.error);
        if (data.success) {
          // Close the modal if successful
          var myModal = new bootstrap.Modal(document.getElementById('retentionPolicyModal'));
          myModal.hide();
        }
      })
      .catch(error => {
        alert('An error occurred. Please try again later.');
        console.error(error);
      });
    });
  });



//   PIN MESSAGES


function getCSRFToken() {
    const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
    return csrfToken;
}

function togglePinMessage(orgId, channelId, messageId) {
    fetch(`/channels/pin-message/${orgId}/${channelId}/${messageId}/`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCSRFToken(), // Use the CSRF token here
        },
    })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                const messageElement = document.getElementById(`message-${messageId}`);
                const chatWindow = document.getElementById("chatWindow");

                if (data.is_pinned) {
                    // Highlight the pinned message
                    messageElement.classList.add("bg-yellow-100");

                    // Move the pinned message to the top
                    chatWindow.prepend(messageElement);
                } else {
                    // Remove the highlight
                    messageElement.classList.remove("bg-yellow-100");

                    // Append the unpinned message back to its original position
                    const originalMessages = [...chatWindow.querySelectorAll(".flex.items-center")].filter(
                        el => el !== messageElement
                    );

                    const lastMessage = originalMessages[originalMessages.length - 1];
                    chatWindow.insertBefore(messageElement, lastMessage.nextSibling);
                }
            } else {
                alert(data.message || "Failed to pin/unpin the message.");
            }
        })
        .catch(error => {
            showNotification('Operation Sucessfull please refresh the page to reflect the changes', 'Refresh', window.location.href);
        });
}




// STAR/UNSTAR THE MESSAGE


// STAR/UNSTAR THE MESSAGE
$(document).on('click', '.star-icon', function () {
    var button = $(this); // Reference to the clicked button
    var messageId = button.data('message-id');
    var orgId = button.data('org-id');
    var channelId = button.data('channel-id');

    // Send AJAX request to toggle star status
    $.ajax({
        url: '/channels/toggle_star_message/' + orgId + '/' + channelId + '/' + messageId + '/',
        type: 'GET',
        success: function (response) {
            if (response.status === 'success') {
                // Toggle the star icon's "filled" class based on the updated is_starred state
                if (response.is_starred) {
                    button.addClass('filled'); // Add filled class to show it's starred
                } else {
                    button.removeClass('filled'); // Remove filled class to unstar it
                }

                // Update the star status text and style dynamically
                var starStatus = button.siblings('.star-status');
                if (response.is_starred) {
                    starStatus.text('Starred').removeClass('unstarred').addClass('starred');
                } else {
                    starStatus.text('Unstarred').removeClass('starred').addClass('unstarred');
                }

                // Show a notification or success message (optional)
                showNotification(
                    response.is_starred ? 'Message has been starred!' : 'Message has been unstarred!',
                    'Dismiss'
                );
            } else {
                // Optional: Handle errors if needed
                console.error('Failed to update the star status:', response.message);
            }
        },
        error: function (xhr, status, error) {
            console.error('An error occurred:', error);
        }
    });
});





// HANDLE REPLIES

document.addEventListener("DOMContentLoaded", function () {
    // Use event delegation to handle the reply button clicks
    document.body.addEventListener("click", function (event) {
        if (event.target && event.target.classList.contains("reply-btn")) {
            const messageId = event.target.dataset.messageId;
            const orgId = event.target.dataset.orgId;
            const channelId = event.target.dataset.channelId;

            // Display the reply input field dynamically
            const replyInputHtml = `
                <div class="mt-2 flex">
                    <input type="text" id="reply-input-${messageId}" 
                        class="border border-gray-300 rounded-md p-2 w-full text-sm" 
                        placeholder="Write your reply..." />
                    <button class="ml-2 px-3 py-2 bg-blue-500 text-white rounded-md text-sm send-reply-btn" 
                        data-message-id="${messageId}" 
                        data-org-id="${orgId}" 
                        data-channel-id="${channelId}">
                        Send
                    </button>
                </div>`;
            event.target.insertAdjacentHTML("afterend", replyInputHtml);

            // Handle sending the reply
            document.querySelector(`#reply-input-${messageId}`).nextElementSibling.addEventListener("click", function () {
                const content = document.querySelector(`#reply-input-${messageId}`).value.trim();
                if (!content) return alert("Reply content cannot be empty!");

                // Send AJAX POST request
                fetch(`/channels/reply/${orgId}/${channelId}/${messageId}/`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "X-CSRFToken": getCSRFToken(), // CSRF token to protect against CSRF attacks
                    },
                    body: JSON.stringify({ content: content }),
                })
                    .then((response) => response.json())
                    .then((data) => {
                        if (data.error) {
                            alert(data.error);
                        } else {
                            // Append the reply to the chat window
                            const replyHtml = `
                                <div class="flex items-center ml-6 mt-2 border-l-4 border-blue-400 pl-2">
                                    <div class="w-8 h-8 flex-shrink-0 bg-blue-400 rounded-full flex items-center justify-center text-white font-bold text-xs mr-3">
                                        ${data.reply.user[0]}
                                    </div>
                                    <div>
                                        <span class="font-semibold text-blue-600">${data.reply.user}</span>
                                        <span class="text-gray-700">${data.reply.content}</span>
                                        <span class="text-xs text-gray-500">${data.reply.timestamp}</span>
                                    </div>
                                </div>`;
                            document.querySelector(`#reply-input-${messageId}`).closest(".flex").insertAdjacentHTML("afterend", replyHtml);
                            document.querySelector(`#reply-input-${messageId}`).remove(); // Remove the input field after sending
                        }
                    })
                    .catch((error) => {
                        console.error("Error:", error);
                        alert("An error occurred. Please try again.");
                    });
            });
        }
    });

    // Function to get CSRF token (for Django)
    function getCSRFToken() {
        return document.querySelector('[name=csrfmiddlewaretoken]').value;
    }
});



// SET MESSAGE AS RECURRING

document.addEventListener("DOMContentLoaded", () => {
    const modal = document.getElementById("recurrenceModal");
    const closeModalButton = document.getElementById("closeModalButton");
    const recurrenceForm = document.getElementById("recurrenceForm");
    const recurrenceType = document.getElementById("recurrenceType");
    const recurrenceDaysContainer = document.getElementById("recurrenceDaysContainer");

    let orgId, channelId, messageId; // Variables to hold IDs dynamically

    // Show modal and capture IDs dynamically
    document.addEventListener("click", (event) => {
        if (event.target && event.target.classList.contains("edt-button")) {
            orgId = event.target.getAttribute("data-org-id");
            channelId = event.target.getAttribute("data-channel-id");
            messageId = event.target.getAttribute("data-message-id");

            modal.classList.remove("hidden");
        }
    });

    // Hide modal
    closeModalButton.addEventListener("click", () => {
        modal.classList.add("hidden");
    });

    // Show/Hide "Select Days" based on recurrence type
    recurrenceType.addEventListener("change", () => {
        if (recurrenceType.value === "weekly" || recurrenceType.value === "custom") {
            recurrenceDaysContainer.style.display = "block";
        } else {
            recurrenceDaysContainer.style.display = "none";
        }
    });

    // Handle form submission
    recurrenceForm.addEventListener("submit", async (e) => {
        e.preventDefault();

        // Collect form data
        const formData = new FormData(recurrenceForm);
        const recurrenceTypeValue = formData.get("recurrence_type");
        const recurrenceDays = formData.getAll("recurrence_days");
        const endDate = formData.get("end_date");

        try {
            const response = await fetch(`/channels/message_recurring/${orgId}/${channelId}/${messageId}/`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    recurrence_type: recurrenceTypeValue,
                    recurrence_days: recurrenceDays,
                    end_date: endDate,
                }),
            });

            const result = await response.json();
            if (response.ok) {
                alert(result.message);
                modal.classList.add("hidden");
            } else {
                alert(result.error || "Something went wrong!");
            }
        } catch (error) {
            alert("Failed to set recurring message. Please try again later.");
        }
    });
});




// MONITOR RECURRENCE MESSAGES

$(document).ready(function() {
    // Trigger the modal when button is clicked
    $("#monitor-recurring-messages-btn").click(function() {
        var org_id = 2;  // Example, replace with actual org_id
        var channel_id = 5;  // Example, replace with actual channel_id

        $.ajax({
            url: `/channels/monitor-recurring-messages/${org_id}/${channel_id}/`,
            method: 'GET',
            success: function(data) {
                if (data.error) {
                    alert('Error: ' + data.error);
                } else {
                    // Populate pending messages table
                    var pendingMessages = data.pending_messages.map(function(message) {
                        return `
                            <tr>
                                <td>${message.text}</td>
                                <td>${message.start_date}</td>
                                <td>${message.end_date || 'N/A'}</td>
                                <td>
                                    <button class="btn btn-danger delete-recurring-message" data-id="${message.id}">Prevent & Delete</button>
                                </td>
                            </tr>
                        `;
                    }).join('');

                    // Populate sent messages table
                    var sentMessages = data.sent_messages.map(function(record) {
                        return `
                            <tr>
                                <td>${record.message_text}</td>
                                <td>${record.sent_at}</td>
                                <td>${record.status || 'N/A'}</td>
                                <td>
                                    <button class="btn btn-danger delete-recurring-message" data-id="${record.id}">Prevent & Delete</button>
                                </td>
                            </tr>
                        `;
                    }).join(''); 

                    // Add data to the modal body
                    $("#pendingMessagesTable tbody").html(pendingMessages);
                    $("#sentMessagesTable tbody").html(sentMessages);

                    // Show the modal
                    $("#recurrenceMonitorModal").modal('show');
                }
            },
            error: function(error) {
                console.log('Error:', error);
            }
        });
    });

    // Handle the deletion of recurring messages
    $(document).on('click', '.delete-recurring-message', function() {
        var messageId = $(this).data('id');
        var confirmation = confirm('Are you sure you want to delete this recurring message?');

        if (confirmation) {
            $.ajax({
                url: `/channels/delete-recurring-message/${messageId}/`,
                method: 'POST',
                data: {
                    'csrfmiddlewaretoken': $('input[name="csrfmiddlewaretoken"]').val()
                },
                success: function(response) {
                    if (response.success) {
                        showNotification("Recurring message prevented successfully");
                        // Refresh the modal to reflect the change
                        $("#monitor-recurring-messages-btn").click();
                    } else {
                        alert('Error: Could not delete the message');
                    }
                },
                error: function(error) {
                    showNotification("Recurring message has been prevented successfully and will be no longer available Refresh the page to new changes",'Refresh', window.location.href);
                }
            });
        }
    });
});



// MANAGE ABUSIVE MESSAGES IN CHANNEL 

document.addEventListener("DOMContentLoaded", function () {
    const orgId = "{{channel.organization.id}}"; 
    const channelId = "{{channel.id}}"; 

    // Fetch flagged messages when the modal is opened
    document.getElementById("warnModal").addEventListener("show.bs.modal", function () {
        fetch(`/channels/fetch-flagged-messages/${orgId}/${channelId}/`)
            .then(response => response.json())
            .then(data => {
                const tableBody = document.getElementById("flaggedMessagesTable");
                tableBody.innerHTML = ""; // Clear previous entries

                if (data.messages.length > 0) {
                    data.messages.forEach((message, index) => {
                        const row = `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${message.message_content}</td>
                                <td>${message.flagged_by}</td>
                                <td>${message.flagged_at}</td>
                                <td>
                                    <button class="btn btn-warning btn-sm warn-button" data-message-id="${message.id}">
                                        Warn User
                                    </button>
                                </td>
                            </tr>
                        `;
                        tableBody.insertAdjacentHTML("beforeend", row);
                    });

                    // Attach event listeners to warn buttons
                    document.querySelectorAll(".warn-button").forEach(button => {
                        button.addEventListener("click", function () {
                            const messageId = this.dataset.messageId;
                            sendWarning(messageId);
                        });
                    });
                } else {
                    tableBody.innerHTML = "<tr><td colspan='5'>No flagged messages found.</td></tr>";
                }
            })
            .catch(error => console.error("Error fetching flagged messages:", error));
    });

    // Send warning email
    function sendWarning(messageId) {
        // Show the loading spinner and message
        document.getElementById("loadingSpinner").style.display = "block";

        // Hide the table while loading
        document.getElementById("flaggedMessagesTable").style.display = "none";

        fetch(`/channels/warn-user/${messageId}/`, {
            method: "POST",
            headers: {
                "X-CSRFToken": getCSRFToken(),
                "Content-Type": "application/json",
            },
        })
            .then(response => response.json())
            .then(data => {
                // Hide the spinner after the request completes
                document.getElementById("loadingSpinner").style.display = "none";
                
                // Show the table again
                document.getElementById("flaggedMessagesTable").style.display = "table-row-group";

                if (data.success) {
                    alert("Warning email sent successfully!");
                } else {
                    alert("Failed to send warning: " + data.error);
                }
            })
            .catch(error => {
                console.error("Error sending warning:", error);

                // Hide the spinner if there was an error
                document.getElementById("loadingSpinner").style.display = "none";
                
                // Show the table again
                document.getElementById("flaggedMessagesTable").style.display = "table-row-group";
            });
    }

    // Function to get CSRF token
    function getCSRFToken() {
        return document.querySelector('[name=csrfmiddlewaretoken]').value;
    }
});



// MANAGE EVENTS(ADMIN ONLY)
// CSRF token setup for Django
const getCookie = (name) => {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        const cookies = document.cookie.split("; ");
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].split("=");
            if (cookie[0] === name) {
                cookieValue = decodeURIComponent(cookie[1]);
                break;
            }
        }
    }
    return cookieValue;
};
const csrftoken = getCookie("csrftoken");

// Fetch and display existing events on page load
const orgIId = "{{ channel.organization.id }}";
const channellId = "{{ channel.id }}";

fetch(`/channels/channels/${orgIId}/save/${channellId}/`, {
    method: "GET",
    headers: {
        "Content-Type": "application/json",
        "X-CSRFToken": csrftoken,
    },
})
.then(response => response.json())
.then(data => {
    if (data.events) {
        const tableBody = document.querySelector("#eventsTable tbody");
        data.events.forEach(event => {
            const newRow = `
                <tr>
                    <td contenteditable="true" class="event-name">${event.event_name}</td>
                    <td contenteditable="true" class="event-date">${event.event_date}</td>
                    <td contenteditable="true" class="event-details">${event.event_details}</td>
                    <td contenteditable="true" class="event-link">${event.event_link}</td>
                </tr>`;
            tableBody.insertAdjacentHTML("beforeend", newRow);
        });
    } else {
        console.log("No events found.");
    }
})
.catch(error => console.error("Error fetching events:", error));

// Function to fetch users based on the current @ input
const fetchUsers = async () => {
    try {
        const response = await fetch(`/channels/fetch-users/${orgIId}/${channellId}/`, {
            method: "GET",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": csrftoken,
            },
        });
        const data = await response.json();
        if (data.users) {
            return data.users;
        } else {
            console.error("No users found.");
            return [];
        }
    } catch (error) {
        console.error("Error fetching users:", error);
        return [];
    }
};

// Function to show the list of users
const showUserList = (users, targetElement) => {
    const userList = document.createElement("ul");
    userList.classList.add("user-list"); // You can style this in CSS
    
    users.forEach(user => {
        const userItem = document.createElement("li");
        userItem.innerText = user.username;
        userItem.addEventListener("click", () => {
            targetElement.innerText = "@" + user.username; // Insert username in the target column
            userList.remove(); // Hide the user list after selection
        });
        userList.appendChild(userItem);
    });

    targetElement.appendChild(userList);
};

// Add Event Listener for editable fields
document.querySelector("#eventsTable").addEventListener("input", async (event) => {
    const targetElement = event.target;
    if (targetElement.contentEditable === "true" && targetElement.innerText.includes("@")) {
        const atSignPosition = targetElement.innerText.indexOf("@");
        const users = await fetchUsers();
        
        // Remove previous user list if any
        const existingList = targetElement.querySelector(".user-list");
        if (existingList) {
            existingList.remove();
        }

        if (users.length > 0) {
            showUserList(users, targetElement);
        }
    }
});

// Add a new row to the table
document.getElementById("addRow").addEventListener("click", () => {
    const tableBody = document.querySelector("#eventsTable tbody");
    const newRow = `
        <tr>
            <td contenteditable="true" class="event-name"></td>
            <td contenteditable="true" class="event-date"></td>
            <td contenteditable="true" class="event-details"></td>
            <td contenteditable="true" class="event-link"></td>
        </tr>`;
    tableBody.insertAdjacentHTML("beforeend", newRow);
});

// Auto-save data on content change
document.querySelector("#eventsTable").addEventListener("input", (event) => {
    const targetRow = event.target.closest("tr");
    if (targetRow) {
        const eventName = targetRow.querySelector(".event-name").innerText.trim();
        const eventDate = targetRow.querySelector(".event-date").innerText.trim();
        const eventDetails = targetRow.querySelector(".event-details").innerText.trim();
        const eventLink = targetRow.querySelector(".event-link").innerText.trim();

        // Check if all fields are filled
        if (eventName && eventDate && eventDetails && eventLink) {
            fetch(`/channels/channels/${orgIId}/save/${channellId}/`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": csrftoken,
                },
                body: JSON.stringify({
                    event_name: eventName,
                    event_date: eventDate,
                    event_details: eventDetails,
                    event_link: eventLink,
                }),
            })
            .then((response) => response.json())
            .then((data) => {
                if (data.success) {
                    console.log("Event saved successfully:", data);
                } else {
                    console.error("Error saving event:", data.message || data.error);
                }
            })
            .catch((error) => console.error("Network error:", error));
        } else {
            console.log("All fields are required to save the event.");
        }
    }
});








// DRAG AND DROP COLOMS
document.addEventListener("DOMContentLoaded", () => {
    const table = document.querySelector("#eventsTable");

    // Add draggable attribute to each column header
    const headers = table.querySelectorAll("th");
    headers.forEach((header, index) => {
        header.setAttribute("draggable", true);
        header.setAttribute("data-index", index);

        // Handle drag start
        header.addEventListener("dragstart", (event) => {
            event.dataTransfer.setData("text/plain", index);
        });

        // Allow drop
        header.addEventListener("dragover", (event) => {
            event.preventDefault();
        });

        // Handle drop
        header.addEventListener("drop", (event) => {
            event.preventDefault();
            const draggedIndex = event.dataTransfer.getData("text/plain");
            const targetIndex = header.getAttribute("data-index");

            if (draggedIndex !== targetIndex) {
                swapColumns(draggedIndex, targetIndex);
            }
        });
    });

    // Function to swap columns
    function swapColumns(draggedIndex, targetIndex) {
        const rows = table.querySelectorAll("tr");

        rows.forEach((row) => {
            const cells = row.querySelectorAll("td, th");
            if (cells[draggedIndex] && cells[targetIndex]) {
                // Swap the dragged and target columns
                row.insertBefore(cells[draggedIndex], cells[targetIndex]);
            }
        });

        // Update header indices after swap
        headers.forEach((header, index) => {
            header.setAttribute("data-index", index);
        });
    }

    // Add new rows dynamically
    const addRowButton = document.querySelector("#addRow");
    addRowButton.addEventListener("click", () => {
        const tableBody = document.querySelector("#eventsTableBody");
        const newRow = document.createElement("tr");

        // Add contenteditable cells
        ["event-name", "event-date", "event-details", "event-link"].forEach((className) => {
            const cell = document.createElement("td");
            cell.setAttribute("contenteditable", "true");
            cell.classList.add(className);
            newRow.appendChild(cell);
        });

        tableBody.appendChild(newRow);
    });
});


// DISPLAY EVENT DETAILS 

document.getElementById("fetchEventDetailsBtn").addEventListener("click", function() {
    // Get the event details from the button's data attributes
    const orgId = this.getAttribute("data-org-id");
    const channelId = this.getAttribute("data-channel-id");

    // Fetch event details using AJAX
    fetch(`/channels/events/fetch/${orgId}/${channelId}/`)
        .then(response => response.json())
        .then(data => {
            // Clear previous data in the table
            const tableBody = document.getElementById("eventDetailsTable").getElementsByTagName("tbody")[0];
            tableBody.innerHTML = ""; // Reset the table body

            // Check if there are events
            if (data.events.length === 0) {
                const row = tableBody.insertRow();
                const cell = row.insertCell(0);
                cell.colSpan = 7; // Adjust for new column
                cell.innerText = "No events found.";
            } else {
                // Dynamically fill the table with event details
                data.events.forEach(event => {
                    const row = tableBody.insertRow();

                    // Event Name
                    row.insertCell(0).innerText = event.event_name;

                    // Event Date/Time
                    row.insertCell(1).innerText = event.event_date;

                    // Event Details
                    row.insertCell(2).innerText = event.event_details;

                    // Event Attachment
                    const cell4 = row.insertCell(3);
                    if (event.event_attachment) {
                        const attachmentLink = document.createElement("a");
                        attachmentLink.href = event.event_attachment;
                        attachmentLink.target = "_blank";
                        attachmentLink.innerText = "Download";
                        cell4.appendChild(attachmentLink);
                    } else {
                        cell4.innerText = "No Attachment";
                    }

                    // Event Link
                    const cell5 = row.insertCell(4);
                    if (event.event_link) {
                        const eventLink = document.createElement("a");
                        eventLink.href = event.event_link;
                        eventLink.target = "_blank";
                        eventLink.innerText = "Go to Event";
                        cell5.appendChild(eventLink);
                    } else {
                        cell5.innerText = "No Link";
                    }

                    // Created By
                    row.insertCell(5).innerText = event.created_by;

                    // Action: Mark as Attending
                    const cell7 = row.insertCell(6);
                    const attendButton = document.createElement("button");
                    attendButton.className = "btn btn-primary btn-sm";
                    attendButton.innerText = "Mark as Attending";
                    attendButton.addEventListener("click", () => {
                        // Show a spinner while processing
                        attendButton.disabled = true; // Disable button
                        attendButton.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Processing...';

                        // Send attendance information via URL
                        fetch(`/channels/mark_attending/${orgId}/${channelId}/${event.id}/`, {
                            method: "GET" // Using GET for simplicity, adjust as per your backend
                        })
                        .then(response => {
                            if (response.ok) {
                             
                                showNotification(`Marked as attending for ${event.event_name}`);

                            } else {
                                alert(`Failed to mark attendance for ${event.event_name}`);
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert("An error occurred while marking attendance.");
                        })
                        .finally(() => {
                            // Re-enable button and restore text
                            attendButton.disabled = false;
                            attendButton.innerHTML = "Mark as Attending";
                        });
                    });
                    cell7.appendChild(attendButton);
                });
            }
        })
        .catch(error => {
            console.error('Error fetching event details:', error);
        });
});




// CHANNEL SETTINGS
// Get CSRF token from the DOM (ensure it's rendered in your template)
const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

// When the modal is opened, fetch and display settings
document.getElementById('settingsModal').addEventListener('show.bs.modal', function () {
    const orgId = "{{channel.organization.id}}";  // Replace with actual organization ID
    const channelId = "{{channel.id}}";  // Replace with actual channel ID

    // Fetch the settings
    fetch(`/channels/channel_settings/${orgId}/${channelId}/`, {
        method: 'GET',
        headers: {
            'X-CSRFToken': csrfToken,
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        if (data.allow_media_uploads !== undefined) {
            document.getElementById('allowMediaUploads').checked = data.allow_media_uploads;
        }
        if (data.allow_codes !== undefined) {
            document.getElementById('allowCodes').checked = data.allow_codes;
        }
        if (data.secure_from_unwanted_requests !== undefined) {
            document.getElementById('secureFromUnwantedRequests').checked = data.secure_from_unwanted_requests;
        }
        if (data.allow_polls !== undefined) {
            document.getElementById('allowPolls').checked = data.allow_polls;
        }
        if (data.allow_sharing_access_to_another_workspace !== undefined) {
            document.getElementById('allowSharingAccess').checked = data.allow_sharing_access_to_another_workspace;
        }
        if (data.track_abusive_messages !== undefined) {
            document.getElementById('trackAbusiveMessages').checked = data.track_abusive_messages;
        }
        if (data.allow_integrations !== undefined) {
            document.getElementById('allowIntegrations').checked = data.allow_integrations;
        }
        if (data.integration_choices) {
            document.getElementById('integrationChoices').value = data.integration_choices;
        }
    })
    .catch(error => console.error('Failed to fetch settings:', error));
});

// Save settings automatically as user toggles
const settingsForm = document.getElementById('settingsForm');
settingsForm.addEventListener('change', function () {
    const settingsData = {
        allow_media_uploads: document.getElementById('allowMediaUploads').checked,
        allow_codes: document.getElementById('allowCodes').checked,
        secure_from_unwanted_requests: document.getElementById('secureFromUnwantedRequests').checked,
        allow_polls: document.getElementById('allowPolls').checked,
        allow_sharing_access_to_another_workspace: document.getElementById('allowSharingAccess').checked,
        track_abusive_messages: document.getElementById('trackAbusiveMessages').checked,
        allow_integrations: document.getElementById('allowIntegrations').checked,
        integration_choices: document.getElementById('integrationChoices').value
    };

    const orgId = "{{channel.organization.id}}";  // Replace with actual organization ID
    const channelId = "{{channel.id}}";  // Replace with actual channel ID

    // Send settings to the server via AJAX
    fetch(`/channels/channel_settings/${orgId}/${channelId}/`, {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrfToken,
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(settingsData)
    })
    .then(response => response.json())
    .then(data => {
        console.log('Settings saved successfully');
    })
    .catch(error => console.error('Failed to save settings:', error));
});

















// DELETE CHANNEL DATA

// Bootstrap 5 Modal Instances
const deleteChannelDataModal = new bootstrap.Modal(document.getElementById('deleteChannelDataModal'));
  const deleteChannelPasswordModal = new bootstrap.Modal(document.getElementById('deleteChannelPasswordModal'));

  // Open the Select Data Modal
  document.getElementById('deleteChannelDataBtn').addEventListener('click', () => {
    deleteChannelDataModal.show();
  });

  // Handle Next Button in Select Data Modal
  document.getElementById('nextToPasswordModalBtn').addEventListener('click', () => {
    const selectedOptions = [];
    if (document.getElementById('deleteMessagesOption').checked) selectedOptions.push('messages');
    if (document.getElementById('deleteLinksOption').checked) selectedOptions.push('links');
    if (document.getElementById('deleteAudioOption').checked) selectedOptions.push('audio');
    if (document.getElementById('deleteVideoOption').checked) selectedOptions.push('video');
    if (document.getElementById('deleteActivityLogsOption').checked) selectedOptions.push('activity');

    if (selectedOptions.length > 0) {
      deleteChannelDataModal.hide();
      deleteChannelPasswordModal.show();
    } else {
      alert('Please select at least one type of data to delete.');
    }
  });

  // Handle Submit Button in Password Modal
  document.getElementById('submitChannelPasswordBtn').addEventListener('click', () => {
    const password = document.getElementById('channelPasswordInput').value;
    const selectedOptions = [];
    if (document.getElementById('deleteMessagesOption').checked) selectedOptions.push('messages');
    if (document.getElementById('deleteLinksOption').checked) selectedOptions.push('links');
    if (document.getElementById('deleteAudioOption').checked) selectedOptions.push('audio');
    if (document.getElementById('deleteVideoOption').checked) selectedOptions.push('video');
    if (document.getElementById('deleteActivityLogsOption').checked) selectedOptions.push('activity');

    fetch('{% url "delete_channel_data" org_id=channel.organization.id channel_id=channel.id %}', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': '{{ csrf_token }}',
      },
      body: JSON.stringify({
        password: password,
        data_to_delete: selectedOptions,
      }),
    })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Data deleted successfully!');
        } else {
            showNotification('Channels selected data deleted successfully. Please refresh the page for new changes.', 'Refresh', window.location.href);
        }
        deleteChannelPasswordModal.hide();
      })
      .catch(error => {
        console.error('Error:', error);
        alert('An error occurred. Please try again.');
        deleteChannelPasswordModal.hide();
      });
  });


// CUSTOM NOTIFICATION FUNCTION

function showNotification(message, linkText, linkUrl) {
    const notificationContainer = document.createElement('div');
    notificationContainer.style.position = 'fixed';
    notificationContainer.style.top = '20px';
    notificationContainer.style.right = '20px';
    notificationContainer.style.padding = '15px 20px';
    notificationContainer.style.backgroundColor = '#007bff'; // Fresh blue
    notificationContainer.style.color = 'white';
    notificationContainer.style.borderRadius = '15px';
    notificationContainer.style.fontSize = '16px';
    notificationContainer.style.zIndex = '1000';
    notificationContainer.style.display = 'flex';
    notificationContainer.style.alignItems = 'center';
    notificationContainer.style.opacity = '0';
    notificationContainer.style.transform = 'translateX(100%)';
    notificationContainer.style.transition = 'transform 0.6s ease-out, opacity 0.6s ease-out'; // Smooth animation

    // Adding a checkmark icon with a bit of style
    const checkmark = document.createElement('span');
    checkmark.textContent = '✔'; // Checkmark symbol
    checkmark.style.fontSize = '24px';
    checkmark.style.marginRight = '15px';
    checkmark.style.transform = 'rotate(10deg)'; // Slightly rotate for a fun touch

    const messageElement = document.createElement('span');
    messageElement.textContent = message;
    messageElement.style.flexGrow = '1'; // Allow message to grow and use remaining space
    messageElement.style.fontWeight = '500';

    const linkElement = document.createElement('a');
    linkElement.textContent = linkText;
    linkElement.href = linkUrl;
    linkElement.style.color = '#ffffff';
    linkElement.style.textDecoration = 'underline';
    linkElement.style.marginLeft = '15px';
    linkElement.style.fontWeight = 'bold';

    // Append the checkmark, message, and link to the notification
    notificationContainer.appendChild(checkmark);
    notificationContainer.appendChild(messageElement);
    notificationContainer.appendChild(linkElement);

    // Append the notification to the body
    document.body.appendChild(notificationContainer);

    // Trigger animation to make the notification slide in
    setTimeout(() => {
        notificationContainer.style.opacity = '1';
        notificationContainer.style.transform = 'translateX(0)';
    }, 100);

    // Remove the notification after 5 seconds
    setTimeout(() => {
        notificationContainer.style.opacity = '0';
        notificationContainer.style.transform = 'translateX(100%)';
        setTimeout(() => {
            notificationContainer.remove();
        }, 600); // Allow time for animation to finish
    }, 5000);
}


</script>

   <!-- Add Bootstrap 5 JS just before the closing </body> tag -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<br><br><br><br><br><br><br>
{% include 'footer.html' %}