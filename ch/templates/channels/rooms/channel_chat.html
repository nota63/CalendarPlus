
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{% csrf_token %}">
    <title>Chat in Channel: {{ channel.name }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">

    <!-- Add Bootstrap 5 CSS in your <head> section -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<style>
  /* Style for the modal */
  .modal-content {
        background-color: #f8f9fa; /* Light background for modal */
        border-radius: 15px;
        padding: 20px;
    }

    /* Title of the modal */
    .modal-title {
        font-size: 1.5rem;
        font-weight: bold;
        color: #007bff;
    }

    /* Table style inside modal */
    .modal-body table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    .modal-body table th,
    .modal-body table td {
        padding: 10px;
        text-align: left;
        border: 1px solid #ddd;
    }

    .modal-body table th {
        background-color: #007bff;
        color: #fff;
    }

    .modal-body table td {
        background-color: #f1f1f1;
    }

    /* Members List */
    #membersList {
        margin-top: 15px;
        list-style: none;
        padding: 0;
    }

    #membersList li {
        padding: 5px 0;
        font-size: 1rem;
        color: #333;
    }

    #membersList li:hover {
        background-color: #f1f1f1;
    }

    /* Footer styling */
    .modal-footer {
        background-color: #f1f1f1;
        border-top: 1px solid #ddd;
        padding: 10px;
    }

    .modal-footer .btn-secondary {
        background-color: #6c757d;
        color: white;
    }

    .modal-footer .btn-secondary:hover {
        background-color: #5a6268;
    }



    .popup-message {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%);
    padding: 10px 20px;
    background-color: #007bff;
    color: white;
    border-radius: 5px;
    font-size: 16px;
    z-index: 9999;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
}

/* Emoji Picker Modal Styling */
#emojiPickerModal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
    width: 80%;
    max-width: 500px;
    padding: 20px;
    display: none; /* Initially hidden */
    opacity: 0;
    transition: opacity 0.3s ease, transform 0.3s ease;
    z-index: 1000; /* Ensure it's above other content */
    text-align: center; /* Center content horizontally */
}

/* When the modal is visible */
#emojiPickerModal.show {
    display: block;
    opacity: 1;
    transform: translate(-50%, -50%) scale(1);
}

/* Emoji container styling */
#emojiContainer {
    display: grid;
    grid-template-columns: repeat(6, 1fr); /* 6 emojis per row */
    gap: 10px;
    justify-items: center; /* Center emojis in the grid */
    align-items: center;
    overflow-y: auto;
    max-height: 250px;
    padding: 10px;
}

/* Adjust the grid layout for smaller screens */
@media (max-width: 600px) {
    #emojiContainer {
        grid-template-columns: repeat(4, 1fr); /* 4 emojis per row on smaller screens */
    }
}

@media (max-width: 400px) {
    #emojiContainer {
        grid-template-columns: repeat(3, 1fr); /* 3 emojis per row on very small screens */
    }
}

/* Individual emoji button styling */
.emoji {
    font-size: 30px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 12px;
    border-radius: 8px;
    background-color: #f5f5f5;
    transition: background-color 0.2s ease, transform 0.2s ease;
    text-align: center;
}

/* Hover effect on emojis */
.emoji:hover {
    background-color: #e0e0e0;
    transform: scale(1.2);
}

/* Close button for the modal - Highlighted in red */
#closeEmojiPickerModal {
    position: absolute;
    top: 10px;
    right: 10px;
    background: none;
    border: none;
    color: red; /* Red color for close button */
    font-size: 20px;
    cursor: pointer;
    transition: color 0.2s ease;
}

/* Close button hover effect */
#closeEmojiPickerModal:hover {
    color: darkred; /* Darker red on hover */
}

/* Add smooth fade-in animation */
@keyframes fadeIn {
    0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.9);
    }
    100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
}

#emojiPickerModal.show {
    animation: fadeIn 0.3s ease forwards;
}




/* Modal Background */
.hidden {
    display: none;
}

.fixed {
    position: fixed;
}

.inset-0 {
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
}

.bg-gray-600 {
    background-color: rgba(0, 0, 0, 0.6);
}

.bg-opacity-50 {
    background-color: rgba(0, 0, 0, 0.5);
}

/* Modal Box */
.bg-white {
    background-color: #ffffff;
}

.p-6 {
    padding: 1.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.w-1/3 {
    width: 33.33%;
}

/* Modal Title */
.text-xl {
    font-size: 1.25rem;
}

.font-bold {
    font-weight: bold;
}

.mb-4 {
    margin-bottom: 1rem;
}

/* Input and Buttons */
.border {
    border: 1px solid #ccc;
}

.p-2 {
    padding: 0.5rem;
}

.w-full {
    width: 100%;
}

.mb-4 {
    margin-bottom: 1rem;
}

.bg-blue-500 {
    background-color: #3b82f6;
}

.text-white {
    color: #ffffff;
}

.ml-2 {
    margin-left: 0.5rem;
}

.flex {
    display: flex;
}

.justify-end {
    justify-content: flex-end;
}

/* Modal Animation */
@keyframes modalFadeIn {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes modalFadeOut {
    0% {
        opacity: 1;
        transform: scale(1);
    }
    100% {
        opacity: 0;
        transform: scale(0.8);
    }
}

#audioUploadModal, #videoUploadModal {
    animation: modalFadeIn 0.3s ease-out forwards;
}

.hidden #audioUploadModal, .hidden #videoUploadModal {
    animation: modalFadeOut 0.3s ease-in forwards;
}





/* Modal Background */
.hidden {
    display: none;
}

.fixed {
    position: fixed;
}

.inset-0 {
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
}

.bg-gray-600 {
    background-color: rgba(0, 0, 0, 0.6);
}

.bg-opacity-50 {
    background-color: rgba(0, 0, 0, 0.5);
}

/* Modal Box */
.bg-white {
    background-color: #ffffff;
}

.p-6 {
    padding: 1.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.w-1/3 {
    width: 33.33%;
}

/* Modal Title */
.text-xl {
    font-size: 1.25rem;
}

.font-bold {
    font-weight: bold;
}

.mb-4 {
    margin-bottom: 1rem;
}

/* Input Fields */
.border {
    border: 1px solid #ccc;
}

.p-2 {
    padding: 0.5rem;
}

.w-full {
    width: 100%;
}

.mb-4 {
    margin-bottom: 1rem;
}

/* List of Users (Mention Modal) */
#mentionList {
    max-height: 200px;
    overflow-y: auto;
    margin-bottom: 1rem;
}

#mentionList li {
    padding: 0.5rem;
    border: 1px solid #ddd;
    border-radius: 0.25rem;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

#mentionList li:hover {
    background-color: #f0f0f0;
}

/* Buttons */
.bg-blue-500 {
    background-color: #3b82f6;
}

.bg-gray-500 {
    background-color: #6b7280;
}

.text-white {
    color: #ffffff;
}

.ml-2 {
    margin-left: 0.5rem;
}

.flex {
    display: flex;
}

.justify-end {
    justify-content: flex-end;
}

/* Modal Animation */
@keyframes modalFadeIn {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes modalFadeOut {
    0% {
        opacity: 1;
        transform: scale(1);
    }
    100% {
        opacity: 0;
        transform: scale(0.8);
    }
}

#mentionModal, #sendLinkModal {
    animation: modalFadeIn 0.3s ease-out forwards;
}

.hidden #mentionModal, .hidden #sendLinkModal {
    animation: modalFadeOut 0.3s ease-in forwards;
}




/* Modal Background */
.hidden {
    display: none;
}

.fixed {
    position: fixed;
}

.inset-0 {
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
}

.bg-gray-600 {
    background-color: rgba(0, 0, 0, 0.6);
}

.bg-opacity-50 {
    background-color: rgba(0, 0, 0, 0.5);
}

/* Modal Box */
.bg-white {
    background-color: #ffffff;
}

.p-6 {
    padding: 1.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.w-1/3 {
    width: 33.33%;
}

/* Modal Title */
.text-xl {
    font-size: 1.25rem;
}

.font-bold {
    font-weight: bold;
}

.mb-4 {
    margin-bottom: 1rem;
}

/* Coming Soon Icon */
#comingSoonIcon {
    font-size: 3rem;
    color: #ffcc00;
    margin-bottom: 1rem;
}

/* Modal Content */
p {
    font-size: 1rem;
    color: #333;
    margin-bottom: 1.5rem;
}

/* Button */
.bg-gray-500 {
    background-color: #6b7280;
}

.text-white {
    color: #ffffff;
}

.p-2 {
    padding: 0.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

/* Modal Animation */
@keyframes modalFadeIn {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes modalFadeOut {
    0% {
        opacity: 1;
        transform: scale(1);
    }
    100% {
        opacity: 0;
        transform: scale(0.8);
    }
}

#comingSoonModal {
    animation: modalFadeIn 0.5s ease-out forwards;
}

.hidden #comingSoonModal {
    animation: modalFadeOut 0.3s ease-in forwards;
}


/* sidebar styles */
/* Sidebar Style */
.sidebar {
    position: fixed;
    top: 0;
    left: 0;
    width: 280px;
    height: 100%;
    background-color: #2f3136; /* Dark background for a polished look */
    color: #fff;
    padding-top: 30px;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    border-right: 2px solid #444; /* Subtle border for a defined edge */
    box-shadow: 2px 0px 10px rgba(0, 0, 0, 0.5); /* Shadow effect for depth */
}

/* Header Section */
.sidebar-header h2 {
    font-size: 24px;
    font-weight: bold;
    margin-left: 20px;
    color: #f1f1f1; /* Lighter text for the header */
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 20px;
}

/* Menu Items */
.sidebar-menu {
    flex-grow: 1;
    margin-top: 20px;
    margin-bottom: 20px;
}

.menu-item {
    width: 100%;
    padding: 12px 20px;
    font-size: 16px;
    text-align: left;
    color: #b9bbbe;
    background-color: transparent;
    border: none;
    cursor: pointer;
    border-radius: 6px;
    transition: background-color 0.3s ease, color 0.3s ease;
    display: flex;
    align-items: center;
}

.menu-item:hover {
    background-color: #404850; /* Darker gray background on hover */
    color: #fff; /* Change text color to white */
}

/* Active State for Menu Items */
.menu-item.active {
    background-color: #007bff;
    color: #fff;
}

/* Icon next to text (optional) */
.menu-item i {
    margin-right: 10px; /* Space for icons */
}

/* Footer Section */
.sidebar-footer {
    margin-top: auto;
    padding-bottom: 20px;
    padding-left: 20px;
}

.sidebar-footer .menu-item {
    margin-top: 10px;
    padding: 12px 20px;
    font-size: 16px;
    color: #b9bbbe;
    border-radius: 6px;
}

.sidebar-footer .menu-item:hover {
    background-color: #404850;
}

/* Responsive Design for smaller screens */
@media screen and (max-width: 768px) {
    .sidebar {
        width: 220px; /* Adjust sidebar width for mobile */
    }

    .sidebar-header h2 {
        font-size: 20px;
    }

    .menu-item {
        font-size: 14px;
        padding: 10px 15px;
    }
}
/* Modal Background */
.hidden {
    display: none;
}

.fixed {
    position: fixed;
}

.inset-0 {
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
}

.bg-gray-600 {
    background-color: rgba(0, 0, 0, 0.6);
}

.bg-opacity-50 {
    background-color: rgba(0, 0, 0, 0.5);
}

/* Modal Box */
.bg-white {
    background-color: #ffffff;
}

.p-6 {
    padding: 1.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.w-1/3 {
    width: 33.33%;
}

/* Modal Title */
.text-xl {
    font-size: 1.25rem;
}

.font-bold {
    font-weight: bold;
}

.mb-4 {
    margin-bottom: 1rem;
}

/* Coming Soon Icon */
#comingSoonIcon {
    font-size: 3rem;
    color: #ffcc00;
    margin-bottom: 1rem;
}

/* Modal Content */
p {
    font-size: 1rem;
    color: #333;
    margin-bottom: 1.5rem;
}

/* Button */
.bg-gray-500 {
    background-color: #6b7280;
}

.text-white {
    color: #ffffff;
}

.p-2 {
    padding: 0.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

/* Modal Animation */
@keyframes modalFadeIn {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes modalFadeOut {
    0% {
        opacity: 1;
        transform: scale(1);
    }
    100% {
        opacity: 0;
        transform: scale(0.8);
    }
}

#filterModal {
    animation: modalFadeIn 0.5s ease-out forwards;
}

.hidden #filterModal {
    animation: modalFadeOut 0.3s ease-in forwards;
}






/* Styling the main section */
.channel-info {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    background-color: #1a1a1a; /* Dark background */
    color: #fff; /* White text color */
    border-radius: 8px;
    width: 70%; /* Reduce width */
    max-width: 600px; /* Maximum width */
    margin-top: 40px; /* Space from the top of the page */
}

/* Styling the container holding image and text */
.channel-info-container {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    width: 100%;
}

/* Styling the image */
.channel-image {
    width: 60px; /* Reduced image size */
    height: auto;
    border-radius: 50%;
    margin-right: 15px; /* Space between image and text */
}

/* Styling the text section */
.channel-text {
    max-width: 450px; /* Reduced max width of the text section */
}

/* Heading Style */
.text-primary {
    font-size: 1.2rem; /* Smaller heading */
    color: #4e73df; /* Blue color for title */
    margin-bottom: 10px;
}

/* Text Style */
.text-muted {
    font-size: 0.9rem; /* Smaller text size */
    color: #a0a0a0; /* Muted gray for description text */
}





/* Modal Background */
.hidden {
    display: none;
}

.fixed {
    position: fixed;
}

.inset-0 {
    top: 0;
    right: 0;
    bottom: 0;
    left: 0;
}

.bg-gray-600 {
    background-color: rgba(0, 0, 0, 0.6);
}

.bg-opacity-50 {
    background-color: rgba(0, 0, 0, 0.5);
}

/* Modal Box */
.bg-white {
    background-color: #ffffff;
}

.p-6 {
    padding: 1.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

.w-1/3 {
    width: 33.33%;
}

/* Modal Title */
.text-xl {
    font-size: 1.25rem;
}

.font-bold {
    font-weight: bold;
}

.mb-4 {
    margin-bottom: 1rem;
}

/* Coming Soon Icon */
#comingSoonIcon {
    font-size: 3rem;
    color: #ffcc00;
    margin-bottom: 1rem;
}

/* Modal Content */
p {
    font-size: 1rem;
    color: #333;
    margin-bottom: 1.5rem;
}

/* Button */
.bg-gray-500 {
    background-color: #6b7280;
}

.text-white {
    color: #ffffff;
}

.p-2 {
    padding: 0.5rem;
}

.rounded-lg {
    border-radius: 0.5rem;
}

/* Modal Animation */
@keyframes modalFadeIn {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes modalFadeOut {
    0% {
        opacity: 1;
        transform: scale(1);
    }
    100% {
        opacity: 0;
        transform: scale(0.8);
    }
}

#deleteMessagesModal {
    animation: modalFadeIn 0.5s ease-out forwards;
}

.hidden #deleteMessagesModal {
    animation: modalFadeOut 0.3s ease-in forwards;
}


.menu-dropdown {
    display: none;
}

.menu-button:hover + .menu-dropdown,
.menu-button:focus + .menu-dropdown {
    display: block;
}


</style>





<!-- Modal for displaying the user list -->
<div id="userListModal" class="modal fade" tabindex="-1" aria-labelledby="userListModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="userListModalLabel">Channel Users including you</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul id="userList" class="list-group">
                    <!-- List of users will be dynamically populated here -->
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Bootstrap 5 Modal to show the logs -->
<div class="modal fade" id="activityLogsModal" tabindex="-1" aria-labelledby="activityLogsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="activityLogsModalLabel">Activity Logs</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" style="max-height: 400px; overflow-y: auto;">
                <div id="activityLogsList" class="list-group">
                    <!-- Logs will be dynamically populated here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal for Channel Details -->
<div id="channelDetailsModal" class="modal fade" tabindex="-1" aria-labelledby="channelDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="channelDetailsModalLabel">Channel Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- About Section -->
                <h5>About</h5>
                <p><i class="bi bi-card-text text-primary" style="font-size: 1.2rem;"></i> <strong>Name:</strong> <span id="channelName"></span></p>
                <p><i class="bi bi-type text-primary" style="font-size: 1.2rem;"></i> <strong>Type:</strong> <span id="channelType"></span></p>
                <p><i class="bi bi-eye text-primary" style="font-size: 1.2rem;"></i> <strong>Visibility:</strong> <span id="channelVisibility"></span></p>
                <p><i class="bi bi-calendar text-primary" style="font-size: 1.2rem;"></i> <strong>Created At:</strong> <span id="channelCreatedAt"></span></p>
                <p><i class="bi bi-person text-primary" style="font-size: 1.2rem;"></i> <strong>Created By:</strong> <span id="channelCreatedBy"></span></p>

                <!-- Members Section -->
                <h5>Members</h5>
                <ul id="membersList" class="list-group">
                    <!-- Members will be dynamically populated here -->
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Popup Message -->
<div id="popupMessage" class="popup-message" style="display: none;">
    We'll export the data and send it to {{request.user.email}}. You can proceed with other tasks in the meantime...
</div>




<!-- Modal to Display the Channel Statistics -->
<div class="modal fade" id="statisticsModal" tabindex="-1" aria-labelledby="statisticsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="statisticsModalLabel">Channel Statistics</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <h5>Total Messages: <span id="totalMessages"></span></h5>
          <h5>Total Links: <span id="totalLinks"></span></h5>
          <h5>King User: <span id="kingUser"></span></h5>
  
          <!-- Chart Section -->
          <div class="row">
            <!-- Messages Chart -->
            <div class="col-md-6 mb-4">
              <canvas id="messagesChart"></canvas>
            </div>
  
            <!-- Links Chart -->
            <div class="col-md-6 mb-4">
              <canvas id="linksChart"></canvas>
            </div>
  
            <!-- Chart 3: User Message Counts -->
            <div class="col-md-6 mb-4">
              <canvas id="userMessageCountsChart"></canvas>
            </div>
  
            <!-- Chart 4: User Link Counts -->
            <div class="col-md-6 mb-4">
              <canvas id="userLinkCountsChart"></canvas>
            </div>
  
            <!-- Chart 5: Total Messages -->
            <div class="col-md-6 mb-4">
              <canvas id="totalMessagesChart"></canvas>
            </div>
  
            <!-- Chart 6: Total Links -->
            <div class="col-md-6 mb-4">
              <canvas id="totalLinksChart"></canvas>
            </div>
  
            <!-- Chart 7: King User Stats -->
            <div class="col-md-6 mb-4">
              <canvas id="kingUserChart"></canvas>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>
  


  <!-- Coming Soon Modal -->
<div id="comingSoonModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg w-1/3">
        <div id="comingSoonIcon" class="flex justify-center">
            <i class="fas fa-clock"></i> <!-- Clock icon for "Coming Soon" -->
        </div>
        <h2 class="text-xl font-bold mb-4">Coming Soon...</h2>
        <p>This feature will be available soon. Stay tuned!</p>
        <div class="flex justify-end mt-4">
            <button id="closeComingSoonModal" class="bg-gray-500 text-white p-2 rounded-lg">Close</button>
        </div>
    </div>
</div>




<!-- Filter Modal -->
<div id="filterModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg w-1/3">
        <h2 class="text-xl font-bold mb-4">Select Filter Option</h2>
        
        <!-- Filter options -->
        <div>
            <input type="radio" id="today" name="filter" value="today">
            <label for="today" class="ml-2">Today</label>
        </div>
        <div>
            <input type="radio" id="yesterday" name="filter" value="yesterday">
            <label for="yesterday" class="ml-2">Yesterday</label>
        </div>
        <div>
            <input type="radio" id="last_week" name="filter" value="last_week">
            <label for="last_week" class="ml-2">Last Week</label>
        </div>
        <div>
            <input type="radio" id="last_month" name="filter" value="last_month">
            <label for="last_month" class="ml-2">Last Month</label>
        </div>
        <div>
            <input type="radio" id="specific_date" name="filter" value="specific_date">
            <label for="specific_date" class="ml-2">Specific Date</label>
            <input type="date" id="specificDate" class="ml-2 mt-2" style="display:none;">
        </div>

        <!-- Buttons -->
        <div class="flex justify-end mt-4">
            <button id="applyFilter" class="bg-blue-500 text-white p-2 rounded-lg">Apply</button>
            <button id="closeFilterModal" class="bg-gray-500 text-white p-2 ml-2 rounded-lg">Cancel</button>
        </div>
    </div>
</div>



<!-- Delete Messages Modal -->
<div id="deleteMessagesModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white p-6 rounded-lg w-1/3">
        <h2 class="text-xl font-bold text-red-500 mb-4">Delete All My Messages</h2>
        <p class="text-gray-700 mb-4">
            Please enter your password to confirm. This action cannot be undone.
        </p>
        <input 
            type="password" 
            id="passwordInput" 
            class="border p-2 w-full mb-4 rounded-lg" 
            placeholder="Enter your password"
        >
        <div class="flex justify-end">
            <button id="confirmDeleteButton" class="bg-red-500 text-white px-4 py-2 rounded-lg mr-2">
                Confirm
            </button>
            <button id="cancelDeleteButton" class="bg-gray-500 text-white px-4 py-2 rounded-lg">
                Cancel
            </button>
        </div>
    </div>
</div>



<!-- Edit Message Modal -->
<div class="modal fade" id="editMessageModal" tabindex="-1" aria-labelledby="editMessageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editMessageModalLabel">Edit Message</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <textarea id="editMessageContent" class="form-control" rows="4"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveEditButton">Save changes</button>
            </div>
        </div>
    </div>
</div>


<!-- Modal for editing link -->
<div class="modal fade" id="editLinkModal" tabindex="-1" aria-labelledby="editLinkModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editLinkModalLabel">Edit Link</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="editLinkForm">
                    <div class="mb-3">
                        <label for="editLinkText" class="form-label">Link Text</label>
                        <input type="text" class="form-control" id="editLinkText" required>
                    </div>
                    <div class="mb-3">
                        <label for="editLinkUrl" class="form-label">Link URL</label>
                        <input type="url" class="form-control" id="editLinkUrl" required>
                    </div>
                    <button type="button" id="saveEditLinkButton" class="btn btn-primary">Save Changes</button>
                </form>
            </div>
        </div>
    </div>
</div>



<!-- Modal for channel stats -->
<div 
    class="modal fade" 
    id="statsModal" 
    tabindex="-1" 
    aria-labelledby="statsModalLabel" 
    aria-hidden="true"
>
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="statsModalLabel">Memory usage of your messages links & media</h5>
                <button 
                    type="button" 
                    class="btn-close" 
                    data-bs-dismiss="modal" 
                    aria-label="Close"
                ></button>
            </div>
            <div class="modal-body">
                <canvas id="chartContainer" height="200"></canvas>
            </div>
        </div>
    </div>
</div>


<!-- Filter by User Modal -->
<div
    class="modal fade"
    id="filterByUserModal"
    tabindex="-1"
    aria-labelledby="filterByUserModalLabel"
    aria-hidden="true"
>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="filterByUserModalLabel">Filter by User</h5>
                <button
                    type="button"
                    class="btn-close"
                    data-bs-dismiss="modal"
                    aria-label="Close"
                ></button>
            </div>
            <div class="modal-body">
                <ul id="userListt" class="list-group">
                    <!-- Users will be dynamically added here -->
                </ul>
            </div>
        </div>
    </div>
</div>



<!-- ---------------------------------------------------------------------------------------------------------------------------------------------------------- -->


<br><br>
<!-- -------------------------------------------------------------------------------------------------------------------------------------------------------- -->

<section class="d-flex align-items-center py-3 ml-auto" style="max-width: 80%; justify-content: flex-end; margin-right: 20px;">
    <div class="d-flex align-items-center">
        <img src="https://th.bing.com/th/id/OIP.MQrqu3lrda8Tc7LOTnisxgHaHa?rs=1&pid=ImgDetMain" 
             class="img-fluid rounded-circle" 
             style="max-width: 80px; height: auto;" 
             alt="Channel Image">
        <div class="ms-3">
            <h2 class="text-primary">
                Everyoneâ€™s all here in <strong>#{{channel.name}}</strong>
            </h2>
            <p class="text-muted">
                Share announcements and updates about company news, upcoming events, or teammates who deserve some kudos. â­
            </p>
        </div>
    </div>
</section>


<!-- sidebar --------------------------------------------------------------------------------------------------------------------------------------- -->
<div class="sidebar">
    <div class="sidebar-header">
        <h2># {{channel.name}}</h2>
    </div>
    
    <div class="sidebar-menu">
        <!-- Button to trigger fetching logs -->
        <button id="fetchLogsButton" class="menu-item"><i class="fas fa-history"></i> Fetch Activity Logs</button>
        
        <!-- Button to open the user list modal -->
        <button id="userListButton" class="menu-item"><i class="fas fa-users"></i> View Users</button>

        <!-- VIEW CHANNEL DETAILS -->
        <button id="viewChannelDetailsButton" class="menu-item"><i class="fas fa-info-circle"></i> View Channel Details</button>

        <!-- Export Data Link -->
        <a href="{% url 'export_data' org_id=channel.organization.id channel_id=channel.id %}" 
           class="menu-item" id="exportDataButton"><i class="fas fa-download"></i> Export Data</a>

        <!-- Button to Trigger the Modal -->
        <button type="button" class="menu-item" data-bs-toggle="modal" data-bs-target="#statisticsModal">
            <i class="fas fa-chart-line"></i> Show Channel Statistics
        </button>

        
        <button id="filterButton" class="menu-item" data-bs-toggle="modal" data-bs-target="">
            <i class="fas fa-chart-line"></i> Jump to
        </button>

        <button id="filterButton" class="menu-item" data-bs-toggle="modal" data-bs-target="">
            <i class="fas fa-building"></i>
                    <a href="{% url 'org_detail' org_id=channel.organization.id%}">
                {{channel.organization.name}}
            </a>
        </button>

        <button id="filterButton" class="menu-item" data-bs-toggle="modal" data-bs-target="">
            <i class="fas fa-sync"></i>
                    <a href="{% url 'channel_chat' channel_id=channel.id%}">
                Refresh
            </a>
        </button>

        <!-- Delete All My Messages Button -->
      <button id="deleteMessagesButton" class="menu-item" data-bs-toggle="modal" data-bs-target="">
         <i class="fas fa-trash-alt"></i> Delete All My Messages
      </button>

      <!-- Button to Trigger Modal -->
<!-- Button to Trigger Modal -->
<button 
    id="showStatsButton" 
    class="menu-item"
    data-bs-toggle="modal" 
    data-bs-target="#statsModal"
>
<i class="fas fa-database"></i>
  My memory usage
</button>

</div>
    
    <div class="sidebar-footer">
        <button class="menu-item"><i class="fas fa-cogs"></i> Settings</button>
        <button class="menu-item"><i class="fas fa-sign-out-alt"></i> Log Out</button>
    </div>
</div>


<!-- ------------------------------------------------------------------------------------------------- -->

<body class="bg-gray-100">
    
    <div class="max-w-4xl mx-auto mt-10">
        <div class="mb-4">
            <input 
                type="text" 
                id="searchInput" 
                placeholder="ğŸ” Search messages and links..." 
                class="form-control form-control-lg w-full p-2 text-gray-700 bg-gray-100 border border-gray-300 rounded-lg shadow-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
            />
        </div>
<!-- -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------  -->
        <div id="chatWindow" class="bg-gradient-to-br from-gray-100 to-white p-4 rounded-xl shadow-2xl mb-4 max-h-[400px] overflow-y-auto border border-gray-300">
            <!-- Loop through messages and display them -->
            {% for message in messages %}
                <div class="flex items-center border-b border-gray-200 py-3 hover:bg-gray-50 rounded-lg px-2 transition duration-200 relative">
                    <!-- User avatar placeholder -->
                    <div class="w-10 h-10 flex-shrink-0 bg-gradient-to-tr from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">
                        {{ message.user.username|slice:":1" }}
                    </div>
                    <!-- Message content -->
                    <div class="flex flex-col w-full">
                        <span class="font-semibold text-purple-600">{{ message.user.username }}</span>
                        <span class="text-gray-700">
                            {% if message.link %}
                                <a href="{{ message.link }}" target="_blank" class="text-blue-500 hover:underline font-medium">
                                    {{ message.link }}
                                </a>
                            {% else %}
                                {{ message.content }}
                            {% endif %}
                        </span>
                        <span class="text-xs text-gray-500 mt-1 self-end">{{ message.timestamp|date:"H:i" }}</span>
                    </div>
                    <!-- 3-dot menu -->
                    {% if message.user == request.user %}
                        <div class="relative">
                            <button class="menu-button text-gray-400 hover:text-gray-600 focus:outline-none">
                                &#x22EE;
                            </button>
                            <div class="menu-options hidden absolute top-6 right-0 bg-white shadow-md rounded-lg text-sm">
                                <!-- Inside the menu options for links -->

                                <form action="{% url 'delete_message' org_id=channel.organization.id channel_id=channel.id message_id=message.id %}" method="POST" class="inline-block">
                                    {% csrf_token %}
                                    <button type="submit" class="delete-message text-red-500 px-4 py-2 w-full hover:bg-red-50">
                                        Delete
                                    </button>
                                </form>
                               <!-- edit message button -->
                                <button class="edit-button text-green-500 px-4 py-2 w-full hover:bg-green-50" data-bs-toggle="modal" data-bs-target="#editMessageModal" data-message-id="{{ message.id }}" data-current-content="{{ message.content }}">
                                    <i class="fas fa-ellipsis-v"></i> Edit
                                </button>
                                
                               
        
                                
                            </div>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        
            <!-- Loop through links and display them -->
            {% for link in links %}
                <div class="flex items-center border-b border-gray-200 py-3 hover:bg-gray-50 rounded-lg px-2 transition duration-200 relative">
                    <!-- User avatar placeholder -->
                    <div class="w-10 h-10 flex-shrink-0 bg-gradient-to-tr from-blue-500 to-green-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">
                        {{ link.user.username|slice:":1" }}
                    </div>
                    <!-- Link content -->
                    <div class="flex flex-col w-full">
                        <span class="font-semibold text-green-600">{{ link.user.username }}</span>
                        <span>
                            <a href="{{ link.link }}" target="_blank" class="text-blue-600 hover:underline font-medium">
                                {{ link.text }}
                            </a>
                        </span>
                        <span class="text-xs text-gray-500 mt-1 self-end">{{ link.timestamp|date:"H:i" }}</span>
                    </div>
                    <!-- 3-dot menu -->
                    {% if link.user == request.user %}
                        <div class="relative">
                            <button class="menu-button text-gray-400 hover:text-gray-600 focus:outline-none">
                                &#x22EE;
                            </button>
                            <div class="menu-options hidden absolute top-6 right-0 bg-white shadow-md rounded-lg text-sm">
                                <!-- Inside the menu options for links -->
                                <form action="{% url 'delete_link' org_id=channel.organization.id channel_id=channel.id link_id=link.id %}" method="POST" class="inline-block">
                                    {% csrf_token %}
                                    <button type="submit" class="delete-message text-red-500 px-4 py-2 w-full hover:bg-red-50">
                                        Delete
                                    </button>
                                </form>

                               
                               <!-- Edit Link Button -->
                               <button class="edit-link-button text-green-500 px-4 py-2 w-full hover:bg-green-50" 
                               data-link-id="{{ link.id }}" 
                               data-current-text="{{ link.text }}" 
                               data-current-link="{{ link.link }}" 
                               type="button" 
                               data-bs-toggle="modal" 
                               data-bs-target="#editLinkModal">
                           Edit Link
                       </button>
                       

                                
                            </div>
                        </div>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        
        <!-- ------------------------------------------------------------------------------------------ -->
        <div class="flex items-center space-x-2 bg-gray-100 p-2 rounded-lg">
            <!-- Mention User Icon -->
            <button id="mentionButton" class="p-2 text-yellow-500 hover:text-yellow-600">
                <i class="fas fa-at text-xl"></i>
            </button>
        
            <!-- Message Input -->
            <input id="messageInput" type="text" 
                   class="border border-gray-300 p-2 w-full rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" 
                   placeholder="Type a message...">
        
            <!-- Send Message Icon -->
            <button id="sendMessage" class="p-2 text-blue-500 hover:text-blue-600">
                <i class="fas fa-paper-plane text-xl"></i>
            </button>
        
            <!-- Send Link Icon -->
            <button id="sendLinkButton" class="p-2 text-green-500 hover:text-green-600">
                <i class="fas fa-link text-xl"></i>
            </button>
        
            <!-- Emoji Picker Icon -->
            <button id="emojiPickerButton" class="p-2 text-purple-500 hover:text-purple-600">
                <i class="fas fa-smile text-xl"></i>
            </button>
        
            <!-- Upload Audio Icon -->
            <button id="uploadAudioButton" class="p-2 text-indigo-500 hover:text-indigo-600">
                <i class="fas fa-microphone-alt text-xl"></i>
            </button>
        
            <!-- Upload Video Icon -->
            <button id="uploadVideoButton" class="p-2 text-teal-500 hover:text-teal-600">
                <i class="fas fa-video text-xl"></i>
            </button>


            <!-- Call Icon -->
<button id="callButton" class="p-2 text-green-500 hover:text-green-600">
    <i class="fas fa-phone-alt text-xl"></i>
</button>

<!-- Screen Share Icon -->
<button id="screenShareButton" class="p-2 text-blue-500 hover:text-blue-600">
    <i class="fas fa-desktop text-xl"></i>
</button>

<!-- Screen Share Icon -->
<button id="screenShareButton" class="p-2 text-blue-500 hover:text-blue-600">
    <i class="fas fa-plus text-xl"></i>
</button>

<!-- Filter by User Button -->
<button
    class=" p-2 text-blue-500 hover:text-blue-600 "
    data-bs-toggle="modal"
    data-bs-target="#filterByUserModal"
>
<i class="fas fa-user text-xl"></i>
</button>


</div>



       

        

        <!-- Modal to mention users -->
        <div id="mentionModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg w-1/3">
                <h2 class="text-xl font-bold mb-4">Mention a User</h2>
                <ul id="mentionList" class="space-y-2">
                    <!-- List of users will be populated here -->
                </ul>
                <div class="flex justify-end">
                    <button id="closeMentionModal" class="bg-gray-500 text-white p-2 rounded-lg">Close</button>
                </div>
            </div>
        </div>

        <!-- Modal to send link -->
        <div id="sendLinkModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg w-1/3">
                <h2 class="text-xl font-bold mb-4">Send a Link</h2>
                <input id="linkText" type="text" class="border p-2 w-full mb-4" placeholder="Link Text">
                <input id="linkUrl" type="url" class="border p-2 w-full mb-4" placeholder="URL">
                <div class="flex justify-end">
                    <button id="sendLink" class="bg-blue-500 text-white p-2 rounded-lg">Send Link</button>
                    <button id="closeLinkModal" class="bg-gray-500 text-white p-2 ml-2 rounded-lg">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Emoji Picker Modal -->
        <div id="emojiPickerModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg w-1/3 max-h-[80vh] overflow-y-auto">
                <h2 class="text-xl font-bold mb-4">Pick an Emoji</h2>
                <div id="emojiContainer" class="grid grid-cols-6 gap-2 max-h-[60vh] overflow-y-auto">
                    <!-- Emoji options will be populated here -->
                </div>
                <div class="flex justify-end mt-4">
                    <button id="closeEmojiPickerModal" class="bg-gray-500 text-white p-2 rounded-lg hover:bg-gray-600">Close</button>
                </div>
            </div>
        </div>

        <!-- Audio Upload Modal -->
        <div id="audioUploadModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg w-1/3">
                <h2 class="text-xl font-bold mb-4">Upload Audio</h2>
                <input type="file" id="audioFileInput" class="border p-2 w-full mb-4" accept="audio/*">
                <div class="flex justify-end">
                    <button id="uploadAudio" class="bg-blue-500 text-white p-2 rounded-lg">Upload</button>
                    <button id="closeAudioModal" class="bg-gray-500 text-white p-2 ml-2 rounded-lg">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Video Upload Modal -->
        <div id="videoUploadModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-6 rounded-lg w-1/3">
                <h2 class="text-xl font-bold mb-4">Upload Video</h2>
                <input type="file" id="videoFileInput" class="border p-2 w-full mb-4" accept="video/*">
                <div class="flex justify-end">
                    <button id="uploadVideo" class="bg-blue-500 text-white p-2 rounded-lg">Upload</button>
                    <button id="closeVideoModal" class="bg-gray-500 text-white p-2 ml-2 rounded-lg">Cancel</button>
                </div>
            </div>
        </div>

    </div>
<!-- ----------------------------------------------------------------------------------------------------------------------------------------------- -->
    <script>
        // Get the channel ID from the Django template context
        const channelId = "{{ channel.id }}";
        const chatSocket = new WebSocket(`ws://${window.location.host}/ws/channel/${channelId}/`);
   
        // When the WebSocket connection is opened
        chatSocket.onopen = function(e) {
            console.log('WebSocket connection established!');
        };

        // When a new message is received from the WebSocket
        chatSocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            const message = data['message'];
            const username = data['username'];
            // Append the message to the chat window
            const messageElement = document.createElement('div');
            messageElement.className = 'border-b py-2';
            messageElement.innerHTML = `<strong>${username}</strong>: ${message} <span class="text-sm text-gray-500 ml-2">${data['time']}</span>`;
            
            if (data['link']) {
                messageElement.innerHTML = `<strong>${username}</strong>: <a href="${data['link']}" target="_blank" class="text-blue-500 hover:underline">${data['link']}</a> <span class="text-sm text-gray-500 ml-2">${data['time']}</span>`;
            }

            document.getElementById('chatWindow').appendChild(messageElement);
            document.getElementById('chatWindow').scrollTop = document.getElementById('chatWindow').scrollHeight;
        };

        // Emoji Picker Modal Logic
        const emojiPickerButton = document.getElementById('emojiPickerButton');
        const emojiPickerModal = document.getElementById('emojiPickerModal');
        const closeEmojiPickerModal = document.getElementById('closeEmojiPickerModal');

        
// Toggle the emoji picker modal
emojiPickerButton.addEventListener('click', () => {
    emojiPickerModal.classList.add('show');
});

// Close the modal when the close button is clicked
closeEmojiPickerModal.addEventListener('click', () => {
    emojiPickerModal.classList.remove('show');
});
        const emojiContainer = document.getElementById('emojiContainer');
        const emojis = [
  'ğŸš€', 'âš¡', 'ğŸ’¥', 'ğŸ”¥', 'ğŸŒŸ', 'ğŸ†', 'ğŸ’¯', 'âœ…', 'ğŸ“', 'ğŸ’»', 
  'ğŸ“±', 'ğŸ“Š', 'ğŸ’¼', 'ğŸ”§', 'ğŸ› ï¸', 'âš™ï¸', 'ğŸ§ ', 'ğŸ’¡', 'â³', 'â°', 
  'ğŸ’ª', 'ğŸ§‘â€ğŸ’»', 'ğŸ‘©â€ğŸ’»', 'ğŸ¤–', 'ğŸ¤©', 'ğŸ‘‘', 'ğŸ“ˆ', 'ğŸ”', 'ğŸŒ', 'ğŸŒ', 
  'ğŸŒ', 'ğŸ“…', 'ğŸ—“ï¸', 'ğŸ•’', 'ğŸ“', 'ğŸ—ºï¸', 'ğŸŒ', 'ğŸ…', 'ğŸ¥‡', 'ğŸ†', 
  'ğŸ¯', 'ğŸ’­', 'ğŸ”®', 'ğŸ§³', 'ğŸ’ª', 'ğŸš¨', 'âš ï¸', 'â—', 'â•', 'ğŸ’¬', 
  'ğŸ’­', 'ğŸ’¬', 'ğŸ’‹', 'â¤ï¸', 'ğŸ’–', 'ğŸ’™', 'ğŸ’š', 'ğŸ’›', 'ğŸ’œ', 'ğŸ–¤',
  'ğŸ’', 'ğŸ’˜', 'ğŸ’', 'ğŸ’Œ', 'ğŸ’‹', 'ğŸ‘„', 'ğŸ¤', 'ğŸ’™', 'â¤ï¸', 'ğŸ’›', 
  'ğŸ’š', 'ğŸ’œ', 'ğŸ’–', 'â¤ï¸â€ğŸ”¥', 'ğŸ’€', 'â˜ ï¸', 'ğŸ«€', 'ğŸ«£', 'ğŸ™€', 
  'ğŸ˜³', 'ğŸ˜¬', 'ğŸ¤­', 'ğŸ™„', 'ğŸ¤”', 'ğŸ¥²', 'ğŸ˜­', 'ğŸ˜¢', 'ğŸ˜¤', 'ğŸ˜¡', 
  'ğŸ¤¡', 'ğŸ¤£', 'ğŸ˜‚', 'ğŸ˜†', 'ğŸ˜¹', 'ğŸ˜‚', 'ğŸ¤£', 'ğŸ˜', 'ğŸ§', 'ğŸ«¶', 
  'ğŸ¤ª', 'ğŸ¥´', 'ğŸ˜‹', 'ğŸ¤¤', 'ğŸ¤©', 'ğŸ˜', 'ğŸ¥°', 'ğŸ˜', 'ğŸ¤“', 'ğŸ§‘â€ğŸ¤',
  'ğŸ¤', 'ğŸ§', 'ğŸ¶', 'ğŸ¸', 'ğŸ»', 'ğŸ¥', 'ğŸ·', 'ğŸº', 'ğŸµ', 'ğŸ¼',
  'ğŸ¹', 'ğŸ¶', 'ğŸ¥³', 'ğŸ‰', 'ğŸ’ƒ', 'ğŸ•º', 'ğŸ¤¸â€â™€ï¸', 'ğŸ¤¸â€â™‚ï¸', 'ğŸ•º',
  'ğŸ’ƒ', 'ğŸ©°', 'ğŸ‹ï¸â€â™€ï¸', 'ğŸ‹ï¸â€â™‚ï¸', 'ğŸ¤¸â€â™€ï¸', 'ğŸ¤¸â€â™‚ï¸', 'ğŸš´â€â™€ï¸', 
  'ğŸš´â€â™‚ï¸', 'â›·ï¸', 'ğŸ„â€â™€ï¸', 'ğŸ„â€â™‚ï¸', 'ğŸ¤¾â€â™€ï¸', 'ğŸ¤¾â€â™‚ï¸', 'ğŸƒâ€â™€ï¸', 
  'ğŸƒâ€â™‚ï¸', 'ğŸ’†â€â™€ï¸', 'ğŸ’†â€â™‚ï¸', 'ğŸ’…', 'ğŸ§‘â€ğŸ¦°', 'ğŸ§‘â€ğŸ¦³', 'ğŸ§‘â€ğŸ¦±',
  'ğŸ’…', 'ğŸ§–â€â™€ï¸', 'ğŸ§–â€â™‚ï¸', 'ğŸ§‘â€âš–ï¸', 'ğŸ¯', 'ğŸ³', 'ğŸ“', 'ğŸ¸', 
  'âš½', 'ğŸ€', 'ğŸˆ', 'ğŸ¾', 'ğŸ', 'ğŸ‘', 'ğŸ’', 'ğŸ¥‹', 'â›¸ï¸', 'ğŸ…',
  'ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰', 'ğŸ†', 'ğŸ®', 'ğŸ®', 'ğŸ–¥ï¸', 'ğŸ²', 'ğŸ¯', 'ğŸ§©',
  'ğŸ²', 'ğŸ§ ', 'ğŸ’¡', 'ğŸ“š', 'ğŸ“–', 'ğŸ“', 'ğŸ“œ', 'ğŸ“„', 'ğŸ“‹', 'ğŸ“',
  'âœ‚ï¸', 'ğŸ“Œ', 'ğŸ“', 'ğŸ“…', 'ğŸ“†', 'ğŸ—“ï¸', 'ğŸ”–', 'ğŸ—ƒï¸', 'ğŸ“’', 
  'ğŸ“š', 'ğŸ“‘', 'ğŸ“™', 'ğŸ“˜', 'ğŸ“—', 'ğŸ“’', 'ğŸ““', 'ğŸ“‚', 'ğŸ“', 'ğŸ’¼', 
  'ğŸ§³', 'ğŸ’', 'ğŸ’¼', 'ğŸ§¸', 'ğŸ‘•', 'ğŸ‘š', 'ğŸ‘—', 'ğŸ‘–', 'ğŸ‘”', 'ğŸ‘š', 
  'ğŸ‘ ', 'ğŸ‘¢', 'ğŸ‘¡', 'ğŸ‘Ÿ', 'ğŸ¥¿', 'ğŸ‘', 'ğŸ§¢', 'ğŸ‘‘', 'ğŸ‘’', 'ğŸ©', 
  'ğŸ’', 'ğŸ“¿', 'ğŸ’„', 'ğŸ’…', 'ğŸ‘“', 'ğŸ•¶ï¸', 'ğŸ‘›', 'ğŸ‘', 'ğŸ’¼', 'ğŸ§³', 
  'ğŸ’', 'ğŸ‘œ', 'ğŸ‘', 'ğŸ‘›', 'ğŸ§£', 'ğŸ§¤', 'ğŸ§¥', 'ğŸ‘—', 'ğŸ‘š', 'ğŸ§µ', 
  'ğŸ§¶', 'ğŸ¨', 'ğŸ­', 'ğŸª', 'ğŸ–¼ï¸', 'ğŸ¬', 'ğŸ¥', 'ğŸï¸', 'ğŸ¬', 'ğŸ“¸', 
  'ğŸ“·', 'ğŸ“¹', 'ğŸ¥', 'ğŸ¬', 'ğŸï¸', 'ğŸ­', 'ğŸ–¼ï¸', 'ğŸ¤', 'ğŸ§', 'ğŸ¼',
  'ğŸ¶', 'ğŸµ', 'ğŸ»', 'ğŸº', 'ğŸ·', 'ğŸ¸', 'ğŸ¥', 'ğŸ¤', 'ğŸ¬', 'ğŸµ',
  'ğŸ¶', 'ğŸ§', 'ğŸ¤', 'ğŸ¼', 'ğŸ¸', 'ğŸ¥', 'ğŸ»', 'ğŸ¶', 'ğŸ§', 'ğŸ·', 
  'ğŸº', 'ğŸ¸', 'ğŸª•', 'ğŸ¶', 'ğŸ¤', 'ğŸ¬', 'ğŸ¶', 'ğŸ§', 'ğŸ“»', 'ğŸµ',
  'ğŸ¼', 'ğŸ¸', 'ğŸ¹', 'ğŸ·', 'ğŸ¥', 'ğŸ¼', 'ğŸ§', 'ğŸ»', 'ğŸ¤', 'ğŸ¶',
  'ğŸ¸', 'ğŸ·', 'ğŸº', 'ğŸ»', 'ğŸ¶', 'ğŸ¼', 'ğŸ¤', 'ğŸµ', 'ğŸ¶', 'ğŸ¹'
];



        emojiPickerButton.onclick = () => {
            emojiContainer.innerHTML = '';
            emojis.forEach(emoji => {
                const button = document.createElement('button');
                button.className = 'text-2xl';
                button.textContent = emoji;
                button.onclick = () => {
                    const messageInput = document.getElementById('messageInput');
                    messageInput.value += emoji;
                    emojiPickerModal.classList.add('hidden');
                };
                emojiContainer.appendChild(button);
            });
            emojiPickerModal.classList.remove('hidden');
        };

        closeEmojiPickerModal.onclick = () => emojiPickerModal.classList.add('hidden');

        // Open the audio upload modal
        document.getElementById('uploadAudioButton').onclick = function() {
            document.getElementById('audioUploadModal').classList.remove('hidden');
        };

        // Close the audio upload modal
        document.getElementById('closeAudioModal').onclick = function() {
            document.getElementById('audioUploadModal').classList.add('hidden');
        };

        // Open the video upload modal
        document.getElementById('uploadVideoButton').onclick = function() {
            document.getElementById('videoUploadModal').classList.remove('hidden');
        };

        // Close the video upload modal
        document.getElementById('closeVideoModal').onclick = function() {
            document.getElementById('videoUploadModal').classList.add('hidden');
        };

        // Handle file uploads (Audio and Video)
        document.getElementById('uploadAudio').onclick = function() {
            const audioFile = document.getElementById('audioFileInput').files[0];
            if (audioFile) {
                // Handle audio file upload here (send to server)
                chatSocket.send(JSON.stringify({'audio': audioFile}));
                document.getElementById('audioUploadModal').classList.add('hidden');
            }
        };

        document.getElementById('uploadVideo').onclick = function() {
            const videoFile = document.getElementById('videoFileInput').files[0];
            if (videoFile) {
                // Handle video file upload here (send to server)
                chatSocket.send(JSON.stringify({'video': videoFile}));
                document.getElementById('videoUploadModal').classList.add('hidden');
            }
        };

        // Send the message when the Send button is clicked
        document.getElementById('sendMessage').onclick = function(e) {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value;
            if (message.trim()) {
                chatSocket.send(JSON.stringify({'message': message}));
                messageInput.value = '';  // Clear the input
            }
        };

        // Allow the Enter key to send the message
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('sendMessage').click();
            }
        });


           // Handle WebSocket connection closing
           chatSocket.onclose = function(e) {
            console.log('WebSocket connection closed.');
        };

        // Send the message when the Send button is clicked
        document.getElementById('sendMessage').onclick = function(e) {
            const messageInput = document.getElementById('messageInput');
            const message = messageInput.value;
            if (message.trim()) {
                chatSocket.send(JSON.stringify({'message': message}));
                messageInput.value = '';  // Clear the input
            }
        };

        // Allow the Enter key to send the message
        document.getElementById('messageInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('sendMessage').click();
            }
        });

        // Open the mention modal when the "Mention User" button is clicked
        document.getElementById('mentionButton').onclick = function() {
            // Fetch the members from the organization
            fetch(`/channels/get_organization_members/{{ channel.organization.id }}/`)

                .then(response => response.json())
                .then(data => {
                    const mentionList = document.getElementById('mentionList');
                    mentionList.innerHTML = '';  // Clear existing list
                    data.members.forEach(member => {
                        const listItem = document.createElement('li');
                        listItem.className = 'cursor-pointer text-blue-500 hover:underline';
                        listItem.textContent = member.username;
                        listItem.onclick = function() {
                            const messageInput = document.getElementById('messageInput');
                            messageInput.value += `@${member.username} `; // Append mention to input
                            document.getElementById('mentionModal').classList.add('hidden');
                        };
                        mentionList.appendChild(listItem);
                    });
                    document.getElementById('mentionModal').classList.remove('hidden');
                });
        };

        // Close the mention modal when the "Close" button is clicked
        document.getElementById('closeMentionModal').onclick = function() {
            document.getElementById('mentionModal').classList.add('hidden');
        };

        // Open the send link modal when the "Send Link" button is clicked
        document.getElementById('sendLinkButton').onclick = function() {
            document.getElementById('sendLinkModal').classList.remove('hidden');
        };

        // Close the send link modal when the "Cancel" button is clicked
        document.getElementById('closeLinkModal').onclick = function() {
            document.getElementById('sendLinkModal').classList.add('hidden');
        };

        // Send the link when the "Send Link" button in the modal is clicked
        document.getElementById('sendLink').onclick = function() {
            const linkText = document.getElementById('linkText').value;
            const linkUrl = document.getElementById('linkUrl').value;
            if (linkText.trim() && linkUrl.trim()) {
                chatSocket.send(JSON.stringify({'linkText': linkText, 'linkUrl': linkUrl}));
                document.getElementById('linkText').value = '';  // Clear the link text input
                document.getElementById('linkUrl').value = '';   // Clear the link URL input
                document.getElementById('sendLinkModal').classList.add('hidden');
            }
        };

// -----------------------------------------------------------------------------------------------------------------------------------------------------------------





document.getElementById('userListButton').onclick = function () {
    const orgId = "{{ channel.organization.id }}"; // Organization ID from Django template
    const channelId = "{{ channel.id }}"; // Channel ID from Django template

    // Make an AJAX request to fetch users associated with the channel
    fetch(`/channels/channels/get_members/${orgId}/${channelId}/`)
        .then(response => response.json())
        .then(data => {
            const userList = document.getElementById('userList');
            userList.innerHTML = ''; // Clear existing user list

            if (data.members && data.members.length > 0) {
                // Populate the user list with members
                data.members.forEach(user => {
                    const listItem = document.createElement('li');
                    listItem.className = 'list-group-item cursor-pointer text-primary';
                    listItem.textContent = user.username; // Display the username
                    userList.appendChild(listItem);
                });
            } else {
                // Handle case when no users are found
                const noUsersItem = document.createElement('li');
                noUsersItem.className = 'list-group-item text-danger';
                noUsersItem.textContent = "No users found!";
                userList.appendChild(noUsersItem);
            }

            // Show the modal using Bootstrap 5's modal JavaScript
            const modal = new bootstrap.Modal(document.getElementById('userListModal'));
            modal.show();
        })
        .catch(error => {
            console.error('Error fetching users:', error);
        });
};



// Fetch activity logs

document.getElementById('fetchLogsButton').onclick = function() {
    const channelId = "{{ channel.id }}";  // Channel ID from Django template
    const orgId = "{{channel.organization.id}}";

    // Make an AJAX request to fetch activity logs
    fetch(`/channels/channels/fetch_activity_logs/${channelId}/${orgId}`)
        .then(response => response.json())
        .then(data => {
            const logsList = document.getElementById('activityLogsList');
            logsList.innerHTML = '';  // Clear existing logs

            if (data.success) {
                // If logs are found, populate the modal with them
                data.logs.forEach(log => {
                    const logItem = document.createElement('div');
                    logItem.className = 'list-group-item list-group-item-action';
                    logItem.innerHTML = `
                        <strong>${log.user}</strong> ${log.content} 
                        <span class="text-muted text-sm">(${log.timestamp})</span>
                    `;
                    logsList.appendChild(logItem);
                });

                // Show the modal
                var myModal = new bootstrap.Modal(document.getElementById('activityLogsModal'));
                myModal.show();
            } else {
                const noLogsItem = document.createElement('div');
                noLogsItem.className = 'list-group-item text-center text-muted';
                noLogsItem.textContent = "No activity logs found.";
                logsList.appendChild(noLogsItem);
            }
        })
        .catch(error => {
            console.error('Error fetching activity logs:', error);
        });
};



// SEARCH BAR 

document.getElementById('searchInput').addEventListener('input', function () {
    const query = this.value.trim(); // Get the search input
    const orgId = "{{ channel.organization.id }}"; // Pass organization ID dynamically
    const channelId = "{{ channel.id }}"; // Pass channel ID dynamically

    // AJAX request to fetch filtered messages and links
    fetch(`/channels/channels/search/${orgId}/${channelId}/?q=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(data => {
            const chatWindow = document.getElementById('chatWindow');
            chatWindow.innerHTML = ''; // Clear the chat window

            // Display filtered messages
            if (data.messages.length > 0) {
                data.messages.forEach(message => {
                    const messageDiv = document.createElement('div');
                    messageDiv.className = 'border-b py-2';
                    messageDiv.innerHTML = `
                        <strong>${message.user__username}</strong>: ${message.content}
                        <span class="text-sm text-gray-500 ml-2">${message.timestamp}</span>
                    `;
                    chatWindow.appendChild(messageDiv);
                });
            }

            // Display filtered links
            if (data.links.length > 0) {
                data.links.forEach(link => {
                    const linkDiv = document.createElement('div');
                    linkDiv.className = 'border-b py-2';
                    linkDiv.innerHTML = `
                        <strong>${link.user__username}</strong>: 
                        <a href="${link.link}" target="_blank" class="text-blue-500 hover:underline">${link.text}</a>
                        <span class="text-sm text-gray-500 ml-2">${link.timestamp}</span>
                    `;
                    chatWindow.appendChild(linkDiv);
                });
            }

            // If no results found
            if (data.messages.length === 0 && data.links.length === 0) {
                chatWindow.innerHTML = '<p class="text-center text-gray-500">No results found!</p>';
            }
        })
        .catch(error => {
            console.error('Error fetching search results:', error);
        });
});


// CHANNEL DETAILS
document.getElementById('viewChannelDetailsButton').onclick = function() {
    const channelId = "{{ channel.id }}";  // Get channel ID dynamically from the template
    const orgId = "{{ channel.organization.id }}";  // Get organization ID dynamically from the template

    // Make an AJAX request to fetch channel details
    fetch(`/channels/channels/channel_details/${orgId}/${channelId}/`)
        .then(response => response.json())
        .then(data => {
            // Update the modal with the fetched data
            document.getElementById('channelName').textContent = data.name;
            document.getElementById('channelType').textContent = data.type;
            document.getElementById('channelVisibility').textContent = data.visibility;
            document.getElementById('channelCreatedAt').textContent = data.created_at;
            document.getElementById('channelCreatedBy').textContent = data.created_by;

            // Clear existing members
            const membersList = document.getElementById('membersList');
            membersList.innerHTML = '';

            // Add members to the list
            data.members.forEach(member => {
                const memberItem = document.createElement('li');
                memberItem.textContent = member.full_name;
                membersList.appendChild(memberItem);
            });

            // Show the modal using Bootstrap 5 without jQuery
            var modal = new bootstrap.Modal(document.getElementById('channelDetailsModal'));
            modal.show();
        })
        .catch(error => {
            console.error('Error fetching channel details:', error);
        });
};


// Exporting data pop up

document.getElementById('exportDataButton').onclick = function(event) {
    // Prevent the default action (navigating to the export page)
    event.preventDefault();

    // Show the popup message
    const popupMessage = document.getElementById('popupMessage');
    popupMessage.style.display = 'block';

    // Hide the popup after 5 seconds
    setTimeout(function() {
        popupMessage.style.display = 'none';

        // Redirect to the export data URL after the message disappears
        window.location.href = event.target.href;
    }, 3000);
};


// CHANNEL STATISTICS

 // Event listener for showing the modal
document.getElementById('statisticsModal').addEventListener('show.bs.modal', function () {
    // Fetch the org_id and channel_id dynamically, you can pass them from the context
    var org_id = "{{channel.organization.id}}";  // Replace with dynamic org_id
    var channel_id = "{{channel.id}}";  // Replace with dynamic channel_id

    // Make the AJAX request
    fetch(`/channels/channel/statistics/${org_id}/${channel_id}/`, { // Adjust the URL if necessary
      method: 'GET',
    })
    .then(response => response.json())
    .then(data => {
      if (data.error) {
        alert('Error fetching data: ' + data.error);
      } else {
        // Render the charts
        renderCharts(data);
      }
    })
    .catch(() => {
      alert('An error occurred while fetching the statistics.');
    });
});

// Function to render the charts with data from the response
function renderCharts(data) {
    // Messages Chart
    var ctxMessages = document.getElementById('messagesChart').getContext('2d');
    var messagesChart = new Chart(ctxMessages, {
      type: 'bar',
      data: {
        labels: data.message_chart.labels,
        datasets: [{
          label: data.message_chart.label,
          data: data.message_chart.data,
          backgroundColor: data.message_chart.background_color,
          borderColor: data.message_chart.border_color,
          borderWidth: data.message_chart.border_width
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    // Links Chart
    var ctxLinks = document.getElementById('linksChart').getContext('2d');
    var linksChart = new Chart(ctxLinks, {
      type: 'bar',
      data: {
        labels: data.link_chart.labels,
        datasets: [{
          label: data.link_chart.label,
          data: data.link_chart.data,
          backgroundColor: data.link_chart.background_color,
          borderColor: data.link_chart.border_color,
          borderWidth: data.link_chart.border_width
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    // User Message Counts Chart
    var ctxUserMessageCounts = document.getElementById('userMessageCountsChart').getContext('2d');
    var userMessageCountsChart = new Chart(ctxUserMessageCounts, {
      type: 'pie',
      data: {
        labels: data.user_message_counts.map(item => item.user),
        datasets: [{
          label: 'User Message Counts',
          data: data.user_message_counts.map(item => item.message_count),
          backgroundColor: ['rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)', 'rgba(255, 159, 64, 0.2)', 'rgba(54, 162, 235, 0.2)'],
          borderColor: ['rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)', 'rgba(54, 162, 235, 1)'],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true
      }
    });

    // User Link Counts Chart
    var ctxUserLinkCounts = document.getElementById('userLinkCountsChart').getContext('2d');
    var userLinkCountsChart = new Chart(ctxUserLinkCounts, {
      type: 'pie',
      data: {
        labels: data.user_link_counts.map(item => item.user),
        datasets: [{
          label: 'User Link Counts',
          data: data.user_link_counts.map(item => item.link_count),
          backgroundColor: ['rgba(75, 192, 192, 0.2)', 'rgba(153, 102, 255, 0.2)', 'rgba(255, 159, 64, 0.2)', 'rgba(54, 162, 235, 0.2)'],
          borderColor: ['rgba(75, 192, 192, 1)', 'rgba(153, 102, 255, 1)', 'rgba(255, 159, 64, 1)', 'rgba(54, 162, 235, 1)'],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true
      }
    });

    // Total Messages Chart (Bar chart)
    var ctxTotalMessages = document.getElementById('totalMessagesChart').getContext('2d');
    var totalMessagesChart = new Chart(ctxTotalMessages, {
      type: 'bar',
      data: {
        labels: ['Total Messages'],
        datasets: [{
          label: 'Total Messages',
          data: [data.total_messages],
          backgroundColor: 'rgba(75, 192, 192, 0.2)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    // Total Links Chart (Bar chart)
    var ctxTotalLinks = document.getElementById('totalLinksChart').getContext('2d');
    var totalLinksChart = new Chart(ctxTotalLinks, {
      type: 'bar',
      data: {
        labels: ['Total Links'],
        datasets: [{
          label: 'Total Links',
          data: [data.total_links],
          backgroundColor: 'rgba(153, 102, 255, 0.2)',
          borderColor: 'rgba(153, 102, 255, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });

    // King User Chart (Pie chart)
    var ctxKingUser = document.getElementById('kingUserChart').getContext('2d');
    var kingUserChart = new Chart(ctxKingUser, {
      type: 'pie',
      data: {
        labels: [data.king_user],
        datasets: [{
          label: 'King User Stats',
          data: [data.total_messages, data.total_links], // Data for the king user
          backgroundColor: ['rgba(255, 159, 64, 0.2)', 'rgba(54, 162, 235, 0.2)'],
          borderColor: ['rgba(255, 159, 64, 1)', 'rgba(54, 162, 235, 1)'],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true
      }
    });
}


// Coming soon modal

// Open "Coming Soon" modal for Call button
document.getElementById('callButton').addEventListener('click', function() {
        document.getElementById('comingSoonModal').classList.remove('hidden');
    });

    // Open "Coming Soon" modal for Screen Share button
    document.getElementById('screenShareButton').addEventListener('click', function() {
        document.getElementById('comingSoonModal').classList.remove('hidden');
    });

    // Close "Coming Soon" modal
    document.getElementById('closeComingSoonModal').addEventListener('click', function() {
        document.getElementById('comingSoonModal').classList.add('hidden');
    });






// Open the filter modal
document.getElementById('filterButton').onclick = function() {
    document.getElementById('filterModal').classList.remove('hidden');
};

// Close the filter modal
document.getElementById('closeFilterModal').onclick = function() {
    document.getElementById('filterModal').classList.add('hidden');
};

// Show specific date input when "Specific Date" is selected
document.getElementById('specific_date').addEventListener('change', function() {
    document.getElementById('specificDate').style.display = 'block';
});

// Hide specific date input when other options are selected
document.querySelectorAll('input[name="filter"]').forEach(function(element) {
    element.addEventListener('change', function() {
        if (element.value !== 'specific_date') {
            document.getElementById('specificDate').style.display = 'none';
        }
    });
});

// Apply the filter and send AJAX request
document.getElementById('applyFilter').onclick = function() {
    let filterOption = document.querySelector('input[name="filter"]:checked').value;
    let specificDate = filterOption === 'specific_date' ? document.getElementById('specificDate').value : null;

    // Replace these with actual org_id and channel_id values
    let orgId = "{{channel.organization.id}}";  
    let channelId = "{{channel.id}}";  

    // Send AJAX request to fetch filtered messages
    fetch(`/channels/filter_messages/${orgId}/${channelId}/?filter_option=${filterOption}&specific_date=${specificDate}`)
        .then(response => response.json())
        .then(data => {
            // Update the UI with filtered messages
            let messagesContainer = document.getElementById('chatWindow');
            messagesContainer.innerHTML = '';  // Clear existing messages

            data.messages.forEach(message => {
                let messageDiv = document.createElement('div');
                messageDiv.classList.add('message');
                messageDiv.innerHTML = `
                    <div>${message.user}</div>
                    <div>${message.content}</div>
                    <div>${message.timestamp}</div>
                    ${message.link ? `<a href="${message.link}" target="_blank">${message.link}</a>` : ''}
                `;
                messagesContainer.appendChild(messageDiv);
            });

            // Update the UI with filtered links
            let linksContainer = document.getElementById('linksWindow');
            linksContainer.innerHTML = '';  // Clear existing links

            data.links.forEach(link => {
                let linkDiv = document.createElement('div');
                linkDiv.classList.add('link');
                linkDiv.innerHTML = `
                    <div>${link.user}</div>
                    <div><a href="${link.link}" target="_blank">${link.text}</a></div>
                    <div>${link.timestamp}</div>
                `;
                linksContainer.appendChild(linkDiv);
            });
        })
        .catch(error => console.error('Error fetching data:', error));

    // Close the modal after applying the filter
    document.getElementById('filterModal').classList.add('hidden');
};



// Delete all messages of user 

document.addEventListener('DOMContentLoaded', function () {
    const deleteMessagesButton = document.getElementById('deleteMessagesButton');
    const deleteMessagesModal = document.getElementById('deleteMessagesModal');
    const confirmDeleteButton = document.getElementById('confirmDeleteButton');
    const cancelDeleteButton = document.getElementById('cancelDeleteButton');
    const passwordInput = document.getElementById('passwordInput');
    
    const orgId = "{{channel.organization.id}}"; 
    const channelId = "{{channel.id}}"; 

    // Open Modal
    deleteMessagesButton.onclick = function () {
        deleteMessagesModal.classList.remove('hidden');
    };

    // Close Modal
    cancelDeleteButton.onclick = function () {
        deleteMessagesModal.classList.add('hidden');
        passwordInput.value = ''; // Clear input field
    };

    // AJAX Request to Delete Messages
    confirmDeleteButton.onclick = function () {
        const password = passwordInput.value;

        if (!password) {
            alert('Please enter your password!');
            return;
        }

        fetch(`/channels/api/delete-messages/${orgId}/${channelId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken') // Ensure CSRF token is included
            },
            body: JSON.stringify({ password: password })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                deleteMessagesModal.classList.add('hidden');
                passwordInput.value = '';

                // Remove messages from chat window
                const chatWindow = document.getElementById('chatWindow');
                if (chatWindow) {
                    chatWindow.innerHTML = ''; // Clear messages
                }
            } else {
                alert(data.message);
            }
        })
        .catch(error => console.error('Error:', error));
    };

    // Helper Function to Get CSRF Token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
});

// show 3 dot menu

document.addEventListener('click', function (event) {
    if (event.target.classList.contains('menu-button')) {
        // Toggle menu options visibility
        const menu = event.target.nextElementSibling;
        menu.classList.toggle('hidden');
    } else {
        // Close all open menus if clicked outside
        document.querySelectorAll('.menu-options').forEach(menu => {
            menu.classList.add('hidden');
        });
    }
});



// Edit message 
document.addEventListener('DOMContentLoaded', function () {
    let currentMessageId = null;
    let currentMessageElement = null;

    // When the edit button is clicked, set up the modal
    const editButtons = document.querySelectorAll('.edit-button');
    editButtons.forEach(button => {
        button.addEventListener('click', function () {
            currentMessageId = this.dataset.messageId;
            currentMessageElement = this.closest('.flex.items-center'); // The element that contains the message
            const currentContent = this.dataset.currentContent;
            document.getElementById('editMessageContent').value = currentContent; // Populate the textarea with current message content
        });
    });

    // When the save button is clicked, send AJAX request to update the message
    document.getElementById('saveEditButton').addEventListener('click', function () {
        const newContent = document.getElementById('editMessageContent').value.trim(); // Remove leading/trailing spaces
        if (!newContent) {
            alert("Message content cannot be empty or just spaces.");
            return;
        }

        // Get the CSRF token from the page
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        const orgId = "{{ channel.organization.id }}";
        const channelId = "{{ channel.id }}";

        // Send AJAX request to update the message
        fetch(`/channels/channels/edit_message/${orgId}/${channelId}/${currentMessageId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({
                content: newContent
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update the message content in the DOM immediately for the user
                currentMessageElement.querySelector('.message-content').textContent = newContent;
                $('#editMessageModal').modal('hide'); // Hide the modal after successful edit
            } else {
                alert(data.error || 'Failed to update the message.');
            }
        })
        .catch(error => {
           
        showNotification('Message updated successfully. Please refresh the page for new changes.', 'Refresh', window.location.href);
        });
    });
});

// Edit the link

document.addEventListener('DOMContentLoaded', function() {
    // When the edit button is clicked, open the modal and populate fields
    const editLinkButtons = document.querySelectorAll('.edit-link-button');
    editLinkButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Get link data from the button's data attributes
            const linkId = this.dataset.linkId;
            const currentText = this.dataset.currentText;
            const currentLink = this.dataset.currentLink;

            // Populate the modal's input fields with the existing data
            document.getElementById('editLinkText').value = currentText;
            document.getElementById('editLinkUrl').value = currentLink;

            // Update the modal's save button with the correct link ID
            const saveButton = document.getElementById('saveEditLinkButton');
            saveButton.dataset.linkId = linkId;
        });
    });

    // When the save button is clicked, send AJAX request to update the link
    document.getElementById('saveEditLinkButton').addEventListener('click', function() {
        const newText = document.getElementById('editLinkText').value.trim();
        const newLink = document.getElementById('editLinkUrl').value.trim();

        // Validate inputs
        if (!newText || !newLink) {
            alert("Both link text and URL are required.");
            return;
        }

        // Get the CSRF token from the page
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;
        const linkId = this.dataset.linkId;
        const orgId = "{{ channel.organization.id }}";
        const channelId = "{{ channel.id }}";

        // Send AJAX request to update the link
        fetch(`/channels/channels/edit_link/${orgId}/${channelId}/${linkId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({
                text: newText,
                link: newLink
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update the link content in the DOM immediately for the user
                const linkElement = document.querySelector(`.link[data-link-id="${linkId}"]`);
                linkElement.querySelector('.link-text').textContent = newText;
                linkElement.querySelector('.link-url').textContent = newLink;

                // Hide the modal after successful update
                $('#editLinkModal').modal('hide');
            } else {
                alert(data.error || 'Failed to update the link.');
            }
        })
        .catch(error => {
            showNotification('Link updated successfully. Please refresh the page for new changes.', 'Refresh', window.location.href);
        });
    });
});


// CHANNEL STATS

document.addEventListener("DOMContentLoaded", function () {
    const showStatsButton = document.getElementById("showStatsButton");

    const orgId = "{{channel.organization.id}}";  
    const channelId = "{{channel.id}}";  

    // Show Stats Modal
    showStatsButton.addEventListener("click", async () => {
        try {
            // Fetch data via AJAX
            const response = await fetch(`/channels/channel-data/${orgId}/${channelId}/`);
            if (!response.ok) throw new Error("Failed to fetch data");
            const data = await response.json();

            // Render both Pie and Bar charts
            renderPieChart(data);
            renderBarChart(data);
        } catch (error) {
            console.error("Error fetching stats:", error);
        }
    });

    // Function to render Pie Chart
    function renderPieChart(data) {
        const ctx = document.getElementById("chartContainer").getContext("2d");

        // Destroy previous chart if it exists
        if (window.pieChart) {
            window.pieChart.destroy();
        }

        window.pieChart = new Chart(ctx, {
            type: "pie",
            data: {
                labels: ["Messages", "Links"],
                datasets: [
                    {
                        label: "Memory Usage (KB)",
                        data: [
                            data.total_message_memory / 1024,  // Convert bytes to KB
                            data.total_links_memory_combined / 1024,   // Convert bytes to KB
                        ],
                        backgroundColor: ["#007bff", "#28a745"],
                    },
                ],
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: "top",
                    },
                    tooltip: {
                        callbacks: {
                            label: (tooltipItem) => {
                                return `${tooltipItem.label}: ${tooltipItem.raw.toFixed(2)} KB`;
                            },
                        },
                    },
                },
            },
        });
    }

    // Function to render Bar Chart
    function renderBarChart(data) {
        const ctx = document.getElementById("chartContainer").getContext("2d");

        // Destroy previous chart if it exists
        if (window.barChart) {
            window.barChart.destroy();
        }

        window.barChart = new Chart(ctx, {
            type: "bar",
            data: {
                labels: ["Text Memory", "Audio Memory", "Video Memory", "Links Text Memory", "Links URL Memory"],
                datasets: [
                    {
                        label: "Memory Usage (KB)",
                        data: [
                            data.total_text_memory / 1024,
                            data.total_audio_memory / 1024,
                            data.total_video_memory / 1024,
                            data.total_links_text_memory / 1024,
                            data.total_links_memory / 1024,
                        ],
                        backgroundColor: ["#007bff", "#28a745", "#ffc107", "#17a2b8", "#e83e8c"],
                    },
                ],
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: "top",
                    },
                    tooltip: {
                        callbacks: {
                            label: (tooltipItem) => {
                                return `${tooltipItem.label}: ${tooltipItem.raw.toFixed(2)} KB`;
                            },
                        },
                    },
                },
            },
        });
    }
});


// FILTER BY USER 
document.addEventListener("DOMContentLoaded", function () {
    const orgId = "{{ channel.organization.id }}";
    const channelId = "{{ channel.id }}";

    // Populate the user list
    async function fetchUsers() {
        console.log("Fetching users...");  // Added log to check if this is being triggered
        try {
            const response = await fetch(`/channels/fetch-users/${orgId}/${channelId}/`);
            const data = await response.json();

            const userList = document.getElementById("userListt");
            userList.innerHTML = ""; // Clear previous list

            data.users.forEach((user) => {
                const listItem = document.createElement("li");
                listItem.className =
                    "list-group-item d-flex justify-content-between align-items-center cursor-pointer";
                listItem.textContent = user.username;
                listItem.dataset.userId = user.id;
                listItem.addEventListener("click", () => filterMessages(user.id));
                userList.appendChild(listItem);
            });
        } catch (error) {
            console.error("Error fetching users:", error);
        }
    }

    // Filter messages by user
    async function filterMessages(userId) {
        console.log(`Filtering by user: ${userId}`);  // Added log to check if this is being triggered
        try {
            const response = await fetch(
                `/channels/filter-by-user/${orgId}/${channelId}/${userId}/`
            );
            const data = await response.json();

            const chatWindow = document.getElementById("chatWindow");
            chatWindow.innerHTML = ""; // Clear existing messages and links

            // Display filtered messages
            data.messages.forEach((message) => {
                const messageDiv = document.createElement("div");
                messageDiv.className =
                    "flex items-center border-b border-gray-200 py-3 hover:bg-gray-50 rounded-lg px-2 transition duration-200 relative";
                messageDiv.innerHTML = ` 
                    <div class="w-10 h-10 flex-shrink-0 bg-gradient-to-tr from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">
                        ${message.content.slice(0, 1)}
                    </div>
                    <div class="flex flex-col w-full">
                        <span class="font-semibold text-purple-600">User</span>
                        <span class="text-gray-700">${message.content}</span>
                        <span class="text-xs text-gray-500 mt-1 self-end">${message.timestamp}</span>
                    </div>
                `;
                chatWindow.appendChild(messageDiv);
            });

            // Display filtered links
            data.links.forEach((link) => {
                const linkDiv = document.createElement("div");
                linkDiv.className =
                    "flex items-center border-b border-gray-200 py-3 hover:bg-gray-50 rounded-lg px-2 transition duration-200 relative";
                linkDiv.innerHTML = `
                    <div class="w-10 h-10 flex-shrink-0 bg-gradient-to-tr from-blue-500 to-green-500 rounded-full flex items-center justify-center text-white font-bold text-sm mr-4">
                        ${link.text.slice(0, 1)}
                    </div>
                    <div class="flex flex-col w-full">
                        <span class="font-semibold text-green-600">User</span>
                        <span>
                            <a href="${link.link}" target="_blank" class="text-blue-600 hover:underline font-medium">
                                ${link.text}
                            </a>
                        </span>
                        <span class="text-xs text-gray-500 mt-1 self-end">${link.timestamp}</span>
                    </div>
                `;
                chatWindow.appendChild(linkDiv);
            });

            // Close the modal
            const filterByUserModal = bootstrap.Modal.getInstance(
                document.getElementById("filterByUserModal")
            );
            filterByUserModal.hide();
        } catch (error) {
            console.error("Error filtering messages:", error);
        }
    }

    // Fetch users when the modal is shown
    const filterByUserModal = document.getElementById("filterByUserModal");
    filterByUserModal.addEventListener("show.bs.modal", function () {
        console.log("Modal is opening..."); // Log to check if the modal is triggering the fetch
        setTimeout(fetchUsers, 100); // Delay to ensure modal fully loads
    });
});









// CUSTOM NOTIFICATION FUNCTION

// Custom function to display a notification with a clickable link
function showNotification(message, linkText, linkUrl) {
    const notificationContainer = document.createElement('div');
    notificationContainer.style.position = 'fixed';
    notificationContainer.style.top = '10px';
    notificationContainer.style.right = '10px';
    notificationContainer.style.padding = '15px';
    notificationContainer.style.backgroundColor = '#28a745';
    notificationContainer.style.color = 'white';
    notificationContainer.style.borderRadius = '5px';
    notificationContainer.style.fontSize = '16px';
    notificationContainer.style.zIndex = '1000';

    const messageElement = document.createElement('span');
    messageElement.textContent = message;

    const linkElement = document.createElement('a');
    linkElement.textContent = linkText;
    linkElement.href = linkUrl;
    linkElement.style.color = '#ffffff';
    linkElement.style.textDecoration = 'underline';
    linkElement.style.marginLeft = '10px';

    // Append the message and link to the notification
    notificationContainer.appendChild(messageElement);
    notificationContainer.appendChild(linkElement);

    // Append the notification to the body
    document.body.appendChild(notificationContainer);

    // Remove the notification after 5 seconds
    setTimeout(() => {
        notificationContainer.remove();
    }, 5000);
}



</script>

   <!-- Add Bootstrap 5 JS just before the closing </body> tag -->
   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
<br><br>
{% include 'footer.html' %}