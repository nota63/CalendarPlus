{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Claim Your CalPoints Reward</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <!-- Physics Engine -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.18.0/matter.min.js"></script>
    <style>
        .glass-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .neon-glow {
            filter: drop-shadow(0 0 12px rgba(67, 56, 202, 0.5));
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .money-particle {
            position: absolute;
            width: 40px;
            animation: float 3s ease-in-out infinite;
        }

        .confirmation-check {
            transform: scale(0);
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .check-visible {
            transform: scale(1);
            opacity: 1;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-indigo-900 to-purple-900 flex items-center justify-center p-4">
    <!-- Main Reward Card -->
    <div class="glass-card rounded-3xl overflow-hidden relative max-w-md w-full transform transition-all duration-500 hover:scale-[1.02]">
        <div class="p-8 relative z-10">
            <!-- Header Section -->
            <div class="flex items-center justify-between mb-8">
                <img src="{% static 'assets/images/calendarplus.png' %}" 
                     class="w-16 h-16 rounded-2xl border-2 border-white/20 neon-glow">
                <img src="{% static 'assets/images/calpoints.png' %}" 
                     class="w-16 h-16 rounded-2xl border-2 border-white/20 neon-glow">
            </div>

            <!-- Main Content -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">
                    Reward Unlocked!
                </h1>
                <p class="text-white/80 mt-3 text-sm">You've earned CalPoints for completing your tasks!</p>
            </div>

            <!-- User Details Card -->
            <div class="bg-white/5 rounded-xl p-6 mb-8 shadow-inner border border-white/10">
                <div class="flex items-center space-x-4 mb-6">
                    <span class="material-icons-round text-blue-400 text-3xl p-3 bg-white/10 rounded-full">person</span>
                    <div>
                        <p class="text-sm text-white/60">Awarded To</p>
                        <p class="font-semibold text-white text-lg">{{ user.username }}</p>
                    </div>
                </div>

                <div class="space-y-4">
                    <div class="flex justify-between items-center">
                        <span class="text-white/70">Workspace</span>
                        <span class="font-medium text-white">{{ latest_reward.organization.name }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-white/70">Project Group</span>
                        <span class="font-medium text-white">{{ latest_reward.group.name }}</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-white/70">Managed By</span>
                        <span class="font-medium text-white">{{ latest_reward.task.created_by.username }}</span>
                    </div>
                </div>
            </div>

            <!-- Points Display -->
            {% if calpoints.points%} 
               <div class="text-center mb-8">
                 <p class="text-white/80 text-sm">Total Points Earned</p>
                 <div class="text-6xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent mt-2">
                    {{ calpoints.points }}<span class="text-lg">CP</span>
                </div>
              </div>
            {% endif %}  

        </div>

        <!-- Claim Button -->
        <button id="claim-btn" 
                class="w-full bg-gradient-to-r from-emerald-400 to-cyan-500 hover:from-emerald-500 hover:to-cyan-600 text-white font-semibold py-5 px-8 transition-all duration-300 transform hover:scale-[1.02] active:scale-95 shadow-xl border-t border-white/10">
            <span class="flex items-center justify-center space-x-3">
                <span class="material-icons-round text-xl">savings</span>
                <span class="text-lg">Claim Reward</span>
            </span>
        </button>
    </div>

    <!-- Confirmation Overlay -->
    <div id="confirmation" class="fixed inset-0 bg-black/80 flex items-center justify-center opacity-0 pointer-events-none transition-opacity duration-500 backdrop-blur-lg">
        <div class="glass-card p-12 rounded-3xl text-center transform transition-all scale-90">
            <div class="confirmation-check">
                <!-- Animated Checkmark -->
                <div class="check-icon mb-6">
                    <svg class="w-24 h-24 text-emerald-400 mx-auto animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                
                <!-- Confirmation Text -->
                <h2 class="text-4xl font-bold bg-gradient-to-r from-emerald-400 to-cyan-400 bg-clip-text text-transparent mb-4">
                    Reward Claimed!
                </h2>
                <p class="text-white/80 text-lg">
                    {% if calpoints.points %}
                      {{ calpoints.points }} CP added to your balance
                    {% endif %}  
                </p>
                
                <!-- Additional Info -->
                <div class="mt-6 bg-white/5 p-4 rounded-xl">
                    <p class="text-sm text-white/70">Current Balance</p>
                    <p class="text-2xl font-bold text-emerald-400">{{ user.calpoints_balance }} CP</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Physics-based Money Explosion
        function createMoneyExplosion(x, y) {
            const Engine = Matter.Engine,
                Render = Matter.Render,
                World = Matter.World,
                Bodies = Matter.Bodies;

            // Create engine
            const engine = Engine.create();
            const render = Render.create({
                element: document.body,
                engine: engine,
                options: {
                    width: window.innerWidth,
                    height: window.innerHeight,
                    wireframes: false,
                    background: 'transparent'
                }
            });

            // Create 50 money particles
            for(let i = 0; i < 50; i++) {
                const money = Bodies.rectangle(
                    x,
                    y,
                    40, 40, 
                    {
                        render: {
                            sprite: {
                                texture: 'https://www.freeiconspng.com/uploads/money-png-5.png',
                                xScale: 0.15,
                                yScale: 0.15
                            }
                        },
                        chamfer: { radius: 10 },
                        restitution: 0.8,
                        angularVelocity: Math.random() * 0.5
                    }
                );
                World.add(engine.world, money);
            }

            // Add walls to contain particles
            World.add(engine.world, [
                Bodies.rectangle(window.innerWidth/2, window.innerHeight + 50, window.innerWidth, 100, { isStatic: true }),
                Bodies.rectangle(-50, window.innerHeight/2, 100, window.innerHeight, { isStatic: true }),
                Bodies.rectangle(window.innerWidth + 50, window.innerHeight/2, 100, window.innerHeight, { isStatic: true })
            ]);

            // Run the engine
            Engine.run(engine);
            Render.run(render);

            // Cleanup after 3 seconds
            setTimeout(() => {
                Render.stop(render);
                World.clear(engine.world);
                Engine.clear(engine);
                document.body.removeChild(render.canvas);
            }, 3000);
        }

        // Claim Button Handler
        document.getElementById('claim-btn').addEventListener('click', () => {
            const btn = document.getElementById('claim-btn');
            btn.disabled = true;
            btn.innerHTML = `
                <span class="flex items-center justify-center space-x-3">
                    <span class="material-icons-round animate-spin">autorenew</span>
                    <span class="text-lg">Claiming...</span>
                </span>
            `;

            // Get button position for explosion origin
            const rect = btn.getBoundingClientRect();
            createMoneyExplosion(
                rect.left + rect.width/2,
                rect.top + rect.height/2
            );

            // Show confirmation after animation
            setTimeout(() => {
                const confirmation = document.getElementById('confirmation');
                confirmation.classList.add('opacity-100', 'pointer-events-auto');
                document.querySelector('.confirmation-check').classList.add('check-visible');
            }, 1000);
        });
    </script>
</body>
</html>