
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ group.name }} Tasks</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <!-- Modern Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Plus Jakarta Sans', 'sans-serif'],
                        'display': ['Manrope', 'sans-serif']
                    },
                    colors: {
                        primary: {
                            50: '#f0f7ff',
                            100: '#e0eefe',
                            200: '#bae0fd',
                            300: '#7dccfc',
                            400: '#36b3f9',
                            500: '#0c98eb',
                            600: '#0271c9',
                            700: '#0262b0',
                            800: '#065393',
                            900: '#0a4479',
                        },
                        secondary: {
                            50: '#f8f5ff',
                            100: '#f1ebfe',
                            200: '#e4d9fd',
                            300: '#d0b9fc',
                            400: '#b68ef9',
                            500: '#9e65f5',
                            600: '#8647e8',
                            700: '#7834ca',
                            800: '#602ca1',
                            900: '#4e257c',
                        }
                    },
                    boxShadow: {
                        'neumorph': '20px 20px 60px #d9d9d9, -20px -20px 60px #ffffff',
                        'neumorph-sm': '10px 10px 30px #d9d9d9, -10px -10px 30px #ffffff',
                        'glass': '0 8px 32px 0 rgba(31, 38, 135, 0.07)',
                    }
                }
            }
        }
    </script>
    <style>
        /* all modal styles and animations */
          /* Base Styles */
body {
  font-family: 'Inter', system-ui, -apple-system, sans-serif;
}

/* Modal Backdrop Blur */
.modal-backdrop.show {
  backdrop-filter: blur(8px);
  background-color: rgba(0, 0, 0, 0.2);
  opacity: 1 !important;
}

/* Main Modal Container */
.modal {
  backdrop-filter: blur(12px);
}

/* Modal Content Styling */
.modal-content {
  background: rgba(255, 255, 255, 0.75);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 16px;
  box-shadow: 
    0 8px 32px 0 rgba(31, 38, 135, 0.15),
    0 4px 16px rgba(0, 0, 0, 0.05);
  backdrop-filter: blur(20px);
  transform: scale(0.97);
  transition: all 0.3s ease;
}

.modal.show .modal-content {
  transform: scale(1);
}

/* Modal Header */
.modal-header {
  border-bottom: 1px solid rgba(0, 0, 0, 0.08);
  padding: 1.25rem 2rem;
}

.modal-title {
  font-weight: 600;
  color: #1a1a1a;
  font-size: 1.25rem;
}

/* Modal Body */
.modal-body {
  padding: 1.5rem 2rem;
  color: #4a4a4a;
  line-height: 1.6;
}

/* Modal Footer */
.modal-footer {
  border-top: 1px solid rgba(0, 0, 0, 0.08);
  padding: 1rem 2rem;
  gap: 0.75rem;
}

/* Close Button Customization */
.btn-close {
  opacity: 0.6;
  transition: all 0.2s ease;
  filter: invert(0.3);
}

.btn-close:hover {
  opacity: 1;
  transform: rotate(90deg);
}

/* Custom Button Styles */
.modal-footer .btn {
  padding: 0.625rem 1.5rem;
  border-radius: 8px;
  font-weight: 500;
  transition: all 0.2s ease;
  border: 1px solid transparent;
}

.btn-primary {
  background: rgba(59, 130, 246, 0.9);
  backdrop-filter: blur(4px);
  color: white;
}

.btn-primary:hover {
  background: rgba(59, 130, 246, 1);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
}

.btn-secondary {
  background: rgba(243, 244, 246, 0.9);
  backdrop-filter: blur(4px);
  color: #1f2937;
}

.btn-secondary:hover {
  background: rgba(229, 231, 235, 0.9);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

/* Neuomorphic Effect on Focus */
.modal-content:focus-within {
  box-shadow: 
    0 8px 32px 0 rgba(31, 38, 135, 0.15),
    0 0 0 2px rgba(59, 130, 246, 0.3);
}

/* Responsive Tweaks */
@media (max-width: 576px) {
  .modal-content {
    margin: 0.5rem;
    border-radius: 12px;
  }
}
        /* Glassomorphism and other custom styles */
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .glass-sidebar {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(15px);
            border-right: 1px solid rgba(255, 255, 255, 0.18);
        }
        
        .priority-badge {
            padding: 4px 10px;
            border-radius: 30px;
            font-size: 0.75rem;
            font-weight: 600;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }
        
        .sidebar-menu-item:hover .sidebar-icon,
        .sidebar-menu-item.active .sidebar-icon {
            transform: translateX(4px);
        }

        /* Scrollbars */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background-color: rgba(241, 245, 249, 0.5);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb {
            background-color: rgba(148, 163, 184, 0.5);
            border-radius: 10px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background-color: rgba(100, 116, 139, 0.5);
        }

        /* Group List */
        #group-list {
        max-height: 200px; /* Limit the height */
        overflow-y: auto; /* Enable vertical scrolling */
        scrollbar-width: thin; /* For Firefox */
        scrollbar-color: transparent transparent; /* For Firefox */
    }

    #group-list::-webkit-scrollbar {
        width: 8px; /* Width of the scrollbar */
    }

    #group-list::-webkit-scrollbar-thumb {
        background-color: transparent; /* Invisible scrollbar thumb */
        border-radius: 10px;
    }

    /* Hide scrollbar when not needed */
    #group-list::-webkit-scrollbar-track {
        background-color: transparent; /* Invisible track */
    }

    /* Ensure the first 3 groups are displayed and limit scrollable area */
    .group-item:nth-child(n+4) {
        display: none; /* Hide all groups after the first 3 */
    }
    </style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-blue-50/30 min-h-screen font-sans text-gray-800 overflow-hidden">
    <div class="flex h-screen overflow-hidden">
        <!-- Sidebar -->
        <aside class="glass-sidebar hidden md:flex flex-col w-64 h-screen fixed z-20 transition-all duration-300 ease-in-out shadow-glass">
            <!-- Logo -->
            <div class="p-6 border-b border-gray-100">
                <div class="flex items-center">
                    <div class="h-9 w-9 flex items-center justify-center rounded-xl bg-gradient-to-br from-primary-500 to-secondary-500 shadow-lg">
                        <span class="material-icons-round text-white">bolt</span>
                    </div>
                    <span class="ml-3 text-xl font-display font-bold text-gray-800">{{organization.name}}</span>
                </div>
            </div>
            
            <!-- User Profile -->
            <div class="p-4 border-b border-gray-100">
                <div class="flex items-center space-x-3">
                    <div class="h-10 w-10 rounded-full bg-gradient-to-br from-primary-100 to-secondary-100 flex items-center justify-center">
                        <span class="font-medium text-primary-700">{{ user.first_name|first }}{{ user.last_name|first }}</span>
                    </div>
                    <div>
                        <h3 class="text-sm font-medium">{{ user.first_name }} {{ user.last_name }}</h3>
                        <p class="text-xs text-gray-500">{{ user.email }}</p>
                    </div>
                </div>
            </div>
            
            <!-- Navigation Menu -->
            <nav class="flex-1 px-2 py-4 overflow-y-auto">
                <div class="mb-6">
                    <h3 class="ml-4 text-xs uppercase font-semibold text-gray-500 tracking-wider">Dashboard</h3>
                    <ul class="mt-3 space-y-1">
                        <li>
                            <a href="#" class="sidebar-menu-item flex items-center px-4 py-3 text-primary-600 rounded-xl bg-primary-50">
                                <span class="material-icons-round sidebar-icon mr-3 text-primary-500 transition-transform duration-200">dashboard</span>
                                <span class="font-medium">Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="sidebar-menu-item flex items-center px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-xl">
                                <span class="material-icons-round sidebar-icon mr-3 text-gray-500 transition-transform duration-200">check_circle</span>
                                <span>My Tasks</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="sidebar-menu-item flex items-center px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-xl">
                                <span class="material-icons-round sidebar-icon mr-3 text-gray-500 transition-transform duration-200">today</span>
                                <span>My Day</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="sidebar-menu-item flex items-center px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-xl">
                                <span class="material-icons-round sidebar-icon mr-3 text-gray-500 transition-transform duration-200">calendar_month</span>
                                <span>Calendar</span>
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div class="mb-6">
                    <h3 class="ml-4 text-xs uppercase font-semibold text-gray-500 tracking-wider">Groups</h3>
                    <ul class="mt-3 space-y-1" id="group-list">
                        {% for group in groups %}
                            <li class="group-item">
                                <a href="{% url 'task_calendar' organization.id group.id %}" class="sidebar-menu-item flex items-center px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-xl">
                                    <span class="material-icons-round sidebar-icon mr-3 text-gray-500 transition-transform duration-200">group</span>
                                    <span>{{ group.name }}</span>
                                </a>
                            </li>
                        {% empty %}
                            <li class="text-gray-400 text-sm ml-4">No groups available</li>
                        {% endfor %}
                    </ul>
                </div>
                
                
                <div class="mb-6">
                    <h3 class="ml-4 text-xs uppercase font-semibold text-gray-500 tracking-wider">Settings</h3>
                    <ul class="mt-3 space-y-1">
                        <li>
                            <a href="#" class="sidebar-menu-item flex items-center px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-xl">
                                <span class="material-icons-round sidebar-icon mr-3 text-gray-500 transition-transform duration-200">settings</span>
                                <span>Settings</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="sidebar-menu-item flex items-center px-4 py-3 text-gray-700 hover:bg-gray-50 rounded-xl">
                                <span class="material-icons-round sidebar-icon mr-3 text-gray-500 transition-transform duration-200">help_outline</span>
                                <span>Help & Support</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
            
            <!-- Footer -->
            <div class="p-4 border-t border-gray-100">
                <a href="#" class="flex items-center text-gray-700">
                    <span class="material-icons-round mr-3 text-gray-500">logout</span>
                    <span>Logout</span>
                </a>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="flex-1 overflow-auto ml-0 md:ml-64">
            <!-- Top Navbar -->
            <header class="sticky top-0 z-10 glass-card shadow-sm">
                <div class="flex items-center justify-between px-6 h-16">
                    <!-- Sidebar Toggle Button -->
                    <button class="md:hidden text-gray-500 hover:text-gray-900 focus:outline-none">
                        <span class="material-icons-round">menu</span>
                    </button>
                    
                    <!-- Search Bar -->
                    <div class="flex-1 max-w-xl mx-4">
                        <div class="relative">
                            <span class="absolute inset-y-0 left-0 flex items-center pl-4 text-gray-400">
                                <span class="material-icons-round text-lg">search</span>
                            </span>
                            <input type="text" id="taskSearch" placeholder="Search tasks, projects, or people..." 
                                   class="w-full py-2 pl-12 pr-4 bg-gray-50 border-none rounded-xl focus:ring-2 focus:ring-primary-500/30 focus:bg-white transition-all">
                        </div>
                    </div>
                    
                    <!-- Right Side Icons -->
                    <div class="flex items-center space-x-4">
                        <button class="p-2 text-gray-500 hover:text-gray-900 hover:bg-gray-100 rounded-full">
                            <span class="material-icons-round">notifications</span>
                        </button>
                        <button class="p-2 text-gray-500 hover:text-gray-900 hover:bg-gray-100 rounded-full">
                            <span class="material-icons-round">help_outline</span>
                        </button>
                        <button class="p-2 text-gray-500 hover:text-gray-900 hover:bg-gray-100 rounded-full" id="fetchGroupDetailsBtn" data-org-id="{{organization.id}}" data-group-id="{{group.id}}">
                            <span class="material-icons-round">group</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="p-6">
                <!-- Page Header -->
                <div class="mb-8">
                    <div class="flex flex-col md:flex-row md:items-center md:justify-between">
                        <div>
                            <h1 class="text-3xl font-display font-bold text-gray-900">{{ group.name }} Tasks</h1>
                            <p class="mt-2 text-gray-600">Manage your assigned tasks efficiently and collaborate with your team.</p>
                        </div>
                        <div class="mt-4 md:mt-0">
                            <button class="bg-gradient-to-r from-primary-500 to-secondary-500 hover:from-primary-600 hover:to-secondary-600 text-white px-6 py-2.5 rounded-xl font-medium flex items-center gap-2 transition-all transform hover:scale-[1.02] shadow-md"
                                data-bs-toggle="offcanvas" data-bs-target="#learnMoreSidebar">
                                <span class="material-icons-round text-lg">help_outline</span>
                                Quick Guide
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Controls & Filters -->
                <div class="glass-card rounded-2xl p-6 mb-8 shadow-lg">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                        <!-- View Options -->
                        <div class="flex items-center space-x-2">
                            <button class="p-2 bg-primary-50 text-primary-600 rounded-lg flex items-center gap-1 font-medium">
                                <span class="material-icons-round text-sm">grid_view</span>
                                <span>Grid</span>
                            </button>
                            <button class="p-2 hover:bg-gray-100 text-gray-600 rounded-lg flex items-center gap-1 font-medium">
                                <span class="material-icons-round text-sm">view_list</span>
                                <span>List</span>
                            </button>
                            <button class="p-2 hover:bg-gray-100 text-gray-600 rounded-lg flex items-center gap-1 font-medium">
                                <span class="material-icons-round text-sm">view_kanban</span>
                                <span>Board</span>
                            </button>
                        </div>
                        
                        <!-- Filters -->
                        <div class="flex flex-wrap gap-3">
                            <!-- Priority Filter -->
                            <div class="glass-effect bg-white/80 rounded-xl">
                                <form method="get" class="flex items-center">
                                    <span class="pl-4 text-sm font-medium text-gray-600">Priority:</span>
                                    <select class="form-select bg-transparent border-none focus:ring-2 focus:ring-primary-500/30 rounded-lg px-4 py-2 text-gray-700"
                                            name="priority" onchange="this.form.submit()">
                                        <option value="">All</option>
                                        <option value="low" {% if request.GET.priority == 'low' %}selected{% endif %}>Low</option>
                                        <option value="medium" {% if request.GET.priority == 'medium' %}selected{% endif %}>Medium</option>
                                        <option value="high" {% if request.GET.priority == 'high' %}selected{% endif %}>High</option>
                                        <option value="urgent" {% if request.GET.priority == 'urgent' %}selected{% endif %}>Urgent</option>
                                    </select>
                                </form>
                            </div>
                            
                            <!-- Date Filter -->
                            <div class="glass-effect bg-white/80 rounded-xl px-4 py-2 flex items-center gap-2">
                                <span class="material-icons-round text-gray-500">date_range</span>
                                <span class="text-sm font-medium text-gray-600">Date</span>
                                <span class="material-icons-round text-gray-500 text-sm">arrow_drop_down</span>
                            </div>
                            
                            <!-- Assignee Filter -->
                            <div class="glass-effect bg-white/80 rounded-xl px-4 py-2 flex items-center gap-2">
                                <span class="material-icons-round text-gray-500">person</span>
                                <span class="text-sm font-medium text-gray-600">Assignee</span>
                                <span class="material-icons-round text-gray-500 text-sm">arrow_drop_down</span>
                            </div>
                        </div>
                        
                        <!-- Add Task Button -->
                        <button class="bg-primary-500 hover:bg-primary-600 text-white px-4 py-2 rounded-xl font-medium flex items-center gap-2 transition-all transform hover:scale-[1.02] shadow-md">
                            <span class="material-icons-round">add</span>
                            <span>New Task</span>
                        </button>
                    </div>
                </div>

                <!-- Tasks Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12" id="tasksGrid">
                    {% for task in tasks %}
                    <div class="glass-card group relative rounded-2xl p-6 border border-gray-100/60 shadow-lg hover:shadow-xl transition-all duration-300 hover:translate-y-[-2px]">
                        <!-- Priority Indicator -->
                        <div class="absolute top-6 right-6">
                            <span class="priority-badge 
                                {% if task.priority == 'urgent' %}bg-red-100 text-red-800
                                {% elif task.priority == 'high' %}bg-orange-100 text-orange-800
                                {% elif task.priority == 'medium' %}bg-yellow-100 text-yellow-800
                                {% else %}bg-green-100 text-green-800{% endif %}">
                                {{ task.priority }}
                            </span>
                        </div>

                        <!-- Task Content -->
                        <div class="space-y-5">
                            <div>
                                <h3 class="text-xl font-semibold text-gray-800 mb-1">{{ task.title }}</h3>
                            </div>

                            <!-- Metadata -->
                            <div class="space-y-3">
                                <div class="flex items-center gap-3 text-gray-600">
                                    <span class="material-icons-round text-primary-500">calendar_today</span>
                                    <span class="text-sm">{{ task.start }}</span>
                                </div>
                                <div class="flex items-center gap-3 text-gray-600">
                                    <span class="material-icons-round text-secondary-500">schedule</span>
                                    <span class="text-sm">Coming soon</span>
                                </div>
                                <div class="flex items-center gap-3 text-gray-600">
                                    <span class="material-icons-round text-green-500">person</span>
                                    <div class="flex -space-x-2">
                                        <div class="h-6 w-6 rounded-full bg-blue-100 flex items-center justify-center text-xs text-blue-600 border-2 border-white">JD</div>
                                        <div class="h-6 w-6 rounded-full bg-green-100 flex items-center justify-center text-xs text-green-600 border-2 border-white">AK</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Progress Bar -->
                            <div>
                                <div class="flex justify-between text-sm mb-2">
                                    <span class="text-gray-600">Progress</span>
                                    <span class="font-medium text-primary-600">{{ task.progress }}%</span>
                                </div>
                                <div class="h-2 bg-gray-200 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-primary-400 to-secondary-400 rounded-full transition-all duration-500" 
                                         style="width: {{ task.progress }}%"></div>
                                </div>
                            </div>

                            <!-- Actions -->
                            <div class="flex items-center justify-between pt-4 border-t border-gray-100">
                                <div class="flex items-center gap-2">
                                    <button class="p-2 hover:bg-gray-100 rounded-lg text-gray-500 hover:text-gray-700 transition-colors"
                                        onclick="toggleDropdown('{{ task.id }}')">
                                        <span class="material-icons-round">more_vert</span>
                                    </button>
                                    <div class="flex items-center gap-1 text-sm text-gray-500">
                                        <span class="material-icons-round text-sm">comment</span>
                                        5
                                    </div>
                                </div>
                                
                                <div class="flex items-center gap-2">
                                    {% if task.in_my_day %}
                                    <button class="px-4 py-1.5 bg-green-100 text-green-700 rounded-full text-sm font-medium flex items-center gap-2">
                                        <span class="material-icons-round text-sm">check_circle</span>
                                        Added
                                    </button>
                                    {% else %}
                                    <button class="px-4 py-1.5 bg-primary-100 text-primary-700 hover:bg-primary-200 rounded-full text-sm font-medium flex items-center gap-2 transition-colors"
                                            onclick="addToMyDay('{{ group.organization.id }}', '{{ group.id }}', '{{ task.id }}')">
                                        <span class="material-icons-round text-sm">add_task</span>
                                        Add to Day
                                    </button>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Dropdown Menu -->
                        <div id="dropdownMenu{{ task.id }}" class="absolute right-6 top-16 hidden w-48 glass-card rounded-xl shadow-xl z-10 overflow-hidden">
                            <ul class="py-1.5">
                                <li>
                                    <button class="w-full text-left px-4 py-2.5 hover:bg-gray-50 flex items-center gap-3 text-gray-700 text-sm font-medium transition-colors duration-200 ease-out">
                                        <i class="material-icons-round text-primary-600 text-[20px]">visibility</i>
                                        View Details
                                    </button>
                                </li>
                                
                                {% if task.in_my_day %}
                                    <li>
                                        <a href="{% url 'task_detail' org_id=group.organization.id group_id=group.id task_id=task.id %}" 
                                           class="w-full text-left px-4 py-2.5 hover:bg-gray-50 flex items-center gap-3 text-green-600 text-sm font-medium transition-colors duration-200 ease-out">
                                            <i class="material-icons-round text-green-600 text-[20px]">launch</i>
                                            Launch Task
                                        </a>
                                    </li>
                                {% else %}
                                    <li>
                                        <button class="w-full text-left px-4 py-2.5 hover:bg-gray-50 flex items-center gap-3 text-amber-600 text-sm font-medium transition-colors duration-200 ease-out" 
                                                onclick="addToMyDay('{{ group.organization.id }}', '{{ group.id }}', '{{ task.id }}')">
                                            <i class="material-icons-round text-amber-600 text-[20px]">add_task</i>
                                            Add to My Day
                                        </button>
                                    </li>
                                {% endif %}
                                {% if extend_tasks %}
                                  <li>
                                      <button class="w-full text-left px-4 py-2.5 hover:bg-gray-50 flex items-center gap-3 text-red-600 text-sm font-medium transition-colors duration-200 ease-out" 
                                       data-bs-toggle="modal" data-bs-target="#cancelTaskModal" 
                                       onclick="setCancelTaskData('{{ organization.id }}', '{{ group.id }}', '{{ task.id }}', '{{ task.title }}')">
                                       <i class="material-icons-round text-red-600 text-[20px]">cancel</i>
                                        Cancel Task
                                     </button>
                                 </li>

                                 <li>
                                    <button class="w-full text-left px-4 py-2.5 hover:bg-gray-50 flex items-center gap-3 text-primary-600 text-sm font-medium transition-colors duration-200 ease-out" 
                                    data-bs-toggle="modal" data-bs-target="#subTaskModal" 
                                     onclick="setSubTaskData('{{ organization.id }}', '{{ group.id }}', '{{ task.id }}')">
                                    <i class="material-icons-round text-primary-600 text-[20px]">add_task</i>
                                    Create SubTask
                                     </button>
                                 </li>
                                 <li>
                                    <button class="w-full text-left px-4 py-2.5 hover:bg-gray-50 flex items-center gap-3 text-secondary-600 text-sm font-medium transition-colors duration-200 ease-out"
                                      data-bs-toggle="modal" data-bs-target="#manageSubTaskModal"
                                     onclick="loadSubTasks('{{ organization.id }}', '{{ group.id }}', '{{ task.id }}')">
                                   <i class="material-icons-round text-secondary-600 text-[20px]">playlist_add_check</i>
                                   Manage SubTasks
                                  </button>
                                </li>
                                <li>
                                    <button class="w-full text-left px-4 py-2.5 hover:bg-gray-50 flex items-center gap-3 text-secondary-600 text-sm font-medium transition-colors duration-200 ease-out" 
                                      data-bs-toggle="modal" data-bs-target="#exportTaskModal" 
                                     onclick="exportTask('{{ organization.id }}', '{{ group.id }}', '{{ task.id }}')"> 
                                   <i class="material-icons-round text-secondary-600 text-[20px]">file_download</i>
                                    Export 
                                  </button>
                                </li>

                                <li>
                                    <button class="w-full text-left px-4 py-2.5 hover:bg-gray-50 flex items-center gap-3 text-secondary-600 text-sm font-medium transition-colors duration-200 ease-out" 
                                     data-bs-toggle="modal" 
                                     data-bs-target="#attachFileModal"
                                     data-org-id="{{ organization.id }}"
                                     data-group-id="{{ group.id }}"
                                     data-task-id="{{ task.id }}">
                                    <i class="material-icons-round text-secondary-600 text-[20px]">attach_file</i>
                                    Attach Files
                                </button>

                                </li>
                                {% endif %} 
                            </ul>
                        </div>
                    </div>
                    {% endfor %}
                </div>

            <!-- Pagination -->
            <div class="glass-card rounded-2xl p-4 mb-12 shadow-md neuro-element">
                <nav class="flex items-center justify-between">
                    <div class="flex items-center gap-1 text-slate-600">
                        <span class="text-sm font-medium">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
                    </div>
                    
                    <div class="flex items-center gap-2">
                        {% if page_obj.has_previous %}
                        <a href="?page=1" class="p-2 hover:bg-slate-100 rounded-lg text-slate-500 hover:text-primary-600 transition-colors">
                            <span class="material-icons-round">first_page</span>
                        </a>
                        <a href="?page={{ page_obj.previous_page_number }}" class="p-2 hover:bg-slate-100 rounded-lg text-slate-500 hover:text-primary-600 transition-colors">
                            <span class="material-icons-round">chevron_left</span>
                        </a>
                        {% endif %}

                        {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}" class="p-2 hover:bg-slate-100 rounded-lg text-slate-500 hover:text-primary-600 transition-colors">
                            <span class="material-icons-round">chevron_right</span>
                        </a>
                        <a href="?page={{ page_obj.paginator.num_pages }}" class="p-2 hover:bg-slate-100 rounded-lg text-slate-500 hover:text-primary-600 transition-colors">
                            <span class="material-icons-round">last_page</span>
                        </a>
                        {% endif %}
                    </div>
                </nav>
            </div>
        </main>
    </div>

<!---------------------------------------------------------------------------------------------------------------------------------  -->
    <!-- Learn More Sidebar -->
    <div class="fixed inset-0 bg-black/50 z-50 hidden" id="learnMoreOverlay"></div>
    <div class="fixed top-0 right-0 h-full w-96 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-50" 
         id="learnMoreSidebar">
        <div class="p-6 h-full flex flex-col">
            <!-- Header -->
            <div class="flex items-center justify-between mb-8">
                <h3 class="text-xl font-semibold text-gray-800 flex items-center gap-2">
                    <span class="material-icons-round text-blue-500">school</span>
                    Task Guide
                </h3>
                <button onclick="closeSidebar()" class="p-2 hover:bg-gray-100 rounded-lg text-gray-500">
                    <span class="material-icons-round">close</span>
                </button>
            </div>

            <!-- Content -->
            <div class="flex-1 overflow-y-auto space-y-6">
                <div class="space-y-4">
                    <h4 class="font-medium text-gray-800 flex items-center gap-2">
                        <span class="material-icons-round text-green-500">rocket_launch</span>
                        Getting Started
                    </h4>
                    <div class="space-y-3 text-gray-600 text-sm">
                        <p>Use priority levels to organize your workflow effectively. Start with urgent tasks and work your way down.</p>
                        <div class="p-4 bg-blue-50/50 rounded-xl">
                            <span class="text-xs font-medium text-blue-600">Pro Tip:</span>
                            <p class="mt-1">Add recurring tasks to "My Day" to build consistent work habits.</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <h4 class="font-medium text-gray-800 flex items-center gap-2">
                        <span class="material-icons-round text-purple-500">priority_high</span>
                        Priority System
                    </h4>
                    <div class="grid grid-cols-2 gap-3 text-sm">
                        <div class="p-3 bg-red-50/50 rounded-xl">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-2 h-2 bg-red-500 rounded-full"></div>
                                <span class="font-medium text-red-700">Urgent</span>
                            </div>
                            <p class="text-red-600/80">Immediate action required, critical deadlines</p>
                        </div>
                        <div class="p-3 bg-orange-50/50 rounded-xl">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-2 h-2 bg-orange-500 rounded-full"></div>
                                <span class="font-medium text-orange-700">High</span>
                            </div>
                            <p class="text-orange-600/80">Important tasks needing attention</p>
                        </div>
                        <div class="p-3 bg-yellow-50/50 rounded-xl">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-2 h-2 bg-yellow-500 rounded-full"></div>
                                <span class="font-medium text-yellow-700">Medium</span>
                            </div>
                            <p class="text-yellow-600/80">Regular priority tasks</p>
                        </div>
                        <div class="p-3 bg-green-50/50 rounded-xl">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                <span class="font-medium text-green-700">Low</span>
                            </div>
                            <p class="text-green-600/80">Can be scheduled for later</p>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <h4 class="font-medium text-gray-800 flex items-center gap-2">
                        <span class="material-icons-round text-blue-500">tips_and_updates</span>
                        Productivity Tips
                    </h4>
                    <div class="space-y-3 text-sm text-gray-600">
                        <div class="flex items-start gap-3">
                            <span class="material-icons-round text-blue-400 flex-shrink-0">check_circle</span>
                            <div>
                                <p class="font-medium">Daily Review</p>
                                <p class="text-sm">Start each day by reviewing priority tasks</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-3">
                            <span class="material-icons-round text-purple-400 flex-shrink-0">timeline</span>
                            <div>
                                <p class="font-medium">Progress Tracking</p>
                                <p class="text-sm">Update task progress at least twice daily</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="pt-6 border-t border-gray-100">
                <button onclick="closeSidebar()" class="w-full py-2.5 px-4 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl text-sm font-medium transition-colors">
                    Close Guide
                </button>
            </div>
        </div>
    </div>
<!-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- -->
<!-- Extend Tasks APP modals -->
<!-- Cancel Task Modal -->
<div class="modal fade" id="cancelTaskModal" tabindex="-1" aria-labelledby="cancelTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered max-w-2xl">
        <div class="modal-content rounded-xl shadow-lg">
            <!-- Modal Header -->
            <div class="modal-header bg-red-50 rounded-t-xl p-6 border-b border-red-100">
                <div class="w-full">
                    <h5 class="modal-title text-2xl font-bold text-red-600 mb-2" id="cancelTaskModalLabel">
                        Cancel Task: <span id="cancelTaskTitle" class="break-words"></span>
                    </h5>
                    <p class="text-sm text-red-700 opacity-90">
                        We will notify your manager about this cancellation
                    </p>
                </div>
                <button type="button" class="btn-close opacity-70 hover:opacity-100" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body p-6 space-y-4">
                <label for="cancelReason" class="block text-base font-medium text-gray-700">
                    Please provide the reason for cancellation
                </label>
                <textarea 
                    id="cancelReason" 
                    class="form-control w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 placeholder-gray-400" 
                    rows="4"
                    placeholder="Describe the reason for canceling this task..."
                ></textarea>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer bg-gray-50 rounded-b-xl p-6 border-t border-gray-100">
                <button 
                    type="button" 
                    class="btn btn-secondary px-5 py-2.5 hover:bg-gray-200 transition-colors"
                    data-bs-dismiss="modal"
                >
                    Close
                </button>
                <button 
                    id="cancelTaskButton" 
                    class="btn btn-danger px-6 py-2.5 bg-red-600 hover:bg-red-700 text-white transition-colors flex items-center justify-center gap-2"
                    onclick="submitTaskCancellation()"
                >
                    <span id="loadingSpinner" class="hidden">
                        <i class="fas fa-spinner fa-spin"></i>
                    </span>
                    Confirm Cancellation
                </button>
            </div>
        </div>
    </div>
</div>

<!-- CREATE SUBTASK -->
<!-- SubTask Modal -->
<div class="modal fade" id="subTaskModal" tabindex="-1" aria-labelledby="subTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered max-w-3xl">
        <div class="modal-content rounded-xl shadow-lg">
            <!-- Modal Header -->
            <div class="modal-header bg-blue-50 rounded-t-xl p-6 border-b border-blue-100">
                <div class="w-full">
                    <h5 class="modal-title text-2xl font-bold text-blue-600 mb-1" id="subTaskModalLabel">
                        Create New SubTask
                    </h5>
                    <p class="text-sm text-blue-700 opacity-90">
                        Add detailed information for the subtask
                    </p>
                </div>
                <button type="button" class="btn-close opacity-70 hover:opacity-100" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body p-6 space-y-6">
                <form id="subTaskForm" class="space-y-4">
                    <!-- Title Input -->
                    <div class="space-y-2">
                        <label for="subTaskTitle" class="block text-base font-medium text-gray-700">
                            SubTask Title <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="text" 
                            id="subTaskTitle" 
                            required
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 placeholder-gray-400"
                        >
                    </div>

                    <!-- Description Input -->
                    <div class="space-y-2">
                        <label for="subTaskDescription" class="block text-base font-medium text-gray-700">
                            Description (Optional)
                        </label>
                        <textarea 
                            id="subTaskDescription" 
                            rows="3"
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 placeholder-gray-400"
                        ></textarea>
                    </div>

                    <!-- Priority Select -->
                    <div class="space-y-2">
                        <label for="subTaskPriority" class="block text-base font-medium text-gray-700">
                            Priority Level
                        </label>
                        <select 
                            id="subTaskPriority" 
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"
                        >
                            <option value="low" class="text-green-600">Low</option>
                            <option value="medium" selected class="text-yellow-600">Medium</option>
                            <option value="high" class="text-orange-600">High</option>
                            <option value="urgent" class="text-red-600">Urgent</option>
                        </select>
                    </div>

                    <!-- Deadline Input -->
                    <div class="space-y-2">
                        <label for="subTaskDeadline" class="block text-base font-medium text-gray-700">
                            Deadline <span class="text-red-500">*</span>
                        </label>
                        <input 
                            type="datetime-local" 
                            id="subTaskDeadline" 
                            required
                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 bg-white"
                        >
                    </div>

                    <!-- Submit Button -->
                    <div class="pt-4">
                        <button 
                            type="submit" 
                            class="w-full btn btn-success px-6 py-3 bg-green-600 hover:bg-green-700 text-white font-medium rounded-lg transition-colors flex items-center justify-center gap-2"
                        >
                            <span id="submitText">Create SubTask</span>
                            <span id="loadingSpinner" class="hidden">
                                <i class="fas fa-spinner fa-spin"></i>
                            </span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<!-- MANAGE SUBTASK MODAL  -->
<!-- Manage SubTask Modal -->
<div class="modal fade" id="manageSubTaskModal" tabindex="-1" aria-labelledby="manageSubTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content rounded-xl shadow-2xl bg-white border border-gray-200">
        <!-- Modal Header -->
        <div class="modal-header px-6 py-4 bg-gray-50 border-b border-gray-200 rounded-t-xl">
          <div class="flex items-center justify-between w-full">
            <div>
              <h3 class="text-2xl font-semibold text-gray-800">
                <i class="material-icons-round text-blue-600 align-middle mr-2">list_alt</i>
                Manage Subtasks
              </h3>
              <p class="text-sm text-gray-500 mt-1">Manage subtasks for current workflow</p>
            </div>
            <div class="flex items-center gap-3">
              <!-- Add Task Button -->
              <button 
                  class="inline-flex items-center px-4 py-2.5 bg-blue-100 hover:bg-blue-200 text-blue-800 rounded-lg transition-colors duration-300 focus:ring-4 focus:ring-blue-200/50 focus:outline-none font-medium"
                  data-bs-toggle="modal" 
                  data-bs-target="#subTaskModal"
                 onclick="setSubTaskData('{{ organization.id }}', '{{ group.id }}', '{{ task.id }}')"
                    >
              <i class="material-icons-round text-base mr-2 text-blue-600">add_circle</i>
                CREATE SUBTASK
             </button>


              <button 
                type="button" 
                class="btn-icon-close"
                data-bs-dismiss="modal" 
                aria-label="Close"
              >
                <i class="material-icons-round">close</i>
              </button>
            </div>
          </div>
        </div>
  
        <!-- Modal Body -->
        <div class="modal-body p-6 bg-white">
          <div class="space-y-4">
            <h4 class="text-lg font-medium text-gray-700 mb-2">
              <i class="material-icons-round text-gray-500 mr-2">checklist</i>
              Existing Subtasks
            </h4>
            
            <!-- Subtask List -->
            <div id="subtaskList" class="grid gap-2 max-h-[60vh] overflow-y-auto pr-3">
              <!-- Loading State -->
              <div class="animate-pulse flex space-x-4">
                <div class="flex-1 space-y-4 py-1">
                  <div class="h-4 bg-gray-200 rounded w-3/4"></div>
                  <div class="space-y-2">
                    <div class="h-4 bg-gray-200 rounded"></div>
                    <div class="h-4 bg-gray-200 rounded w-5/6"></div>
                  </div>
                </div>
              </div>
  
              <!-- Subtask Item Example -->
              <div class="subtask-item group flex items-center gap-4 p-4 bg-white rounded-lg border border-gray-200 hover:border-blue-200 hover:shadow-sm transition-all">
                <div class="flex-1">
                  <div class="flex items-center gap-3">
                    <i class="material-icons-round text-gray-400 cursor-move hover:text-gray-600">drag_indicator</i>
                    <span class="font-medium text-gray-700">Design Homepage Layout</span>
                    <span class="px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800">In Progress</span>
                  </div>
                  <p class="text-sm text-gray-500 ml-8 mt-1">Create responsive design mockups for homepage sections</p>
                </div>
                <div class="flex items-center gap-2">
                  <button class="btn-icon text-gray-500 hover:bg-gray-100">
                    <i class="material-icons-round text-base">edit</i>
                  </button>
                  <button class="btn-icon text-gray-500 hover:bg-red-100 hover:text-red-600">
                    <i class="material-icons-round text-base">delete</i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


<!-- EXPORT TASKS -->

<!-- EXPORT TASKS -->
 <!-- Export Task Modal -->
 <div id="exportTaskModal" class="modal fade" tabindex="-1" aria-labelledby="exportTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content p-4">
            <!-- Modal Header -->
            <div class="flex justify-between items-center">
                <h2 class="text-lg font-semibold">Export Task</h2>
                <button type="button" class="close text-gray-500 hover:text-gray-700" data-bs-dismiss="modal">
                    &times;
                </button>
            </div>

            <!-- Modal Body -->
            <div class="mt-4">
                <p class="text-gray-600">Choose how you want to export this task:</p>
                <div class="flex flex-col gap-3 mt-3">
                    <!-- Export via Email -->
                    <button id="export-email-btn"
                        class="w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 flex items-center gap-2">
                        <i class="material-icons-round">email</i> Send to Email
                    </button>

                    <!-- Export Now -->
                    <button id="export-now-btn"
                        class="w-full px-4 py-2 bg-purple-600 text-white rounded-md hover:bg-purple-700 flex items-center gap-2">
                        <i class="material-icons-round">download</i> Export Now
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ATTACH THE FILE TO THE TASK(PREMIUM) -->
<!-- 📌 Attach File Modal -->
<!-- Material Icons CDN -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

<!-- Material Icons CDN -->
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

<div id="attachFileModal" class="modal fade" tabindex="-1" aria-labelledby="attachFileLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 overflow-hidden" 
             style="background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px);">
            
            <!-- Modal Header -->
            <div class="modal-header border-bottom-0 py-4 px-5">
                <h5 class="modal-title text-primary fw-600 d-flex align-items-center gap-2">
                    <i class="material-icons-round fs-5">attach_file</i>
                    <span class="fs-5">Attach File</span>
                </h5>
                <button type="button" class="btn-close shadow-none" data-bs-dismiss="modal" aria-label="Close">
                    <i class="material-icons-round text-muted">close</i>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body px-5 pt-0 d-flex gap-4">
                <!-- Left Column -->
                <div class="w-50 pe-3">
                    <!-- Drag & Drop Area -->
                    <div id="dropArea" 
                         class="border-2 border-dashed rounded-3 p-5 text-center cursor-pointer position-relative bg-white bg-opacity-50 transition-all"
                         style="border-color: rgba(156, 39, 176, 0.3);">
                        <div class="position-absolute top-50 start-50 translate-middle">
                            <i class="material-icons-round text-primary fs-1 mb-2">cloud_upload</i>
                            <p class="text-muted mb-1 fw-500">Drag & Drop files</p>
                            <p class="text-muted fs-7 mb-2">or</p>
                            <input type="file" id="fileInput" class="d-none">
                            <button type="button" 
                                    class="btn btn-sm btn-primary rounded-pill px-4 shadow-sm"
                                    onclick="document.getElementById('fileInput').click();">
                                <i class="material-icons-round me-2 fs-6">upload</i>
                                Browse Files
                            </button>
                        </div>
                    </div>

                    <br><br>

                    <!-- File Details -->
                    <div class="mt-4">
                        <!-- File Name -->
                        <div class="form-floating mb-3">
                            <input type="text" id="fileName" class="form-control border-0 bg-white bg-opacity-50" 
                                   placeholder=" " style="height: 56px;">
                            <label class="text-muted d-flex align-items-center gap-2">
                                <i class="material-icons-round fs-6">drive_file_rename_outline</i>
                                File Name
                            </label>
                        </div>

                        <!-- Description -->
                        <div class="form-floating mb-3">
                            <textarea id="fileDescription" class="form-control border-0 bg-white bg-opacity-50" 
                                      placeholder=" " style="height: 100px;"></textarea>
                            <label class="text-muted d-flex align-items-center gap-2">
                                <i class="material-icons-round fs-6">description</i>
                                Description
                            </label>
                        </div>

                        <!-- Category Select -->
                        <div class="mb-3 position-relative">
                            <i class="material-icons-round position-absolute start-0 top-50 translate-middle-y ms-3 text-muted">category</i>
                            <select id="fileCategory" class="form-select border-0 bg-white bg-opacity-50 ps-5" style="height: 56px;">
                                <option value="document">Document</option>
                                <option value="image">Image</option>
                                <option value="code">Code File</option>
                                <option value="audio">Audio File</option>
                                <option value="video">Video File</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <!-- Checkboxes -->
                        <div class="d-flex flex-column gap-3">
                            <div class="form-check ps-0">
                                <input class="form-check-input d-none" type="checkbox" id="isPrivate">
                                <label class="form-check-label d-flex align-items-center gap-2 cursor-pointer" for="isPrivate">
                                    <div class="checkbox-container bg-white bg-opacity-50 rounded-2" style="width: 24px; height: 24px;">
                                        <i class="material-icons-round checkbox-icon text-primary fs-6" style="display: none;">check_box</i>
                                        <i class="material-icons-round checkbox-icon-outline text-muted fs-6">check_box_outline_blank</i>
                                    </div>
                                    <span class="text-muted">Mark as Private</span>
                                </label>
                            </div>

                            <div class="form-check ps-0">
                                <input class="form-check-input d-none" type="checkbox" id="sendCopyToManager">
                                <label class="form-check-label d-flex align-items-center gap-2 cursor-pointer" for="sendCopyToManager">
                                    <div class="checkbox-container bg-white bg-opacity-50 rounded-2" style="width: 24px; height: 24px;">
                                        <i class="material-icons-round checkbox-icon text-primary fs-6" style="display: none;">check_box</i>
                                        <i class="material-icons-round checkbox-icon-outline text-muted fs-6">check_box_outline_blank</i>
                                    </div>
                                    <span class="text-muted">Send Copy to Manager</span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column -->
                <div class="w-50 ps-3 border-start">
                    <!-- File Preview -->
                    <div class="mb-4">
                        <h6 class="text-muted fw-600 mb-3 d-flex align-items-center gap-2">
                            <i class="material-icons-round fs-6">preview</i>
                            File Preview
                        </h6>
                        <div id="filePreview" class="border-0 rounded-3 bg-white bg-opacity-50 p-4 text-center transition-all"
                             style="min-height: 200px;">
                            <div class="file-preview-content">
                                <i class="material-icons-round text-muted fs-1">insert_drive_file</i>
                                <p class="text-muted mt-2 mb-0">No file selected</p>
                            </div>
                        </div>
                    </div>

                    <!-- Progress Bar -->
                    <div class="mt-4">
                        <h6 class="text-muted fw-600 mb-3 d-flex align-items-center gap-2">
                            <i class="material-icons-round fs-6">pending_actions</i>
                            Upload Progress
                        </h6>
                        <div class="progress rounded-pill" style="height: 8px; background: rgba(156, 39, 176, 0.1);">
                            <div id="progressBar" class="progress-bar rounded-pill bg-primary-gradient" 
                                 role="progressbar" style="width: 0%; transition: width 0.3s ease;">
                            </div>
                        </div>
                        <p class="text-end text-muted fs-7 mt-2 mb-0"><span id="progressPercent">0</span>% Complete</p>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer border-top-0 px-5 pb-4 pt-0">
                <button type="button" class="btn btn-link text-muted text-decoration-none" data-bs-dismiss="modal">
                    Cancel
                </button>
                <button type="button" id="uploadBtn" 
                        class="btn btn-primary rounded-pill px-5 shadow-sm d-flex align-items-center gap-2">
                    <i class="material-icons-round fs-6">cloud_upload</i>
                    Upload File
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Group[ and team details modal] -->
<div class="modal fade" id="groupDetailsModal" tabindex="-1" aria-labelledby="groupDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="groupDetailsModalLabel">Group Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div id="groupDetailsContent">
                    <p class="text-center">Loading...</p>
                </div>
            </div>
        </div>
    </div>
</div>





<!-- Bootstrap 5 JS (with Popper.js) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
        // Sidebar Toggle
        function toggleSidebar() {
            document.getElementById('learnMoreOverlay').classList.toggle('hidden');
            document.getElementById('learnMoreSidebar').classList.toggle('translate-x-full');
        }

        function closeSidebar() {
            document.getElementById('learnMoreOverlay').classList.add('hidden');
            document.getElementById('learnMoreSidebar').classList.add('translate-x-full');
        }

        // Dropdown Toggle
        function toggleDropdown(taskId) {
            const dropdown = document.getElementById(`dropdownMenu${taskId}`);
            dropdown.classList.toggle('hidden');
            
            // Close when clicking outside
            document.addEventListener('click', function close(e) {
                if (!dropdown.contains(e.target) && !e.target.closest(`[onclick="toggleDropdown('${taskId}')"]`)) {
                    dropdown.classList.add('hidden');
                    document.removeEventListener('click', close);
                }
            });
        }

        // Add to My Day
        function addToMyDay(orgId, groupId, taskId) {
            const csrfToken = "{{ csrf_token }}";
            fetch(`/tasks/add-to-my-day/${orgId}/${groupId}/${taskId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': csrfToken
                }
            })
            .then(response => response.json())
            .then(data => {
                if(data.success) {
                    // Update UI
                    const button = document.querySelector(`[onclick="addToMyDay('${orgId}', '${groupId}', '${taskId}')"]`);
                    if(button) {
                        button.outerHTML = `
                            <button class="px-4 py-1.5 bg-green-100 text-green-700 rounded-full text-sm font-medium flex items-center gap-2">
                                <span class="material-icons-round text-sm">check_circle</span>
                                Added
                            </button>
                        `;
                    }
                }
            })
            .catch(error => console.error('Error:', error));
        }

        // Close sidebar when clicking overlay
        document.getElementById('learnMoreOverlay').addEventListener('click', closeSidebar);


// CANCEL THE TASK
let selectedOrgId = null;
    let selectedGroupId = null;
    let selectedTaskId = null;

    // Function to set task details when opening the cancel modal
    function setCancelTaskData(orgId, groupId, taskId, taskTitle) {
        selectedOrgId = orgId;
        selectedGroupId = groupId;
        selectedTaskId = taskId;

        document.getElementById("cancelTaskTitle").innerText = taskTitle;
    }

    // Function to get CSRF token from cookies
    function getCSRFToken() {
        let cookies = document.cookie.split("; ");
        for (let cookie of cookies) {
            let [name, value] = cookie.split("=");
            if (name === "csrftoken") return value;
        }
        return "";
    }

    // Function to submit task cancellation
    async function submitTaskCancellation() {
        const reason = document.getElementById("cancelReason").value.trim();
        const cancelButton = document.getElementById("cancelTaskButton");
        const spinner = document.getElementById("loadingSpinner");

        if (!reason) {
            alert("Please enter a reason for cancellation.");
            return;
        }

        // Disable button and show spinner
        cancelButton.disabled = true;
        spinner.classList.remove("hidden");

        try {
            const response = await fetch(`/tasks/cancel-task/${selectedOrgId}/${selectedGroupId}/${selectedTaskId}/`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": getCSRFToken()
                },
                body: JSON.stringify({ reason: reason })
            });

            const data = await response.json();

            if (data.success) {
                alert("Task has been canceled successfully.");
                location.reload();
            } else {
                alert("Error canceling task. Please try again.");
            }
        } catch (error) {
            console.error("Error:", error);
            alert("Something went wrong. Please try again.");
        } finally {
            // Enable button and hide spinner
            cancelButton.disabled = false;
            spinner.classList.add("hidden");
        }
    }




// CREATE SUBTASK
// Variables to store captured IDs
let orgId, groupId, taskId;

// Function to set task data when button is clicked
function setSubTaskData(org, group, task) {
    orgId = org;
    groupId = group;
    taskId = task;
}

// Run this only when the modal form is submitted
document.addEventListener("DOMContentLoaded", function () {
    const subTaskForm = document.getElementById("subTaskForm");
    const submitText = document.getElementById("submitText");
    const loadingSpinner = document.getElementById("loadingSpinner");

    subTaskForm.addEventListener("submit", function (event) {
        event.preventDefault();

        // Get input values
        const title = document.getElementById("subTaskTitle").value.trim();
        const description = document.getElementById("subTaskDescription").value.trim();
        const priority = document.getElementById("subTaskPriority").value;
        const deadline = document.getElementById("subTaskDeadline").value;

        if (!title || !deadline) {
            alert("Title and Deadline are required!");
            return;
        }

        // Show loading spinner
        submitText.classList.add("d-none");
        loadingSpinner.classList.remove("d-none");

        // CSRF Token
        const csrftoken = getCSRFToken();

        // AJAX Request
        fetch(`/tasks/create-subtask/${orgId}/${groupId}/${taskId}/`, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "X-CSRFToken": csrftoken,
            },
            body: JSON.stringify({
                title: title,
                description: description,
                priority: priority,
                deadline: deadline,
            }),
        })
        .then(response => response.json())
        .then(data => {
            if (data.error) {
                alert("Error: " + data.error);
            } else {
                alert("SubTask Created Successfully!");
                window.location.reload();
            }
        })
        .catch(error => {
            console.error("Error:", error);
            alert("Something went wrong!");
        })
        .finally(() => {
            // Hide spinner and show button text
            submitText.classList.remove("d-none");
            loadingSpinner.classList.add("d-none");
        });
    });

    // Function to get CSRF Token
    function getCSRFToken() {
        return document.cookie.split("; ").find(row => row.startsWith("csrftoken="))?.split("=")[1];
    }
});



// MANAGE SUBTASKS - Full Material UI Implementation
function loadSubTasks(orgId, groupId, taskId) {
    fetch(`/tasks/subtasks/${orgId}/${groupId}/${taskId}/`)
        .then(response => response.json())
        .then(data => {
            const subtaskList = document.getElementById("subtaskList");
            subtaskList.innerHTML = '';

            if (data.subtasks.length === 0) {
                subtaskList.innerHTML = `
                    <div class="flex flex-col items-center justify-center p-8 rounded-xl bg-white/30 backdrop-blur-sm border border-gray-200/50">
                        <svg class="w-12 h-12 text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        <p class="text-gray-500 font-medium">No subtasks created yet</p>
                        <p class="text-sm text-gray-400 mt-1">Click the '+' button to add new subtasks</p>
                    </div>
                `;
                return;
            }

            data.subtasks.forEach(subtask => {
                subtaskList.innerHTML += `
                    <div class="group relative mb-4 p-5 rounded-xl bg-white/70 backdrop-blur-sm border border-gray-200/60 shadow-sm hover:shadow-md transition-all duration-200 ease-out">
                        <div class="flex gap-4 items-start">
                            <div class="flex-1 min-w-0">
                                <h3 class="text-gray-800 font-semibold text-base mb-2 truncate">${subtask.title}</h3>
                                
                                <div class="flex flex-wrap items-center gap-4 mb-4">
                                    <div class="flex items-center gap-2">
                                        <span class="text-sm text-gray-500">Status:</span>
                                        <select 
                                            id="status-${subtask.id}"
                                            class="min-w-[120px] px-3 py-1.5 text-sm rounded-lg border border-gray-300/80 bg-white/90 shadow-xs focus:ring-2 focus:ring-blue-500/50 focus:border-blue-500 transition-all"
                                            onchange="changeSubTaskStatus('${orgId}', '${groupId}', '${taskId}', '${subtask.id}')">
                                            <option value="Pending" ${subtask.status === "Pending" ? "selected" : ""}>🟡 Pending</option>
                                            <option value="In Progress" ${subtask.status === "In Progress" ? "selected" : ""}>🔵 In Progress</option>
                                            <option value="Completed" ${subtask.status === "Completed" ? "selected" : ""}>🟢 Completed</option>
                                            <option value="Cancelled" ${subtask.status === "Cancelled" ? "selected" : ""}>⚪ Cancelled</option>
                                            <option value="Overdue" ${subtask.status === "Overdue" ? "selected" : ""}>🔴 Overdue</option>
                                        </select>
                                    </div>

                                    <div class="flex items-center gap-2">
                                        <span class="text-sm text-gray-500">Priority:</span>
                                        <div class="flex items-center gap-1 px-2 py-1 rounded-full bg-blue-50/80 text-blue-600 text-xs font-medium">
                                            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                                                <path fill-rule="evenodd" d="M12.395 2.553a1 1 0 00-1.45-.385c-.345.23-.614.558-.822.88-.214.33-.403.713-.57 1.116-.334.804-.614 1.768-.84 2.734a31.365 31.365 0 00-.613 3.58 2.64 2.64 0 01-.945-1.067c-.328-.68-.398-1.534-.398-2.654A1 1 0 005.05 6.05 6.981 6.981 0 003 11a7 7 0 1011.95-4.95c-.592-.591-.98-.985-1.348-1.467-.363-.476-.724-1.063-1.207-2.03zM12.12 15.12A3 3 0 017 13s.879.5 2.5.5c0-1 .5-4 1.25-4.5.5 1 .786 1.293 1.371 1.879A2.99 2.99 0 0113 13a2.99 2.99 0 01-.879 2.121z" clip-rule="evenodd"/>
                                            </svg>
                                            High
                                        </div>
                                    </div>
                                </div>

                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <span class="text-sm text-gray-500">Progress</span>
                                        <span id="progress-${subtask.id}" class="text-sm font-semibold text-blue-600">${subtask.progress}%</span>
                                    </div>
                                    <div class="relative">
                                        <div class="h-2.5 bg-gray-200/80 rounded-full overflow-hidden">
                                            <div 
                                                id="progress-bar-${subtask.id}"
                                                class="h-full rounded-full ${getProgressColor(subtask.progress)} transition-all duration-300 ease-out"
                                                style="width: ${subtask.progress}%">
                                                <div class="absolute inset-0 bg-white/30 animate-pulse"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="flex flex-col gap-2">
                                <button 
                                    onclick="updateSubTask('${orgId}', '${groupId}', '${taskId}', '${subtask.id}', 'increase')"
                                    class="p-2 rounded-full bg-blue-50/80 hover:bg-blue-100 text-blue-600 shadow-xs hover:shadow-sm transition-all duration-150 ease-in-out transform hover:scale-105 active:scale-95">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                                    </svg>
                                </button>
                                
                                <button 
                                    onclick="updateSubTask('${orgId}', '${groupId}', '${taskId}', '${subtask.id}', 'decrease')"
                                    class="p-2 rounded-full bg-gray-100/80 hover:bg-gray-200 text-gray-600 shadow-xs hover:shadow-sm transition-all duration-150 ease-in-out transform hover:scale-105 active:scale-95">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 12H6"/>
                                    </svg>
                                </button>
                                
                                <button 
                                    onclick="deleteSubTask('${orgId}', '${groupId}', '${taskId}', '${subtask.id}')"
                                    class="p-2 rounded-full bg-red-50/80 hover:bg-red-100 text-red-500 shadow-xs hover:shadow-sm transition-all duration-150 ease-in-out transform hover:scale-105 active:scale-95">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            });
        })
        .catch(error => console.error("Error fetching subtasks:", error));
}

function updateSubTask(orgId, groupId, taskId, subtaskId, action) {
    fetch(`/tasks/subtasks/update/${orgId}/${groupId}/${taskId}/${subtaskId}/`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCSRFToken()
        },
        body: JSON.stringify({ progress: action === "increase" ? 10 : -10 })
    })
    .then(response => response.json())
    .then(data => {
        const progressBar = document.getElementById(`progress-bar-${subtaskId}`);
        const progressText = document.getElementById(`progress-${subtaskId}`);
        
        progressBar.style.width = `${data.new_progress}%`;
        progressBar.className = `h-full rounded-full ${getProgressColor(data.new_progress)} transition-all duration-300 ease-out`;
        progressText.innerText = data.new_progress;
    })
    .catch(error => console.error("Error updating subtask:", error));
}

function changeSubTaskStatus(orgId, groupId, taskId, subtaskId) {
    const newStatus = document.getElementById(`status-${subtaskId}`).value;
    
    fetch(`/tasks/subtasks/update/${orgId}/${groupId}/${taskId}/${subtaskId}/`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCSRFToken()
        },
        body: JSON.stringify({ status: newStatus })
    })
    .then(response => response.json())
    .then(data => {
        const statusSelect = document.getElementById(`status-${subtaskId}`);
        statusSelect.classList.add('animate-pulse');
        setTimeout(() => statusSelect.classList.remove('animate-pulse'), 500);
    })
    .catch(error => console.error("Error updating status:", error));
}

function deleteSubTask(orgId, groupId, taskId, subtaskId) {
    if (!confirm('Are you sure you want to delete this subtask?')) return;
    
    fetch(`/tasks/subtasks/delete/${orgId}/${groupId}/${taskId}/${subtaskId}/`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCSRFToken()
        }
    })
    .then(() => {
        const subtaskElement = document.getElementById(`subtask-${subtaskId}`);
        if (subtaskElement) {
            subtaskElement.classList.add('opacity-0', 'translate-x-10');
            setTimeout(() => loadSubTasks(orgId, groupId, taskId), 300);
        }
    })
    .catch(error => console.error("Error deleting subtask:", error));
}

// Get CSRF Token - Fixed
function getCSRFToken() {
    let csrfToken = document.querySelector("[name=csrfmiddlewaretoken]");
    return csrfToken ? csrfToken.value : ""; // Ensure CSRF token exists
}


function getProgressColor(progress) {
    if (progress < 30) return 'bg-red-500';
    if (progress < 70) return 'bg-yellow-500';
    return 'bg-green-500';
}



// EXPORT TASKS
function exportTask(orgId, groupId, taskId) {
    // Store IDs for export
    window.exportTaskData = { orgId, groupId, taskId };
}

// Utility function to show/hide loader
function toggleLoader(button, show) {
    if (show) {
        button.dataset.originalText = button.innerHTML; // Store original text
        button.innerHTML = `<span class="loader"></span> Processing...`;
        button.disabled = true;
    } else {
        button.innerHTML = button.dataset.originalText;
        button.disabled = false;
    }
}

// Handle Export Now
document.getElementById("export-now-btn").addEventListener("click", function () {
    let { orgId, groupId, taskId } = window.exportTaskData;
    let button = this;
    
    toggleLoader(button, true); // Show loader

    fetch(`/tasks/export-task-data/${orgId}/${groupId}/${taskId}?action=export`)
        .then(response => response.blob())
        .then(blob => {
            let a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "task_report.pdf";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        })
        .catch(error => console.error("Error exporting:", error))
        .finally(() => toggleLoader(button, false)); // Hide loader
});

// Handle Send to Email
// Handle Send to Email
document.getElementById("export-email-btn").addEventListener("click", function () {
    let { orgId, groupId, taskId } = window.exportTaskData;
    let button = this;

    toggleLoader(button, true); // Show loader

    fetch(`/tasks/export-task-data/${orgId}/${groupId}/${taskId}/?action=email`)  // ✅ FIXED: Correct query param format
        .then(response => response.json())
        .then(data => {
            alert(data.message);
        })
        .catch(error => console.error("Error sending email:", error))
        .finally(() => toggleLoader(button, false)); // Hide loader
});



// attach files to the task (PREMIUM)
document.addEventListener("DOMContentLoaded", () => {
    const fileInput = document.getElementById("fileInput");
    const dropArea = document.getElementById("dropArea");
    const previewContainer = document.getElementById("filePreview");
    const progressBar = document.getElementById("progressBar");
    const uploadBtn = document.getElementById("uploadBtn");

    let selectedOrgId = null;
    let selectedGroupId = null;
    let selectedTaskId = null;

    // 📌 Open Modal and Store Task ID
    document.body.addEventListener("click", (event) => {
        const button = event.target.closest("[data-bs-target='#attachFileModal']");
        if (button) {
            selectedOrgId = button.getAttribute("data-org-id");
            selectedGroupId = button.getAttribute("data-group-id");
            selectedTaskId = button.getAttribute("data-task-id");
        }
    });

    // 📌 Drag & Drop Handling
    ["dragover", "dragenter"].forEach(event => {
        dropArea.addEventListener(event, (e) => {
            e.preventDefault();
            dropArea.classList.add("bg-gray-200");
        });
    });

    ["dragleave", "drop"].forEach(event => {
        dropArea.addEventListener(event, (e) => {
            e.preventDefault();
            dropArea.classList.remove("bg-gray-200");
        });
    });

    dropArea.addEventListener("drop", (e) => {
        const file = e.dataTransfer.files[0];
        handleFileSelection(file);
    });

    // 📌 File Input Change Handling
    fileInput.addEventListener("change", () => {
        handleFileSelection(fileInput.files[0]);
    });

    // 📌 Handle File Selection & Preview
    function handleFileSelection(file) {
        if (!file) {
            previewContainer.innerHTML = `<p class="text-gray-500">No file selected</p>`;
            return;
        }

        document.getElementById("fileName").value = file.name;
        const fileReader = new FileReader();

        fileReader.onload = (e) => {
            const fileType = file.type.split("/")[0];

            if (fileType === "image") {
                previewContainer.innerHTML = `<img src="${e.target.result}" class="max-w-full max-h-40 mx-auto rounded">`;
            } else if (fileType === "video") {
                previewContainer.innerHTML = `<video controls class="max-w-full max-h-40 mx-auto rounded">
                                                <source src="${e.target.result}" type="${file.type}">
                                              </video>`;
            } else {
                previewContainer.innerHTML = `<p class="text-gray-800"><i class="material-icons-round">insert_drive_file</i> ${file.name}</p>`;
            }
        };

        fileReader.readAsDataURL(file);
    }

    // 📌 Upload File via AJAX with Progress Bar & Loading Spinner
    uploadBtn.addEventListener("click", () => {
        const file = fileInput.files[0];
        if (!file) {
            alert("Please select a file to upload!");
            return;
        }

        if (!selectedTaskId || !selectedOrgId || !selectedGroupId) {
            alert("Task ID is missing. Please try again.");
            return;
        }

        const formData = new FormData();
        formData.append("attachment", file);
        formData.append("name", document.getElementById("fileName").value);
        formData.append("description", document.getElementById("fileDescription").value);
        formData.append("category", document.getElementById("fileCategory").value);
        formData.append("is_private", document.getElementById("isPrivate").checked);
        formData.append("send_copy_to_manager", document.getElementById("sendCopyToManager").checked);

        const uploadUrl = `/tasks/attach-task-file/${selectedOrgId}/${selectedGroupId}/${selectedTaskId}/`;

        // ✅ Add Spinner Before Request
        uploadBtn.innerHTML = `<div class="flex items-center gap-2">
                                    <div class="animate-spin h-5 w-5 border-4 border-white border-t-transparent rounded-full"></div>
                                    Uploading...
                               </div>`;
        uploadBtn.disabled = true;

        fetch(uploadUrl, {
            method: "POST",
            headers: {
                "X-CSRFToken": getCSRFToken(),
            },
            body: formData,
        }).then(response => response.json())
          .then(data => {
              if (data.success) {
                  alert("File uploaded successfully!");
                  location.reload();
              } else {
                  alert("Upload failed: " + data.error);
              }
          })
          .catch(error => console.error("Upload Error:", error))
          .finally(() => {
              // ✅ Remove Spinner After Request Completes
              uploadBtn.innerHTML = "Upload File";
              uploadBtn.disabled = false;
          });
    });

    function getCSRFToken() {
        return document.cookie.split("; ").find(row => row.startsWith("csrftoken"))?.split("=")[1] || "";
    }
});

// Group and team details
document.addEventListener("DOMContentLoaded", function () {
    const fetchGroupDetailsBtn = document.getElementById("fetchGroupDetailsBtn");
    const modalContent = document.getElementById("groupDetailsContent");

    fetchGroupDetailsBtn.addEventListener("click", function () {
        const orgId = this.getAttribute("data-org-id");
        const groupId = this.getAttribute("data-group-id");

        modalContent.innerHTML = `<p class="text-center">Loading...</p>`;

        fetch(`/groups/get-group-details/${orgId}/${groupId}/`)
            .then(response => response.json())
            .then(data => {
                if (data.group) {
                    const { id, name, description, team_leader, created_at } = data.group;
                    let membersHTML = '';

                    data.members.forEach(member => { 
  membersHTML += `
    <div class="flex items-center p-2 rounded-lg hover:bg-gray-50 transition-colors">
      <img src="${member.profile_picture || 'https://via.placeholder.com/40'}" 
           class="rounded-full object-cover w-10 h-10 border border-gray-200 shadow-sm" 
           alt="${member.name}">
      <span class="ml-3 font-medium text-gray-700">${member.name}</span>
    </div>`;
});

modalContent.innerHTML = `
  <div class="p-6 max-w-2xl mx-auto bg-white rounded-xl shadow-md">
    <h5 class="text-xl font-bold text-gray-800 mb-2">${name}</h5>
    <p class="text-gray-600 mb-4">${description}</p>
    <p class="text-sm text-gray-500 mb-6"><span class="font-medium">Created At:</span> ${created_at}</p>
    
    <div class="mb-6">
      <h6 class="text-sm font-bold text-gray-700 uppercase tracking-wider mb-3">Team Leader</h6>
      <div class="flex items-center p-3 bg-gray-50 rounded-lg">
        <img src="${team_leader?.profile_picture || 'https://via.placeholder.com/50'}" 
             class="rounded-full object-cover w-12 h-12 border-2 border-white shadow-md" 
             alt="${team_leader?.name || 'No Leader'}">
        <span class="ml-3 font-semibold text-gray-800">${team_leader?.name || "No Leader"}</span>
      </div>
    </div>
    
    <div>
      <h6 class="text-sm font-bold text-gray-700 uppercase tracking-wider mb-3">Members</h6>
      ${membersHTML ? 
        `<div class="grid grid-cols-1 md:grid-cols-2 gap-2">
          ${membersHTML}
        </div>` : 
        '<p class="text-gray-500 italic">No members found.</p>'}
    </div>
  </div>
`;
                    // Open the modal
                    new bootstrap.Modal(document.getElementById("groupDetailsModal")).show();
                } else {
                    modalContent.innerHTML = `<p class="text-danger text-center">Error fetching details.</p>`;
                }
            })
            .catch(() => {
                modalContent.innerHTML = `<p class="text-danger text-center">Failed to load group details.</p>`;
            });
    });
});

// SEARCH AND FILTER TASKS IN REAL TIME
// Wait for the DOM to load
document.addEventListener('DOMContentLoaded', function () {
        // Get the search input field
        const searchInput = document.querySelector('input[type="text"][placeholder="Search tasks, projects, or people..."]');
        const tasksGrid = document.getElementById('tasksGrid');
        const taskCards = tasksGrid.getElementsByClassName('glass-card');

        // Function to filter tasks based on search query
        function filterTasks(query) {
            console.log("Search query:", query); // Debugging: Log the search query

            // Convert the query to lowercase for case-insensitive search
            const lowerCaseQuery = query.toLowerCase();

            // Loop through all task cards and filter them
            Array.from(taskCards).forEach((card, index) => {
                // Get the task title
                const taskTitle = card.querySelector('h3') ? card.querySelector('h3').textContent.toLowerCase() : '';
                console.log(`Task #${index + 1} - Title:`, taskTitle);

                // Get task priority (if exists)
                const priorityBadge = card.querySelector('.priority-badge');
                const taskPriority = priorityBadge ? priorityBadge.textContent.toLowerCase().trim() : '';
                console.log(`Task #${index + 1} - Priority:`, taskPriority);

                // Get task start date (if exists)
                const taskStart = card.querySelector('.text-sm') ? card.querySelector('.text-sm').textContent.toLowerCase() : '';
                console.log(`Task #${index + 1} - Start Date:`, taskStart);

                // Get task people (if exists)
                const taskPeople = card.querySelector('.text-xs') ? card.querySelector('.text-xs').textContent.toLowerCase() : '';
                console.log(`Task #${index + 1} - People:`, taskPeople);

                // Debugging: Display which fields will be searched
                console.log(`Task #${index + 1} - Fields for search:`, {
                    taskTitle,
                    taskPriority,
                    taskStart,
                    taskPeople
                });

                // Check if the query matches any of the fields
                const isMatch = taskTitle.includes(lowerCaseQuery) || taskPriority.includes(lowerCaseQuery) || taskStart.includes(lowerCaseQuery) || taskPeople.includes(lowerCaseQuery);
                if (isMatch) {
                    card.style.display = ''; // Show the task if it matches
                    console.log(`Task #${index + 1} matches the search!`); // Debugging: Task matches
                } else {
                    card.style.display = 'none'; // Hide the task if it does not match
                    console.log(`Task #${index + 1} does not match the search.`); // Debugging: Task doesn't match
                }
            });
        }

        // Add event listener to the search input
        searchInput.addEventListener('input', function () {
            const query = searchInput.value.trim();
            filterTasks(query); // Call the function to filter tasks
        });
    });

</script>
</body>
</html>

