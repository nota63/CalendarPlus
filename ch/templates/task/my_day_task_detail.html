

{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ task.title }} - Task Details</title>
    <link rel="stylesheet" href="{% static 'assets/css/my_tasks.css' %}">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">
    <!-- FullCalendar CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css" />
    <!-- jQuery (Required) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
     <!-- FullCalendar JS -->
     <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
     <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js"></script>
     <!-- Tailwind CSS CDN -->
     <script src="https://cdn.tailwindcss.com"></script>
    <!-- Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
    <meta name="csrf-token" content="{{ csrf_token }}">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css" rel="stylesheet">
    <!-- Link CSS File -->
    <link rel="stylesheet" href="{% static 'tasks/user_tasks.css' %}">

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet" />





</head>

<style>

/* Enable scrolling in comments section */
/* Enable scrolling but hide scrollbar */
.space-y-4 {
    max-height: 300px; /* Adjust height as needed */
    overflow-y: auto;
    scrollbar-width: none; /* Hide scrollbar in Firefox */
    -ms-overflow-style: none; /* Hide scrollbar in IE/Edge */
}

/* Hide scrollbar in WebKit-based browsers (Chrome, Safari) */
.space-y-4::-webkit-scrollbar {
    display: none;
}

/* Enable scrolling in notes section */
/* Enable scrolling but hide scrollbar */
.space-y-4 {
    max-height: 300px; /* Adjust height as needed */
    overflow-y: auto;
    scrollbar-width: none; /* Hide scrollbar in Firefox */
    -ms-overflow-style: none; /* Hide scrollbar in IE/Edge */
}

/* Hide scrollbar in WebKit-based browsers (Chrome, Safari) */
.space-y-4::-webkit-scrollbar {
    display: none;
}








/* üåü Calendar Container - Light Theme */
#calendar {
    background: #ffffff; /* Pure White Background */
    padding: 10px;
    border-radius: 8px;
    box-shadow: 0px 3px 10px rgba(0, 0, 0, 0.1);
}

/* üåü Toolbar & Buttons */
.fc-header-toolbar {
    background: #f5f5f5; /* Light Gray */
    padding: 8px;
    border-radius: 6px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.fc-button {
    background-color: #1976d2 !important; /* Material Blue */
    color: white !important;
    border-radius: 5px !important;
    padding: 5px 10px !important;
    font-size: 14px;
    transition: 0.2s ease-in-out;
}

.fc-button:hover {
    background-color: #1565c0 !important; /* Slightly Darker Blue */
}

/* üìÖ Thinner Calendar Days */
.fc-daygrid-day {
    background: #fafafa; /* Very Light Gray */
    border: 1px solid rgba(0, 0, 0, 0.05);
    height: 40px; /* Thinner Height */
}

/* üåü Current Day Highlight */
.fc-day-today {
    background: rgba(25, 118, 210, 0.15) !important;
    border: 1px solid #1976d2 !important;
    font-weight: bold;
}

/* üìÖ Event Styling - Material UI Look */
.fc-event {
    background: #42a5f5; /* Material Light Blue */
    color: white !important;
    border-radius: 4px;
    padding: 4px;
    font-size: 12px;
    font-weight: bold;
    transition: 0.2s ease-in-out;
}

/* üåü Hover Effect */
.fc-event:hover {
    background: #1e88e5;
    transform: scale(1.03);
    box-shadow: 0px 3px 8px rgba(0, 0, 0, 0.2);
}

/* ‚è∞ Week View - Thinner Slots */
.fc-timegrid-slot {
    background: #ffffff;
    border: 1px solid rgba(0, 0, 0, 0.05);
    height: 30px; /* Thinner Slots */
}

/* üåü Sidebar / Labels */
.fc-sidebar {
    background: #eeeeee;
    color: #424242;
    padding: 8px;
    border-radius: 6px;
}

/* Overall body styling */
body {
    font-family: 'Arial', sans-serif;
    background-color: #000; /* Pure black background */
    color: hsl(0, 100%, 1%); /* Light text color */
    margin: 0;
    padding: 0;
}

/* Task container styling */
.task-container {
    width: 90%; /* Increased width */
    max-width: 1400px; /* Maximum width */
    margin: 50px auto; /* Centering the container */
    padding: 30px;
    background-color: #000; /* Pure black background */
    box-shadow: 0 0 20px rgba(255, 255, 255, 0.2); /* Glowing effect */
    border-radius: 20px; /* Rounded corners */
    font-weight: bold; /* Bold text */
    font-size: 20px; /* Adjusted font size */
    border: 2px solid #333; /* Dark border */
    transition: all 0.3s ease; /* Smooth transition */
    position: relative;
    overflow: hidden;
}

/* Glowing border effect */
.task-container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, #000, #000, #000, #000); /* Same color for pure black */
    background-size: 400% 400%;
    z-index: -1;
    animation: glowing-border 5s linear infinite; /* Glowing animation */
    border-radius: 20px;
}

/* Glowing effect animation */
@keyframes glowing-border {
    0% {
        background-position: 400% 0;
    }
    50% {
        background-position: 0 100%;
    }
    100% {
        background-position: 400% 0;
    }
}

/* Add hover effect with shine */
.task-container:hover {
    box-shadow: 0 0 25px rgba(255, 255, 255, 0.4); /* Shine effect */
    transform: translateY(-10px); /* Heavy lift on hover */
}

/* Styling the text inside the container */
.task-container p {
    font-size: 18px; /* Adjust paragraph text */
    color: #fff; /* Light text color for contrast */
}
/* Container with dark theme and stylish look */
.task-container {
    opacity: 0;
    transform: translateY(-100vh) scale(0.8); /* Starts from above the page */
    animation: slideInFromTop 1s ease-out forwards; /* Animation to slide in smoothly */
    border-radius: 30px; /* Rounded corners */
    padding: 20px;
    box-shadow: 0 0 25px rgba(255, 255, 255, 0.3), 0 0 50px rgba(255, 255, 255, 0.5); /* Glowing effect */
    background-color: #000; /* Dark theme background */
    color: white; /* White text for contrast */
    transition: transform 0.5s ease-in-out, box-shadow 0.5s ease-in-out; /* Smooth transition on hover */
}

/* Animation for smooth sliding from the top */
@keyframes slideInFromTop {
    0% {
        opacity: 0;
        transform: translateY(-100vh) scale(0.8); /* Starts from above the screen */
        box-shadow: 0 0 25px rgba(255, 255, 255, 0.3); /* Glowing starts softly */
    }
    60% {
        opacity: 0.6;
        transform: translateY(30px) scale(1.05); /* Moving towards its final position */
        box-shadow: 0 0 30px rgba(255, 255, 255, 0.4); /* Increased glow */
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1); /* Fully in place, no scaling */
        box-shadow: 0 0 50px rgba(255, 255, 255, 0.7); /* Max glow effect */
    }
}

/* Hover effect to enhance the feel when the user interacts */
.task-container:hover {
    transform: scale(1.05);
    box-shadow: 0 0 60px rgba(255, 255, 255, 0.8), 0 0 120px rgba(255, 255, 255, 1);
}


       /* Import Google Fonts */
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');
@import url('https://fonts.googleapis.com/icon?family=Material+Icons');

/* Dark sidebar styling */
/* Dark sidebar styling */
.activity-logs-sidebar {
    position: fixed;
    top: 0;
    right: -400px;  /* Hidden initially */
    width: 400px;
    height: 100%;
    background-color: #333;
    color: white;
    font-family: 'Roboto', sans-serif;  /* Use Roboto font */
    transition: right 0.3s ease;
    z-index: 999;
    box-shadow: -5px 0 15px rgba(0, 0, 0, 0.5);
    overflow-y: auto; /* Enable vertical scrolling */
}

/* Sidebar content */
.sidebar-content {
    padding: 15px;
    overflow-y: auto;
}

/* Activity logs container */
.activity-logs-container {
    max-height: calc(100% - 100px);
    overflow-y: auto;
    margin-top: 10px;
}

/* Individual activity log item */
.activity-log {
    margin-bottom: 12px;
    padding: 12px;
    background-color: #444;
    border-radius: 5px;
    font-size: 14px;  /* Smaller font size */
    font-family: 'Roboto', sans-serif;
}

/* Title of activity log */
.activity-log h5 {
    margin: 0;
    font-weight: 500;
    font-size: 16px;  /* Reduced title font size */
    color: #FFD700;  /* Gold color for the title */
}

/* Description of activity log */
.activity-log p {
    margin: 5px 0;
    color: #ddd;  /* Lighter color for description */
    font-weight: 400;
    font-size: 13px;  /* Reduced font size for description */
}

/* Button to close the sidebar */
#closeSidebarButton {
    background-color: #f8f9fa;
    border: none;
    color: #333;
    font-size: 16px;  /* Slightly reduced button font size */
    padding: 8px 12px;
    border-radius: 5px;
    font-weight: 600;
    font-family: 'Roboto', sans-serif;
}

/* Bu
/* Material Icon for activity log button */
#activityLogsButton i {
    font-size: 16px;  /* Smaller size for the icon */
}

/* When sidebar is open, bring it to the right */
.activity-logs-sidebar.open {
    right: 0;
}

/* Apply hover effects for buttons */
#activityLogsButton:hover {
    background-color: #0056b3;
    cursor: pointer;
}

#closeSidebarButton:hover {
    background-color: #e2e6ea;
    curs.form-check-input {
    width: 50px;
    height: 25px;
    background-color: #ccc;
    border: none;
    transition: background-color 0.3s ease;
}

.form-check-input:checked {
    background-color: #28a745; /* Green when checked */
}

.form-check-label {
    margin-left: 10px;
    font-size: 14px;
    color: #333;
}
or: pointer;
}


/* Style for the tag container and tags */
.badge.bg-warning {
    font-size: 0.85rem;  /* Reduces font size */
    padding: 0.4rem 0.6rem;  /* Adjusts padding to make the tag smaller */
    border-radius: 12px;  /* Adds rounded corners */
    margin-right: 5px;  /* Adds spacing between tags */
    margin-bottom: 5px;  /* Adds spacing below tags */
}

/* Style for the remove button inside the tag */
.badge.bg-warning button.remove-tag {
    font-size: 0.75rem;  /* Reduces the size of the remove button */
    padding: 0.2rem 0.4rem;  /* Adjusts padding of the button */
    margin-left: 8px;  /* Adds space between the tag text and the button */
    border-radius: 50%;  /* Makes the remove button circular */
    background-color: #dc3545;  /* Red background for the remove button */
    color: white;  /* White text color */
    border: none;  /* Removes button border */
    transition: background-color 0.3s ease;  /* Smooth transition for hover effect */
}

.badge.bg-warning button.remove-tag:hover {
    background-color: #c82333;  /* Darker red on hover */
    cursor: pointer;  /* Changes cursor to pointer on hover */
}
/* Style for the add tag button */
#add-tag-btn {
    font-size: 0.9rem;  /* Reduces font size for a smaller button */
    padding: 0.3rem 0.5rem;  /* Adjusts padding to make the button smaller */
    border-radius: 25px;  /* Makes the button more rounded */
    background-color: #28a745;  /* Green color for the add button */
    color: white;  /* White text color */
    border: none;  /* No border */
    transition: background-color 0.3s ease;  /* Smooth transition for hover effect */
}

#add-tag-btn:hover {
    background-color: #218838;  /* Darker green on hover */
    cursor: pointer;  /* Pointer cursor on hover */
}

/* Style for the 'No tags' message */
.badge.bg-secondary {
    font-size: 0.85rem;
    padding: 0.4rem 0.6rem;
    border-radius: 12px;
    background-color: #6c757d;  /* Gray background for 'No tags' */
    color: white;
}

/* Stopwatch Container */
#stopwatch-container {
    background-color: #121212;  /* Black background */
    padding: 15px 25px;
    border-radius: 8px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
    max-width: 200px;
    max-height: 170px;
    text-align: center;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    border: 2px solid transparent;  /* Transparent border to start */
    position: relative;
    transition: border-color 0.5s ease, box-shadow 0.5s ease;
}

/* Glowing Border Effect */
#stopwatch-container:hover {
    border-color: #00bfff;  /* Light blue border */
    box-shadow: 0 4px 15px rgba(0, 191, 255, 0.7);  /* Glow effect */
}

/* Time Display */
#time-display {
    font-size: 20px;  /* Medium time display */
    font-weight: bold;
    color: #00bfff;  /* Light blue color */
    letter-spacing: 1px;
    transition: all 0.3s ease;
}

/* Button Styling */
#start-stop-btn, #save-time-btn {
    padding: 8px 18px;
    font-size: 14px;
    border-radius: 5px;
    margin: 5px;
    cursor: pointer;
    transition: transform 0.2s ease, background-color 0.3s ease;
    border: none;
    outline: none;
}

#start-stop-btn {
    background-color: #007bff;  /* Blue button */
    color: white;
}

#start-stop-btn:hover {
    background-color: #0056b3;  /* Darker blue on hover */
    transform: scale(1.05);
}

#save-time-btn {
    background-color: #28a745; /* Green button */
    color: white;
    display: none; /* Initially hidden */
}

#save-time-btn:hover {
    background-color: #218838; /* Darker green on hover */
    transform: scale(1.05);
}

/* Smooth Time Change Transition */
@keyframes timeChange {
    0% {
        transform: scale(1);
        color: #00bfff;
    }
    50% {
        transform: scale(1.1);
        color: #ff9800;  /* Orange momentary effect */
    }
    100% {
        transform: scale(1);
        color: #00bfff;
    }
}

#time-display.animate-time {
    animation: timeChange 0.5s ease-in-out;  /* Smooth transition */
}

/* Optional - For Stopwatch's Start/Stop Button Toggle */
#stopwatch-container .btn {
    transition: all 0.3s ease;
}
#problemsSidebar .offcanvas-body {
    background-color: #f8f9fa; /* Light gray background */
    color: #343a40; /* Dark gray text */
    padding: 1.5rem;
}

#problemsSidebar {
    border-left: 1px solid #ddd;
}

#problems-content ul {
    list-style-type: none;
    padding: 0;
}

#problems-content li {
    padding: 0.5rem 0;
    border-bottom: 1px solid #ddd;
}


/* problem sidebar styles */
/* Importing Google Fonts */
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500&display=swap');

/* Basic Reset */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

/* Sidebar Style */
#problemsSidebar {
    background-color: #2C2C2C; /* Darker background for the sidebar */
    color: white;  /* White text for visibility */
    font-family: 'Roboto', sans-serif;  /* Google Font */
    padding: 15px;
    font-size: 0.9rem;  /* Slightly smaller font size */
    max-width: 400px;  /* Optional: Set a max-width for the sidebar */
    border-left: 3px solid #ffcc00; /* Golden left border for the sidebar */
}

#problemsSidebarLabel {
    color: white;  /* Sidebar header text color */
    font-weight: 500;  /* Bold for the title */
    font-size: 1.2rem; /* Larger font size for the header */
    margin-bottom: 15px; /* Add spacing between the header and the content */
}

#problems-list {
    list-style: none;
    padding-left: 0;
    margin-top: 20px;
}

#problems-list li {
    background-color: #3E3E3E;  /* Slightly lighter dark background for each problem */
    margin: 5px 0;
    padding: 12px;
    border-radius: 5px;
    font-size: 0.9rem;  /* Default font size for the list items */
    color: white;  /* White text for list items */
    border-bottom: 1px solid #444444; /* Subtle border for each list item */
}

/* Add a hover effect for each list item */
#problems-list li:hover {
    background-color: #4a4a4a;
    cursor: pointer;
}

/* For strong text inside list items */
#problems-list li strong {
    color: #ffcc00; /* Golden color for names and important text */
}

/* Responsive Design */
@media (max-width: 768px) {
    #problemsSidebar {
        font-size: 0.85rem;  /* Slightly smaller font size on mobile */
    }
}



/* styles for spinner */
/* Spinner and loading text container */
#loading-spinner {
    display: none;
    width: 40px;
    height: 40px;
    border: 4px solid #f3f3f3; /* Light background */
    border-top: 4px solid #007bff; /* Blue color for the spinner */
    border-radius: 50%;
    animation: spin 2s linear infinite;
}

#loading-text {
    display: none;
    font-size: 16px;
    font-weight: 500;
    color: #007bff; /* Match the blue of the spinner */
    margin-left: 10px;
    vertical-align: middle;
    font-family: 'Roboto', sans-serif;
}

/* Animation for spinner */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Additional premium feel for the form button and text */
#raise-problem-btn {
    position: relative;
    padding-right: 50px; /* Space for the spinner */
    transition: all 0.3s ease-in-out;
}

#raise-problem-btn:disabled {
    background-color: #d6d6d6;
    cursor: not-allowed;
}

/* Optionally, add a hover effect on the button */
#raise-problem-btn:hover {
    background-color: #e03e3e;
    color: #fff;
}

/* You can also center the spinner and text vertically */
.spinner-container {
    display: flex;
    align-items: center;
}

.dropdown-toggle {
    background: none;
    border: none;
    font-size: 20px;
    cursor: pointer;
    color: #6c757d; /* Subtle gray for premium look */
}

.dropdown-menu {
    border-radius: 5px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.dropdown-item:hover {
    background-color: #28a745; /* Match "success" button color */
    color: white;
}

/* Spinner container */
.loading-spinner {
    display: none;
    text-align: center;
    font-size: 14px;
    color: #007bff; /* Blue color for the spinner text */
}

/* Spinner animation */
.loading-spinner .spinner-border {
    width: 2rem;
    height: 2rem;
    border-width: 0.25em;
    animation: spin 1s linear infinite;
}

/* Spinner spin animation */
@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Styling the 'Reporting to manager...' text */
.loading-spinner span {
    margin-left: 10px;
    font-size: 14px;
    font-weight: bold;
    color: #007bff;
}

/* jsonresponse notification */
/* Notification container */
.notification {
    display: none; /* Hidden by default */
    position: fixed;
    top: -70px; /* Initially off-screen */
    left: 50%;
    transform: translateX(-50%);
    padding: 10px 20px;
    background-color: #1e90ff; /* Light blue background */
    color: #fff;
    font-size: 16px;
    font-family: 'Montserrat', sans-serif;
    font-weight: 500;
    border-radius: 8px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    z-index: 9999;
    opacity: 0;
    transition: all 0.6s ease-out; /* Ultra smooth transition */
    text-align: center;
    letter-spacing: 1px; /* Add some spacing for a more premium look */
    text-transform: capitalize;
}

/* To show the notification with smooth animation */
.notification.show {
    display: block;
    top: 20px; /* Slide into view */
    opacity: 1; /* Fade in */
    transform: translateX(-50%) translateY(20px); /* Smooth upward motion */
}

/* Shiny text effect */
.notification .text {
    position: relative;
    animation: shine 1.5s ease-in-out infinite;
}

/* Shiny text animation */
@keyframes shine {
    0% {
        background-position: -200% center;
    }
    100% {
        background-position: 200% center;
    }
}

.notification .text {
    background: linear-gradient(90deg, rgba(255, 255, 255, 0) 25%, rgba(255, 255, 255, 0.6) 50%, rgba(255, 255, 255, 0) 75%);
    background-size: 200% 100%;
    -webkit-background-clip: text;
    color: transparent;
}

/* Close button for the notification */
.notification .close-btn {
    background-color: transparent;
    border: none;
    color: white;
    font-size: 20px;
    font-weight: bold;
    position: absolute;
    top: 8px;
    right: 15px;
    cursor: pointer;
    transition: transform 0.3s ease;
}

/* Hover effect for the close button */
.notification .close-btn:hover {
    transform: rotate(90deg); /* Subtle rotation on hover */
}

/* Styling for the success message */
.notification.success {
    background-color: #1e90ff; /* Light blue background */
    border-left: 5px solid #0f7bcc; /* Darker blue border for a professional touch */
}

/* Optional: Styling for info messages */
.notification.info {
    background-color: #17a2b8; /* Info background (Blue) */
    border-left: 5px solid #117a8b; /* Darker blue border */
}

/* Optional: Styling for warning messages */
.notification.warning {
    background-color: #ffc107; /* Yellow background for warning */
    border-left: 5px solid #e0a800; /* Dark yellow border */
}

/* Greeting */
 /* Base styling for the greeting */
#greeting {
    position: fixed;
    top: 0;
    left: 0;
    transform: translateX(0);
    padding: 20px 40px;
    font-size: 1.5rem;
    font-weight: 700;
    background-color: rgba(0, 0, 0, 0.8);
    color: transparent;
    background-clip: text; /* Clips the background to the text */
    -webkit-background-clip: text; /* For Safari support */
    width: auto;
    z-index: 1000; /* Ensure it stays on top */
    border-radius: 8px;
    opacity: 0; /* Initially hidden for animation */
    animation: slideIn 1s ease-out forwards, fadeIn 1s ease-out forwards;
    font-family: 'Poppins', sans-serif, 'Arial'; /* Modern font */
}

/* Gradient effect for the text */
#greeting {
    background-image: linear-gradient(to right, #00c6ff, #ff6ec7); /* Light blue to pink gradient */
    font-size: 2.5rem; /* Increase font size for more impact */
}

/* Slide in animation */
@keyframes slideIn {
    0% {
        top: -50px;
        opacity: 0;
    }
    100% {
        top: 0;
        opacity: 1;
    }
}

/* Fade-in animation */
@keyframes fadeIn {
    0% {
        opacity: 0;
    }
    100% {
        opacity: 1;
    }
}

body {
    margin: 0; /* Remove margin for better layout */
    font-family: 'Arial', sans-serif; /* Modern font */
    background-color: hsl(240, 3%, 6%); /* Subtle background color for contrast */
}

/* Add a modern font and responsive design */
@media (max-width: 600px) {
    #greeting {
        font-size: 1.5rem; /* Make the text smaller on small screens */
    }
}

#current-date {
    position: fixed;
    top: 10px;
    right: 10px;  /* Position at top-right */
    font-size: 1.4rem;  /* Adjusted size for better readability */
    font-weight: 700;  /* Bold font */
    background-color: rgba(0, 0, 0, 0.7);  /* Slightly darker background */
    color: hsl(175, 87%, 50%);  /* White text color */
    padding: 10px 15px;  /* Padding around the text */
    border-radius: 8px;  /* Rounded corners */
    z-index: 1000;
    font-family: 'Poppins', sans-serif;  /* Modern font */
    letter-spacing: 0.5px;  /* Small letter spacing for better clarity */
    text-align: center;  /* Center the text */
}

/* Optional: Animation for the date when the page loads */
@keyframes fadeInDate {
    0% {
        opacity: 0;
        transform: translateY(-10px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

#current-date {
    animation: fadeInDate 0.8s ease-out forwards;  /* Fade-in and slide-up animation */
}






/* Progress Bar Container */
.progress {
    height: 20px;
    border-radius: 15px;
    background-color: #f1f1f1;
    margin-bottom: 20px;
    box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
}

/* Progress Bar Inner */
.progress-bar {
    height: 100%;
    text-align: center;
    line-height: 20px;
    font-weight: bold;
    color: #fff;
    border-radius: 15px;
    transition: width 0.5s ease-in-out, background-color 0.5s ease;
}

/* Progress Bar Colors Based on Progress */
.progress-bar.bg-success {
    background: linear-gradient(90deg, #00b4d8, #0077b6); /* Blue gradient for good progress */
}

.progress-bar.bg-warning {
    background: linear-gradient(90deg, #f39c12, #f1c40f); /* Yellow gradient for warning */
}

.progress-bar.bg-danger {
    background: linear-gradient(90deg, #e74c3c, #c0392b); /* Red gradient for poor progress */
}

/* Tooltip on Hover (for Progress Bar) */
.progress-bar:hover {
    cursor: pointer;
    opacity: 0.9;
    box-shadow: 0 0 8px rgba(0, 0, 0, 0.2);
}


@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

#comments-list {
    list-style: none;
    padding: 0;
}

#comments-list li {
    font-family: 'Roboto', sans-serif;
    font-size: 0.875rem; /* Smaller font size */
    margin-bottom: 1rem;
}

#comments-list strong {
    font-weight: 700;
}

.comment-text {
    display: block;
    font-size: 1rem; /* Slightly increased font size */
    color: #fff; /* White color for highlight */
}

.dropdown-toggle::after {
    display: none; /* Remove default arrow */
}

.dropdown-menu {
    font-size: 0.75rem; /* Smaller font size */
}

.dropdown-item {
    font-size: 0.75rem; /* Smaller font size */
    padding: 0.25rem 1rem;
}

.dropdown-item:hover {
    background-color: #f8f9fa;
}

.btn-sm {
    font-size: 0.75rem; /* Smaller font size */
    padding: 0.25rem 0.5rem;
}

#comments-list span {
    display: block;
    font-size: 0.75rem; /* Smaller font size */
    color: #777;
}

@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');

#taskNotesList {
    font-family: 'Roboto', sans-serif;
}

</style>
<body>
    
   
<!-- greeting -->
<div id="greeting"></div>


<div id="current-date"></div>
<br>
<br>

    

<!-- PREMIUM MODALS TASKS EXTEND APP  ----------------------------------------------------------------------------------------------->
<!-- FETCH AND MANAGE THE ATTACHMENTS  -->
<!-- ü™ü Premium Attachments Modal -->
<div class="modal fade" id="premiumAttachmentsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg max-w-4xl mx-auto p-4">
        <div class="modal-content border-0 bg-white/70 backdrop-blur-lg rounded-2xl shadow-2xl overflow-hidden">
            <!-- Modal Header -->
            <div class="modal-header bg-white/40 px-6 py-4 border-b border-gray-200/50">
                <div class="flex items-center space-x-3">
                    <span class="material-icons-round text-2xl text-blue-600">folder_open</span>
                    <h5 class="modal-title text-xl font-semibold text-gray-800">Task Attachments</h5>
                </div>
                <button type="button" class="btn-close p-2 hover:bg-gray-100/50 rounded-full transition-all" data-bs-dismiss="modal" aria-label="Close">
                    <span class="material-icons-round text-gray-500">close</span>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body p-0">
                <div id="attachmentsContainer" class="overflow-y-auto max-h-[60vh]">
                    <!-- Content will be injected here -->
                    <div class="p-6 text-center text-gray-500">
                        <div class="animate-pulse">
                            <span class="material-icons-round text-4xl text-gray-400 mb-2">downloading</span>
                            <p class="text-sm">Fetching files...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer bg-white/40 px-6 py-4 border-t border-gray-200/50">
                <button type="button" class="px-5 py-2.5 bg-transparent hover:bg-gray-100/50 text-gray-600 rounded-lg font-medium transition-all flex items-center space-x-2" data-bs-dismiss="modal">
                    <span class="material-icons-round text-lg">arrow_back</span>
                    <span>Close Panel</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- CUSTOM QUERY MODAL  -->
<!-- CUSTOM QUERY MODAL -->
<div class="modal fade" id="queryModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content backdrop-blur-sm bg-white/90 border border-white/20 rounded-xl shadow-2xl">
        <div class="modal-header p-6 border-b border-white/20">
          <div class="flex-1">
            <h5 class="modal-title text-2xl font-semibold text-gray-800 mb-1">
              <span class="material-icons text-primary align-middle mr-2">contact_support</span>
              Task Query
            </h5>
            <div class="flex items-center gap-2">
              <p class="text-sm text-gray-500 mb-0">Free plan: {{queries}} used out of 45</p>
              <a href="#" class="text-primary hover:text-primary-dark text-sm font-medium transition-colors flex items-center">
                Upgrade to Pro
                <span class="material-icons text-base ml-1">arrow_forward</span>
              </a>
            </div>
          </div>
          <button type="button" class="btn-close p-2 hover:bg-gray-100/50 rounded-full transition-colors" data-bs-dismiss="modal" aria-label="Close">
            <span class="material-icons text-gray-500">close</span>
          </button>
        </div>
  
        <div class="modal-body p-6">
          <form id="queryForm" class="space-y-5">
            <input type="hidden" id="orgId">
            <input type="hidden" id="groupId">
            <input type="hidden" id="taskId">
  
            <!-- Subject Input -->
            <div class="space-y-1">
              <label class="text-sm font-medium text-gray-700">Subject</label>
              <div class="relative">
                <input type="text" id="querySubject" 
                       class="w-full px-4 py-2.5 rounded-lg border border-gray-300/80 focus:border-primary/80 focus:ring-2 focus:ring-primary/20 bg-white/50 backdrop-blur-sm placeholder-gray-400 transition-all"
                       placeholder="Enter subject"
                       required>
                <span class="material-icons text-gray-400 absolute right-3 top-3">title</span>
              </div>
            </div>
  
            <!-- Predefined Templates -->
            <div class="space-y-1">
              <label class="text-sm font-medium text-gray-700">Template (Optional)</label>
              <div class="relative">
                <select id="queryTemplate" 
                        class="w-full px-4 py-2.5 pr-10 rounded-lg border border-gray-300/80 focus:border-primary/80 focus:ring-2 focus:ring-primary/20 bg-white/50 backdrop-blur-sm appearance-none transition-all">
                  <option value="">Select a template...</option>
                  <option value="Can you clarify the task requirements?" class="flex items-center py-2">
                    <span class="material-icons text-base mr-2 text-gray-600">help_outline</span>
                    Clarify Requirements
                  </option>
                  <option value="What is the deadline for this task?" class="flex items-center py-2">
                    <span class="material-icons text-base mr-2 text-gray-600">schedule</span>
                    Deadline Inquiry
                  </option>
                  <option value="Do you have any reference materials?" class="flex items-center py-2">
                    <span class="material-icons text-base mr-2 text-gray-600">attachment</span>
                    Request References
                  </option>
                </select>
                <span class="material-icons text-gray-400 absolute right-3 top-3">expand_more</span>
              </div>
            </div>
  
            <!-- Custom Message -->
            <div class="space-y-1">
              <label class="text-sm font-medium text-gray-700">Message</label>
              <textarea id="queryMessage" 
                        class="w-full px-4 py-2.5 rounded-lg border border-gray-300/80 focus:border-primary/80 focus:ring-2 focus:ring-primary/20 bg-white/50 backdrop-blur-sm placeholder-gray-400 resize-y min-h-[120px] transition-all"
                        placeholder="Write your message here..."
                        required></textarea>
            </div>
  
            <!-- Loading Spinner -->
            <div id="queryLoading" class="hidden flex-col items-center justify-center space-y-2 py-4">
              <div class="animate-spin h-8 w-8 border-4 border-primary/30 border-t-primary rounded-full"></div>
              <p class="text-sm text-gray-500">Sending your query...</p>
            </div>
  
            <!-- Modal Footer -->
            <div class="modal-footer pt-6 border-t border-white/20">
              <button type="button" 
                      class="px-5 py-2.5 rounded-lg border border-gray-300/80 bg-white/50 hover:bg-gray-50/80 text-gray-600 transition-colors"
                      data-bs-dismiss="modal">
                Cancel
              </button>
              <button type="submit" 
                      class="px-5 py-2.5 rounded-lg bg-primary hover:bg-primary-dark text-white shadow-sm hover:shadow-md transition-all flex items-center">
                <span class="material-icons text-base mr-2">send</span>
                Send Query
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>


<!-- FULLCALENDAR MODAL  -->

<!-- FULLCALENDAR MODAL  -->
<div class="modal fade" id="fullCalendarModal" tabindex="-1" aria-labelledby="fullCalendarLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered max-w-[90%] xl:max-w-7xl">
        <div class="modal-content overflow-hidden bg-white/95 backdrop-blur-lg rounded-2xl shadow-2xl border border-white/20">
            <!-- Modal Header -->
            <div class="modal-header px-6 py-4 bg-gradient-to-r from-blue-50 to-indigo-50 border-b border-white/30">
                <div class="flex-1">
                    <h5 class="text-2xl font-semibold text-gray-800 mb-1">
                        Schedule Meeting: {{task.title}}
                    </h5>
                    <p class="text-sm text-gray-600 font-medium">
                        Available time slots for your manager - Select a slot to schedule
                    </p>
                </div>
                <button type="button" class="btn-close p-2 transition-all hover:bg-gray-100 rounded-lg" data-bs-dismiss="modal">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body p-6">
                <div class="flex flex-col lg:flex-row gap-6">
                    <!-- Calendar Container -->
                    <div class="flex-1 bg-white/70 backdrop-blur-sm rounded-xl border border-white/30 shadow-lg p-4">
                        <div id="calendar" class="!h-[550px] [--fc-border-color:theme(colors.gray.200)]"></div>
                    </div>

                    <!-- Time Slots Container -->
                    <div class="w-full lg:w-96">
                        <div class="mb-4">
                            <h6 class="text-lg font-semibold text-gray-800 mb-2">Available Time Slots</h6>
                            <div id="timeSlots" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-2 gap-2"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer px-6 py-4 bg-gray-50/80 border-t border-white/30">
                <div class="flex justify-end gap-3 w-full">
                    <button type="button" 
                            class="px-5 py-2 text-sm font-medium text-gray-700 hover:text-gray-900 bg-white hover:bg-gray-100 border border-gray-300 rounded-lg transition-all">
                        Close
                    </button>
                    <button id="proceedToSchedule" 
                            class="px-5 py-2 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-all 
                                   disabled:opacity-50 disabled:pointer-events-none shadow-sm hover:shadow-md">
                        Schedule Meeting
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<style>
    .fc {
    --fc-button-bg-color: #3b82f6;
    --fc-button-border-color: #3b82f6;
    --fc-button-hover-bg-color: #2563eb;
    --fc-button-hover-border-color: #2563eb;
    --fc-today-bg-color: #bfdbfe;
}
</style>







<!-- CONFIRM MEET MODAL -->
<!-- Confirmation Modal -->
<div class="modal fade" id="confirmMeetingModal" tabindex="-1" aria-labelledby="confirmMeetingLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content bg-white rounded-2xl shadow-xl border border-gray-200">
            <!-- Modal Header -->
            <div class="modal-header border-b border-gray-200">
                <h5 class="modal-title text-lg font-semibold text-gray-800">Confirm Meeting</h5>
                <button type="button" class="btn-close text-gray-500 hover:text-gray-700" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Modal Body -->
            <div class="modal-body space-y-4 p-5">
                <p class="text-sm text-gray-600"><strong>Selected Date:</strong> <span id="selectedDate" class="text-gray-800"></span></p>
                <p class="text-sm text-gray-600"><strong>Selected Time Slot:</strong> <span id="selectedTime" class="text-gray-800"></span></p>

                <div>
                    <label for="meetingReason" class="block text-sm font-medium text-gray-700">Reason for Meeting:</label>
                    <select id="meetingReason" class="mt-1 w-full p-2 border border-gray-300 rounded-lg text-sm text-gray-700 focus:ring-2 focus:ring-indigo-400 focus:outline-none">
                        <option value="task_query">Task Queries</option>
                        <option value="facing_bug">Facing Bugs</option>
                        <option value="urgent_issue">Urgent Issue</option>
                        <option value="need_clarification">Need Clarification</option>
                        <option value="other">Other</option>
                    </select>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="modal-footer border-t border-gray-200 flex justify-end space-x-3 p-4">
                <button type="button" class="px-4 py-2 text-sm font-medium bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition" data-bs-dismiss="modal">Cancel</button>
                <button id="scheduleMeeting" class="px-4 py-2 text-sm font-medium bg-green-500 text-white rounded-lg hover:bg-green-600 transition">Schedule Meeting</button>
            </div>
        </div>
    </div>
</div>


<!-- show meeting details (existing) -->
 <!-- Meeting Details Modal -->
<div class="modal fade" id="meetingDetailsModal" tabindex="-1" aria-labelledby="meetingDetailsTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="meetingDetailsTitle">Meeting Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="meetingDetailsBody">
                <!-- Meeting details will be inserted dynamically -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>


<!-- CONVERSATION WITH MANAGER (LIVE) -->


<!-- COMMUNICATE MODAL  -->
 <!-- Chat Modal -->
 <div class="modal fade" id="taskChatModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered max-w-lg">
        <div class="modal-content rounded-xl shadow-2xl">
            <!-- Close Button -->
            <button type="button" class="absolute right-4 top-4 z-10 text-gray-500 hover:text-gray-700 transition-colors" data-bs-dismiss="modal">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>

            <!-- Search Input for Messages -->
          <div class="p-4">
                <input type="text" id="searchMessages" class="w-full p-2 border border-gray-300 rounded-lg" 
                  placeholder="Search messages..." onkeyup="searchMessages()">
             </div>

            <!-- Messages Container -->
            <div class="p-4">
                <div id="chatMessages" class="h-[400px] overflow-y-auto space-y-3 pr-2">
                    <!-- Messages will be loaded here -->
                    <p class="text-sm text-gray-500 text-center py-4">No messages found</p>
                </div>

                <!-- Input Area -->
                <div class="mt-4 flex gap-2">
                    <!-- File Input (hidden) -->
                    <input type="file" id="chatFileInput" class="hidden" />
                    
                    <!-- Attach File Button -->
                    <button onclick="document.getElementById('chatFileInput').click()" class="p-2 text-gray-500 hover:text-blue-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
                        </svg>
                    </button>

                    <!-- Message Input -->
                    <input type="text" id="chatMessageInput" 
                           class="flex-1 px-4 py-2 rounded-full border border-gray-200 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition-all"
                           placeholder="Type a message...">

                    <!-- Send Button -->
                    <button id="sendChatMessage" class="p-2 bg-blue-500 text-white rounded-full hover:bg-blue-600 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/>
                        </svg>
                    </button>
                </div>

                <!-- Action Buttons -->
                <div class="mt-3 flex items-center gap-3">
                    <button id="deleteAllMessages" class="flex items-center gap-1.5 text-red-500 hover:text-red-600 text-sm">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
                        </svg>
                        <span>Clear History</span>
                    </button>
                    
                    <button id="exportChat" class="flex items-center gap-1.5 text-gray-600 hover:text-gray-800 text-sm">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                        </svg>
                        <span>Export</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap');

body {
    font-family: 'Inter', -apple-system, sans-serif;
}

video::-webkit-media-controls-panel {
    background-image: linear-gradient(transparent, rgba(0,0,0,0.3));
}
/*CHAT MODAL  */
    #chatMessages::-webkit-scrollbar {
    width: 6px;
}

#chatMessages::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

#chatMessages::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
}

#chatMessages::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}
</style>


<!-- FILE PREVIEW MODAL -->
<!-- File Preview Modal -->
<div class="modal fade" id="filePreviewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered max-w-7xl h-[95vh]">
        <div class="modal-content rounded-xl shadow-2xl bg-white h-full">
            <!-- Close Button -->
            <button type="button" 
                    class="absolute right-4 top-4 z-50 p-2 text-gray-500 hover:text-gray-700 transition-colors"
                    data-bs-dismiss="modal">
                <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                </svg>
            </button>

            <!-- Preview Content -->
            <div class="h-full p-6">
                <div id="filePreviewContent" class="h-full w-full flex items-center justify-center overflow-y-auto">
                    <!-- Preview content will be injected here -->
                    <div class="text-gray-400 text-lg">Loading preview...</div>
                </div>
            </div>
        </div>
    </div>
</div>



<!-- TASK SUBMISSION MODAL -->

<!-- TASK SUBMISSION MODAL -->
<!-- Task Submission Modal -->
<div class="modal fade" id="taskCompletionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content overflow-hidden" style="
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
            border-radius: 16px;
        ">
            <div class="modal-header bg-gradient-to-r from-blue-600 to-indigo-700 p-6">
                <h5 class="modal-title text-white" style="
                    font-family: 'Roboto Condensed', sans-serif;
                    font-size: 1.5rem;
                    letter-spacing: -0.5px;
                    font-weight: 700;
                ">
                    <i class="mdi mdi-file-send-outline mr-2"></i>
                    Submit Task for Approval
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <div class="modal-body p-6 space-y-5">
                <div class="alert border-l-4 border-red-500 pl-4 bg-red-50/50 py-3 rounded-lg">
                    <p class="text-red-800 font-medium" style="font-family: 'Roboto', sans-serif">
                        <i class="mdi mdi-alert-circle-outline mr-2 text-red-600"></i>
                        Once submitted, your manager will review this request. This action cannot be undone.
                    </p>
                </div>

                <div class="space-y-4">
                    <h6 class="text-gray-700 font-semibold uppercase tracking-wide text-sm" style="font-family: 'Roboto Condensed', sans-serif">
                        <i class="mdi mdi-clipboard-list-outline mr-2 text-blue-600"></i>
                        Submission Details
                    </h6>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        <div class="flex items-center gap-3 p-3 bg-white/50 rounded-lg border-l-4 border-blue-400">
                            <i class="mdi mdi-file-outline text-2xl text-blue-600"></i>
                            <span class="text-gray-700 font-medium">Uploaded Files</span>
                        </div>
                        <div class="flex items-center gap-3 p-3 bg-white/50 rounded-lg border-l-4 border-purple-400">
                            <i class="mdi mdi-clock-outline text-2xl text-purple-600"></i>
                            <span class="text-gray-700 font-medium">Time Spent</span>
                        </div>
                        <div class="flex items-center gap-3 p-3 bg-white/50 rounded-lg border-l-4 border-green-400">
                            <i class="mdi mdi-comment-text-outline text-2xl text-green-600"></i>
                            <span class="text-gray-700 font-medium">Comments</span>
                        </div>
                        <div class="flex items-center gap-3 p-3 bg-white/50 rounded-lg border-l-4 border-orange-400">
                            <i class="mdi mdi-note-text-outline text-2xl text-orange-600"></i>
                            <span class="text-gray-700 font-medium">Notes</span>
                        </div>
                    </div>
                </div>

                <div class="space-y-4">
                    <label class="block text-gray-700 font-medium mb-2" style="font-family: 'Roboto Condensed', sans-serif">
                        <i class="mdi mdi-lock-outline mr-2 text-blue-600"></i>
                        Confirm Password
                    </label>
                    <div class="relative">
                        <input type="password" id="taskPassword" 
                            class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none transition-all"
                            placeholder="Enter your password">
                        <i class="mdi mdi-key-variant absolute right-4 top-3.5 text-gray-400"></i>
                    </div>
                    <small class="text-red-500 font-medium hidden" id="taskCompletionError">
                        <i class="mdi mdi-alert-circle-outline mr-1"></i>
                        Incorrect password
                    </small>
                </div>
            </div>

            <div class="modal-footer px-6 py-4 bg-gray-50/50 border-t border-gray-100">
                <button type="button" 
                    class="px-6 py-2.5 rounded-lg border border-gray-300 hover:bg-gray-50 text-gray-600 font-medium transition-all"
                    data-bs-dismiss="modal">
                    Cancel
                </button>
                <button type="button" 
                    class="px-6 py-2.5 bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white rounded-lg font-medium hover:shadow-lg transition-all"
                    id="submitTaskCompletion">
                    <i class="mdi mdi-send-check-outline mr-2"></i>
                    Submit for Approval
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Share task with team - members -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<div class="modal fade" id="shareTaskModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 overflow-hidden" style="
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(12px);
            border-radius: 1.5rem;
            font-family: 'Poppins', sans-serif;
        ">
            <div class="modal-header p-6" style="border-bottom: 1px solid rgba(255, 255, 255, 0.3);">
                <h5 class="modal-title text-xl font-semibold bg-gradient-to-r from-indigo-600 to-purple-600 bg-clip-text text-transparent">
                    ‚ú® Share Task with Team
                </h5>
                <button type="button" class="btn-close shadow-none" data-bs-dismiss="modal"></button>
            </div>
            
            <div class="modal-body p-6" style="max-height: 60vh; overflow-y: auto;">
                <div class="space-y-3">
                    <div class="flex items-center px-4 py-2.5 bg-white/50 rounded-lg shadow-sm transition-all duration-200 hover:shadow-md">
                        <input type="text" 
                               id="searchMembers" 
                               class="form-control border-0 bg-transparent focus:ring-0 placeholder-gray-400" 
                               placeholder="Search members...">
                        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>

                    <div id="membersList" class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        <!-- Sample Member Card -->
                        <div class="member-card flex items-center p-3 bg-white/60 rounded-xl shadow-sm transition-all duration-200 hover:shadow-md cursor-pointer border-2 border-transparent hover:border-indigo-100">
                            <img src="avatar-placeholder.png" class="w-8 h-8 rounded-full shadow-sm">
                            <div class="ml-3">
                                <h6 class="text-sm font-semibold text-gray-800 mb-0">John Doe</h6>
                                <p class="text-xs text-gray-500 mb-0">Developer</p>
                            </div>
                        </div>
                        <!-- Repeat member cards -->
                    </div>
                </div>
            </div>

            <div class="modal-footer p-6" style="border-top: 1px solid rgba(255, 255, 255, 0.3);">
                <button id="sendTaskBtn" class="btn btn-lg w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all duration-200">
                    <span id="sendSpinner" class="spinner-border spinner-border-sm d-none me-2"></span>
                    Share Task with Selected Members
                </button>
            </div>
        </div>
    </div>
</div>

<!-- CAL-AI MODAL  -->
<div class="modal fade" id="aiChatModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered max-w-4xl">
        <div class="modal-content border-0 overflow-hidden" style="
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        ">
            <div class="modal-header px-6 py-4 border-b border-gray-200/50">
                <div class="flex items-center gap-3">
                    <span class="material-symbols-rounded text-3xl bg-gradient-to-r from-indigo-500 to-purple-600 bg-clip-text text-transparent">
                        smart_toy
                    </span>
                    <div>
                        <h5 class="modal-title text-lg font-semibold text-gray-800 font-[Inter]">
                            CalAI Assistant
                            <span class="ml-2 px-2 py-1 bg-red-100 text-red-800 text-xs rounded-full uppercase font-medium">Beta</span>
                        </h5>
                        <p class="text-sm text-gray-600 mt-1">Your AI-powered productivity companion for {{organization.name}}</p>
                    </div>
                </div>
                <button type="button" class="btn-close p-2 rounded-full hover:bg-gray-100/50 transition-colors" data-bs-dismiss="modal">
                    <span class="material-symbols-rounded text-gray-500">close</span>
                </button>
            </div>

            <div class="modal-body p-6 flex flex-col gap-4">
                <!-- Chat Messages -->
                <div class="flex-1 bg-white/50 rounded-xl p-4 shadow-inner" style="height: 400px">
                    <div id="chatMessages" class="space-y-4 overflow-y-auto h-full pr-3">
                        <!-- System Message -->
                        <div class="flex items-start gap-3">
                            <div class="mt-1">
                                <span class="material-symbols-rounded text-indigo-500">auto_awesome</span>
                            </div>
                            <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 max-w-[85%]">
                                <p class="text-sm text-gray-700">
                                    Hi! I'm CalAI - official AI by CalendarPLus. I can help with:
                                    <br>‚Ä¢ Task/subtask management
                                    <br>‚Ä¢ Meeting scheduling
                                    <br>‚Ä¢ Progress tracking
                                    <br>‚Ä¢ Workflow optimization
                                    <br>‚Ä¢ I work on {{organization.name}} Datasets
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Predefined Queries -->
                <div class="grid md:grid-cols-3 gap-3">
                    <button class="query-btn px-4 py-2.5 bg-white/80 hover:bg-white text-gray-700 text-sm font-medium rounded-xl border border-gray-200/60 shadow-xs hover:shadow-md transition-all">
                        Get nearest subtask
                    </button>
                    <button class="query-btn px-4 py-2.5 bg-white/80 hover:bg-white text-gray-700 text-sm font-medium rounded-xl border border-gray-200/60 shadow-xs hover:shadow-md transition-all">
                        Create new subtask
                    </button>
                    <button class="query-btn px-4 py-2.5 bg-white/80 hover:bg-white text-gray-700 text-sm font-medium rounded-xl border border-gray-200/60 shadow-xs hover:shadow-md transition-all">
                        Schedule meeting with {{task.created_by.username}}
                    </button>
                </div>

                <!-- Input Area -->
                <div class="relative mt-2">
                    <div class="flex gap-2 items-center bg-white/80 backdrop-blur-sm border border-gray-200/60 rounded-xl p-2 shadow-sm">
                        <input type="text" 
                               id="userQuery" 
                               class="flex-1 border-0 bg-transparent focus:ring-0 px-3 py-2 text-gray-700 placeholder-gray-400 text-sm"
                               placeholder="Ask CalAI anything...">
                               <!-- sendQuery -->
                        <button id="senduery" class="btn-send bg-gradient-to-r from-indigo-500 to-purple-600 text-white p-2 rounded-xl hover:shadow-lg transition-shadow">
                            <span class="material-symbols-rounded text-xl">send</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- MANAGE TASK AUTOMATIONS -->
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

<div class="modal fade" id="automationModal" tabindex="-1" aria-labelledby="automationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content border-0" style="border-radius: 1.5rem; backdrop-filter: blur(12px); background: rgba(255, 255, 255, 0.9);">
            <div class="modal-header border-0 px-5 pt-5">
                <div class="w-100">
                    <h2 class="modal-title text-3xl font-bold bg-gradient-to-r from-purple-600 to-blue-500 bg-clip-text text-transparent font-[Inter]">
                        Configure Automations for {{task.title}}
                    </h2>
                    <div class="flex items-center gap-2 mt-2">
                        <span class="px-3 py-1.5 bg-indigo-100/80 text-indigo-600 rounded-full text-sm flex items-center gap-2 w-fit">
                            <i class="material-icons-round text-sm">auto_awesome</i>
                            AI autofill available
                        </span>
                    </div>
                </div>
                <button type="button" class="btn-close p-3" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            
            <div class="modal-body px-5 pb-5">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <!-- Welcome Text -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-purple-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-purple-100/80 rounded-lg">
                                <i class="material-icons-round text-purple-600 text-2xl">waving_hand</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Welcome Message</h3>
                                <p class="text-sm text-gray-600">Send welcome text to {{task.created_by.username}} every Morning</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="send_welcome_text">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-purple-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Submission Request -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-blue-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-blue-100/80 rounded-lg">
                                <i class="material-icons-round text-blue-600 text-2xl">assignment_turned_in</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Submission Request</h3>
                                <p class="text-sm text-gray-600">Automate Submission request after progress reaches to 100</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="send_submission_request_after_completion">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-blue-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Auto Summary -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-teal-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-teal-100/80 rounded-lg">
                                <i class="material-icons-round text-teal-600 text-2xl">summarize</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Auto Summary</h3>
                                <p class="text-sm text-gray-600">Generate summary after approval</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="generate_summary_after_approval">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-teal-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Translation -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-amber-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-amber-100/80 rounded-lg">
                                <i class="material-icons-round text-amber-600 text-2xl">translate</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Auto Translation</h3>
                                <p class="text-sm text-gray-600">Translate content to English</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="translate_in_english">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-amber-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Progress Updates -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-cyan-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-cyan-100/80 rounded-lg">
                                <i class="material-icons-round text-cyan-600 text-2xl">trending_up</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Progress Updates</h3>
                                <p class="text-sm text-gray-600">Provide regular progress updates to {{task.created_by.username}}</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="progress_update">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-cyan-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Post-Approval Greeting -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-pink-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-pink-100/80 rounded-lg">
                                <i class="material-icons-round text-pink-600 text-2xl">mood</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Post-Approval Greeting</h3>
                                <p class="text-sm text-gray-600">Send greeting after approval</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="send_greeting_after_approval">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-pink-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Completion Notification -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-red-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-red-100/80 rounded-lg">
                                <i class="material-icons-round text-red-600 text-2xl">notifications</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Completion Alert</h3>
                                <p class="text-sm text-gray-600">Notify creator on completion</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="notify_task_creator_on_completion">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-red-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Escalation -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-orange-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-orange-100/80 rounded-lg">
                                <i class="material-icons-round text-orange-600 text-2xl">priority_high</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Escalation System</h3>
                                <p class="text-sm text-gray-600">Escalate if not completed</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="escalate_if_not_completed">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-orange-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Deadline Reminders -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-yellow-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-yellow-100/80 rounded-lg">
                                <i class="material-icons-round text-yellow-600 text-2xl">alarm</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Deadline Reminders</h3>
                                <p class="text-sm text-gray-600">Send pre-deadline reminders</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="remind_before_deadline">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-yellow-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Auto Assign -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-lime-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-lime-100/80 rounded-lg">
                                <i class="material-icons-round text-lime-600 text-2xl">person_add</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Auto Assign</h3>
                                <p class="text-sm text-gray-600">Automatically assign reviewer</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="auto_assign_reviewer">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-lime-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Activity Logging -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-gray-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-gray-100/80 rounded-lg">
                                <i class="material-icons-round text-gray-600 text-2xl">history</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Activity Logging</h3>
                                <p class="text-sm text-gray-600">Log activity on completion</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="log_activity_on_completion">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-gray-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Task Chaining -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-indigo-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-indigo-100/80 rounded-lg">
                                <i class="material-icons-round text-indigo-600 text-2xl">link</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Task Chaining</h3>
                                <p class="text-sm text-gray-600">Assign new task after completion</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="assign_task_if_previous_completed">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-indigo-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                      <!-- Install updates -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-lime-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-lime-100/80 rounded-lg">
                                <i class="material-icons-round text-blue-600 text-2xl">apps</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Auto-install new apps</h3>
                                <p class="text-sm text-gray-600">Automatically install or update task management apps as soon as they are released on the CalApp Store.</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="install_new_apps">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-lime-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Deadline Extention -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-indigo-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-indigo-100/80 rounded-lg">
                                <i class="material-icons-round text-red-700 text-2xl">error</i>

                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Deadline Extention</h3>
                                <p class="text-sm text-gray-600">If a task is 80% complete but the deadline is near, auto-extend it by a few days.</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="extend_deadline">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-indigo-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Escalate auto stalled  -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-lime-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-lime-100/80 rounded-lg">
                                <i class="material-icons-round text-yellow-600 text-2xl">pause_circle</i>
                            </div>
                            <div class="flex-1">
                                    <h3 class="font-semibold text-gray-800">Automate Escalation for {{task.title}} if stalled!</h3>
                                    <p class="text-sm text-gray-600"> If no progress is made for 48 hours, notify the manager for follow-up..</p>
                            </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" data-key="automate_stalled">
                                    <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-lime-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                                </label>
                            </div>
                    </div>

                    <!-- Smart Task Priortization -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-indigo-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-indigo-100/80 rounded-lg">
                                <i class="material-icons-round text-green-600 text-2xl">priority_high</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Smart Task Priortization</h3>
                                <p class="text-sm text-gray-600">If {{task.title}} is critical and approaching the deadline but hasn‚Äôt started then we force its priority to urgent.</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="task_priortization">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-indigo-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!--Auto schedule meeting after submission for approval -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-lime-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-lime-100/80 rounded-lg">
                                <i class="material-icons-round text-indigo-600 text-2xl">videocam</i>

                            </div>
                            <div class="flex-1">
                                    <h3 class="font-semibold text-gray-800">Auto-schedule a meeting after task submission for review.</h3>
                                    <p class="text-sm text-gray-600">Let CalAI schedule a meeting with {{task.created_by.username}} after the task is submitted for review, finding the best time by comparing both availabilities.</p>
                            </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" data-key="auto_schedule_meeting_on_approval">
                                    <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-lime-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                                </label>
                            </div>
                    </div>

                    <!-- Task overdue notification -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-indigo-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-indigo-100/80 rounded-lg">
                                <i class="material-icons-round text-red-600 text-2xl">warning</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Overdue Alert</h3>
                                <p class="text-sm text-gray-600">Send alerts on overdue of {{task.title}} to you & {{task.created_by.username}}</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="overdue_notification">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-indigo-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                     <!-- Let CalAI create subtasks-->
                     <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-indigo-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-indigo-100/80 rounded-lg">
                                <i class="material-icons-round text-blue-600 text-2xl">auto_mode</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">CalAI‚Äôs Intelligent Subtask Automation</h3>
                                <p class="text-sm text-gray-600">Let CalAI intelligently break down "{{task.title}}" into up to three subtasks.</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="ai_subtasks">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-indigo-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Smart CalAI planning -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-indigo-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-indigo-100/80 rounded-lg">
                                <i class="material-icons-round text-green-600 text-2xl">integration_instructions</i>

                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">CalAI Estimation And Plans</h3>
                                <p class="text-sm text-gray-600">CalAI estimates how long a task will take based on past tasks, priority, and description| send a structured plan for you.</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="cal_ai_plans">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-indigo-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Send Meeting Summary-->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-indigo-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-indigo-100/80 rounded-lg">
                                <i class="material-icons-round text-blue-600 text-2xl">summarize</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">AI-Generated Meeting Summaries Post-Completion</h3>
                                <p class="text-sm text-gray-600">CalAI ensures you never miss details‚Äîmeeting summaries for {{task.title}} delivered.</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="send_meeting_summary">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-indigo-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Remind Meetings-->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-indigo-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-indigo-100/80 rounded-lg">
                                <i class="material-icons-round text-blue-600 text-2xl">auto_mode</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">CalAI Meeting Reminders</h3>
                                <p class="text-sm text-gray-600">CalAI will remind you & {{task.created_by.username}} before 1 hours of the Meeting</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="remind_my_meetings">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-indigo-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Send chat insights and Summary-->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-indigo-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-indigo-100/80 rounded-lg">
                                <i class="material-icons-round text-purple-600 text-2xl">insights</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Provide Conversation Insights</h3>
                                <p class="text-sm text-gray-600">CalAI will look the conversation between you & {{task.created_by.username}} and provide insights | prevent inappropriate behaviour</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="provide_chat_insights">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-indigo-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Share daily activities-->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-indigo-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-indigo-100/80 rounded-lg">
                                <i class="material-icons-round text-green-600 text-2xl">share</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Share Daily Activities</h3>
                                <p class="text-sm text-gray-600">We will share your daily activities to {{group.created_by.username}} also</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="send_daily_activities">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-indigo-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>

                    <!-- Share problems to workspace admin -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-purple-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-purple-100/80 rounded-lg">
                                <i class="material-icons-round text-purple-600 text-2xl">help_outline</i>

                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Ensure Admin Oversight on Task-Related Issues</h3>
                                <p class="text-sm text-gray-600">CalAI keeps {{group.created_by.username}} informed about problems for better tracking.</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="share_problems_to_admin">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-purple-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>


                    <!-- Remind me every morning -->
                    <div class="automation-item group flex items-center p-4 bg-white/80 backdrop-blur-sm border border-gray-200/70 rounded-xl hover:border-pink-200 hover:shadow-lg transition-all">
                        <div class="flex items-center gap-4 w-full">
                            <div class="p-3 bg-pink-100/80 rounded-lg">
                                <i class="material-icons-round text-pink-600 text-2xl">mood</i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-800">Wake up me Every Morning</h3>
                                <p class="text-sm text-gray-600">CalAI will send me reminders every morning to work on {{task.title}}</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" data-key="remind_me_every_morning">
                                <div class="w-11 h-6 bg-gray-200 rounded-full peer-checked:bg-pink-500 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all"></div>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- -------------------------------------------------------------------------------------------------------------------------- -->
<!-- Modal to add note -->
<div class="modal fade" id="addNoteModal" tabindex="-1" aria-labelledby="addNoteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addNoteModalLabel">Add Note</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <textarea id="noteText" class="form-control" rows="4" placeholder="Enter your note"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="saveNoteButton">Save Note</button>
            </div>
        </div>
    </div>
</div>




<div class="modal fade" id="addTagModal" tabindex="-1" aria-labelledby="addTagModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addTagModalLabel">Add Tag</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <!-- Dropdown for predefined tags -->
        <select class="form-select" id="tag-select">
          <option value="">Select a tag</option>
          <option value="Important">Important</option>
          <option value="Urgent">Urgent</option>
          <option value="Low Priority">Low Priority</option>
          <option value="Completed">Completed</option>
        </select>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="save-tag-btn">Save Tag</button>
      </div>
    </div>
  </div>
</div>


<!-- Sidebar for displaying the problems  -->
<!-- Sidebar for Problems -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="problemsSidebar" aria-labelledby="problemsSidebarLabel">
    <div class="offcanvas-header">
        <h5 id="problemsSidebarLabel">Problems</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">

        <h5>Raise a Problem</h5>
        <form id="raise-problem-form">
            <div class="form-group">
                <label for="problem-description">Problem Description</label>
                <textarea id="problem-description" class="form-control" rows="4" placeholder="Describe the problem..."></textarea>
            </div>
            <button type="button" id="raise-problem-btn" data-org-id="{{ organization.id }}" data-group-id="{{ group.id }}" data-task-id="{{ task.id }}" class="btn btn-danger mt-3">Report Problem</button>


             <!-- Spinner for loading indication -->
           <!-- Spinner for loading indication -->
            <div id="loading-spinner" class="spinner-border text-primary" role="status" style="display: none;">
                 <span class="visually-hidden">Loading...</span>
             </div>
              <div id="loading-text" style="display: none;">Reporting the problem to manager...</div>
        </form>

        <ul id="problems-list">
            {% if problems %}
                {% for problem in problems %}
                    <li>
                        <strong>{{ problem.reported_by.username }}:</strong>
                        {{ problem.description }}
                        ({{ problem.created_at|date:"F j, Y, g:i a" }}) 
                        <strong>Is Resolved: {{ problem.is_resolved }}</strong>
                        
                        <!-- Three-dot menu -->
                        <div class="dropdown" style="display: inline-block; position: relative;">
                            <button class="btn btn-secondary dropdown-toggle" 
                                    type="button" 
                                    id="dropdownMenuButton{{ problem.id }}" 
                                    data-bs-toggle="dropdown" 
                                    aria-expanded="false"
                                    style="background: none; border: none; font-size: 20px; cursor: pointer;">
                                &#x22EE; <!-- Vertical ellipsis -->
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton{{ problem.id }}">
                                <li>
                                    <button class="dropdown-item resolve-problem-btn" 
                                            data-org-id="{{ organization.id }}" 
                                            data-group-id="{{ group.id }}" 
                                            data-task-id="{{ task.id }}" 
                                            data-problem-id="{{ problem.id }}">
                                        Mark as Resolved
                                    </button>
                                </li>
                                <li id="loading-spinner-{{ problem.id }}" class="loading-spinner" style="display: none;">
                                    <div class="spinner-border text-primary" role="status">
                                        <span class="sr-only">Loading...</span>
                                    </div>
                                    <span>Reporting to manager...</span>
                                </li>
                            </ul>
                        </div>
                    </li>
                {% endfor %}
            {% else %}
                <span>No problems yet.</span>
            {% endif %}
        </ul>
        
    </div>
</div>


<!-- edit note modal -->
 <!-- Edit Note Modal -->
<div class="modal fade" id="editNoteModal" tabindex="-1" aria-labelledby="editNoteModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editNoteModalLabel">Edit Note</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="editNoteForm">
            <div class="mb-3">
              <label for="noteContent" class="form-label">Note Content</label>
              <textarea class="form-control" id="noteContent" rows="3"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="saveNoteBtn">Save changes</button>
        </div>
      </div>
    </div>
  </div>
  
<!-- Modal for editing comments -->
<div class="modal fade" id="editCommentModal" tabindex="-1" aria-labelledby="editCommentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editCommentModalLabel">Edit Comment</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <textarea id="commentContent" class="form-control" rows="4"></textarea>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveCommentBtn">Save Changes</button>
            </div>
        </div>
    </div>
</div>




<!-- --------------------------------------------------------------------------------------------------------------------------------------------------- -->
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    body {
        font-family: 'Inter', sans-serif;
    }
    
    .glass-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05), 0 1px 3px rgba(0, 0, 0, 0.05);
    }

    .progress-bar {
        transition: width 0.3s ease-in-out;
    }

    .activity-logs-sidebar {
        transform: translateX(100%);
        transition: transform 0.3s ease-in-out;
    }

    .activity-logs-sidebar.active {
        transform: translateX(0);
    }
</style>
</head>

<body class="bg-gray-50 min-h-screen p-6 font-['Roboto']">
    <!-- Notification -->
    <div id="notification" class="notification hidden fixed top-4 left-1/2 -translate-x-1/2 flex items-center gap-3 px-6 py-3 rounded-lg shadow-md border border-gray-200">
        <span id="notification-text" class="text-sm font-medium text-gray-700"></span>
        <button onclick="closeNotification()" class="material-icons-round text-gray-500 hover:text-gray-700 text-lg">close</button>
    </div>


<!-- WORKING ON IT -------------------------------------------------------------------------------------------------------  -->
{% if calpoints and calpoints.points %}
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&family=Exo+2:wght@600&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />

<div class="cyber-celebration-container">
    <div class="cyber-wire-frame">
        <div class="cyber-content">
            <span class="material-symbols-outlined icon-spark">auto_awesome</span>
            <h1 class="cyber-title">
                <span class="text-gradient">Mission Complete!</span><br>
                <span class="cyber-points">{{ calpoints.points }}</span> CP Acquired
            </h1>
            <div class="cyber-wires"></div>
            <div class="particle-network"></div>
        </div>
    </div>
</div>

<style>
.cyber-celebration-container {
    --neon-blue: #00f3ff;
    --neon-purple: #bc13fe;
    --neon-pink: #ff1ffb;
    --glow-intensity: 2.5;
    font-family: 'Exo 2', sans-serif;
}

.cyber-wire-frame {
    position: relative;
    margin: 2rem auto;
    padding: 2px;
    border-radius: 15px;
    background: linear-gradient(45deg, 
        var(--neon-blue) 0%, 
        var(--neon-purple) 25%, 
        var(--neon-pink) 50%, 
        var(--neon-purple) 75%, 
        var(--neon-blue) 100%);
    background-size: 400% 400%;
    animation: gradient-flow 8s ease infinite, 
               cyber-pulse 2s ease-in-out infinite;
    box-shadow: 0 0 40px rgba(188, 19, 254, 0.4);
}

.cyber-content {
    position: relative;
    padding: 2rem 4rem;
    background: #0a0a12;
    border-radius: 13px;
    overflow: hidden;
}

.icon-spark {
    position: absolute;
    top: -20px;
    right: -20px;
    font-size: 4rem;
    color: var(--neon-pink);
    filter: drop-shadow(0 0 10px var(--neon-pink));
    animation: icon-float 3s ease-in-out infinite;
}

.cyber-title {
    font-family: 'Orbitron', sans-serif;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 2px;
    margin: 1rem 0;
}

.text-gradient {
    background: linear-gradient(90deg, 
        var(--neon-blue), 
        var(--neon-purple), 
        var(--neon-pink));
    -webkit-background-clip: text;
    background-clip: text;
    color: transparent;
    animation: text-shine 3s linear infinite;
}

.cyber-points {
    display: inline-block;
    font-size: 3.5rem;
    font-weight: 900;
    color: var(--neon-blue);
    text-shadow: 0 0 20px var(--neon-blue);
    animation: points-glow 1.5s ease-in-out infinite;
}

/* Wire Frame Animation */
.cyber-wires {
    position: absolute;
    inset: 0;
    background: 
        repeating-linear-gradient(90deg, 
            var(--neon-blue) 0% 0.5%, 
            transparent 0.5% 15%),
        repeating-linear-gradient(0deg, 
            var(--neon-purple) 0% 0.5%, 
            transparent 0.5% 15%);
    mask: 
        linear-gradient(#000 0 0) content-box, 
        linear-gradient(#000 0 0);
    mask-composite: exclude;
    animation: wire-move 4s linear infinite;
}

/* Particle Network */
.particle-network {
    position: absolute;
    inset: 0;
    background: 
        radial-gradient(circle at center, 
            rgba(255,255,255,0.1) 0%, 
            transparent 70%);
    animation: particle-glow 2s ease-in-out infinite;
}

@keyframes gradient-flow {
    0% { background-position: 0% 50%; }
    50% { background-position: 100% 50%; }
    100% { background-position: 0% 50%; }
}

@keyframes cyber-pulse {
    0%, 100% { opacity: 0.9; transform: scale(1); }
    50% { opacity: 1; transform: scale(1.02); }
}

@keyframes text-shine {
    to { background-position: 200% center; }
}

@keyframes points-glow {
    0%, 100% { text-shadow: 0 0 20px var(--neon-blue); }
    50% { text-shadow: 0 0 40px var(--neon-blue), 0 0 60px var(--neon-purple); }
}

@keyframes wire-move {
    to { background-position: 200% 100%; }
}

@keyframes icon-float {
    0%, 100% { transform: translate(0,0) rotate(0deg); }
    25% { transform: translate(5px,-5px) rotate(5deg); }
    75% { transform: translate(-5px,5px) rotate(-5deg); }
}

@keyframes particle-glow {
    0%, 100% { opacity: 0.3; transform: scale(1); }
    50% { opacity: 0.6; transform: scale(1.05); }
}

/* Modern Wire Effects */
.cyber-wire-frame::before,
.cyber-wire-frame::after {
    content: '';
    position: absolute;
    inset: -3px;
    z-index: -1;
    background: linear-gradient(45deg, 
        var(--neon-blue), 
        var(--neon-purple), 
        var(--neon-pink), 
        var(--neon-blue));
    background-size: 400% 400%;
    border-radius: 17px;
    animation: gradient-flow 6s linear infinite, 
               rotate 20s linear infinite;
    filter: blur(25px);
    opacity: 0.7;
}

.cyber-wire-frame::after {
    filter: blur(45px);
    opacity: 0.4;
    animation-duration: 8s, 25s;
}

@keyframes rotate {
    to { transform: rotate(360deg); }
}

/* Modern Font Enhancements */
.cyber-title {
    font-size: 1.8rem;
    line-height: 1.4;
    text-shadow: 0 0 15px rgba(188, 19, 254, 0.6);
}

.material-symbols-outlined {
    font-variation-settings: 'FILL' 1, 'wght' 700, 'GRAD' 0, 'opsz' 48;
}
</style>
{% endif %}



<!-- TASK DEADLINE -->
<div class="fixed top-0 left-1/2 -translate-x-1/2 z-50 w-full max-w-screen-md mx-auto pt-2">
    <div class="p-3 rounded-b-lg bg-white/90 backdrop-blur-sm border border-t-0 border-blue-100 shadow-sm transition-all duration-300 hover:bg-white hover:border-blue-200 hover:shadow-md mx-4">
        <div class="flex items-baseline gap-2">
            <p class="text-[11px] font-medium text-blue-400/90 tracking-wide">TIME REMAINING</p>
            <div class="relative">
                <div class="absolute -inset-x-1.5 inset-y-0 bg-blue-100/30 rounded-sm blur opacity-0 hover:opacity-40 transition-opacity duration-300"></div>
                <p id="countdown" class="text-xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-500 to-blue-600 font-mono tracking-tighter animate-soft-pulse">
                    00:00:00
                </p>
            </div>
        </div>
    </div>
</div>

<style>
@keyframes soft-pulse {
    0% { opacity: 0.95; transform: translateY(0); }
    50% { opacity: 1; transform: translateY(-1px); }
    100% { opacity: 0.95; transform: translateY(0); }
}

.animate-soft-pulse {
    animation: soft-pulse 2.5s ease-in-out infinite;
}
</style>


<!-- main content  ---------------------------------------------------------------------------------------------------------->
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 font-['Roboto']">
    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8">
        <!-- Main Content -->
        <div class="lg:col-span-3">

            <!-- working on --------------------------------- -->
            <!-- Task Header -->
             <!-- Task Header -->
  <div class="bg-white/60 backdrop-blur-md rounded-xl shadow-sm p-6 mb-6 border border-white/30">
    <div class="flex items-center gap-3 mb-4">
      <span class="material-icons-round text-3xl text-blue-600/90 bg-blue-50 p-2 rounded-xl">assignment</span>
      <div>
        <h1 class="text-2xl font-semibold text-gray-800">{{ task.title }}</h1>
        <p class="text-gray-500 text-sm mt-0.5">Created {{ task.created_at|date:"M d, Y" }}</p>
      </div>
    </div>

    <!-- Task Details Grid -->
    <div class="grid md:grid-cols-2 gap-4 mb-6">
      <div class="bg-white/50 backdrop-blur-sm p-4 rounded-lg border border-white/30">
        <div class="flex items-center gap-2">
          <span class="material-icons-round text-red-500/90 text-xl">priority</span>
          <div>
            <h3 class="text-xs font-medium text-gray-500 uppercase tracking-wide">Priority</h3>
            <span class="text-sm font-medium text-red-600/90">
              {{ task.priority|title }}
            </span>
          </div>
        </div>
      </div>
      
      <div class="bg-white/50 backdrop-blur-sm p-4 rounded-lg border border-white/30">
        <div class="flex items-center gap-2">
          <span class="material-icons-round text-purple-500/90 text-xl">schedule</span>
          <div>
            <h3 class="text-xs font-medium text-gray-500 uppercase tracking-wide">Deadline</h3>
            <p class="text-sm font-medium text-gray-700/90">
              {{ task.deadline|date:"M d, Y H:i" }}
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Progress Section (Functionality Preserved) -->
    <div class="bg-white/60 backdrop-blur-md rounded-xl shadow-sm p-6 border border-white/30">
      <div class="flex items-center justify-between mb-3">
        <h2 class="text-lg font-semibold text-gray-700/90">Task Progress</h2>
        <span class="text-xl font-semibold text-blue-600/90">{{ task.progress }}%</span>
      </div>
      
      <!-- Original Progress Structure Preserved -->
      <div class="space-y-4">
        <div class="relative h-2.5 bg-gray-100/50 rounded-full overflow-hidden backdrop-blur-sm">
          <div id="progressBar" 
               class="h-full bg-gradient-to-r from-blue-500 to-blue-400 transition-all duration-300 ease-out shadow-inner"
               style="width: {{ task.progress }}%"
               aria-valuenow="{{ task.progress }}" 
               aria-valuemin="0" 
               aria-valuemax="100">
            <span class="absolute inset-0 flex items-center justify-center text-[9px] font-medium text-white/90 tracking-tighter">
              {{ task.progress }}%
            </span>
          </div>
        </div>
        
        <!-- Original Control Markup Preserved -->
        <div class="flex items-center gap-1.5" id="progress-controls">
            <!-- Decrease Progress Button -->
            <button id="decreaseProgress" 
                    class="w-8 h-8 flex items-center justify-center rounded-full bg-gray-100 hover:bg-gray-200 
                           transition-all active:scale-95 shadow-sm border border-gray-300/50"
                    aria-label="Decrease progress">
                <span class="material-icons-round text-gray-600 text-base">remove</span>
            </button>
        
            <!-- Increase Progress Button -->
            <button id="increaseProgress" 
                    class="w-8 h-8 flex items-center justify-center rounded-full bg-blue-500 hover:bg-blue-600 
                           transition-all active:scale-95 shadow-sm shadow-blue-100"
                    aria-label="Increase progress">
                <span class="material-icons-round text-white text-base">add</span>
            </button>
        </div>
    </div>
    </div>

            <!-- ------------------------------------------------------------------------------------------------------------ -->

                <!-- Action Cards -->
                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <!-- Task Actions -->
                    <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Task Actions</h3>
                        <div class="space-y-3">
                            <button class="w-full flex items-center gap-3 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl transition-colors"
                                    data-bs-toggle="offcanvas" data-bs-target="#problemsSidebar">
                                <span class="material-icons">bug_report</span>
                                View Problems
                            </button>
                            
                            <button id="activityLogsButton" class="w-full flex items-center gap-3 px-4 py-3 bg-gray-800 hover:bg-gray-900 text-white rounded-xl transition-colors">
                                <span class="material-icons">history</span>
                                Activity Logs
                            </button>
                        </div>
                    </div>

                    <!-- Communication -->
                    <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Communication</h3>
                        <div class="space-y-3">
                            <button class="w-full flex items-center gap-3 px-4 py-3 bg-green-600 hover:bg-green-700 text-white rounded-xl transition-colors start-chat-btn"
                                    data-org="{{ organization.id }}" 
                                    data-group="{{ group.id }}" 
                                    data-task="{{ task.id }}">
                                <span class="material-icons">live_tv</span>
                                Go Live Session
                            </button>

                            {% if extend_tasks %}
                            <button class="w-full flex items-center gap-3 px-4 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-xl transition-colors"
                                    data-bs-toggle="modal" 
                                    data-bs-target="#queryModal"
                                    data-org-id="{{ organization.id }}" 
                                    data-group-id="{{ group.id }}" 
                                    data-task-id="{{ task.id }}">
                                <span class="material-icons">email</span>
                                Send Query
                            </button>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- till here ---------------------------------------------------------------------------------------- -->

                <!-- Status Toggle -->
                <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 mb-8">
                    <div class="flex items-center justify-between">
                        <div>
                            <h3 class="text-lg font-semibold text-gray-800">Task Status</h3>
                            <p class="text-sm text-gray-500">Mark as completed when finished</p>
                        </div>
                        <div class="relative inline-block w-14 align-middle select-none transition duration-200 ease-in">
                            <input type="checkbox" 
                                   id="toggleTaskStatus"
                                   class="toggle-checkbox absolute block w-7 h-7 rounded-full bg-white border-2 border-gray-300 appearance-none cursor-pointer"
                                   {% if task.status == 'completed' %} checked {% endif %}
                                   
                                   data-group-id="{{ group_id }}">
                            <label for="toggleTaskStatus" 
                                   class="toggle-label block overflow-hidden h-7 rounded-full bg-gray-300 cursor-pointer transition-colors duration-200 ease-in"></label>
                        </div>
                    </div>
                </div>

              
            
            <!-- Tags & Attachments -->
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <!-- Tags Section -->
                <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-800">Tags</h3>
                        <button id="add-tag-btn" class="p-2 bg-green-100 hover:bg-green-200 text-green-700 rounded-lg transition-colors"
                        id="add-tag-btn"
                        data-task-id="{{ task.id }}"
                        data-org-id="{{ org_id }}"
                        data-group-id="{{ group_id }}">
                        
                            <span class="material-icons">add</span>
                        </button>
                
                    </div>
                    <div class="flex flex-wrap gap-2">
                        {% if task.tags.all %}
                            {% for tag in task.tags.all %}
                            <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full flex items-center gap-2 text-sm">
                                {{ tag.name }}
                                <button class="text-blue-700 hover:text-blue-800 remove-tag"
                                data-tag="{{ tag.name }}" 
                                data-tag-id="{{ tag.id }}"
                                data-task-id="{{ task.id }}"
                                data-org-id="{{ org_id }}"
                                data-group-id="{{ group_id }}">
                                    √ó
                                </button>

                        
                            </span>
                            {% endfor %}
                        {% else %}
                            <p class="text-gray-500 text-sm">No tags added yet</p>
                        {% endif %}
                    </div>
                </div>

                <!-- working on tags -->

                


                    <!-- Attachments -->
                    {% if extend_tasks %}
                    <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Attachments</h3>
                        <div class="space-y-3">
                            <button class="w-full flex items-center gap-3 px-4 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-xl transition-colors"
                                    data-bs-toggle="modal" 
                                    data-bs-target="#premiumAttachmentsModal"
                                    data-org-id="{{ org_id }}" 
                                    data-group-id="{{ group.id }}" 
                                    data-task-id="{{ task.id }}">
                                <span class="material-icons">attach_file</span>
                                Manage Files
                            </button>
                            <button class="w-full flex items-center gap-3 px-4 py-3 bg-teal-600 hover:bg-teal-700 text-white rounded-xl transition-colors"
                                    data-bs-toggle="modal" 
                                    data-bs-target="#fullCalendarModal"
                                    data-org-id="{{ org_id }}" 
                                    data-group-id="{{ group.id }}" 
                                    data-task-id="{{ task.id }}">
                                <span class="material-icons">schedule</span>
                                Schedule Meeting
                            </button>
                        </div>
                    </div>
                    {% endif %}
                </div>

                <!-- Notes & Comments -->
                <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6">
                    <!-- Notes -->
                    <div class="mb-8">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Notes</h3>
                            <button class="flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-xl transition-colors"
                                    data-bs-toggle="modal" data-bs-target="#addNoteModal">
                                <span class="material-icons">add</span>
                                Add Note
                            </button>
                        </div>
                        {% if task.notes.all %}
                        <div class="space-y-4">
                            {% for note in task.notes.all %}
                            <div class="p-4 bg-gray-50 rounded-xl">
                                <div class="flex items-start justify-between mb-2">
                                    <div>
                                        <h4 class="font-medium text-gray-700">{{ note.user.username }}</h4>
                                        <p class="text-sm text-gray-500">{{ note.created_at|date:"M d, Y H:i" }}</p>
                                    </div>
                                    <div class="dropdown">
                                        <button class="p-1 hover:bg-gray-200 rounded-lg dropdown-toggle"
                                                data-bs-toggle="dropdown">
                                            <span class="material-icons text-gray-600">more_vert</span>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item delete-note" data-note-id="{{ note.id }}" 
                                                data-task-id="{{ task.id }}" 
                                                data-group-id="{{ task.group.id }}" 
                                                data-org-id="{{ task.group.organization.id }}">Delete</a>
                                            </li>

                                            <li><a class="dropdown-item edit-note"data-note-id="{{ note.id }}" 
                                                        data-task-id="{{ task.id }}" 
                                                        data-group-id="{{ task.group.id }}" 
                                                        data-org-id="{{ task.group.organization.id }}" 
                                                        data-note-content="{{ note.note }}">Edit</a>
                                                    </li>
                                        </ul>
                                    </div>
                                </div>
                                <p class="text-gray-600">{{ note.note }}</p>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-gray-500 text-center py-4">No notes available</p>
                        {% endif %}
                    </div>

                    <!-- Comments -->
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Comments</h3>
                        <div class="mb-4">
                            <textarea id="comment-text" 
                                      class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                      rows="3" 
                                      placeholder="Write your comment..."></textarea>

                            <button id="submit-comment" 
                                    class="mt-2 px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-xl transition-colors" data-org-id="{{ org_id }}" 
                                    data-group-id="{{ group_id }}" 
                                    data-task-id="{{ task.id }}">
        
                                Post Comment
                            </button>
                        </div>
                        {% if task.comments.all %}
                        <div class="space-y-4">
                            {% for comment in task.comments.all %}
                            <div class="p-4 bg-gray-50 rounded-xl">
                                <div class="flex items-start justify-between mb-2">
                                    <div>
                                        <h4 class="font-medium text-gray-700">{{ comment.user.username }}</h4>
                                        <p class="text-sm text-gray-500">{{ comment.created_at|date:"M d, Y H:i" }}</p>
                                    </div>
                                    <div class="dropdown">
                                        <button class="p-1 hover:bg-gray-200 rounded-lg dropdown-toggle"
                                                data-bs-toggle="dropdown">
                                            <span class="material-icons text-gray-600">more_vert</span>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item edit-comment" data-comment-id="{{ comment.id }}" 
                                                        data-org-id="{{ org_id }}" 
                                                        data-group-id="{{ group_id }}" 
                                                        data-task-id="{{ task.id }}" 
                                                        data-comment-content="{{ comment.comment }}">Edit</a>
                                                    </li>

                                            <li>
                                                <a class="dropdown-item delete-comment"    data-comment-id="{{ comment.id }}" 
                                                        data-org-id="{{ org_id }}" 
                                                        data-group-id="{{ group_id }}" 
                                                        data-task-id="{{ task.id }}">Delete</a>
                                                    </li>
                                        </ul>
                                    </div>
                                </div>
                                <p class="text-gray-600">{{ comment.comment }}</p>
                            </div>
                            {% endfor %}
                        </div>
                        {% else %}
                        <p class="text-gray-500 text-center py-4">No comments yet</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Sidebar -->
        <div class="lg:col-span-1">
            <!-- Quick Actions -->
            <div class="quick-actions-container   bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Quick Actions</h3>
                <div class="space-y-3">


                    <button id="openShareTaskModal" 
                      data-org-id="123" 
                      data-group-id="456" 
                      data-task-id="789" 
                      class="w-full flex items-center gap-3 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors">
                      <span class="material-icons" style="color: dodgerblue;" >share</span>
                     Share and Help
                  </button>

                <!-- Task Completion Button -->
                {% if task.status != 'completed' and task.status != 'pending_approval' %}
                   <button class="w-full flex items-center gap-3 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors" id="openTaskCompletionModal"
                    data-org-id="{{ organization.id }}"
                   data-group-id="{{ group.id }}"
                   data-task-id="{{ task.id }}">
                   <span class="material-icons" style="color: dodgerblue;">send</span>
                   Submit Task for Approval
                  </button>
                 {% endif %}

                <!-- Launch CalAI -->
                <button type="button" class="w-full flex items-center gap-3 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors" data-bs-toggle="modal" data-bs-target="#aiChatModal">
                    <span class="material-icons" style="color: teal;">android</span>
                    CalAI
                </button>
                <!-- automations -->
                <button class="w-full flex items-center gap-3 px-4 py-3 bg-gray-100 hover:bg-gray-200 text-gray-700 rounded-xl transition-colors" data-bs-toggle="modal" data-bs-target="#automationModal">
                    <span class="material-icons" style="color: teal;">settings_suggest</span>
                    Automations
                </button>
                
                </div>
            </div>

            <!-- Status Card -->
            <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6 mb-8">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Task Status</h3>
                <div class="flex items-center gap-4">
                    <div class="relative w-16 h-16">
                        <svg class="w-full h-full" viewBox="0 0 100 100">
                            <circle class="text-gray-200" stroke-width="8" stroke="currentColor" fill="transparent" r="44" cx="50" cy="50"/>
                            <circle class="text-blue-500" stroke-width="8" stroke-dasharray="{{ task.progress }} 100" 
                                    stroke-linecap="round" stroke="currentColor" fill="transparent" r="44" cx="50" cy="50"/>
                        </svg>
                        <span class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-lg font-bold text-blue-600">
                            {{ task.progress }}%
                        </span>
                    </div>
                    <div>
                        <p class="text-sm text-gray-600">Deadline:</p>
                        <p class="font-medium text-gray-800">{{ task.deadline|date:"M d" }}</p>
                    </div>
                </div>
            </div>

            <!-- Time Tracking -->
            <div class="bg-white/80 backdrop-blur-sm rounded-2xl shadow-xl p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Time Tracking</h3>
                <div class="space-y-4">
                    <div class="text-center p-4 bg-blue-50 rounded-xl">
                        <p class="text-3xl font-bold text-blue-600 mb-2" id="time-display">00:00:00</p>
                        <div class="flex gap-2 justify-center">
                            <button id="start-stop-btn" 
                                    class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors"
                                    data-task-id="{{ task.id }}" 
                                    data-org-id="{{ org_id }}" 
                                    data-group-id="{{ group_id }}"
                                    >
                                Start
                            </button>
                            <button id="save-time-btn" 
                                    class="px-6 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition-colors" 
                                    style="display: none;">
                                Save
                            </button>
                        </div>
                    </div>
                    <div class="text-sm text-gray-600">
                        <p class="font-medium mb-2">Tracked Time:</p>
                        {% if task.time_tracking.all %}
                        <ul class="space-y-2">
                            {% for time_entry in task.time_tracking.all %}
                            <li class="flex justify-between items-center">
                                <span>{{ time_entry.user.username }}</span>
                                <span class="font-medium">{{ time_entry.time_spent }}h</span>
                            </li>
                            {% endfor %}
                        </ul>
                        {% else %}
                        <p class="text-gray-500">No time tracked yet</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .toggle-checkbox:checked {
        right: 0;
        border-color: #3B82F6;
        background-color: #3B82F6;
    }
    .toggle-checkbox:checked + .toggle-label {
        background-color: #BFDBFE;
    }
    .dropdown-menu {
        min-width: 120px;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    .dropdown-item {
        padding: 8px 16px;
        font-size: 14px;
        transition: background-color 0.2s;
    }
    .dropdown-item:hover {
        background-color: #F3F4F6;
    }
</style>
<!-------------------------------------------------------------------------------------------------------------------------------------------------------------  -->
    <!-- Activity Logs Sidebar -->
     <!-- Sidebar for Activity Logs -->
<div id="activityLogsSidebar" class="activity-logs-sidebar">
    <div class="sidebar-content">
        <button id="closeSidebarButton" class="btn btn-light">Close</button>
        <h3>Activity Logs</h3>
        <div id="activityLogsContainer" class="activity-logs-container">
            <!-- Activity logs will be loaded here -->
        </div>
    </div>
</div>

<!-- ---------------------------------------------------------------working on ui------------------------------------- -->

























<!-- Bootstrap 5 JS -->
 <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.10/main.min.js"></script>
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Bootstrap 5 JS (Includes Popper.js) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<!-- sortable.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
<!-- Connect Javascript & Attributes -->
 <!-- Link new js file and configure attributes  -->
<script type="text/javascript">
    // Inject Django variables into the window object
    window.djangoData = {
        orgId: "{{ organization.id }}",
        groupId: "{{group.id}}",
        taskId:"{{task.id}}",
    };
</script>

 <!-- Link your JS file -->
 <script src="{% static 'tasks/user_tasks.js' %}"></script>




   








<!-- FullCalendar & Dependencies -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.10.2/fullcalendar.min.js"></script>

<script>
$(document).ready(function () {
    let selectedDate = null;
    let selectedTimeSlot = null;
    let orgId, groupId, taskId;

    // Capture Organization, Group, and Task ID
    $("[data-bs-target='#fullCalendarModal']").on("click", function () {
        orgId = $(this).data("org-id");
        groupId = $(this).data("group-id");
        taskId = $(this).data("task-id");
        fetchExistingMeetings();
    });

    // Initialize FullCalendar with Tailwind styling
    $("#calendar").fullCalendar({
        themeSystem: false,
        header: {
            left: "prev,next today",
            center: "title",
            right: "month,agendaWeek,agendaDay",
        },
        buttonIcons: {
            prev: 'chevron_left',
            next: 'chevron_right',
            prevYear: 'keyboard_double_arrow_left',
            nextYear: 'keyboard_double_arrow_right'
        },
        buttonText: {
            today: 'Today',
            month: 'Month',
            week: 'Week',
            day: 'Day'
        },
        events: [],
        eventRender: function(event, element) {
            element.addClass(`
                rounded-lg shadow-sm transition-all duration-200
                ${event.status === 'confirmed' ? 
                    'bg-emerald-100 border border-emerald-200 hover:bg-emerald-200' : 
                    'bg-amber-100 border border-amber-200 hover:bg-amber-200'}
                text-gray-800 text-sm font-medium p-2
                hover:shadow-md hover:-translate-y-0.5
            `);
        },
        dayRender: function(date, cell) {
            cell.addClass(`
                hover:bg-indigo-50 transition-colors cursor-pointer
                border border-gray-100
            `);
        },
        selectable: true,
        dayClick: function(date) {
            selectedDate = date.format("YYYY-MM-DD");
            fetchAvailableSlots();
        },
        eventClick: function(event) {
            $("#meetingDetailsTitle").text("Meeting Details");
            let meetingLinkHtml = event.meeting_link ? 
                `<a href="${event.meeting_link}" target="_blank" class="
                    inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white
                    rounded-lg hover:bg-indigo-700 transition-colors shadow-sm
                    hover:shadow-md
                ">
                    <span class="material-icons-outlined text-sm">videocam</span>
                    Join Meeting
                </a>` : 
                `<span class="text-red-500 text-sm flex items-center gap-2">
                    <span class="material-icons-outlined text-sm">link_off</span>
                    No meeting link available
                </span>`;

            $("#meetingDetailsBody").html(`
                <div class="space-y-4 text-gray-700">
                    <div class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg">
                        <span class="material-icons-outlined text-indigo-500">calendar_today</span>
                        <span class="font-medium">${event.start.format("YYYY-MM-DD")}</span>
                    </div>
                    <div class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg">
                        <span class="material-icons-outlined text-indigo-500">schedule</span>
                        ${event.start.format("HH:mm")} - ${event.end ? event.end.format("HH:mm") : "N/A"}
                    </div>
                    <div class="flex items-start gap-3 p-2 hover:bg-gray-50 rounded-lg">
                        <span class="material-icons-outlined text-indigo-500">description</span>
                        <span class="flex-1">${event.title}</span>
                    </div>
                    <div class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg">
                        <span class="material-icons-outlined text-indigo-500">info</span>
                        <span class="px-3 py-1 rounded-full text-sm ${
                            event.status === 'confirmed' ? 
                            'bg-emerald-100 text-emerald-800' : 'bg-amber-100 text-amber-800'
                        }">
                            ${event.status || "Pending"}
                        </span>
                    </div>
                    <div class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg">
                        <span class="material-icons-outlined text-indigo-500">link</span>
                        ${meetingLinkHtml}
                    </div>
                </div>
            `);
            $("#meetingDetailsModal").modal("show");
        },
        viewRender: function(view) {
            // Style calendar buttons
            $('.fc-button-group, .fc-button').addClass(`
                bg-white shadow-sm rounded-lg overflow-hidden
                border border-gray-200 hover:shadow-md
            `);
            $('.fc-button').addClass(`
                px-4 py-2 text-gray-700 font-medium
                hover:bg-gray-50 transition-all
                flex items-center gap-2
            `);
            $('.fc-icon').addClass('material-icons-outlined text-sm');
            $('.fc-today-button').addClass('text-indigo-600');
            $('.fc-today').addClass('bg-indigo-50');
        }
    });

    // Fetch Available Time Slots & Meetings
    function fetchAvailableSlots() {
        if (!selectedDate) return;

        $.ajax({
            url: `/tasks/get-available-slots/?org_id=${orgId}&group_id=${groupId}&task_id=${taskId}&date=${selectedDate}`,
            method: "GET",
            dataType: "json",
            success: function(data) {
                let slotsDiv = $("#timeSlots");
                slotsDiv.html("").addClass(`
                    grid grid-cols-2 md:grid-cols-3 gap-2
                    max-h-[60vh] overflow-y-auto p-2
                `);

                if (!data.available_slots || data.available_slots.length === 0) {
                    slotsDiv.html(`
                        <div class="col-span-3 text-center p-6">
                            <span class="material-icons-outlined text-gray-400 text-4xl mb-2">hourglass_empty</span>
                            <p class="text-gray-500">No available slots for this date</p>
                        </div>
                    `);
                    return;
                }

                data.available_slots.forEach((slot, index) => {
                    let time = slot.start_time;
                    let slotBtn = $(`
                        <button class="
                            slot-btn w-full
                            px-4 py-3 text-sm font-medium
                            rounded-xl transition-all duration-300
                            border-2 border-indigo-100 hover:border-indigo-300
                            bg-white/80 backdrop-blur-sm hover:bg-indigo-50
                            hover:scale-[1.02] shadow-sm
                            animate-fade-in-up
                            flex items-center justify-center
                        ">
                            <span class="material-icons-outlined text-sm mr-2 text-indigo-500">schedule</span>
                            ${time}
                        </button>
                    `)
                    .data("time", time)
                    .on("click", function() {
                        $(".slot-btn").removeClass(`
                            bg-indigo-600 text-white border-indigo-600
                            ring-2 ring-indigo-200
                        `);
                        $(this).addClass(`
                            bg-indigo-600 text-white border-indigo-600
                            ring-2 ring-indigo-200
                        `);
                        selectedTimeSlot = $(this).data("time");
                        $("#proceedToSchedule")
                            .prop("disabled", false)
                            .removeClass("opacity-50 cursor-not-allowed")
                            .addClass("hover:bg-indigo-700");
                    })
                    .css('animation-delay', `${index * 50}ms`);

                    slotsDiv.append(slotBtn);
                });

                $("#availableSlotsModal").modal("show");
            },
            error: function(xhr, status, error) {
                console.log("Error fetching slots:", error);
                alert("‚ùå Failed to fetch available slots. Please try again.");
            },
        });
    }

    // Fetch Existing Meetings for Task
    function fetchExistingMeetings() {
        $.ajax({
            url: `/tasks/get-existing-meetings/?org_id=${orgId}&group_id=${groupId}&task_id=${taskId}`,
            method: "GET",
            dataType: "json",
            success: function(data) {
                let meetings = data.meetings || [];
                $("#calendar").fullCalendar("removeEvents");
                meetings.forEach((meeting) => {
                    $("#calendar").fullCalendar("renderEvent", {
                        id: meeting.id,
                        title: meeting.reason.replace("_", " "),
                        start: meeting.date + "T" + meeting.start_time,
                        end: meeting.date + "T" + meeting.end_time,
                        status: meeting.status,
                        meeting_link: meeting.meeting_link,
                        allDay: false,
                    });
                });
            },
            error: function(xhr, status, error) {
                console.log("Error fetching meetings:", error);
            },
        });
    }

    // Proceed to Confirm Modal
    $("#proceedToSchedule").on("click", function() {
        $("#selectedDate").text(selectedDate);
        $("#selectedTime").text(selectedTimeSlot);
        $("#confirmMeetingModal").modal("show");
    });

    // Schedule Meeting AJAX
   // Schedule Meeting AJAX
$("#scheduleMeeting").on("click", function () {
    let reason = $("#meetingReason").val();
    if (!reason) {
        $("#meetingReason").addClass("border-red-500");
        return;
    }

    // Show Loading Spinner
    $("#scheduleMeeting").prop("disabled", true).html(
        `<span class="spinner-border spinner-border-sm"></span> Scheduling...`
    );

    $.ajax({
        url: "/tasks/schedule-the-meeting/",
        method: "POST",
        headers: { "X-CSRFToken": getCSRFToken() },
        contentType: "application/json",
        data: JSON.stringify({
            org_id: orgId,
            group_id: groupId,
            task_id: taskId,
            date: selectedDate,
            start_time: selectedTimeSlot,
            reason: reason,
        }),
        success: function (data) {
            if (data.success) {
                showNotification("‚úÖ Meeting Scheduled Successfully!", "bg-emerald-500");
                setTimeout(() => location.reload(), 1500);
            } else {
                showNotification("‚ùå Error: " + data.error, "bg-red-500");
            }
        },
        error: function (xhr) {
            showNotification("‚ùå Failed to schedule meeting", "bg-red-500");
        },
        complete: function () {
            // Hide Loading Spinner
            $("#scheduleMeeting").prop("disabled", false).html("Schedule Meeting");
        },
    });
});

    // Helper functions
    function getCSRFToken() {
        return $("[name=csrfmiddlewaretoken]").val();
    }

    function showNotification(text, bgColor) {
        let notification = $(`
            <div class="fixed bottom-4 right-4 ${bgColor} text-white px-6 py-3 
                rounded-lg shadow-lg flex items-center gap-2 animate-slide-in">
                <span class="material-icons-outlined">notification_important</span>
                ${text}
            </div>
        `);
        $("body").append(notification);
        setTimeout(() => notification.remove(), 3000);
    }

    // Add custom animations
    const style = document.createElement('style');
    style.textContent = `
        @keyframes fade-in-up {
            0% { opacity: 0; transform: translateY(10px); }
            100% { opacity: 1; transform: translateY(0); }
        }
        @keyframes slide-in {
            0% { transform: translateX(100%); }
            100% { transform: translateX(0); }
        }
        .animate-fade-in-up { animation: fade-in-up 0.3s ease-out forwards; }
        .animate-slide-in { animation: slide-in 0.3s ease-out; }
        
        .fc-toolbar h2 { 
            font-size: 1.25rem;
            font-weight: 600;
            color: #374151;
        }
        
        .fc-day-header {
            background: #f8fafc;
            color: #64748b;
            font-weight: 500;
            padding: 8px;
            border-color: #e2e8f0;
        }
        
        .modal-glass {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
    `;
    document.head.appendChild(style);

    // Style all modals
    $(".modal-content").addClass(`
        modal-glass rounded-xl shadow-2xl
        border border-white/20 overflow-hidden
    `);
    $(".modal-header").addClass(`
        border-b border-gray-200/50 p-4
        flex items-center justify-between
    `);
    $(".modal-title").addClass(`
        text-xl font-semibold text-gray-800
        flex items-center gap-2
    `);
    $(".modal-body").addClass("p-4");
    $(".modal-footer").addClass(`
        border-t border-gray-200/50 px-4 py-3
        flex items-center justify-end gap-2
    `);
    
    // Style form inputs
    $("#meetingReason").addClass(`
        w-full px-4 py-2 border border-gray-200 rounded-lg
        focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500
        transition-all
    `);
});
</script>




<!-- Script -->
<script>
       $(document).ready(function() {
    $('#submit-comment').click(function() {
        var commentText = $('#comment-text').val().trim();
        if (commentText == "") {
            alert("Please write a comment before submitting.");
            return;
        }

        var orgId = $(this).data('org-id');
        var groupId = $(this).data('group-id');
        var taskId = $(this).data('task-id');

        // Construct the URL using JavaScript
        var url = '/tasks/task/' + orgId + '/' + groupId + '/' + taskId + '/add_comment/';

        // Send the comment via AJAX
        $.ajax({
            type: 'POST',
            url: url,
            data: {
                'comment': commentText,
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function(response) {
                // Append new comment to the list
                $('#comments-list').append('<li><strong>' + response.username + ':</strong> ' + response.comment + ' (' + response.created_at + ')</li>');
                showNotification('Comment has been added to your task')

                // Clear the comment text area
                $('#comment-text').val('');
            },
            error: function(xhr, errmsg, err) {
                alert("Error submitting comment. Please try again.");
            }
        });
    });
});


// Handle add note featue
document.getElementById("saveNoteButton").addEventListener("click", function() {
    // Fetch the task ID, org ID, and group ID from template context
    var taskId = '{{ task.id }}';
    var orgId = '{{ org_id }}';
    var groupId = '{{ group_id }}';

    // Get the note content
    var noteContent = document.getElementById("noteText").value;

    if (noteContent.trim() === "") {
        alert("Please enter a note!");
        return;
    }

    // Construct the URL dynamically using JavaScript syntax
    var url = "/tasks/task/" + orgId + "/" + groupId + "/" + taskId + "/add_note/";

    // Send the note via AJAX
    $.ajax({
        type: 'POST',
        url: url,
        data: {
            'note': noteContent,
            'csrfmiddlewaretoken': '{{ csrf_token }}' // CSRF token for security
        },
        success: function(response) {
            // Close the modal
            $('#addNoteModal').modal('hide');

            // Append the new note to the list of notes (or update UI as needed)
            var newNote = "<li><strong>You:</strong> " + response.note + " (" + response.created_at + ")</li>";
            document.querySelector("#taskNotesList").insertAdjacentHTML('beforeend', newNote);
            showNotification("Note is integrated")

            // Clear the textarea
            document.getElementById("noteText").value = "";
        },
        error: function(xhr, status, error) {
            alert("Error while adding note: " + error);
        }
    });
});

// Handle the timer
function toggleTimer() {
    var taskId = '{{ task.id }}';
    var orgId = '{{ org_id }}';
    var groupId = '{{ group_id }}';
    var button = document.getElementById("startStopButton");
    var icon = document.getElementById("timerIcon");
    
    // Check if timer is running by reading button text
    var isRunning = button.innerText.toLowerCase() === "stop timer";

    // Set action to either start or stop based on current button state
    var action = isRunning ? "stop" : "start";

    // Make AJAX request to start/stop timer
    $.ajax({
        type: 'POST',
        url: '/tasks/task/' + orgId + '/' + groupId + '/' + taskId + '/manage_timer/',
        data: {
            'action': action,  // send the action (start/stop)
            'csrfmiddlewaretoken': '{{ csrf_token }}'  // CSRF token for security
        },
        success: function(response) {
            if (response.status === 'started') {
                button.innerText = "Stop Timer";  // Change button text to "Stop Timer"
                icon.classList.remove("bi-play-circle");  // Remove play icon
                icon.classList.add("bi-pause-circle");   // Add pause icon
                startTimerDisplay();  // Start updating the time display
            } else if (response.status === 'stopped') {
                button.innerText = "Start Timer";  // Change button text back to "Start Timer"
                icon.classList.remove("bi-pause-circle");  // Remove pause icon
                icon.classList.add("bi-play-circle");      // Add play icon
                stopTimerDisplay();  // Stop updating the time display
            }
        },
        error: function(xhr, status, error) {
            alert("Error: " + error);
        }
    });
}

function startTimerDisplay() {
    // Implement the timer countdown functionality in real-time
    var timeSpent = document.getElementById("timeSpent");
    var startTime = Date.now();  // Capture the start time when the timer starts
    
    // Update time every second
    var timerInterval = setInterval(function() {
        var elapsedTime = Date.now() - startTime;
        var seconds = Math.floor((elapsedTime / 1000) % 60);
        var minutes = Math.floor((elapsedTime / 60000) % 60);
        var hours = Math.floor((elapsedTime / 3600000) % 24);
        
        // Format time as HH:mm:ss
        timeSpent.innerText = formatTime(hours, minutes, seconds);
    }, 1000);
    
    // Store interval ID to clear it when stopping the timer
    window.timerInterval = timerInterval;
}

function stopTimerDisplay() {
    // Clear the interval and stop updating the time display
    clearInterval(window.timerInterval);
}

function formatTime(hours, minutes, seconds) {
    // Format time to be displayed as HH:mm:ss
    return (hours < 10 ? "0" + hours : hours) + ":" + 
           (minutes < 10 ? "0" + minutes : minutes) + ":" + 
           (seconds < 10 ? "0" + seconds : seconds);
}


// handle the progress

document.getElementById('increaseProgress').addEventListener('click', function () {
    updateProgress(10); // Increase by 10
});

document.getElementById('decreaseProgress').addEventListener('click', function () {
    updateProgress(-10); // Decrease by 10
});

function updateProgress(delta) {
    const progressBar = document.getElementById('progressBar');
    const currentProgress = parseInt(progressBar.getAttribute('aria-valuenow'));
    const newProgress = Math.min(100, Math.max(0, currentProgress + delta)); // Ensure between 0 and 100

    $.ajax({
        type: 'POST',
        url: '/tasks/tasks/{{ org_id }}/{{ group_id }}/{{ task.id }}/update_progress/',
        data: {
            'progress': newProgress,
            'csrfmiddlewaretoken': '{{ csrf_token }}'
        },
        success: function (response) {
            if (response.status === 'success') {
                progressBar.style.width = response.progress + '%';
                progressBar.setAttribute('aria-valuenow', response.progress);
                progressBar.textContent = response.progress + '%';
                showNotification("Progress has been synced")
            } else {
                alert(response.message || 'An error occurred.');
            }
        },
        error: function (xhr, status, error) {
            alert('Error: ' + error);
        }
    });
}

// Handle activity logs

$(document).ready(function () {
    // Handle the click event to open the sidebar
    $('#activityLogsButton').click(function () {
        // Fetch activity logs via AJAX when the sidebar is opened
        var orgId = '{{ org_id }}';
        var groupId = '{{ group_id }}';
        var taskId = '{{ task.id }}';

        $.ajax({
            type: 'GET',
            url: '/tasks/tasks/' + orgId + '/' + groupId + '/' + taskId + '/activity_logs/',
            success: function (response) {
                if (response.status === 'success') {
                    loadActivityLogs(response.activity_logs);
                    showNotification("Activity Logs up and running")
                    // Show the sidebar
                    $('#activityLogsSidebar').css('right', '0');
                } else {
                    alert('Error: ' + response.message);
                }
            },
            error: function (xhr, status, error) {
                alert('Error fetching activity logs: ' + error);
            }
        });
    });

    // Handle the close button click to hide the sidebar
    $('#closeSidebarButton').click(function () {
        $('#activityLogsSidebar').css('right', '-400px');
    });
    showNotification('Task is fired up and ready')

    // Function to load activity logs into the sidebar
    function loadActivityLogs(logs) {
        var container = $('#activityLogsContainer');
        container.empty();  // Clear any existing logs

        // Loop through and display each log
        logs.forEach(function (log) {
            var logElement = `
                <div class="activity-log">
                    <h5>${log.action}</h5>
                    <p>${log.details}</p>
                    <small>${log.created_at}</small>
                </div>
            `;
            container.append(logElement);
        });
    }
});


// Handle task toggle as completed

document.getElementById('toggleTaskStatus').addEventListener('change', function () {
    const taskId = this.getAttribute('data-task-id');
    const orgId = this.getAttribute('data-org-id');
    const groupId = this.getAttribute('data-group-id');
    const isChecked = this.checked;

    // Determine the action based on the toggle state
    const action = isChecked ? 'completed' : 'pending';

    // Send an AJAX request
    fetch(`/tasks/tasks/${orgId}/${groupId}/${taskId}/toggle_status/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCSRFToken(), 
        },
        body: JSON.stringify({ status: action }),
    })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                // Update the label text
                document.querySelector('label[for="toggleTaskStatus"]').textContent = 
                    isChecked ? 'Mark as Pending' : 'Mark as Completed';
                    showNotification("Victory achieved")
            } else {
                alert('Failed to update task status.');
                this.checked = !isChecked; // Revert the toggle state
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred.');
            this.checked = !isChecked; // Revert the toggle state
        });
});

// Function to get the CSRF token
function getCSRFToken() {
    const name = 'csrftoken';
    const cookies = document.cookie.split(';');
    for (let i = 0; i < cookies.length; i++) {
        const cookie = cookies[i].trim();
        if (cookie.startsWith(name + '=')) {
            return cookie.substring(name.length + 1);
        }
    }
    return '';
}

/* Handle add remove tag  */
/* Handle Add/Remove Tag */
// Handle Add Tag Button click
document.getElementById('add-tag-btn').addEventListener('click', function () {
    const taskId = this.getAttribute('data-task-id'); // Fetch task ID
    const orgId = this.getAttribute('data-org-id');  // Fetch org ID
    const groupId = this.getAttribute('data-group-id'); // Fetch group ID

    // Open the modal to choose tags
    $('#addTagModal').modal('show');

    // Ensure we only bind the event handler once
    const saveTagButton = document.getElementById('save-tag-btn');
    saveTagButton.onclick = function () {
        const selectedTag = document.getElementById('tag-select').value; // Get selected tag
        if (!selectedTag) {
            alert('Please select a tag.');
            return;
        }

        // Send an AJAX request to add the tag
        fetch(`/tasks/tasks/${orgId}/${groupId}/${taskId}/update_tags/`, { // Corrected the URL structure
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken(), // Ensure you include your CSRF token
            },
            body: JSON.stringify({ action: 'add', tag_name: selectedTag }), // Send action and tag_name
        })
            .then(response => response.json())
            .then(data => {
                if (data.tag_name) { // Check if tag_name exists in the response
                    // Create the new tag element
                    const tagBadge = document.createElement('span');
                    tagBadge.classList.add('badge', 'bg-warning');
                    tagBadge.setAttribute('id', `tag-${data.tag_name}`); // Set id for the tag
                    tagBadge.setAttribute('data-task-id', taskId);
                    tagBadge.setAttribute('data-org-id', orgId);
                    tagBadge.setAttribute('data-group-id', groupId);
                    tagBadge.innerHTML = `
                        ${data.tag_name}
                        <button class="btn btn-sm btn-danger remove-tag" 
                                data-tag="${data.tag_name}" 
                                data-tag-id="${data.tag_name}" 
                                data-task-id="${taskId}" 
                                data-org-id="${orgId}" 
                                data-group-id="${groupId}">-</button>
                    `;

                    // Append the new tag to the tag container dynamically
                    const tagContainer = document.querySelector('p');
                    if (tagContainer) {
                        // If there's an existing "No tags" message, remove it
                        const noTagsElement = tagContainer.querySelector('.badge.bg-secondary');
                        if (noTagsElement) {
                            noTagsElement.remove(); // Remove "No tags" message
                        }

                        // Insert the new tag badge before the "+" button
                        const addTagButton = tagContainer.querySelector('#add-tag-btn');
                        if (addTagButton) {
                            tagContainer.insertBefore(tagBadge, addTagButton);
                        } else {
                            // If no "+" button, append it to the end
                            tagContainer.appendChild(tagBadge);
                        }
                    }

                    // Show success notification
                    showNotification('Your task has been tagged!');

                    // Close the modal
                    $('#addTagModal').modal('hide');
                } else {
                    alert('Failed to add tag.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred.');
            });
    };
});


// Remove tag event listener (Improved delegation)
document.addEventListener('click', function (event) {
    if (event.target && event.target.classList.contains('remove-tag')) {
        // Make sure the event is triggered by the button with class 'remove-tag'
        
        const tagElement = event.target.closest('.badge');  // Find the parent badge element
        const taskId = tagElement.getAttribute('data-task-id');  // Fetch task ID from the badge parent
        const orgId = tagElement.getAttribute('data-org-id');  // Fetch org ID from the badge parent
        const groupId = tagElement.getAttribute('data-group-id');  // Fetch group ID from the badge parent
        const tagName = event.target.getAttribute('data-tag');  // Fetch tag name
        
        // Send an AJAX request to remove the tag
        fetch(`/tasks/tasks/${orgId}/${groupId}/${taskId}/update_tags/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCSRFToken(),
            },
            body: JSON.stringify({ action: 'remove', tag_name: tagName }),  // Send action and tag_name
        })
        .then(response => response.json())
        .then(data => {
            if (data.tag_name) {  // Check if tag_name exists in the response
                // Remove the tag from the displayed list
                tagElement.remove();
                showNotification('Tag removed successfully','success');  // Remove the tag element from the DOM
            } else {
                alert('Failed to remove tag.');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred.');
        });
    }
});

// Handle time tracking
// Stopwatch Variables
let stopwatchInterval;
let isRunning = false;
let startTime = 0;
let elapsedTime = 0;

// DOM elements for stopwatch
const startStopBtn = document.getElementById('start-stop-btn');
const resetBtn = document.getElementById('reset-btn');  // Ensure this button exists or add it if needed
const timeDisplay = document.getElementById('time-display');

// Capture dynamic task ID, org ID, and group ID from button attributes
const taskId = startStopBtn.getAttribute('data-task-id');
const orgId = startStopBtn.getAttribute('data-org-id');
const groupId = startStopBtn.getAttribute('data-group-id');

// Function to format time (HH:MM:SS)
function formatTime(time) {
    const hours = Math.floor(time / 3600);
    const minutes = Math.floor((time % 3600) / 60);
    const seconds = time % 60;

    return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
}

// Function to start/stop the stopwatch
function toggleStopwatch() {
    if (isRunning) {
        // Stop the stopwatch
        clearInterval(stopwatchInterval);
        startStopBtn.textContent = 'Start';
        saveTime();  // Save the time once stopped
    } else {
        // Start the stopwatch
        startTime = Date.now() - elapsedTime;
        stopwatchInterval = setInterval(updateTimeDisplay, 1000);
        startStopBtn.textContent = 'Stop';
    }
    isRunning = !isRunning;
    showNotification('Stopwatch in action, logging your activity time. It will keep going until you stop it')
}

// Function to update time display
function updateTimeDisplay() {
    elapsedTime = Date.now() - startTime;
    timeDisplay.textContent = formatTime(elapsedTime / 1000);  // Convert to seconds
}

// Function to reset the stopwatch
function resetStopwatch() {
    clearInterval(stopwatchInterval);
    isRunning = false;
    startStopBtn.textContent = 'Start';
    timeDisplay.textContent = '00:00:00';
    elapsedTime = 0;
}

// Function to save time to the database and append it dynamically
// Function to save time to the database
function saveTime() {
    const timeSpent = (elapsedTime / 1000 / 3600).toFixed(2); // Convert to hours

    // Send AJAX request to save time
    fetch(`/tasks/tasks/${orgId}/${groupId}/${taskId}/save_time/`, {  // Correct URL structure
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCSRFToken(),  // Ensure CSRF token is included
        },
        body: JSON.stringify({
            time_spent: timeSpent,  // Send time spent in hours
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            
            showNotification("Time logged with precision")
            
            
            // Dynamically create a new badge for the new time entry
            const newBadge = document.createElement('span');
            newBadge.classList.add('badge', 'bg-info');
            newBadge.setAttribute('id', `time-entry-${data.time_entry_id}`); // Set unique ID for the time entry badge
            newBadge.setAttribute('data-task-id', taskId);
            newBadge.setAttribute('data-org-id', orgId);
            newBadge.setAttribute('data-group-id', groupId);
            newBadge.textContent = `${data.username}: ${data.time_spent} hours`;

            // Append the new badge to the time tracking section
            const timeTrackingContainer = document.querySelector('p');
            if (timeTrackingContainer) {
                const noTimeElement = timeTrackingContainer.querySelector('.badge.bg-secondary');
                if (noTimeElement) {
                    noTimeElement.remove(); // Remove "No time tracked" message
                }
                timeTrackingContainer.appendChild(newBadge);  // Append the new time entry
            }

            // Optionally reset stopwatch after saving time
            resetStopwatch();
        } else {
            alert('Failed to save time.');
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('An error occurred while saving the time.');
    });
}

// Event listeners for buttons


document.addEventListener('DOMContentLoaded', function () {
    const raiseProblemButton = document.getElementById('raise-problem-btn');
    const loadingSpinner = document.getElementById('loading-spinner'); // Spinner element
    const loadingText = document.getElementById('loading-text'); // Loading text element

    if (raiseProblemButton) {
        raiseProblemButton.addEventListener('click', function () {
            const orgId = this.getAttribute('data-org-id');
            const groupId = this.getAttribute('data-group-id');
            const taskId = this.getAttribute('data-task-id');
            const problemDescription = document.getElementById('problem-description').value;

            if (!problemDescription) {
                alert('Please provide a description for the problem.');
                return;
            }

            // Show the spinner and text
            loadingSpinner.style.display = 'inline-block';
            loadingText.style.display = 'inline-block';

            // Send an AJAX request to report the problem
            fetch(`/tasks/tasks/${orgId}/${groupId}/${taskId}/create_problem/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken(), // Ensure CSRF token is added here
                },
                body: JSON.stringify({
                    description: problemDescription,
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                   
                    showNotification('Issue escalated and flagged to your manager')
                      

                    // Create a new list item for the reported problem
                    const newProblemItem = document.createElement('li');
                    newProblemItem.innerHTML = `
                        <strong>${data.reported_by}</strong>: 
                        ${data.description} 
                        (${new Date(data.created_at).toLocaleString()}) 
                        <strong>Is Resolved: ${data.is_resolved}</strong>
                    `;

                    // Append the new problem to the list
                    const problemsList = document.getElementById('problems-list');
                    if (problemsList) {
                        problemsList.appendChild(newProblemItem);
                     
                        // Trigger the animation
                        setTimeout(function () {
                            newProblemItem.classList.add('show');
                        }, 10); // Adding a small delay to trigger the transition
                    }

                    // Optionally, clear the problem description textarea
                    document.getElementById('problem-description').value = '';
                } else {
                    alert('Failed to report the problem.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('An error occurred while reporting the problem.');
            })
            .finally(() => {
                // Hide the spinner and text once the request is complete
                loadingSpinner.style.display = 'none';
                loadingText.style.display = 'none';
            });
        });
    } else {
        console.error('Raise Problem button not found');
    }
});

// Function to get CSRF token from the cookies
function getCSRFToken() {
    let csrfToken = null;
    const cookieValue = document.cookie.split(';').find(cookie => cookie.trim().startsWith('csrftoken='));
    if (cookieValue) {
        csrfToken = cookieValue.split('=')[1];
    }
    return csrfToken;
}



// Handle problem resolve
document.addEventListener('DOMContentLoaded', function () {
    document.querySelectorAll('.resolve-problem-btn').forEach(button => {
        button.addEventListener('click', function () {
            const orgId = this.getAttribute('data-org-id');
            const groupId = this.getAttribute('data-group-id');
            const taskId = this.getAttribute('data-task-id');
            const problemId = this.getAttribute('data-problem-id');

            console.log(`Resolving problem with orgId=${orgId}, groupId=${groupId}, taskId=${taskId}, problemId=${problemId}`);

            // Reference to the current list item
            const problemListItem = this.closest('li');
            if (!problemListItem) {
                console.error("Problem list item not found!");
                return;
            }

            fetch(`/tasks/tasks/${orgId}/${groupId}/${taskId}/resolve_problem/${problemId}/`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken(),
                },
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                console.log("Server response:", data);
                if (data.success) {
                    // Display notification
                    showNotification(data.success);

                    // Update the Is Resolved field in the UI
                    const isResolvedField = problemListItem.querySelector('strong:nth-of-type(2)');
                    if (isResolvedField) {
                        isResolvedField.textContent = 'Is Resolved: True';
                    } else {
                        console.warn("Is Resolved field not found!");
                    }

                    // Remove the resolve button
                    const resolveButton = problemListItem.querySelector('.resolve-problem-btn');
                    if (resolveButton) {
                        resolveButton.remove();
                    } else {
                        console.warn("Resolve button not found!");
                    }
                } else {
                    alert('Failed to mark the problem as resolved.');
                    console.error("Error response from server:", data);
                }
            })
            .catch(error => {
                console.error('Error occurred:', error);
                alert('An error occurred while resolving the problem.');
            });
        });
    });
});

// Function to show notification
function showNotification(message) {
    const notification = document.getElementById('notification');
    const notificationText = document.getElementById('notification-text');
    notificationText.textContent = message;
    notification.classList.add('show');

    // Auto hide notification after 3 seconds
    setTimeout(() => {
        closeNotification();
    }, 5000);
}

// Function to close the notification
function closeNotification() {
    const notification = document.getElementById('notification');
    notification.classList.remove('show');
}

// Function to get CSRF token from cookies
function getCSRFToken() {
    let csrfToken = null;
    const cookieValue = document.cookie.split(';').find(cookie => cookie.trim().startsWith('csrftoken='));
    if (cookieValue) {
        csrfToken = cookieValue.split('=')[1];
    }
    return csrfToken;
}


// Handle note deletion
document.addEventListener('DOMContentLoaded', function () {
    // Add event listener for delete buttons
    document.querySelectorAll('.delete-note').forEach(button => {
        button.addEventListener('click', function () {
            const noteId = this.getAttribute('data-note-id');
            const taskId = this.getAttribute('data-task-id');
            const groupId = this.getAttribute('data-group-id');
            const orgId = this.getAttribute('data-org-id');

            // Send AJAX request to delete the note
            fetch(`/tasks/tasks/${orgId}/${groupId}/${taskId}/${noteId}/delete_note/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'), // Ensure CSRF token is included
                    'Content-Type': 'application/json',
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.message) {
                    // Remove the note element from the DOM
                    const noteElement = document.getElementById(`note-${noteId}`);
                    if (noteElement) {
                        noteElement.remove();
                    }
                   
                    showNotification("Note has been expunged and is no longer available.")
                } else if (data.error) {
                    alert(data.error);
                }
            })
            .catch(error => console.error('Error:', error));
        });
    });
});

// Function to get the CSRF token
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            // Does this cookie string begin with the name we want?
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}



// Edit the note
document.addEventListener('DOMContentLoaded', function () {
    // Function to get CSRF token from the cookies
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Handle Edit button click
    document.querySelectorAll('.edit-note').forEach(button => {
        button.addEventListener('click', function () {
            const noteId = this.getAttribute('data-note-id');
            const taskId = this.getAttribute('data-task-id');
            const groupId = this.getAttribute('data-group-id');
            const orgId = this.getAttribute('data-org-id');
            const currentNoteContent = this.getAttribute('data-note-content');
            
            // Populate the modal with the current note content
            document.getElementById('noteContent').value = currentNoteContent;

            // Show the modal
            const editModal = new bootstrap.Modal(document.getElementById('editNoteModal'));
            editModal.show();

            // Set a save handler for the modal save button
            document.getElementById('saveNoteBtn').addEventListener('click', function () {
                const updatedNoteContent = document.getElementById('noteContent').value;

                fetch(`/tasks/tasks/${orgId}/${groupId}/${taskId}/${noteId}/edit_note/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken'),
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        'note': updatedNoteContent
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        // Find the note item by ID and update the content
                        const noteItem = document.getElementById(`note-${noteId}`);
                        if (noteItem) {
                            const noteContentElement = noteItem.querySelector('.note-content');
                            if (noteContentElement) {
                                noteContentElement.textContent = updatedNoteContent;
                            }
                        }

                        
                        showNotification('Your note has been revised and the updates are now logged')

                        // Close the modal
                        var modal = bootstrap.Modal.getInstance(document.getElementById('editNoteModal'));
                        modal.hide();
                    } else {
                        alert(data.error);
                    }
                })
                .catch(error => console.error('Error:', error));
            });
        });
    });
});

// Edit comment

document.addEventListener('DOMContentLoaded', function () {
    // Function to get CSRF token from the cookies
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Handle Edit Comment button click
    document.querySelectorAll('.edit-comment').forEach(button => {
        button.addEventListener('click', function () {
            const commentId = this.getAttribute('data-comment-id');
            const orgId = this.getAttribute('data-org-id');
            const groupId = this.getAttribute('data-group-id');
            const taskId = this.getAttribute('data-task-id');
            const currentCommentContent = this.getAttribute('data-comment-content');
            
            // Populate the modal with the current comment content
            document.getElementById('commentContent').value = currentCommentContent;

            // Show the modal
            const editModal = new bootstrap.Modal(document.getElementById('editCommentModal'));
            editModal.show();

            // Set up the save button handler
            document.getElementById('saveCommentBtn').addEventListener('click', function saveHandler() {
                const updatedCommentContent = document.getElementById('commentContent').value;

                fetch(`/tasks/tasks/${orgId}/${groupId}/${taskId}/${commentId}/edit_comment/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken'),
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        'comment': updatedCommentContent
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        // Update the comment text in the list
                        const commentItem = document.querySelector(`#comment-${commentId} .comment-text`);
                        commentItem.textContent = updatedCommentContent;
                        showNotification("The update to the comment was successful.")

                        // Close the modal
                        editModal.hide();
                    } else {
                        alert(data.error);
                    }
                })
                .catch(error => console.error('Error:', error));

                // Remove the save handler after execution to avoid duplicates
                this.removeEventListener('click', saveHandler);
            });
        });
    });
});


// Delete comment

document.addEventListener('DOMContentLoaded', function () {
    // Handle Delete Comment click
    document.querySelectorAll('.delete-comment').forEach(button => {
        button.addEventListener('click', function () {
            const commentId = this.getAttribute('data-comment-id');
            const taskId = this.getAttribute('data-task-id');
            const groupId = this.getAttribute('data-group-id');
            const orgId = this.getAttribute('data-org-id');

            // Show confirmation dialog
            if (confirm("Are you sure you want to delete this comment?")) {
                fetch(`/tasks/tasks/${orgId}/${groupId}/${taskId}/${commentId}/delete_comment/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken'),
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        // Remove the deleted comment from the list
                        const commentItem = document.getElementById(`comment-${commentId}`);
                        commentItem.remove();

                     
                        showNotification('The comment deletion was successful.')
                    } else {
                        alert(data.error);
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        });
    });
});

// CSRF Token Helper Function
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Greeting
document.addEventListener('DOMContentLoaded', function() {
            // Function to get current hour
            function getGreeting() {
                const currentHour = new Date().getHours();  // Get current hour (0-23)
                let greetingMessage = '';

                // Determine the appropriate greeting based on the time of day
                if (currentHour >= 5 && currentHour < 12) {
                    greetingMessage = 'Good Morning, {{request.user}}!';
                } else if (currentHour >= 12 && currentHour < 17) {
                    greetingMessage = 'Good Afternoon, {{request.user}}!';
                } else if (currentHour >= 17 && currentHour < 21) {
                    greetingMessage = 'Good Evening, {{request.user}}!';
                } else {
                    greetingMessage = 'Good Night, {{request.user}}!';
                }

                // Display the greeting
                document.getElementById('greeting').textContent = greetingMessage;
            }

            // Call the function when the page loads
            getGreeting();
        });

// Current date 

document.addEventListener("DOMContentLoaded", function () {
        // Get current date
        const now = new Date();

        // Format the date
        const dayOfWeek = now.toLocaleString('en-us', { weekday: 'short' }); // "Fri"
        const day = now.getDate(); // "10"
        const month = now.toLocaleString('en-us', { month: 'long' }); // "January"
        const year = now.getFullYear(); // "2025"

        // Create the formatted date string
        const formattedDate = `${dayOfWeek} ${day} ${month}`;

        // Display the date
        const currentDateElement = document.getElementById("current-date");
        currentDateElement.innerHTML = formattedDate;
    });




// FETCH AND MANAGE THE TASKS ATTACHMENTS
document.addEventListener("DOMContentLoaded", () => {
    const modal = document.getElementById("premiumAttachmentsModal");
    const attachmentsContainer = document.getElementById("attachmentsContainer");

    let selectedOrgId = null;
    let selectedGroupId = null;
    let selectedTaskId = null;

    // üìå Open Modal & Fetch Attachments
    modal.addEventListener("show.bs.modal", (event) => {
        const button = event.relatedTarget;
        selectedOrgId = button.getAttribute("data-org-id");
        selectedGroupId = button.getAttribute("data-group-id");
        selectedTaskId = button.getAttribute("data-task-id");

        fetchAttachments();
    });

    // üìå Fetch Attachments via AJAX
    function fetchAttachments() {
        attachmentsContainer.innerHTML = `<p class="text-muted">Loading files...</p>`;

        fetch(`/tasks/fetch-task-attachments/${selectedOrgId}/${selectedGroupId}/${selectedTaskId}/`)
            .then(response => response.json())
            .then(data => {
                if (data.attachments.length === 0) {
                    attachmentsContainer.innerHTML = `<p class="text-muted">No attachments found.</p>`;
                    return;
                }

                let html = `
<div class="max-w-6xl mx-auto p-6 font-['Inter']">
    <div class="bg-white/30 backdrop-blur-lg rounded-2xl shadow-xl overflow-hidden border border-white/20">
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-black/10">
                    <tr class="text-left text-gray-700">
                        <th class="px-6 py-4 font-semibold uppercase text-sm tracking-wider">Name</th>
                        <th class="px-6 py-4 font-semibold uppercase text-sm tracking-wider">Category</th>
                        <th class="px-6 py-4 font-semibold uppercase text-sm tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/20">`;

data.attachments.forEach((file, index) => {
    html += `
                    <tr class="${index % 2 === 0 ? 'bg-white/5' : 'bg-black/5'} hover:bg-white/10 transition-colors duration-200">
                        <td class="px-6 py-4 text-gray-200 font-medium">${file.name}</td>
                        <td class="px-6 py-4">
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm bg-indigo-100/30 text-indigo-400">
                                ${file.category}
                            </span>
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex items-center space-x-3">
                                <button onclick="previewFile('${file.file_url}', '${file.category}')" 
                                    class="p-2 hover:bg-white/20 rounded-lg transition-all duration-200 group"
                                    title="Preview">
                                    <span class="material-icons text-blue-400 group-hover:text-blue-300">visibility</span>
                                </button>
                                
                                <a href="${file.file_url}" download
                                    class="p-2 hover:bg-white/20 rounded-lg transition-all duration-200 group"
                                    title="Download">
                                    <span class="material-icons text-green-400 group-hover:text-green-300">download</span>
                                </a>
                                
                                <button class="retry-btn p-2 hover:bg-white/20 rounded-lg transition-all duration-200 group"
                                    data-id="${file.id}"
                                    title="Retry">
                                    <span class="material-icons text-yellow-400 group-hover:text-yellow-300">autorenew</span>
                                </button>
                                
                                <button onclick="deleteAttachment(${file.id})" 
                                    class="p-2 hover:bg-white/20 rounded-lg transition-all duration-200 group"
                                    title="Delete">
                                    <span class="material-icons text-red-400 group-hover:text-red-300">delete</span>
                                </button>
                            </div>
                        </td>
                    </tr>`;
});

html += `
                </tbody>
            </table>
        </div>
    </div>
</div>`;

attachmentsContainer.innerHTML = html;


                // Attach event listeners for Retry buttons
                document.querySelectorAll(".retry-btn").forEach(button => {
                    button.addEventListener("click", function () {
                        retryAttachment(this);
                    });
                });
            })
            .catch(error => {
                console.error("Error fetching attachments:", error);
                attachmentsContainer.innerHTML = `<p class="text-danger">Failed to load files.</p>`;
            });
    }

    // üìå Preview File
    window.previewFile = (fileUrl, category) => {
        let previewHTML = `<p class="text-muted">Preview not available.</p>`;

        if (category.toLowerCase().includes("image")) {
            previewHTML = `<img src="${fileUrl}" class="img-fluid rounded">`;
        } else if (category.toLowerCase().includes("video")) {
            previewHTML = `<video controls class="w-100"><source src="${fileUrl}" type="video/mp4"></video>`;
        } else if (category.toLowerCase().includes("audio")) {
            previewHTML = `<audio controls class="w-100"><source src="${fileUrl}" type="audio/mpeg"></audio>`;
        } else if (category.toLowerCase().includes("document") || category.toLowerCase().includes("pdf")) {
            previewHTML = `<iframe src="${fileUrl}" width="100%" height="500px"></iframe>`;
        } else if (category.toLowerCase().includes("code") || category.toLowerCase().includes("text")) {
            fetch(fileUrl)
                .then(response => response.text())
                .then(text => {
                    previewHTML = `<pre class="bg-light p-3 rounded">${text}</pre>`;
                    attachmentsContainer.innerHTML = previewHTML;
                })
                .catch(() => {
                    previewHTML = `<p class="text-danger">Error loading file preview.</p>`;
                    attachmentsContainer.innerHTML = previewHTML;
                });
            return;
        }

        attachmentsContainer.innerHTML = previewHTML;
    };

    // üìå Delete Attachment via AJAX
    window.deleteAttachment = (attachmentId) => {
        if (!confirm("Are you sure you want to delete this file?")) return;

        fetch(`/tasks/delete-task-attachment/${selectedOrgId}/${selectedGroupId}/${selectedTaskId}/${attachmentId}/`, {
            method: "POST",
            headers: { "X-CSRFToken": getCSRFToken() }
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                alert("File deleted successfully!");
                fetchAttachments();  // Refresh list after deletion
            } else {
                alert("Failed to delete file.");
            }
        })
        .catch(error => console.error("Delete Error:", error));
    };

    // üìå Retry Attachment (Send to Task Creator) with Loading Spinner
    function retryAttachment(button) {
        const attachmentId = button.getAttribute("data-id");

        // ‚úÖ Save original button text
        const originalText = button.innerHTML;

        // ‚úÖ Add loading spinner
        button.innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Sending...`;
        button.disabled = true;

        fetch(`/tasks/retry-task-attachment/${selectedOrgId}/${selectedGroupId}/${selectedTaskId}/${attachmentId}/`, {
            method: "POST",
            headers: { "X-CSRFToken": getCSRFToken() }
        })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                alert("File successfully sent to task creator!");
            } else {
                alert("Retry failed. Please try again.");
            }
        })
        .catch(error => {
            console.error("Retry Error:", error);
            alert("An error occurred while sending the attachment.");
        })
        .finally(() => {
            // ‚úÖ Restore button text after request completes
            button.innerHTML = originalText;
            button.disabled = false;
        });
    }

    // üìå Get CSRF Token
    function getCSRFToken() {
        return document.cookie.split("; ").find(row => row.startsWith("csrftoken"))?.split("=")[1] || "";
    }
});


// WRITE CUSTOM QUERY TO THE MANAGER
document.addEventListener("DOMContentLoaded", () => {
    const queryModal = document.getElementById("queryModal");
    const queryForm = document.getElementById("queryForm");
    const querySubject = document.getElementById("querySubject");
    const queryTemplate = document.getElementById("queryTemplate");
    const queryMessage = document.getElementById("queryMessage");
    const queryLoading = document.getElementById("queryLoading");

    let selectedOrgId, selectedGroupId, selectedTaskId;

    // üìå Open Modal & Set IDs
    queryModal.addEventListener("show.bs.modal", (event) => {
        const button = event.relatedTarget;
        selectedOrgId = button.getAttribute("data-org-id");
        selectedGroupId = button.getAttribute("data-group-id");
        selectedTaskId = button.getAttribute("data-task-id");

        // Set hidden input fields
        document.getElementById("orgId").value = selectedOrgId;
        document.getElementById("groupId").value = selectedGroupId;
        document.getElementById("taskId").value = selectedTaskId;
    });

    // üìå Autofill message when selecting a template
    queryTemplate.addEventListener("change", () => {
        queryMessage.value = queryTemplate.value;
    });

    // üìå Handle Query Submission
    queryForm.addEventListener("submit", (event) => {
        event.preventDefault();

        // Get values
        const subject = querySubject.value.trim();
        const message = queryMessage.value.trim();
        if (!subject || !message) {
            alert("Please fill out all fields.");
            return;
        }

        // Show loading spinner
        queryLoading.classList.remove("d-none");

        fetch(`/tasks/send-task-query/${selectedOrgId}/${selectedGroupId}/${selectedTaskId}/`, {
            method: "POST",
            headers: {
                "X-CSRFToken": getCSRFToken(),
                "Content-Type": "application/json"
            },
            body: JSON.stringify({ subject, message })
        })
        .then(response => response.json())
        .then(data => {
            queryLoading.classList.add("d-none");
            if (data.message) {
                alert("üì® Query sent successfully!");
                queryForm.reset(); // Reset form after success
            } else {
                alert("‚ö†Ô∏è Error sending query. Try again!");
            }
        })
        .catch(error => {
            console.error("Query Error:", error);
            queryLoading.classList.add("d-none");
            alert("‚ö†Ô∏è Something went wrong. Try again later!");
        });
    });

    // üìå Get CSRF Token Function
    function getCSRFToken() {
        return document.cookie.split("; ").find(row => row.startsWith("csrftoken"))?.split("=")[1] || "";
    }
});


// predifined templates selection
document.querySelectorAll('.template-btn').forEach(btn => {
    btn.addEventListener('click', () => {
        document.getElementById('queryMessage').value = btn.dataset.template;
    });
});

// COMMUNICATE WITH MANAGER IN REAL TIME CHAT 


// COMMUNICATE BOTH USERS (MANAGER & THE TASK ACCOMPLISHER)
document.addEventListener("DOMContentLoaded", function () {
    let orgId, groupId, taskId;

    // Open Modal & Fetch Messages
    document.querySelectorAll(".start-chat-btn").forEach((btn) => {
        btn.addEventListener("click", function () {
            orgId = this.dataset.org;
            groupId = this.dataset.group;
            taskId = this.dataset.task;

            fetchMessages(orgId, groupId, taskId);
            new bootstrap.Modal(document.getElementById("taskChatModal")).show();
        });
    });

    // working on it

    // Fetch Messages & Files
    function fetchMessages(orgId, groupId, taskId) {
    fetch(`/tasks/fetch-task-messages/${orgId}/${groupId}/${taskId}/`)
        .then(response => response.json())
        .then(data => {
            const chatContainer = document.getElementById("chatMessages");
            chatContainer.innerHTML = "";

            if (data.messages.length > 0) {
                data.messages.forEach(msg => {
                    const messageElement = document.createElement("div");
                    messageElement.classList.add("flex", "gap-3", "p-3", "hover:bg-gray-50", "transition-colors");

                    let filePreview = "";
                    if (msg.file) {
                        const fileExt = msg.file.split('.').pop().toLowerCase();
                        const isImage = ["png", "jpg", "jpeg", "gif", "webp"].includes(fileExt);
                        const isVideo = ["mp4", "webm", "ogg"].includes(fileExt);

                        filePreview = `
                            <div class="mt-2 relative group">
                                ${isImage ? 
                                    `<img src="${msg.file}" class="rounded-lg shadow-sm max-w-[240px] cursor-zoom-in object-cover h-32" 
                                       data-file="${msg.file}">` :
                                 isVideo ?
                                    `<video class="rounded-lg max-w-[240px] cursor-pointer" data-file="${msg.file}">
                                        <source src="${msg.file}" type="video/${fileExt}">
                                     </video>` :
                                    `<div class="flex items-center gap-2 px-4 py-2 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors">
                                        <span class="text-xl">üìé</span>
                                        <a href="${msg.file}" target="_blank" class="font-medium text-gray-700">
                                            View File
                                        </a>
                                     </div>`
                                }
                                <div class="absolute bottom-2 right-2 bg-black/50 text-white rounded-full p-1 backdrop-blur-sm">
                                    <span class="material-icons text-sm">${isImage ? 'photo' : 'description'}</span>
                                </div>
                            </div>`;
                    }

                    messageElement.innerHTML = `
                        <div class="shrink-0">
                            <img src="${msg.profile}" alt="Profile" 
                                 class="w-10 h-10 rounded-full object-cover ring-2 ring-white shadow-sm">
                        </div>
                        <div class="flex-1 min-w-0">
                            <div class="flex items-baseline gap-2">
                                <span class="font-semibold text-gray-800">${msg.sender}</span>
                                <span class="text-sm text-gray-500">${msg.created_at}</span>
                            </div>
                            <p class="mt-1 text-gray-700 whitespace-pre-wrap">${msg.message}</p>
                            ${filePreview}
                        </div>
                    `;

                    chatContainer.appendChild(messageElement);
                });

                // Add event listener for file preview
                document.querySelectorAll(".cursor-zoom-in, .cursor-pointer").forEach((file) => {
                    file.addEventListener("click", function() {
                        openFilePreview(this.dataset.file);
                    });
                });

            } else {
                chatContainer.innerHTML = `
                    <div class="h-full flex items-center justify-center text-gray-400">
                        <div class="text-center">
                            <div class="text-2xl">üí¨</div>
                            <p class="mt-2 font-medium">No messages yet</p>
                        </div>
                    </div>`;
            }
        })
        .catch(err => console.error("Error fetching messages:", err));
}



    // OPEN FILE PREVIEW
    function openFilePreview(fileUrl) {
        const fileExt = fileUrl.split('.').pop().toLowerCase();
        let previewContent = "";

        if (["png", "jpg", "jpeg", "gif", "webp"].includes(fileExt)) {
            previewContent = `<img src="${fileUrl}" class="img-fluid rounded" style="max-width: 100%;">`;
        } else if (["mp4", "webm", "ogg"].includes(fileExt)) {
            previewContent = `<video controls class="w-100">
                                <source src="${fileUrl}" type="video/${fileExt}">
                                Your browser does not support the video tag.
                              </video>`;
        } else {
            previewContent = `<iframe src="${fileUrl}" class="w-100" style="height: 500px;"></iframe>`;
        }

        document.getElementById("filePreviewContent").innerHTML = previewContent;
        new bootstrap.Modal(document.getElementById("filePreviewModal")).show();
    }

    // Send Message (JSON-based)
    document.getElementById("sendChatMessage").addEventListener("click", function () {
        const messageInput = document.getElementById("chatMessageInput");
        const fileInput = document.getElementById("chatFileInput");
        const message = messageInput.value;
        const file = fileInput.files[0];

        if (!message && !file) {
            alert("Please enter a message or select a file.");
            return;
        }

        const reader = new FileReader();
        reader.onload = function (event) {
            const base64File = file ? event.target.result : null;

            fetch("/tasks/send-task-message/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": getCSRFToken(),
                },
                body: JSON.stringify({
                    task_id: taskId,
                    org_id: orgId,
                    group_id: groupId,
                    message: message,
                    file: base64File,
                    file_name: file ? file.name : null,
                }),
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    fetchMessages(orgId, groupId, taskId);
                    messageInput.value = "";
                    fileInput.value = "";
                } else {
                    alert("Error sending message: " + data.error);
                }
            })
            .catch(err => console.error("Error sending message:", err));
        };

        if (file) {
            reader.readAsDataURL(file);
        } else {
            reader.onload();
        }
    });

    // DELETE ALL MESSAGES
    document.getElementById("deleteAllMessages").addEventListener("click", function () {
        if (confirm("Are you sure you want to delete all your messages?")) {
            fetch(`/tasks/delete-task-messages/${orgId}/${groupId}/${taskId}/`, {
                method: "DELETE",
                headers: {
                    "X-CSRFToken": getCSRFToken(),
                },
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    fetchMessages(orgId, groupId, taskId);
                } else {
                    alert("Error deleting messages: " + data.error);
                }
            })
            .catch(err => console.error("Error deleting messages:", err));
        }
    });

    // export task chat
    document.getElementById("exportChat").addEventListener("click", function () {
    const exportUrl = `/tasks/export-task-chat/${orgId}/${groupId}/${taskId}/`;

    fetch(exportUrl, {
        method: "GET",
        headers: {
            "X-CSRFToken": getCSRFToken(),
        },
    })
    .then(response => {
        if (response.ok) {
            return response.blob();
        }
        throw new Error("Failed to export chat");
    })
    .then(blob => {
        const downloadUrl = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = downloadUrl;
        a.download = `task_chat_${taskId}.pdf`;
        document.body.appendChild(a);
        a.click();
        a.remove();
    })
    .catch(err => console.error("Error exporting chat:", err));
});


    // Get CSRF Token
    function getCSRFToken() {
        return document.cookie.split("; ")
            .find(row => row.startsWith("csrftoken"))
            ?.split("=")[1];
    }
});


// handle messages search input
function searchMessages() {
    let input = document.getElementById("searchMessages").value.toLowerCase();
    let messages = document.querySelectorAll("#chatMessages > div");  
    let noMessages = document.getElementById("noMessages");
    let found = false;  

    messages.forEach(msg => {
        let text = msg.innerText.toLowerCase();
        if (text.includes(input)) {
            msg.style.display = "flex";  // Keep flex for alignment
            found = true;
        } else {
            msg.style.display = "none";
        }
    });

    noMessages.style.display = found ? "none" : "block";
}

// Function to Render Messages with Profile Pictures
function renderMessages(messages) {
    let chatMessages = document.getElementById("chatMessages");
    chatMessages.innerHTML = ""; // Clear previous messages

    if (messages.length === 0) {
        chatMessages.innerHTML = `<p class="text-sm text-gray-500 text-center py-4">No messages found</p>`;
        return;
    }

    messages.forEach(msg => {
        let profilePic = msg.profile !== "No url" ? msg.profile : "default-profile.png"; // Use default if no profile pic
        let messageElement = document.createElement("div");
        messageElement.classList.add("flex", "items-start", "gap-3", "p-2", "bg-white", "rounded-lg", "shadow-sm");

        messageElement.innerHTML = `
            <img src="${profilePic}" alt="Profile" class="w-10 h-10 rounded-full object-cover border border-gray-300">
            <div>
                <strong class="block text-gray-800">${msg.sender}</strong>
                <p class="text-gray-600">${msg.message}</p>
                <small class="text-muted d-block">${msg.created_at}</small>
            </div>
        `;

        chatMessages.appendChild(messageElement);
    });
}



// TASK SUBMISSION
document.addEventListener("DOMContentLoaded", function () {
    const openModalBtn = document.getElementById("openTaskCompletionModal");
    const submitTaskBtn = document.getElementById("submitTaskCompletion");
    const errorMsg = document.getElementById("taskCompletionError");

    let orgId, groupId, taskId;

    // ‚úÖ Function to get CSRF token safely
    function getCSRFToken() {
        const csrfMetaTag = document.querySelector('meta[name="csrf-token"]');
        return csrfMetaTag ? csrfMetaTag.getAttribute("content") : null;
    }

    // ‚úÖ Open Modal and Set Task Data
    if (openModalBtn) {
        openModalBtn.addEventListener("click", function () {
            orgId = this.getAttribute("data-org-id");
            groupId = this.getAttribute("data-group-id");
            taskId = this.getAttribute("data-task-id");

            const taskCompletionModal = new bootstrap.Modal(document.getElementById("taskCompletionModal"));
            taskCompletionModal.show();
        });
    }

    // ‚úÖ Handle Task Submission with Loading Spinner
    if (submitTaskBtn) {
        submitTaskBtn.addEventListener("click", function () {
            const password = document.getElementById("taskPassword").value;
            const csrfToken = getCSRFToken();

            if (!password.trim()) {
                errorMsg.textContent = "Password is required!";
                return;
            }

            if (!csrfToken) {
                errorMsg.textContent = "CSRF token missing. Please refresh the page.";
                return;
            }

            // ‚úÖ Store original button content & show spinner
            const originalBtnText = submitTaskBtn.innerHTML;
            submitTaskBtn.innerHTML = `<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Submitting...`;
            submitTaskBtn.disabled = true;

            fetch("/tasks/submit-task-completion/", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-CSRFToken": csrfToken
                },
                body: JSON.stringify({
                    org_id: orgId,
                    group_id: groupId,
                    task_id: taskId,
                    password: password
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === "success") {
                    alert("Task completion request sent for approval! üéâ");
                    location.reload();
                } else {
                    errorMsg.textContent = data.message;
                    submitTaskBtn.innerHTML = originalBtnText;
                    submitTaskBtn.disabled = false;
                }
            })
            .catch(error => {
                errorMsg.textContent = "Something went wrong. Try again.";
                submitTaskBtn.innerHTML = originalBtnText;
                submitTaskBtn.disabled = false;
            });
        });
    }
});


// TASK DEADLINE COUNT
function startCountdown(deadline) {
            let countdownElement = document.getElementById("countdown");
            let deadlineDate = new Date(deadline).getTime();

            function updateCountdown() {
                let now = new Date().getTime();
                let timeLeft = deadlineDate - now;

                if (timeLeft <= 0) {
                    countdownElement.innerHTML = "‚è≥ Time Over!";
                    countdownElement.classList.remove("text-green-400", "text-yellow-400");
                    countdownElement.classList.add("text-red-500");
                    return;
                }

                let days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                let hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                let minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                let seconds = Math.floor((timeLeft % (1000 * 60)) / 1000);

                countdownElement.innerHTML = `${days}d ${hours}h ${minutes}m ${seconds}s`;

                // Change styles dynamically
                if (days < 1) {
                    countdownElement.classList.remove("text-green-400");
                    countdownElement.classList.add("text-yellow-400");
                }
                if (hours < 1) {
                    countdownElement.classList.remove("text-yellow-400");
                    countdownElement.classList.add("text-red-500");
                }
            }

            setInterval(updateCountdown, 1000);
            updateCountdown(); // Run instantly
        }

        // Get deadline from Django (formatted as ISO 8601)
        let taskDeadline = "{{ task.deadline|date:'c' }}";  
        startCountdown(taskDeadline);








// stopwatrch functions
startStopBtn.addEventListener('click', toggleStopwatch);
resetBtn.addEventListener('click', resetStopwatch);

    </script>

    


</body>
</html>


