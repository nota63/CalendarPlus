<div class="container mt-4">
    <h2 class="text-center">ðŸš€ Pulse</h2>
    <p class="text-center">
        See who's online and what they're working on
    </p>

    <!-- Today's Date Section -->
    <section class="text-center">
        <h4>ðŸ“… Today's Date: <span id="today-date"></span></h4>
    </section>

    <!-- Search Bar -->
    <div class="mt-3 mb-4 text-center">
        <input type="text" id="search-user" class="form-control w-50 mx-auto" placeholder="ðŸ” Search users...">
    </div>

    <!-- People Online Section -->
    <div class="card shadow p-3 mb-4">
        <h5 class="text-center fw-bold">ðŸŸ¢ People Online</h5>
        <div class="row text-center">
            {% for hour in time_slots %}
                <div class="col-2 p-1">
                    <span class="badge bg-primary">{{ hour }}</span>
                </div>
            {% endfor %}
        </div>
    </div>

    {% if error %}
        <div class="alert alert-warning text-center">
            {{ error }}
        </div>
    {% else %}
        <div class="row">
            <div class="col-md-8 offset-md-2">
                <ul class="list-group">
                    {% for user, activities in activity_data.items %}
                        <li class="list-group-item user-item">
                            <h5 class="text-primary">ðŸ‘¤ {{ user }}</h5>
                            {% if activities %}
                                <ul>
                                    {% for activity in activities %}
                                        <li>
                                            <span class="badge bg-success">
                                                {{ activity.created_at|date:"M d, Y H:i" }}
                                            </span> 
                                            - {{ activity.activity|default:"No Activity Title" }}
                                        </li>
                                    {% endfor %}
                                </ul>
                            {% else %}
                                <p class="text-muted">No recent activities.</p>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    {% endif %}
</div>

<!-- JavaScript to Set Today's Date & Handle Search -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Set Today's Date
        let today = new Date();
        let formattedDate = today.toLocaleDateString('en-US', {
            weekday: 'long', year: 'numeric', month: 'long', day: 'numeric'
        });
        document.getElementById("today-date").innerText = formattedDate;

        // Search User Filter
        document.getElementById("search-user").addEventListener("keyup", function () {
            let searchValue = this.value.toLowerCase();
            document.querySelectorAll(".user-item").forEach(function (userItem) {
                let userName = userItem.querySelector("h5").innerText.toLowerCase();
                userItem.style.display = userName.includes(searchValue) ? "block" : "none";
            });
        });
    });
</script>
