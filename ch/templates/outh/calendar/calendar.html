<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Calendar Events</title>

    <!-- Bootstrap 5 & FullCalendar CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@3.2.0/dist/fullcalendar.min.css">

    <!-- jQuery, Bootstrap JS, Moment.js, and FullCalendar -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@3.2.0/dist/fullcalendar.min.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            padding: 20px;
        }
        #calendar {
            max-width: 900px;
            margin: 0 auto;
        }
    </style>
</head>
<body>

    <h2 class="text-center">Google Calendar Events</h2>
    <div id="calendar"></div>

    <!-- Bootstrap Modal for Event Details -->
    <div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="eventTitle">Event Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p><strong>Date:</strong> <span id="eventDate"></span></p>
                    <p><strong>Time:</strong> <span id="eventTime"></span></p>
                    <p><strong>Location:</strong> <span id="eventLocation"></span></p>
                    <p><strong>Description:</strong> <span id="eventDescription"></span></p>
                    <p><strong>Organizer:</strong> <span id="eventOrganizer"></span></p>
                    <p><strong>Guests:</strong> <span id="eventGuests"></span></p>
                    <p><strong>Meeting Link:</strong> <a href="#" id="eventMeetingLink" target="_blank">Join Meeting</a></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        $(document).ready(function() {
            $('#calendar').fullCalendar({
                events: '/oauth/calendar/google_events/',  // Fetch Google Calendar events from Django API
                
                eventRender: function(event, element) {
                    element.find('.fc-title').text(event.title);
                },

                eventClick: function(calEvent, jsEvent, view) {
                    var eventId = calEvent.id;  // Google Event ID

                    // Fetch event details via AJAX
                    $.ajax({
                        url: '/oauth/google_event_details/' + eventId + '/',
                        method: 'GET',
                        success: function(data) {
                            // Populate modal fields
                            $('#eventTitle').text(data.title);
                            $('#eventDate').text(moment(data.start).format('MMMM D, YYYY'));
                            $('#eventTime').text(moment(data.start).format('h:mm A') + " - " + moment(data.end).format('h:mm A'));
                            $('#eventLocation').text(data.location || 'No Location');
                            $('#eventDescription').text(data.description || 'No Description');
                            $('#eventOrganizer').text(data.organizer || 'Unknown');
                            $('#eventGuests').text(data.guests ? data.guests.join(', ') : 'No Guests');
                            $('#eventMeetingLink').attr('href', data.meeting_link || '#');

                            // Show the modal
                            $('#eventModal').modal('show');
                        },
                        error: function() {
                            alert('Error fetching event details');
                        }
                    });
                }
            });
        });
    </script>

</body>
</html>
