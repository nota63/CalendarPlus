<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Management | TeamFlow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css">
    <!-- Bootstrap 5 CSS (Latest CDN) -->
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">


</head>

<style>
/* Modal Styles */
 /* Base Styles */
 body {
  font-family: 'Inter', system-ui, -apple-system, sans-serif;
}

/* Modal Backdrop Blur */
.modal-backdrop.show {
  backdrop-filter: blur(8px);
  background-color: rgba(0, 0, 0, 0.2);
  opacity: 1 !important;
}

/* Main Modal Container */
.modal {
  backdrop-filter: blur(12px);
}

/* Modal Content Styling */
.modal-content {
  background: rgba(255, 255, 255, 0.75);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 16px;
  box-shadow: 
    0 8px 32px 0 rgba(31, 38, 135, 0.15),
    0 4px 16px rgba(0, 0, 0, 0.05);
  backdrop-filter: blur(20px);
  transform: scale(0.97);
  transition: all 0.3s ease;
}

.modal.show .modal-content {
  transform: scale(1);
}

/* Modal Header */
.modal-header {
  border-bottom: 1px solid rgba(0, 0, 0, 0.08);
  padding: 1.25rem 2rem;
}

.modal-title {
  font-weight: 600;
  color: #1a1a1a;
  font-size: 1.25rem;
}

/* Modal Body */
.modal-body {
  padding: 1.5rem 2rem;
  color: #4a4a4a;
  line-height: 1.6;
}

/* Modal Footer */
.modal-footer {
  border-top: 1px solid rgba(0, 0, 0, 0.08);
  padding: 1rem 2rem;
  gap: 0.75rem;
}

/* Close Button Customization */
.btn-close {
  opacity: 0.6;
  transition: all 0.2s ease;
  filter: invert(0.3);
}

.btn-close:hover {
  opacity: 1;
  transform: rotate(90deg);
}

/* Custom Button Styles */
.modal-footer .btn {
  padding: 0.625rem 1.5rem;
  border-radius: 8px;
  font-weight: 500;
  transition: all 0.2s ease;
  border: 1px solid transparent;
}

.btn-primary {
  background: rgba(59, 130, 246, 0.9);
  backdrop-filter: blur(4px);
  color: white;
}

.btn-primary:hover {
  background: rgba(59, 130, 246, 1);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
}

.btn-secondary {
  background: rgba(243, 244, 246, 0.9);
  backdrop-filter: blur(4px);
  color: #1f2937;
}

.btn-secondary:hover {
  background: rgba(229, 231, 235, 0.9);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

/* Neuomorphic Effect on Focus */
.modal-content:focus-within {
  box-shadow: 
    0 8px 32px 0 rgba(31, 38, 135, 0.15),
    0 0 0 2px rgba(59, 130, 246, 0.3);
}

/* Responsive Tweaks */
@media (max-width: 576px) {
  .modal-content {
    margin: 0.5rem;
    border-radius: 12px;
  }
}
</style>


<body class="bg-[#f5f6f8] font-inter">
    <!-- Enhanced Sidebar -->
    <div class="fixed left-0 top-0 h-full w-64 bg-white border-r border-[#e5e7eb] p-6 flex flex-col">
        <div class="mb-8">
            <h2 class="text-xl font-bold text-[#2d3436]">Manage Team</h2>
        </div>
        <nav class="flex-1 space-y-1">
            <a href="#" class="flex items-center gap-3 p-2 text-[#636e72] hover:bg-[#f8f9fa] rounded-lg">
                <i class="mdi mdi-view-dashboard text-xl"></i>
                Dashboard
            </a>
            <div class="py-2">
                <div class="text-xs font-medium text-[#636e72] uppercase tracking-wider mb-2">Workspace</div>
                <div class="space-y-1">
                    <a href="#" class="flex items-center gap-3 p-2 bg-[#f1f3f5] text-[#2d3436] rounded-lg">
                        <i class="mdi mdi-account-group text-xl"></i>
                        Team Members
                    </a>
                    <a href="#" class="flex items-center gap-3 p-2 text-[#636e72] hover:bg-[#f8f9fa] rounded-lg">
                        <i class="mdi mdi-calendar-check text-xl"></i>
                        Projects
                    </a>
                    <!-- assign task -->
                     <!-- 🚀 Button to Open Modal -->
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#assignTaskModal">
                        Assign Task
                    </button>

                </div>
            </div>
        </nav>
    </div>

    <main class="ml-64 p-8">
        <!-- Enhanced Header with Breadcrumbs -->
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-3 text-sm text-[#636e72]">
                <a href="{% url 'org_detail' org_id=organization.id %}" class="hover:text-[#2d3436]">{{organization.name}}</a>
                <i class="mdi mdi-chevron-right"></i>
                <a href="#" class="hover:text-[#2d3436]">Teams</a>
                <i class="mdi mdi-chevron-right"></i>
                <span class="text-[#2d3436] font-medium">{{ group.name }}</span>
            </div>
            <div class="flex items-center gap-2">
                <button class="p-2 hover:bg-[#f8f9fa] rounded-lg text-[#636e72]">
                    <i class="mdi mdi-bell-outline text-xl"></i>
                </button>
                <div class="w-8 h-8 bg-[#2d3436] rounded-full"></div>
            </div>
        </div>

        <!-- Group Header Section -->
        <div class="bg-white rounded-xl border border-[#e5e7eb] p-6 mb-6 shadow-sm">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 bg-[#3498db] rounded-xl flex items-center justify-center text-white font-bold text-2xl">
                        {{ group.name|first|upper }}
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-[#2d3436]">{{ group.name }}</h1>
                        <div class="flex items-center gap-2 text-sm text-[#636e72]">
                            <i class="mdi mdi-account-outline"></i>
                            <span>{{ members|length }} members</span>
                            <i class="mdi mdi-clock-outline ml-3"></i>
                            <span>Created {{ group.created_at|date:"M d, Y" }}</span>
                        </div>
                    </div>
                </div>
                <div class="flex gap-3">
                    <a href="{% url 'invite_members_to_group' org_id=organization.id group_id=group.id %}" 
                       class="flex items-center gap-2 bg-[#3498db] hover:bg-[#2980b9] text-white px-4 py-2 rounded-lg transition-all">
                        <i class="mdi mdi-account-plus"></i>
                        Invite Members
                    </a>
                    <div class="relative">
                        <button class="flex items-center gap-2 bg-white hover:bg-[#f8f9fa] text-[#636e72] px-4 py-2 rounded-lg border border-[#e5e7eb] transition-all">
                            <i class="mdi mdi-dots-horizontal"></i>
                        </button>
                        <div class="absolute right-0 mt-1 w-48 bg-white border border-[#e5e7eb] rounded-lg shadow-lg hidden">
                            <a href="{% url 'create_group_event' org_id=organization.id group_id=group.id %}" 
                               class="flex items-center gap-2 px-4 py-2 text-[#636e72] hover:bg-[#f8f9fa]">
                                <i class="mdi mdi-calendar-plus"></i>
                                Create Event
                            </a>
                            <a href="#" class="flex items-center gap-2 px-4 py-2 text-[#636e72] hover:bg-[#f8f9fa]">
                                <i class="mdi mdi-cog-outline"></i>
                                Group Settings
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Members Section with Scroll -->
        <div class="bg-white rounded-xl border border-[#e5e7eb] shadow-sm">
            <div class="p-6 border-b border-[#e5e7eb]">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-[#2d3436]">Members</h3>
                    <div class="flex items-center gap-4">
                        <div class="relative">
                            <input type="text" placeholder="Search members..." 
                                   class="pl-10 pr-4 py-2 w-64 border border-[#e5e7eb] rounded-lg focus:outline-none focus:border-[#3498db] focus:ring-1 focus:ring-[#3498db] text-sm">
                            <i class="mdi mdi-magnify absolute left-3 top-3 text-[#636e72]"></i>
                        </div>
                        <div class="flex items-center gap-2">
                            <button class="p-2 hover:bg-[#f8f9fa] rounded-lg text-[#636e72]">
                                <i class="mdi mdi-filter-variant text-xl"></i>
                            </button>
                            <button class="p-2 hover:bg-[#f8f9fa] rounded-lg text-[#636e72]">
                                <i class="mdi mdi-view-grid-outline text-xl"></i>
                            </button>
                            <button class="p-2 hover:bg-[#f8f9fa] rounded-lg text-[#636e72]">
                                <i class="mdi mdi-format-list-bulleted text-xl"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scrollable Members Area -->
            <div class="h-[calc(100vh-320px)] overflow-y-auto">
                <div class="divide-y divide-[#e5e7eb]">
                    {% for member in members %}
                    <div class="group flex items-center justify-between p-4 hover:bg-[#f8f9fa] transition-colors">
                        <div class="flex items-center gap-4">
                            <div class="relative">
                                <div class="w-10 h-10 bg-[#f1f3f5] rounded-lg flex items-center justify-center text-[#636e72] font-medium">
                                    {{ member.user.username|first|upper }}
                                </div>
                                <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-white"></div>
                            </div>
                            <div>
                                <h4 class="font-medium text-[#2d3436]">{{ member.user.username }}</h4>
                                <p class="text-sm text-[#636e72]">{{ member.user.email }}</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-4">
                            <div class="flex items-center gap-2">
                                <div class="px-3 py-1 rounded-full text-sm font-medium 
                                          {% if member.role == 'Admin' %}bg-red-100 text-red-700
                                          {% else %}bg-[#f1f3f5] text-[#636e72]{% endif %}">
                                    {{ member.role }}
                                </div>
                                <div class="h-2 w-2 rounded-full bg-[#636e72]"></div>
                                <span class="text-sm text-[#636e72]">Last active 2h ago</span>
                            </div>
                            
                            <div class="relative">
                                <button class="text-[#636e72] hover:text-[#2d3436] p-1 rounded-lg hover:bg-[#f1f3f5]">
                                    <i class="mdi mdi-dots-vertical text-xl"></i>
                                </button>
                                <div class="absolute right-0 top-8 hidden group-hover:block w-56 bg-white border border-[#e5e7eb] rounded-lg shadow-lg z-10">
                                    <div class="p-2">
                                        <button class="w-full flex items-center gap-2 px-3 py-2 text-sm text-[#636e72] hover:bg-[#f8f9fa] rounded-md">
                                            <i class="mdi mdi-account-convert"></i>
                                            Change Role
                                        </button>
                                        <button class="w-full flex items-center gap-2 px-3 py-2 text-sm text-[#636e72] hover:bg-[#f8f9fa] rounded-md">
                                            <i class="mdi mdi-shield-account"></i>
                                            Permissions
                                        </button>
                                        <a class="w-full flex items-center gap-2 px-3 py-2 text-sm text-[#636e72] hover:bg-[#f8f9fa] rounded-md" 
                                        href="javascript:void(0);" 
                                        onclick="showMemberDetails({{ member.organization.id }}, {{ member.group.id }}, {{ member.user.id }})">
                                         <i class="mdi mdi-information-outline me-2"></i>
                                         View Details
                                     </a>

                                     <a class="w-full flex items-center gap-2 px-3 py-2 text-sm text-[#636e72] hover:bg-[#f8f9fa] rounded-md" 
                                     href="{% url 'remove_user_from_group' org_id=member.organization.id group_id=member.group.id user_id=member.id %}">
                                      <i class="mdi mdi-trash-can-outline me-2"></i>
                                      Remove Member
                                  </a>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Enhanced Member Details Modal -->
        <div class="fixed inset-0 bg-black bg-opacity-30 hidden" id="memberModal">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-xl w-full max-w-2xl">
                    <div class="p-6 border-b border-[#e5e7eb] flex justify-between items-center">
                        <h3 class="text-lg font-semibold">Member Details</h3>
                        <button onclick="document.getElementById('memberModal').classList.add('hidden')" 
                                class="text-[#636e72] hover:text-[#2d3436] p-1 rounded-lg hover:bg-[#f8f9fa]">
                            <i class="mdi mdi-close text-xl"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        <div class="flex items-start gap-6 mb-6">
                            <div class="w-20 h-20 bg-[#f1f3f5] rounded-xl flex items-center justify-center text-2xl font-bold text-[#636e72]" id="modalAvatar">
                                J
                            </div>
                            <div class="flex-1">
                                <h4 class="text-xl font-semibold text-[#2d3436]" id="modalUsername">John Doe</h4>
                                <div class="flex items-center gap-3 mt-2">
                                    <span class="px-2 py-1 bg-blue-100 text-blue-700 text-sm rounded-full" id="modalRole">Member</span>
                                    <div class="flex items-center gap-1 text-sm text-[#636e72]">
                                        <i class="mdi mdi-clock-outline"></i>
                                        <span id="modalJoinedAt">Joined Jan 12, 2023</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div class="bg-[#f8f9fa] p-4 rounded-lg">
                                    <label class="text-sm text-[#636e72] block mb-2">Contact Information</label>
                                    <div class="space-y-2">
                                        <p class="font-medium text-[#2d3436]" id="modalEmail">john@example.com</p>
                                        <p class="text-sm text-[#636e72]">+1 234 567 890</p>
                                    </div>
                                </div>
                                <div class="bg-[#f8f9fa] p-4 rounded-lg">
                                    <label class="text-sm text-[#636e72] block mb-2">Activity</label>
                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm text-[#2d3436]">Tasks Completed</span>
                                            <span class="text-sm font-medium text-[#3498db]">42</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm text-[#2d3436]">Last Active</span>
                                            <span class="text-sm text-[#636e72]">2 hours ago</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div class="bg-[#f8f9fa] p-4 rounded-lg">
                                    <label class="text-sm text-[#636e72] block mb-2">Permissions</label>
                                    <div class="space-y-2">
                                        <div class="flex items-center gap-2">
                                            <i class="mdi mdi-check-circle text-green-500"></i>
                                            <span class="text-sm text-[#2d3436]">Can create tasks</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="mdi mdi-close-circle text-red-500"></i>
                                            <span class="text-sm text-[#2d3436]">Can delete projects</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-[#f8f9fa] p-4 rounded-lg">
                                    <label class="text-sm text-[#636e72] block mb-2">Groups</label>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="px-2 py-1 bg-[#e5e7eb] text-sm rounded-full">Development</span>
                                        <span class="px-2 py-1 bg-[#e5e7eb] text-sm rounded-full">Design</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</main>
<!-- New modals ---------------------------------------------------------------------------------------------------------------- -->
<!-- Assign Task -->
<!-- 🏆 Bootstrap 5 Task Assignment Modal -->
<div class="modal fade" id="assignTaskModal" tabindex="-1" aria-labelledby="assignTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="assignTaskModalLabel">Assign Task</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- 🚀 Task Fields -->
                <input type="hidden" id="org_id" value="{{ organization.id }}">
                <input type="hidden" id="group_id" value="{{ group.id }}">

                <div class="mb-3">
                    <label class="form-label">Assignee Email</label>
                    <input type="email" class="form-control" id="email" placeholder="Enter user email" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Task Title</label>
                    <input type="text" class="form-control" id="title" placeholder="Task title" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Description</label>
                    <textarea class="form-control" id="description" placeholder="Task description"></textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label">Priority</label>
                    <select class="form-select" id="priority">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Deadline</label>
                    <input type="date" class="form-control" id="deadline" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Start Date</label>
                    <input type="date" class="form-control" id="start_date">
                </div>

                <div class="mb-3">
                    <label class="form-label">End Date</label>
                    <input type="date" class="form-control" id="end_date">
                </div>

                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="is_recurring">
                    <label class="form-check-label">Recurring Task</label>
                </div>

                <div class="mb-3 mt-2">
                    <label class="form-label">Recurrence Pattern</label>
                    <select class="form-select" id="recurrence_pattern">
                        <option value="" selected>None</option>
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Recurrence End Date</label>
                    <input type="date" class="form-control" id="recurrence_end_date">
                </div>

                <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="notify_assignee" checked>
                    <label class="form-check-label">Notify Assignee</label>
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="assignTaskBtn">Assign Task</button>
            </div>
        </div>
    </div>
</div>



<!-- -------------------------------------------------------------------------------------------------------------------------------------------- -->
<!-- Bootstrap 5 JS Bundle (Includes Popper.js) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
        // Initialize interactive elements
        document.querySelectorAll('.relative').forEach(item => {
            item.addEventListener('mouseenter', () => {
                item.querySelector('.hidden')?.classList.remove('hidden');
            });
            item.addEventListener('mouseleave', () => {
                item.querySelector('.hidden')?.classList.add('hidden');
            });
        });

        function showMemberDetails(orgId, groupId, userId) {
            $.ajax({
                url: `/groups/groups/${orgId}/${groupId}/${userId}/group_member_details/`,
                method: 'GET',
                success: function(response) {
                    $('#modalUsername').text(response.username);
                    $('#modalEmail').text(response.email);
                    $('#modalRole').text(response.role);
                    $('#modalJoinedAt').text('Joined ' + response.joined_at);
                    $('#modalAvatar').text(response.username.charAt(0).toUpperCase());
                    $('#memberModal').removeClass('hidden');
                }
            });
        }

        // Close modal when clicking outside
        document.getElementById('memberModal').addEventListener('click', function(e) {
            if(e.target === this) {
                this.classList.add('hidden');
            }
        });

// Assign Task 
// 💖 Assign Task Button Click Event
document.getElementById("assignTaskBtn").addEventListener("click", function() {
    let org_id = document.getElementById("org_id").value;
    let group_id = document.getElementById("group_id").value;
    let email = document.getElementById("email").value;
    let title = document.getElementById("title").value;
    let description = document.getElementById("description").value;
    let priority = document.getElementById("priority").value;
    let deadline = document.getElementById("deadline").value;
    let start_date = document.getElementById("start_date").value || null;
    let end_date = document.getElementById("end_date").value || null;
    let is_recurring = document.getElementById("is_recurring").checked;
    let recurrence_pattern = document.getElementById("recurrence_pattern").value || null;
    let recurrence_end_date = document.getElementById("recurrence_end_date").value || null;
    let notify_assignee = document.getElementById("notify_assignee").checked;

    let requestData = {
        org_id: org_id,
        group_id: group_id,
        email: email,
        title: title,
        description: description,
        priority: priority,
        deadline: deadline,
        start_date: start_date,
        end_date: end_date,
        is_recurring: is_recurring,
        recurrence_pattern: recurrence_pattern,
        recurrence_end_date: recurrence_end_date,
        notify_assignee: notify_assignee
    };

    let apiUrl = `/groups/assign-task/`; // 💖 Replace with your actual endpoint

    fetch(apiUrl, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCookie("csrftoken") // CSRF Token for Django
        },
        body: JSON.stringify(requestData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("✅ Task assigned successfully!");
            location.reload(); // Refresh to update UI
        } else {
            alert("❌ Error: " + data.error);
        }
    })
    .catch(error => {
        console.error("⚠️ Error:", error);
        alert("Something went wrong!");
    });
});

// 🍪 CSRF Token Helper Function (for Django Security)
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        let cookies = document.cookie.split(";");
        for (let i = 0; i < cookies.length; i++) {
            let cookie = cookies[i].trim();
            if (cookie.startsWith(name + "=")) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}




</script>
</body>
</html>