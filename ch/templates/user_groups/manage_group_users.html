<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Group Management | TeamFlow</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@7.2.96/css/materialdesignicons.min.css">
    <!-- Bootstrap 5 CSS (Latest CDN) -->
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Outlined" rel="stylesheet">


</head>

<style>
/* Modal Styles */
 /* Base Styles */
 body {
  font-family: 'Inter', system-ui, -apple-system, sans-serif;
}

/* Modal Backdrop Blur */
.modal-backdrop.show {
  backdrop-filter: blur(8px);
  background-color: rgba(0, 0, 0, 0.2);
  opacity: 1 !important;
}

/* Main Modal Container */
.modal {
  backdrop-filter: blur(12px);
}

/* Modal Content Styling */
.modal-content {
  background: rgba(255, 255, 255, 0.75);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 16px;
  box-shadow: 
    0 8px 32px 0 rgba(31, 38, 135, 0.15),
    0 4px 16px rgba(0, 0, 0, 0.05);
  backdrop-filter: blur(20px);
  transform: scale(0.97);
  transition: all 0.3s ease;
}

.modal.show .modal-content {
  transform: scale(1);
}

/* Modal Header */
.modal-header {
  border-bottom: 1px solid rgba(0, 0, 0, 0.08);
  padding: 1.25rem 2rem;
}

.modal-title {
  font-weight: 600;
  color: #1a1a1a;
  font-size: 1.25rem;
}

/* Modal Body */
.modal-body {
  padding: 1.5rem 2rem;
  color: #4a4a4a;
  line-height: 1.6;
}

/* Modal Footer */
.modal-footer {
  border-top: 1px solid rgba(0, 0, 0, 0.08);
  padding: 1rem 2rem;
  gap: 0.75rem;
}

/* Close Button Customization */
.btn-close {
  opacity: 0.6;
  transition: all 0.2s ease;
  filter: invert(0.3);
}

.btn-close:hover {
  opacity: 1;
  transform: rotate(90deg);
}

/* Custom Button Styles */
.modal-footer .btn {
  padding: 0.625rem 1.5rem;
  border-radius: 8px;
  font-weight: 500;
  transition: all 0.2s ease;
  border: 1px solid transparent;
}

.btn-primary {
  background: rgba(59, 130, 246, 0.9);
  backdrop-filter: blur(4px);
  color: white;
}

.btn-primary:hover {
  background: rgba(59, 130, 246, 1);
  box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2);
}

.btn-secondary {
  background: rgba(243, 244, 246, 0.9);
  backdrop-filter: blur(4px);
  color: #1f2937;
}

.btn-secondary:hover {
  background: rgba(229, 231, 235, 0.9);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
}

/* Neuomorphic Effect on Focus */
.modal-content:focus-within {
  box-shadow: 
    0 8px 32px 0 rgba(31, 38, 135, 0.15),
    0 0 0 2px rgba(59, 130, 246, 0.3);
}

/* Responsive Tweaks */
@media (max-width: 576px) {
  .modal-content {
    margin: 0.5rem;
    border-radius: 12px;
  }
}

/* new styles */
.modal-body::-webkit-scrollbar {
    width: 8px;
}
.modal-body::-webkit-scrollbar-track {
    background: #f1f1f1;
}
.modal-body::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
}
</style>


<body class="bg-[#f5f6f8] font-inter">
    <!-- Enhanced Sidebar -->
    <div class="fixed left-0 top-0 h-full w-64 bg-white border-r border-[#e5e7eb] p-6 flex flex-col">
        <div class="mb-8">
            <h2 class="text-xl font-bold text-[#2d3436]">Manage Team</h2>
        </div>
        <nav class="flex-1 space-y-1">
            <a href="#" class="flex items-center gap-3 p-2 text-[#636e72] hover:bg-[#f8f9fa] rounded-lg">
                <i class="mdi mdi-view-dashboard text-xl"></i>
                Dashboard
            </a>
            <div class="py-2">
                <div class="text-xs font-medium text-[#636e72] uppercase tracking-wider mb-2">Workspace</div>
                <div class="space-y-1">
                    <a href="#" class="flex items-center gap-3 p-2 bg-[#f1f3f5] text-[#2d3436] rounded-lg">
                        <i class="mdi mdi-account-group text-xl"></i>
                        Team Members
                    </a>
                    <a href="#" class="flex items-center gap-3 p-2 text-[#636e72] hover:bg-[#f8f9fa] rounded-lg">
                        <i class="mdi mdi-calendar-check text-xl"></i>
                        Projects
                    </a>
                    <!-- assign task -->
                     <!-- ðŸš€ Button to Open Modal -->
                    <button type="button" class="flex items-center gap-3 p-2 text-[#636e72] hover:bg-[#f8f9fa] rounded-lg" data-bs-toggle="modal" data-bs-target="#assignTaskModal">
                        <i class="mdi mdi-checkbox-marked-circle-outline text-xl"></i>
                        Assign Task
                    </button>
                    <!-- create group event -->
                    <button id="createGroupEventBtn" class="flex items-center gap-3 p-2 text-[#636e72] hover:bg-[#f8f9fa] rounded-lg">
                        <i class="mdi mdi-calendar-plus text-xl"></i> 
                        Create Group Event</button>
                </div>
            </div>
        </nav>
    </div>

    <main class="ml-64 p-8">
        <!-- Enhanced Header with Breadcrumbs -->
        <div class="flex items-center justify-between mb-6">
            <div class="flex items-center gap-3 text-sm text-[#636e72]">
                <a href="{% url 'org_detail' org_id=organization.id %}" class="hover:text-[#2d3436]">{{organization.name}}</a>
                <i class="mdi mdi-chevron-right"></i>
                <a href="#" class="hover:text-[#2d3436]">Teams</a>
                <i class="mdi mdi-chevron-right"></i>
                <span class="text-[#2d3436] font-medium">{{ group.name }}</span>
            </div>
            <div class="flex items-center gap-2">
                <button class="p-2 hover:bg-[#f8f9fa] rounded-lg text-[#636e72]">
                    <i class="mdi mdi-bell-outline text-xl"></i>
                </button>
                <div class="w-8 h-8 bg-[#2d3436] rounded-full"></div>
            </div>
        </div>

        <!-- Group Header Section -->
        <div class="bg-white rounded-xl border border-[#e5e7eb] p-6 mb-6 shadow-sm">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="w-14 h-14 bg-[#3498db] rounded-xl flex items-center justify-center text-white font-bold text-2xl">
                        {{ group.name|first|upper }}
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-[#2d3436]">{{ group.name }}</h1>
                        <div class="flex items-center gap-2 text-sm text-[#636e72]">
                            <i class="mdi mdi-account-outline"></i>
                            <span>{{ members|length }} members</span>
                            <i class="mdi mdi-clock-outline ml-3"></i>
                            <span>Created {{ group.created_at|date:"M d, Y" }}</span>
                        </div>
                    </div>
                </div>
                <div class="flex gap-3">
                  
                    <button type="button" class="flex items-center gap-2 bg-[#3498db] hover:bg-[#2980b9] text-white px-4 py-2 rounded-lg transition-all" data-bs-toggle="modal" data-bs-target="#inviteModal">
                        <i class="mdi mdi-account-plus"></i>
                        Invite Members
                    </button>
                    
                    <div class="relative">
                        <button class="flex items-center gap-2 bg-white hover:bg-[#f8f9fa] text-[#636e72] px-4 py-2 rounded-lg border border-[#e5e7eb] transition-all">
                            <i class="mdi mdi-dots-horizontal"></i>
                        </button>
                        <div class="absolute right-0 mt-1 w-48 bg-white border border-[#e5e7eb] rounded-lg shadow-lg hidden">
                           
            
                            <button type="button" class="flex items-center gap-2 px-4 py-2 text-[#636e72] hover:bg-[#f8f9fa]" data-bs-toggle="modal" data-bs-target="#invitationStatusModal">
                                <i class="mdi mdi-cog-outline"></i>
                                Track Invitations
                            </button>
                            
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Members Section with Scroll -->
        <div class="bg-white rounded-xl border border-[#e5e7eb] shadow-sm">
            <div class="p-6 border-b border-[#e5e7eb]">
                <div class="flex items-center justify-between">
                    <h3 class="text-lg font-semibold text-[#2d3436]">Members</h3>
                    <div class="flex items-center gap-4">
                        <div class="relative">
                            <input type="text" placeholder="Search members..." 
                                   class="pl-10 pr-4 py-2 w-64 border border-[#e5e7eb] rounded-lg focus:outline-none focus:border-[#3498db] focus:ring-1 focus:ring-[#3498db] text-sm">
                            <i class="mdi mdi-magnify absolute left-3 top-3 text-[#636e72]"></i>
                        </div>
                        <div class="flex items-center gap-2">
                            <button class="p-2 hover:bg-[#f8f9fa] rounded-lg text-[#636e72]">
                                <i class="mdi mdi-filter-variant text-xl"></i>
                            </button>
                            <button class="p-2 hover:bg-[#f8f9fa] rounded-lg text-[#636e72]">
                                <i class="mdi mdi-view-grid-outline text-xl"></i>
                            </button>
                            <button class="p-2 hover:bg-[#f8f9fa] rounded-lg text-[#636e72]">
                                <i class="mdi mdi-format-list-bulleted text-xl"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Scrollable Members Area -->
            <div class="h-[calc(100vh-320px)] overflow-y-auto">
                <div class="divide-y divide-[#e5e7eb]">
                    {% for member in members %}
                    <div class="group flex items-center justify-between p-4 hover:bg-[#f8f9fa] transition-colors">
                        <div class="flex items-center gap-4">
                            <div class="relative">
                                <div class="w-10 h-10 bg-[#f1f3f5] rounded-lg flex items-center justify-center text-[#636e72] font-medium">
                                    {{ member.user.username|first|upper }}
                                </div>
                                <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-white"></div>
                            </div>
                            <div>
                                <h4 class="font-medium text-[#2d3436]">{{ member.user.username }}</h4>
                                <p class="text-sm text-[#636e72]">{{ member.user.email }}</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center gap-4">
                            <div class="flex items-center gap-2">
                                <div class="px-3 py-1 rounded-full text-sm font-medium 
                                          {% if member.role == 'Admin' %}bg-red-100 text-red-700
                                          {% else %}bg-[#f1f3f5] text-[#636e72]{% endif %}">
                                    {{ member.role }}
                                </div>
                                <div class="h-2 w-2 rounded-full bg-[#636e72]"></div>
                                <span class="text-sm text-[#636e72]">Last active 2h ago</span>
                            </div>
                            
                            <div class="relative">
                                <button class="text-[#636e72] hover:text-[#2d3436] p-1 rounded-lg hover:bg-[#f1f3f5]">
                                    <i class="mdi mdi-dots-vertical text-xl"></i>
                                </button>
                                <div class="absolute right-0 top-8 hidden group-hover:block w-56 bg-white border border-[#e5e7eb] rounded-lg shadow-lg z-10">
                                    <div class="p-2">
                                        <button class="w-full flex items-center gap-2 px-3 py-2 text-sm text-[#636e72] hover:bg-[#f8f9fa] rounded-md">
                                            <i class="mdi mdi-account-convert"></i>
                                            Change Role
                                        </button>
                                        <button class="w-full flex items-center gap-2 px-3 py-2 text-sm text-[#636e72] hover:bg-[#f8f9fa] rounded-md">
                                            <i class="mdi mdi-shield-account"></i>
                                            Permissions
                                        </button>
                                        <a class="w-full flex items-center gap-2 px-3 py-2 text-sm text-[#636e72] hover:bg-[#f8f9fa] rounded-md" 
                                        href="javascript:void(0);" 
                                        onclick="showMemberDetails({{ member.organization.id }}, {{ member.group.id }}, {{ member.user.id }})">
                                         <i class="mdi mdi-information-outline me-2"></i>
                                         View Details
                                     </a>

                                     <a class="w-full flex items-center gap-2 px-3 py-2 text-sm text-[#636e72] hover:bg-[#f8f9fa] rounded-md" 
                                     href="{% url 'remove_user_from_group' org_id=member.organization.id group_id=member.group.id user_id=member.id %}">
                                      <i class="mdi mdi-trash-can-outline me-2"></i>
                                      Remove Member
                                  </a>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Enhanced Member Details Modal -->
        <div class="fixed inset-0 bg-black bg-opacity-30 hidden" id="memberModal">
            <div class="flex items-center justify-center min-h-screen p-4">
                <div class="bg-white rounded-xl w-full max-w-2xl">
                    <div class="p-6 border-b border-[#e5e7eb] flex justify-between items-center">
                        <h3 class="text-lg font-semibold">Member Details</h3>
                        <button onclick="document.getElementById('memberModal').classList.add('hidden')" 
                                class="text-[#636e72] hover:text-[#2d3436] p-1 rounded-lg hover:bg-[#f8f9fa]">
                            <i class="mdi mdi-close text-xl"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        <div class="flex items-start gap-6 mb-6">
                            <div class="w-20 h-20 bg-[#f1f3f5] rounded-xl flex items-center justify-center text-2xl font-bold text-[#636e72]" id="modalAvatar">
                                J
                            </div>
                            <div class="flex-1">
                                <h4 class="text-xl font-semibold text-[#2d3436]" id="modalUsername">John Doe</h4>
                                <div class="flex items-center gap-3 mt-2">
                                    <span class="px-2 py-1 bg-blue-100 text-blue-700 text-sm rounded-full" id="modalRole">Member</span>
                                    <div class="flex items-center gap-1 text-sm text-[#636e72]">
                                        <i class="mdi mdi-clock-outline"></i>
                                        <span id="modalJoinedAt">Joined Jan 12, 2023</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-6">
                            <div class="space-y-4">
                                <div class="bg-[#f8f9fa] p-4 rounded-lg">
                                    <label class="text-sm text-[#636e72] block mb-2">Contact Information</label>
                                    <div class="space-y-2">
                                        <p class="font-medium text-[#2d3436]" id="modalEmail">john@example.com</p>
                                        <p class="text-sm text-[#636e72]">+1 234 567 890</p>
                                    </div>
                                </div>
                                <div class="bg-[#f8f9fa] p-4 rounded-lg">
                                    <label class="text-sm text-[#636e72] block mb-2">Activity</label>
                                    <div class="space-y-2">
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm text-[#2d3436]">Tasks Completed</span>
                                            <span class="text-sm font-medium text-[#3498db]">42</span>
                                        </div>
                                        <div class="flex items-center justify-between">
                                            <span class="text-sm text-[#2d3436]">Last Active</span>
                                            <span class="text-sm text-[#636e72]">2 hours ago</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div class="bg-[#f8f9fa] p-4 rounded-lg">
                                    <label class="text-sm text-[#636e72] block mb-2">Permissions</label>
                                    <div class="space-y-2">
                                        <div class="flex items-center gap-2">
                                            <i class="mdi mdi-check-circle text-green-500"></i>
                                            <span class="text-sm text-[#2d3436]">Can create tasks</span>
                                        </div>
                                        <div class="flex items-center gap-2">
                                            <i class="mdi mdi-close-circle text-red-500"></i>
                                            <span class="text-sm text-[#2d3436]">Can delete projects</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-[#f8f9fa] p-4 rounded-lg">
                                    <label class="text-sm text-[#636e72] block mb-2">Groups</label>
                                    <div class="flex flex-wrap gap-2">
                                        <span class="px-2 py-1 bg-[#e5e7eb] text-sm rounded-full">Development</span>
                                        <span class="px-2 py-1 bg-[#e5e7eb] text-sm rounded-full">Design</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</main>
<!-- New modals ---------------------------------------------------------------------------------------------------------------- -->
<!-- Assign Task -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<!-- Modern Task Assignment Modal -->
<div class="modal fade" id="assignTaskModal" tabindex="-1" aria-labelledby="assignTaskModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered max-w-3xl">
        <div class="modal-content rounded-xl">
            <!-- Header -->
            <div class="modal-header p-6 border-b border-gray-200">
                <div class="flex items-center justify-between w-full">
                    <h3 class="text-xl font-semibold text-gray-900">Assign New Task</h3>
                    <button type="button" class="p-2 hover:bg-gray-100 rounded-lg" data-bs-dismiss="modal">
                        <i class="mdi mdi-close text-xl text-gray-500"></i>
                    </button>
                </div>
            </div>

            <!-- Body -->
            <div class="modal-body p-6 space-y-6">
                <input type="hidden" id="org_id" value="{{ organization.id }}">
                <input type="hidden" id="group_id" value="{{ group.id }}">

                <!-- Assignee Section -->
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            Assignee Email
                            <span class="text-gray-400 font-normal">(Required)</span>
                        </label>
                        <input type="email" id="email" 
                               class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                               placeholder="team.member@company.com">
                        <p class="mt-2 text-sm text-gray-500">User must be a group member</p>
                    </div>

                    <!-- Task Details Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Left Column -->
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Task Title
                                    <span class="text-gray-400 font-normal">(Required)</span>
                                </label>
                                <input type="text" id="title" 
                                       class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                       placeholder="e.g., Update Marketing Strategy">
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Description
                                </label>
                                <textarea id="description" rows="3"
                                          class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                          placeholder="Add detailed task description..."></textarea>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Task Priority
                                </label>
                                <select id="priority" 
                                        class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="low" class="text-green-600">Low</option>
                                    <option value="medium" selected class="text-yellow-600">Medium</option>
                                    <option value="high" class="text-red-600">High</option>
                                </select>
                            </div>
                        </div>

                        <!-- Right Column -->
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    Deadline
                                    <span class="text-gray-400 font-normal">(Required)</span>
                                </label>
                                <input type="date" id="deadline" 
                                       class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>

                            <!-- Date Range -->
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Start Date
                                    </label>
                                    <input type="date" id="start_date" 
                                           class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        End Date
                                    </label>
                                    <input type="date" id="end_date" 
                                           class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>

                            <!-- Recurrence Section -->
                            <div class="pt-4 border-t border-gray-200 space-y-4">
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" id="is_recurring" 
                                           class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                    <label class="text-sm font-medium text-gray-700">
                                        Recurring Task
                                    </label>
                                </div>

                                <div id="recurrenceOptions" class="space-y-4 hidden">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            Recurrence Pattern
                                        </label>
                                        <select id="recurrence_pattern" 
                                                class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                            <option value="daily">Daily</option>
                                            <option value="weekly">Weekly</option>
                                            <option value="monthly">Monthly</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">
                                            End Recurrence
                                        </label>
                                        <input type="date" id="recurrence_end_date" 
                                               class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Notification Settings -->
                <div class="flex items-center gap-3 pt-4 border-t border-gray-200">
                    <input type="checkbox" id="notify_assignee" 
                           class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500" checked>
                    <div>
                        <label class="text-sm font-medium text-gray-700">
                            Send Notification
                        </label>
                        <p class="text-sm text-gray-500">Email notification will be sent to the assignee</p>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="modal-footer p-6 border-t border-gray-200 flex justify-end gap-3">
                <button type="button" 
                        class="px-6 py-2.5 text-gray-700 bg-white hover:bg-gray-50 border border-gray-300 rounded-lg transition-colors"
                        data-bs-dismiss="modal">
                    Cancel
                </button>
                <button type="button" id="assignTaskBtn"
                        class="px-6 py-2.5 text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors shadow-sm">
                    Assign Task
                    <span id="submitSpinner" class="spinner-border spinner-border-sm" role="status" aria-hidden="true" style="display:none;"></span>
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    // Toggle recurrence options visibility
    document.getElementById('is_recurring').addEventListener('change', function(e) {
        const recurrenceOptions = document.getElementById('recurrenceOptions');
        recurrenceOptions.classList.toggle('hidden', !e.target.checked);
    });
</script>

<!-- Create Group Event  -->
<!-- Create Group Event Modal -->
<div class="modal fade" id="createGroupEventModal" tabindex="-1" aria-labelledby="createGroupEventModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content rounded-xl shadow-2xl border-0">
            <!-- Header Section -->
            <div class="modal-header bg-gradient-to-r from-blue-50 to-indigo-50 px-6 py-4 border-b border-gray-200">
                <div class="flex items-center justify-between w-full">
                    <div>
                        <h3 class="modal-title text-2xl font-bold text-gray-800 font-sans" id="createGroupEventModalLabel">
                            Create Group Event
                        </h3>
                        <p class="text-sm text-gray-500 mt-1">Schedule a new group meeting or session</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <button id="fetchEventsBtn" data-bs-toggle="modal" data-bs-target="#eventModal"
                                class="btn btn-outline-secondary flex items-center text-sm px-4 py-2 rounded-lg border border-gray-300 hover:border-gray-400">
                            <span class="material-icons-outlined text-base mr-2">list_alt</span>
                            View Events
                        </button>
                        <button type="button" 
                                class="p-2 hover:bg-gray-100 rounded-full transition-colors"
                                data-bs-dismiss="modal" 
                                aria-label="Close">
                            <span class="material-icons-outlined text-gray-500">close</span>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Form Content -->
            <div class="modal-body overflow-y-auto max-h-[calc(100vh-10rem)] px-6 py-4">
                <form id="createGroupEventForm" class="space-y-5">
                    <!-- Event Title -->
                    <div>
                        <label for="eventTitle" class="block text-sm font-medium text-gray-700 mb-1">
                            Event Title <span class="text-red-500">*</span>
                        </label>
                        <div class="relative">
                            <input type="text" 
                                   id="eventTitle" 
                                   class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 placeholder-gray-400"
                                   placeholder="Team Sync Meeting"
                                   required>
                            <span class="material-icons-outlined absolute right-3 top-3 text-gray-400">title</span>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Maximum 60 characters</p>
                    </div>

                    <!-- Description -->
                    <div>
                        <label for="eventDescription" class="block text-sm font-medium text-gray-700 mb-1">
                            Description
                        </label>
                        <textarea id="eventDescription" 
                                  class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 placeholder-gray-400"
                                  rows="3"
                                  placeholder="Add meeting agenda and important details"></textarea>
                    </div>

                    <!-- Date & Time Section -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <!-- Event Date -->
                        <div>
                            <label for="eventDate" class="block text-sm font-medium text-gray-700 mb-1">
                                Date <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <input type="date" 
                                       id="eventDate" 
                                       class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                       required>
                                <span class="material-icons-outlined absolute right-3 top-3 text-gray-400">calendar_today</span>
                            </div>
                        </div>

                        <!-- Start Time -->
                        <div>
                            <label for="eventStartTime" class="block text-sm font-medium text-gray-700 mb-1">
                                Start Time <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <input type="time" 
                                       id="eventStartTime" 
                                       class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                       required>
                                <span class="material-icons-outlined absolute right-3 top-3 text-gray-400">schedule</span>
                            </div>
                        </div>

                        <!-- End Time -->
                        <div>
                            <label for="eventEndTime" class="block text-sm font-medium text-gray-700 mb-1">
                                End Time <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <input type="time" 
                                       id="eventEndTime" 
                                       class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                       required>
                                <span class="material-icons-outlined absolute right-3 top-3 text-gray-400">timer_off</span>
                            </div>
                        </div>
                    </div>

                    <!-- Location & Meeting Link -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Location -->
                        <div>
                            <label for="eventLocation" class="block text-sm font-medium text-gray-700 mb-1">
                                Location <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <input type="text" 
                                       id="eventLocation" 
                                       list="locationOptions"
                                       class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 placeholder-gray-400"
                                       placeholder="Select or type location"
                                       required>
                                <datalist id="locationOptions">
                                    <!-- Options remain same as original -->
                                    <option value="Zoom">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-camera-video" viewBox="0 0 16 16">
                                          <path d="M8 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1h5z"/>
                                          <path d="M14 4v8l3-4-3-4z"/>
                                        </svg> Zoom
                                      </option>
                                      <option value="Google Meet">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-google" viewBox="0 0 16 16">
                                          <path d="M8.293 3.293a1 1 0 0 1 1.414 0L14 7.586a1 1 0 0 1 0 1.414L9.707 13.707a1 1 0 0 1-1.414-1.414L11.586 9H3a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h8.586L8.293 3.293z"/>
                                        </svg> Google Meet
                                      </option>
                                      <option value="Organization">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-house-door" viewBox="0 0 16 16">
                                          <path d="M6.5 0a.5.5 0 0 1 .5.5v2.4l4-2.5a.5.5 0 0 1 .8.4v10a.5.5 0 0 1-.8.4l-4-2.5v2.4a.5.5 0 0 1-.5.5h-5a.5.5 0 0 1-.5-.5V7.5a.5.5 0 0 1 .5-.5h3V2.5a.5.5 0 0 1 .5-.5z"/>
                                        </svg> Organization
                                      </option>
                                      <option value="Salesforce">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cloud" viewBox="0 0 16 16">
                                          <path d="M9.5 2a4.5 4.5 0 0 1 4.5 4.5c0 1.5-.75 2.825-1.875 3.625a4.5 4.5 0 0 1-5.75 6.25c-1.244 0-2.356-.532-3.187-1.385a5.5 5.5 0 0 1-7.092-8.49A4.5 4.5 0 0 1 5.5 2h4z"/>
                                        </svg> Salesforce
                                      </option>
                                      <option value="Microsoft Teams">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-file-earmark-text" viewBox="0 0 16 16">
                                          <path d="M10.5 0a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-.5.5h-4a.5.5 0 0 1-.5-.5V.5a.5.5 0 0 1 .5-.5h4z"/>
                                          <path d="M12 3a3 3 0 0 1 3 3v9a3 3 0 0 1-3 3H4a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3h8z"/>
                                        </svg> Microsoft Teams
                                      </option>
                                      <option value="Skype">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-telephone" viewBox="0 0 16 16">
                                          <path d="M1 3.5a1 1 0 0 1 1-1h3a1 1 0 0 1 1 1v3a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-3z"/>
                                          <path d="M6.84 0C5.462 0 4.167.49 3.23 1.352l-.5.5C2.14 2.566 2 3.082 2 3.5v5c0 .418.14.934.23 1.148l.5.5C4.167 10.51 5.462 11 6.84 11h2.32c1.378 0 2.673-.49 3.61-1.352l.5-.5c.09-.214.23-.73.23-1.148v-5c0-.418-.14-.934-.23-1.148l-.5-.5C9.51.49 8.215 0 6.84 0z"/>
                                        </svg> Skype
                                      </option>
                                      <option value="Webex">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-repeat" viewBox="0 0 16 16">
                                          <path d="M8 1a7 7 0 1 0 0 14 7 7 0 0 0 0-14zM8 0a8 8 0 1 1 0 16A8 8 0 0 1 8 0z"/>
                                        </svg> Webex
                                      </option>
                                      <option value="Slack">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-slack" viewBox="0 0 16 16">
                                          <path d="M3.004 2.295A1 1 0 0 0 2.288 2.83a.5.5 0 0 1 .004.537l1.04 1.76a.5.5 0 0 1-.015.53l-.842 1.402a.5.5 0 0 1-.533.196l-.44-.256a.5.5 0 0 0-.661.007L.858 9.108a1 1 0 0 0 .04 1.475l5.323 3.078A.5.5 0 0 1 6 13h7a.5.5 0 0 1 .36-.84L14.1 11.358a1 1 0 0 0-.04-1.475l-5.304-3.07a.5.5 0 0 0-.661-.007l-.44.256a.5.5 0 0 1-.533-.196l-.841-1.402a.5.5 0 0 1-.015-.53l1.04-1.76a.5.5 0 0 1 .004-.537A1 1 0 0 0 8.162.36l-3.58 2.093z"/>
                                        </svg> Slack
                                      </option>
                    
                                </datalist>
                                <span class="material-icons-outlined absolute right-3 top-3 text-gray-400">location_on</span>
                            </div>
                        </div>

                        <!-- Meeting Link -->
                        <div>
                            <label for="meetingLink" class="block text-sm font-medium text-gray-700 mb-1">
                                Meeting Link <span class="text-red-500">*</span>
                            </label>
                            <div class="relative">
                                <input type="url" 
                                       id="meetingLink" 
                                       class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 placeholder-gray-400"
                                       placeholder="https://"
                                       required>
                                <span class="material-icons-outlined absolute right-3 top-3 text-gray-400">link</span>
                            </div>
                        </div>
                    </div>

                    <!-- Slots & Recurrence -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Slots -->
                        <div>
                            <label for="eventSlots" class="block text-sm font-medium text-gray-700 mb-1">
                                Available Slots
                            </label>
                            <div class="relative">
                                <input type="number" 
                                       id="eventSlots" 
                                       value="0"
                                       class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                       min="0">
                                <span class="material-icons-outlined absolute right-3 top-3 text-gray-400">people_alt</span>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Configure the seats in the event</p>
                        </div>

                        <!-- Recurrence Type -->
                        <div>
                            <label for="recurrenceType" class="block text-sm font-medium text-gray-700 mb-1">
                                Recurrence
                            </label>
                            <div class="relative">
                                <select id="recurrenceType" 
                                        class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 appearance-none bg-no-repeat">
                                    <option value="none">No recurrence</option>
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="bi-weekly">Bi-Weekly</option>
                                    <option value="monthly">Monthly</option>
                                    <option value="yearly">Yearly</option>
                                </select>
                                <span class="material-icons-outlined absolute right-3 top-3 text-gray-400 pointer-events-none">arrow_drop_down</span>
                            </div>
                        </div>
                    </div>

                    <!-- Recurrence Details -->
                    <div class="space-y-4" id="recurrenceDetails" style="display: none;">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <!-- End Date -->
                            <div id="recurrenceEndDateGroup">
                                <label for="recurrenceEndDate" class="block text-sm font-medium text-gray-700 mb-1">
                                    End Date
                                </label>
                                <div class="relative">
                                    <input type="date" 
                                           id="recurrenceEndDate" 
                                           class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <span class="material-icons-outlined absolute right-3 top-3 text-gray-400">event_available</span>
                                </div>
                            </div>

                            <!-- Days -->
                            <div id="recurrenceDaysGroup">
                                <label for="recurrenceDays" class="block text-sm font-medium text-gray-700 mb-1">
                                    Specific Days
                                </label>
                                <input type="text" 
                                       id="recurrenceDays" 
                                       class="w-full px-4 py-2.5 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                       placeholder="E.g. Monday, Wednesday">
                            </div>
                        </div>
                    </div>
                </form>
            </div>

            <!-- Footer -->
            <div class="modal-footer bg-gray-50 px-6 py-4 border-t border-gray-200">
                <div class="flex items-center justify-between w-full">
                    <button type="button" 
                            class="btn btn-outline-gray flex items-center px-5 py-2.5 rounded-lg border border-gray-300 hover:border-gray-400 text-gray-700"
                            data-bs-dismiss="modal">
                        <span class="material-icons-outlined text-base mr-2">close</span>
                        Cancel
                    </button>
                    <button type="button" 
                            id="submitGroupEventBtn" 
                            class="btn btn-primary bg-blue-600 hover:bg-blue-700 text-white flex items-center px-5 py-2.5 rounded-lg transition-all">
                        <span class="material-icons-outlined text-base mr-2">event_add</span>
                        Create Event
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Manage The Events -->

<!-- Modal 1: Group Events List -->
<div class="modal fade" id="eventModal" tabindex="-1" aria-labelledby="eventModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered max-w-xl">
        <div class="modal-content rounded-xl shadow-2xl">
            <!-- Header -->
            <div class="modal-header p-6 pb-4 border-b border-gray-200">
                <div class="flex items-center justify-between w-full">
                    <h3 class="text-xl font-semibold text-gray-900">
                        <i class="mdi mdi-calendar-multiple text-blue-600 mr-2"></i>
                        Group Events
                    </h3>
                    <button type="button" 
                            class="p-2 hover:bg-gray-100 rounded-lg text-gray-500"
                            data-bs-dismiss="modal">
                        <i class="mdi mdi-close text-xl"></i>
                    </button>
                </div>
            </div>

            <!-- Body with Scrollable Content -->
            <div class="modal-body p-6">
                <!-- Action Bar -->
                <div class="flex items-center justify-between mb-6">
                    <button id="createGroupEventBtn" 
                            class="flex items-center gap-2 px-4 py-2.5 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-all">
                        <i class="mdi mdi-plus-circle-outline text-lg"></i>
                        Create Group Event
                    </button>
                    
                    <div class="flex items-center gap-2 text-sm text-gray-500">
                        <i class="mdi mdi-information-outline text-blue-500"></i>
                        <span>Tap event row to view bookings</span>
                    </div>
                </div>

                <!-- Scrollable Event List -->
                <ul id="event-list" class="space-y-2 max-h-[calc(100vh-12rem)] overflow-y-auto pr-4">
                    <!-- List items will maintain original structure -->
                    <!-- Sample Event Item -->
                    <li class="group flex items-center justify-between p-3 hover:bg-gray-50 rounded-lg cursor-pointer transition-colors border border-gray-100">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-green-500 rounded-full"></div>
                                <h4 class="font-medium text-gray-900 truncate">Team Planning Session</h4>
                            </div>
                            <div class="flex items-center gap-3 mt-1 text-sm text-gray-500">
                                <span class="flex items-center gap-1.5">
                                    <i class="mdi mdi-calendar-blank text-gray-400"></i>
                                    2023-08-15
                                </span>
                                <span class="text-gray-300">â€¢</span>
                                <span class="flex items-center gap-1.5">
                                    <i class="mdi mdi-clock-outline text-gray-400"></i>
                                    14:00 - 16:00
                                </span>
                            </div>
                        </div>
                        <i class="mdi mdi-chevron-right text-gray-400 group-hover:text-blue-600 transition-colors"></i>
                    </li>
                    <!-- Repeat list items as needed -->
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Modal 2 for displaying Booking Details -->
<div class="modal fade" id="bookingDetailsModal" tabindex="-1" aria-labelledby="bookingDetailsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered max-w-xl">
        <div class="modal-content rounded-xl shadow-2xl">
            <!-- Header -->
            <div class="modal-header p-6 pb-4 border-b border-gray-200">
                <div class="flex items-center justify-between w-full">
                    <h3 class="text-xl font-semibold text-gray-900 flex items-center gap-2">
                        <i class="mdi mdi-calendar-check text-blue-600"></i>
                        Booking Details
                    </h3>
                    <button type="button" 
                            class="p-2 hover:bg-gray-100 rounded-lg text-gray-500"
                            data-bs-dismiss="modal">
                        <i class="mdi mdi-close text-xl"></i>
                    </button>
                </div>
            </div>

            <!-- Body -->
            <div class="modal-body p-6">
                <!-- Helper Text -->
                <div class="flex items-center gap-2 text-sm text-gray-500 mb-4">
                    <i class="mdi mdi-information-outline text-blue-500"></i>
                    <span>Bookings are listed here for the event</span>
                </div>

                <!-- Scrollable Booking List -->
                <ul id="booking-list" class="space-y-3 max-h-[60vh] overflow-y-auto pr-4">
                    <!-- Sample Booking Item -->
                    <li class="group flex items-start gap-4 p-3 hover:bg-gray-50 rounded-lg transition-colors border border-gray-100">
                        <!-- Profile Picture -->
                        <div class="relative">
                            <img src="profile-placeholder.jpg" 
                                 class="w-10 h-10 rounded-full border-2 border-white shadow-sm">
                            <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-white"></div>
                        </div>
                        
                        <!-- Booking Details -->
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center justify-between gap-2">
                                <h4 class="font-medium text-gray-900 truncate">John Doe</h4>
                                <span class="px-2 py-1 text-xs font-medium bg-green-100 text-green-700 rounded-full">
                                    Confirmed
                                </span>
                            </div>
                            <div class="mt-1.5 text-sm text-gray-500">
                                <div class="flex items-center gap-2">
                                    <i class="mdi mdi-calendar-blank text-gray-400"></i>
                                    <span>Booked on 2023-08-15 at 14:00</span>
                                </div>
                            </div>
                        </div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- Invite Team-mates into the group -->
<div class="modal fade" id="inviteModal" tabindex="-1" aria-labelledby="inviteModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content rounded-xl shadow-2xl">
            <!-- Header Section -->
            <div class="modal-header px-6 py-4 border-b border-gray-100">
                <div class="flex items-center justify-between w-full">
                    <div>
                        <h5 class="modal-title text-xl font-semibold text-gray-900" id="inviteModalLabel">Invite to {{group.name}}</h5>
                        <p class="text-sm text-gray-500 mt-1">Collaborate with your team members</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <button type="button" class="btn btn-light px-3 py-2 text-gray-600 hover:bg-gray-50 rounded-lg flex items-center gap-2 transition-all" data-bs-toggle="modal" data-bs-target="#invitationStatusModal">
                            <i class="mdi mdi-clock-outline text-lg"></i>
                            Invitation History
                        </button>
                        <button type="button" class="btn-close p-2" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="modal-body p-6">
                <form id="inviteForm">
                    <input type="hidden" name="csrfmiddlewaretoken" value="{{ csrf_token }}">
                    
                    <!-- Email Input Section -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Invite by Email</label>
                        <div class="email-input-container relative p-3 border-2 border-gray-200 rounded-lg hover:border-blue-500 transition-colors">
                            <div class="flex flex-wrap gap-2" id="emailTagsContainer">
                                <div class="email-tag bg-blue-50 text-blue-800 px-3 py-1 rounded-full flex items-center gap-2">
                                    <img src="placeholder-user.jpg" class="w-5 h-5 rounded-full" alt="">
                                    user@example.com
                                    <button type="button" class="remove-email text-blue-600 hover:text-blue-800">Ã—</button>
                                </div>
                            </div>
                            <input type="text" 
                                   class="flex-1 min-w-[200px] border-0 focus:ring-0 p-1 text-sm" 
                                   id="emailInput" 
                                   placeholder="Enter emails or paste multiple..."
                                   data-role="tagsinput">
                            <div class="absolute top-2 right-2 flex items-center gap-2">
                                <button type="button" class="text-gray-400 hover:text-blue-600" title="Import from CSV">
                                    <i class="mdi mdi-file-import-outline text-lg"></i>
                                </button>
                                <button type="button" class="text-gray-400 hover:text-blue-600" title="Recent contacts">
                                    <i class="mdi mdi-clock-outline text-lg"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Role Selection -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">Select Role</label>
                        <div class="grid grid-cols-3 gap-4">
                            <div class="role-card p-4 border rounded-lg cursor-pointer hover:border-blue-500 transition-all">
                                <div class="flex items-center gap-3">
                                    <i class="mdi mdi-shield-account-outline text-blue-600 text-xl"></i>
                                    <div>
                                        <h6 class="font-medium text-gray-900">Admin</h6>
                                        <p class="text-sm text-gray-500">Full access</p>
                                    </div>
                                </div>
                            </div>
                            <div class="role-card p-4 border rounded-lg cursor-pointer hover:border-blue-500 transition-all">
                                <div class="flex items-center gap-3">
                                    <i class="mdi mdi-account-group-outline text-purple-600 text-xl"></i>
                                    <div>
                                        <h6 class="font-medium text-gray-900">Member</h6>
                                        <p class="text-sm text-gray-500">Limited access</p>
                                    </div>
                                </div>
                            </div>
                            <div class="role-card p-4 border rounded-lg cursor-pointer hover:border-blue-500 transition-all">
                                <div class="flex items-center gap-3">
                                    <i class="mdi mdi-eye-outline text-green-600 text-xl"></i>
                                    <div>
                                        <h6 class="font-medium text-gray-900">Guest</h6>
                                        <p class="text-sm text-gray-500">View-only</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Permissions Section -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">Permissions</label>
                        <div class="space-y-2">
                            <label class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded">
                                <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600">
                                <span class="text-sm">Can create tasks</span>
                            </label>
                            <label class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded">
                                <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600">
                                <span class="text-sm">Can edit workspace settings</span>
                            </label>
                            <label class="flex items-center gap-3 p-2 hover:bg-gray-50 rounded">
                                <input type="checkbox" class="form-checkbox h-4 w-4 text-blue-600">
                                <span class="text-sm">Can manage members</span>
                            </label>
                        </div>
                    </div>

                    <!-- Recent Contacts -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-3">Recent Collaborators</label>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="contact-item flex items-center gap-3 p-2 hover:bg-gray-50 rounded cursor-pointer">
                                {% if profile_picture %}
                                <img src="{{profile_picture.url}}" class="w-8 h-8 rounded-full" alt="">
                                {% endif %}
                                <div>
                                    <h6 class="text-sm font-medium">{{username.username}}</h6>
                                    <!-- <p class="text-xs text-gray-500">{{email}}</p> -->
                                </div>
                                <input type="checkbox" class="ml-auto form-checkbox h-4 w-4 text-blue-600">
                            </div>
                            <!-- Repeat contact items -->
                        </div>
                    </div>

                    <!-- Custom Message -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Custom Message</label>
                        <textarea class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-blue-500" 
                                  rows="3" 
                                  placeholder="Add a personal message..."></textarea>
                    </div>

                    <!-- Footer Actions -->
                    <div class="modal-footer bg-gray-50 px-6 py-4 border-t border-gray-100">
                        <div class="flex items-center justify-between w-full">
                            <div class="text-sm text-gray-500">
                                <i class="mdi mdi-information-outline mr-2"></i>
                                Invitations expire in 7 days
                            </div>
                            <div class="flex gap-3">
                                <button type="button" class="btn btn-light px-5 py-2 rounded-lg">Preview Invite</button>
                                <button type="submit" class="btn btn-primary px-5 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white">
                                    Send Invites
                                    <i class="mdi mdi-send-outline ml-2"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </form>

                <!-- Loading State -->
                <div id="loading" class="absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center hidden">
                    <div class="text-center">
                        <div class="spinner-border text-blue-600 w-12 h-12" role="status"></div>
                        <p class="mt-3 text-gray-600">Sending invitations...</p>
                    </div>
                </div>

                <!-- Response Messages -->
                <div id="responseMessages" class="mt-4 space-y-2"></div>
            </div>
        </div>
    </div>
</div>

<!-- Track Invitations (Updated) -->
<div class="modal fade" id="invitationStatusModal" tabindex="-1" aria-labelledby="invitationStatusModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content rounded-xl shadow-2xl">
            <!-- Header -->
            <div class="modal-header px-6 py-4 border-b border-gray-100">
                <div class="flex items-center justify-between w-full">
                    <div>
                        <h5 class="modal-title text-xl font-semibold text-gray-900">Invitation Manager</h5>
                        <p class="text-sm text-gray-500 mt-1">Track invitation status and manage requests</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="relative">
                            <input type="search" 
                                   class="form-control pl-10 pr-4 py-2 border-gray-200 rounded-lg" 
                                   placeholder="Search invites...">
                            <i class="mdi mdi-magnify absolute left-3 top-2.5 text-gray-400"></i>
                        </div>
                        <button type="button" class="btn-close p-2" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                </div>
            </div>

            <!-- Body Content -->
            <div class="modal-body p-6">
                <!-- Status Filters -->
                <div class="flex items-center gap-3 mb-6">
                    <span class="text-sm font-medium text-gray-700">Filter by:</span>
                    <div class="status-filters flex gap-2">
                        <button class="px-3 py-1 rounded-full bg-blue-100 text-blue-800 text-sm font-medium hover:bg-blue-200 transition-colors">
                            All {{total_invitations}}
                        </button>
                        <button class="px-3 py-1 rounded-full bg-yellow-100 text-yellow-800 text-sm font-medium hover:bg-yellow-200 transition-colors">
                            Pending ({{pending_count}})
                        </button>
                        <button class="px-3 py-1 rounded-full bg-green-100 text-green-800 text-sm font-medium hover:bg-green-200 transition-colors">
                            Accepted ({{accepted_count}})
                        </button>
                        <button class="px-3 py-1 rounded-full bg-red-100 text-red-800 text-sm font-medium hover:bg-red-200 transition-colors">
                            Rejected ({{rejected_count}})
                        </button>
                    </div>
                </div>

                <!-- Invitations List -->
                <div class="space-y-4" id="invitationsContainer">
                    <!-- Invitation Item -->
                    <div class="invitation-item flex items-center justify-between p-4 border rounded-lg hover:border-blue-200 transition-all">
                        <div class="flex items-center gap-4">
                            <div class="avatar">
                                <img src="user-avatar.jpg" class="w-10 h-10 rounded-full" alt="User avatar">
                            </div>
                            <div>
                                <h6 class="font-medium text-gray-900">john@company.com</h6>
                                <div class="flex items-center gap-2 mt-1">
                                    <span class="text-xs px-2 py-1 bg-blue-100 text-blue-800 rounded-full">Workspace Admin</span>
                                    <span class="text-xs text-gray-500">Invited 2 days ago</span>
                                </div>
                            </div>
                        </div>
                        <div class="flex items-center gap-4">
                            <span class="status-badge px-3 py-1 rounded-full bg-yellow-100 text-yellow-800 text-sm">Pending</span>
                            <div class="dropdown">
                                <button class="btn btn-icon text-gray-400 hover:text-gray-600" type="button" data-bs-toggle="dropdown">
                                    <i class="mdi mdi-dots-vertical"></i>
                                </button>
                                <ul class="dropdown-menu shadow-lg">
                                    <li><a class="dropdown-item" href="#"><i class="mdi mdi-email-outline mr-2"></i>Resend Invite</a></li>
                                    <li><a class="dropdown-item text-red-600" href="#"><i class="mdi mdi-delete-outline mr-2"></i>Revoke Access</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- More invitation items... -->
                </div>

                <!-- Loading Overlay -->
                <div id="loading" class="absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center hidden">
                    <div class="text-center">
                        <div class="spinner-border text-blue-600 w-12 h-12" role="status"></div>
                        <p class="mt-3 text-gray-600">Loading invitations...</p>
                    </div>
                </div>

                <!-- Empty State -->
                <div class="empty-state text-center py-12 hidden">
                    <i class="mdi mdi-email-remove-outline text-4xl text-gray-300 mb-4"></i>
                    <h5 class="text-gray-700 font-medium">No pending invitations</h5>
                    <p class="text-gray-500 mt-1">All your invitations have been responded to</p>
                </div>

                <!-- Pagination -->
                <div class="mt-6 flex items-center justify-between">
                    <span class="text-sm text-gray-500">Showing 1-10 of 25 invitations</span>
                    <div class="flex gap-2">
                        <button class="btn btn-icon text-gray-500 hover:bg-gray-50 rounded">
                            <i class="mdi mdi-chevron-left"></i>
                        </button>
                        <button class="btn btn-icon text-gray-500 hover:bg-gray-50 rounded">
                            <i class="mdi mdi-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<!-- -------------------------------------------------------------------------------------------------------------------------------------------- -->
<!-- Bootstrap 5 JS Bundle (Includes Popper.js) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
        // Initialize interactive elements
        document.querySelectorAll('.relative').forEach(item => {
            item.addEventListener('mouseenter', () => {
                item.querySelector('.hidden')?.classList.remove('hidden');
            });
            item.addEventListener('mouseleave', () => {
                item.querySelector('.hidden')?.classList.add('hidden');
            });
        });

        function showMemberDetails(orgId, groupId, userId) {
            $.ajax({
                url: `/groups/groups/${orgId}/${groupId}/${userId}/group_member_details/`,
                method: 'GET',
                success: function(response) {
                    $('#modalUsername').text(response.username);
                    $('#modalEmail').text(response.email);
                    $('#modalRole').text(response.role);
                    $('#modalJoinedAt').text('Joined ' + response.joined_at);
                    $('#modalAvatar').text(response.username.charAt(0).toUpperCase());
                    $('#memberModal').removeClass('hidden');
                }
            });
        }

        // Close modal when clicking outside
        document.getElementById('memberModal').addEventListener('click', function(e) {
            if(e.target === this) {
                this.classList.add('hidden');
            }
        });

// Assign Task 
// Assign Task 
// ðŸ’– Assign Task Button Click Event
document.getElementById("assignTaskBtn").addEventListener("click", function() {
    let org_id = document.getElementById("org_id").value;
    let group_id = document.getElementById("group_id").value;
    let email = document.getElementById("email").value;
    let title = document.getElementById("title").value;
    let description = document.getElementById("description").value;
    let priority = document.getElementById("priority").value;
    let deadline = document.getElementById("deadline").value;
    let start_date = document.getElementById("start_date").value || null;
    let end_date = document.getElementById("end_date").value || null;
    let is_recurring = document.getElementById("is_recurring").checked;
    let recurrence_pattern = document.getElementById("recurrence_pattern").value || null;
    let recurrence_end_date = document.getElementById("recurrence_end_date").value || null;
    let notify_assignee = document.getElementById("notify_assignee").checked;

    let requestData = {
        org_id: org_id,
        group_id: group_id,
        email: email,
        title: title,
        description: description,
        priority: priority,
        deadline: deadline,
        start_date: start_date,
        end_date: end_date,
        is_recurring: is_recurring,
        recurrence_pattern: recurrence_pattern,
        recurrence_end_date: recurrence_end_date,
        notify_assignee: notify_assignee
    };

    let apiUrl = `/groups/assign-task/`; // ðŸ’– Replace with your actual endpoint

    // Get the submit button and spinner elements
    let submitBtn = document.getElementById("assignTaskBtn");
    let spinner = document.getElementById("submitSpinner");

    // Show the spinner and disable the button to prevent multiple submissions
    submitBtn.disabled = true;
    spinner.style.display = "inline-block";  // Show the spinner

    fetch(apiUrl, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCookie("csrftoken") // CSRF Token for Django
        },
        body: JSON.stringify(requestData)
    })
    .then(response => response.json())
    .then(data => {
        // Hide the spinner and enable the button
        submitBtn.disabled = false;
        spinner.style.display = "none";  // Hide the spinner

        if (data.success) {
            alert("âœ… Task assigned successfully!");
            location.reload(); // Refresh to update UI
        } else {
            alert("âŒ Error: " + data.error);
        }
    })
    .catch(error => {
        // Hide the spinner and enable the button
        submitBtn.disabled = false;
        spinner.style.display = "none";  // Hide the spinner

        console.error("âš ï¸ Error:", error);
        alert("Something went wrong!");
    });
});

// ðŸª CSRF Token Helper Function (for Django Security)
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        let cookies = document.cookie.split(";");
        for (let i = 0; i < cookies.length; i++) {
            let cookie = cookies[i].trim();
            if (cookie.startsWith(name + "=")) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Create Group Event 
document.getElementById("createGroupEventBtn").addEventListener("click", function() {
    // Show the modal
    let createEventModal = new bootstrap.Modal(document.getElementById("createGroupEventModal"));
    createEventModal.show();
});

document.getElementById("submitGroupEventBtn").addEventListener("click", function() {
    // Gather the form data
    let org_id = "{{organization.id}}";
    let group_id = "{{group.id}}";
    let title = document.getElementById("eventTitle").value;
    let description = document.getElementById("eventDescription").value;
    let date = document.getElementById("eventDate").value;
    let start_time = document.getElementById("eventStartTime").value;
    let end_time = document.getElementById("eventEndTime").value;
    let meeting_link = document.getElementById("meetingLink").value;
    let location = document.getElementById("eventLocation").value;
    let slots = document.getElementById("eventSlots").value;
    let recurrence_type = document.getElementById("recurrenceType").value;
    let recurrence_end_date = document.getElementById("recurrenceEndDate").value || null;
    let recurrence_days = document.getElementById("recurrenceDays").value || null;

    let requestData = {
        org_id: org_id,
        group_id: group_id,
        title: title,
        description: description,
        date: date,
        start_time: start_time,
        end_time: end_time,
        meeting_link: meeting_link,
        location: location,
        slots: slots,
        recurrence_type: recurrence_type,
        recurrence_end_date: recurrence_end_date,
        recurrence_days: recurrence_days
    };

    let apiUrl = '/groups/create-group-event/'; // Replace with the correct endpoint URL

    fetch(apiUrl, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-CSRFToken": getCookie("csrftoken") // CSRF Token
        },
        body: JSON.stringify(requestData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert("âœ… Event created successfully!");
            location.reload(); // Reload page to see the event
        } else {
            alert("âŒ Error: " + data.error);
        }
    })
    .catch(error => {
        console.error("âš ï¸ Error:", error);
        alert("Something went wrong!");
    });
});

// CSRF Token Helper Function (for Django)
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
        let cookies = document.cookie.split(";");
        for (let i = 0; i < cookies.length; i++) {
            let cookie = cookies[i].trim();
            if (cookie.startsWith(name + "=")) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

// Manage Events And Bookings
document.addEventListener("DOMContentLoaded", function () {
    // Fetch data from Django template
    const orgId = "{{ organization.id }}";
    const groupId = "{{ group.id }}";
    
    const eventListContainer = document.getElementById("event-list");
    const bookingListContainer = document.getElementById("booking-list");

    // Button to trigger event fetch
    const fetchEventsBtn = document.getElementById("fetchEventsBtn");

    // Debugging output
    console.log(`Organization ID: ${orgId}, Group ID: ${groupId}`);

    // Bootstrap Modals initialization (they will be opened using data-bs-toggle)
    const eventModal = new bootstrap.Modal(document.getElementById("eventModal"));
    const bookingModal = new bootstrap.Modal(document.getElementById("bookingDetailsModal"));

    // Fetch Group Events
    fetchEventsBtn.addEventListener("click", function () {
        console.log("Fetching group events...");

        // Use the original URL to fetch events
        fetch(`/groups/fetch-group-events-new/?org_id=${orgId}&group_id=${groupId}`)
    .then(response => response.json())
    .then(data => {
        console.log("Events fetched:", data);

        if (data && data.events) {
            eventListContainer.innerHTML = ""; // Clear previous events
            data.events.forEach(event => {
                console.log("Event:", event);

                let eventItem = document.createElement("li");
                eventItem.className = "group relative p-4 hover:bg-gray-50 border-b border-gray-100 last:border-0 transition-colors event-item";
                eventItem.dataset.eventId = event.id;
                eventListContainer.appendChild(eventItem);

                // Event content with Tailwind styling
                eventItem.innerHTML = `
                    <div class="flex items-start justify-between gap-4">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2">
                                <div class="w-2 h-2 bg-blue-500 rounded-full mt-1"></div>
                                <h3 class="font-medium text-gray-900 truncate">${event.title}</h3>
                            </div>
                            <div class="flex flex-wrap items-center gap-x-3 gap-y-1 mt-1.5 text-sm text-gray-500">
                                <div class="flex items-center gap-1.5">
                                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                    <span>${event.date}</span>
                                </div>
                                <div class="flex items-center gap-1.5">
                                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                    </svg>
                                    <span>${event.start_time} - ${event.end_time}</span>
                                </div>
                                ${event.location ? `
                                <div class="flex items-center gap-1.5">
                                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                    </svg>
                                    <span>${event.location}</span>
                                </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <a href="${event.meeting_link}" 
                           class="flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 rounded-lg transition-colors shadow-sm shrink-0">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Join
                        </a>
                    </div>
                `;

                eventListContainer.appendChild(eventItem);
            });
            $('#eventModal').modal('show');
        } else {
            console.error("No events found in the response.");
        }
    })
    .catch(error => {
        console.error("Error fetching events:", error);
    });
    });

    // Fetch Bookings when an Event is clicked
    eventListContainer.addEventListener("click", function (event) {
        if (event.target.classList.contains("event-item")) {
            let eventId = event.target.dataset.eventId;
            console.log(`Fetching bookings for event ID: ${eventId}`);

            // Use the original URL to fetch bookings for the selected event
            fetch(`/groups/fetch-bookings-new/?org_id=${orgId}&group_id=${groupId}&event_id=${eventId}`)
                .then(response => response.json())
                .then(data => {
                    console.log("Bookings fetched:", data);

                    if (data && data.bookings) {
                        bookingListContainer.innerHTML = ""; // Clear previous bookings
                        data.bookings.forEach(booking => {
                            console.log("Booking:", booking); // Debugging individual bookings

                            let bookingItem = document.createElement("li");
                            bookingItem.className = "list-group-item";

                            // Handle profile picture (fallback to a default if none exists)
                            const profilePicture = booking.profile_picture || 'default_profile_picture.jpg';

                            bookingItem.innerHTML = `
  <div class="flex items-center gap-3 p-3 hover:bg-gray-50 rounded-lg transition-colors group">
    <div class="relative">
      <img src="${profilePicture}" 
           class="w-10 h-10 rounded-full object-cover border-2 border-white shadow-sm">
      <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-green-500 rounded-full border-2 border-white"></div>
    </div>
    
    <div class="flex-1 min-w-0">
      <div class="flex items-center gap-2">
        <span class="font-semibold text-gray-900 truncate">${booking.full_name}</span>
        <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium 
                  ${booking.status === 'Confirmed' 
                    ? 'bg-green-100 text-green-700' 
                    : 'bg-gray-100 text-gray-600'}">
          ${booking.status}
        </span>
      </div>
      <div class="flex items-center gap-1.5 text-sm text-gray-500">
        <span>Booked on</span>
        <time class="font-medium">${booking.booking_date}</time>
        <span class="text-gray-300">â€¢</span>
        <time class="font-medium">${booking.booking_time}</time>
      </div>
    </div>
    
    <button class="opacity-0 group-hover:opacity-100 transition-opacity text-gray-400 hover:text-gray-600 p-1 rounded-lg">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
      </svg>
    </button>
  </div>
`;
                            bookingListContainer.appendChild(bookingItem);
                        });
                        // Automatically open the booking modal using Bootstrap's data-bs-toggle mechanism
                        $('#bookingDetailsModal').modal('show');
                    } else {
                        console.error("No bookings found in the response.");
                    }
                })
                .catch(error => {
                    console.error("Error fetching bookings:", error);
                });
        }
    });
});

// Invite Members into the group

document.getElementById('inviteForm').addEventListener('submit', function (event) {
    event.preventDefault();

    let emails = document.getElementById('emailInput').value;
    let loading = document.getElementById('loading');
    let responseMessages = document.getElementById('responseMessages');
    let csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

    responseMessages.innerHTML = "";
    loading.style.display = "block";

    fetch(`/groups/invite-members-group-update/{{ organization.id }}/{{ group.id }}/`, {
        method: 'POST',
        headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'X-CSRFToken': csrfToken,
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        body: new URLSearchParams({ emails: emails }),
    })
    .then(response => response.json())
    .then(data => {
        loading.style.display = "none";

        if (data.sent) {
            responseMessages.innerHTML += `<div class="alert alert-success">${data.sent.join('<br>')}</div>`;
        }
        if (data.warnings) {
            responseMessages.innerHTML += `<div class="alert alert-warning">${data.warnings.join('<br>')}</div>`;
        }
        if (data.errors) {
            responseMessages.innerHTML += `<div class="alert alert-danger">${data.errors.join('<br>')}</div>`;
        }
    })
    .catch(error => {
        loading.style.display = "none";
        responseMessages.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
    });
});

// Track Invitations (Update)
document.getElementById('invitationStatusModal').addEventListener('show.bs.modal', function () {
    // Use Django template variables properly
    let orgId = "{{ organization.id }}";  // Ensure these are rendered properly in the template
    let groupId = "{{ group.id }}";      // Ensure these are rendered properly in the template

    let loading = document.getElementById('loading');
    let invitationsContainer = document.getElementById('invitationsContainer');
    
    // Show loading spinner
    loading.style.display = "block";
    invitationsContainer.innerHTML = ""; // Clear existing data

    // Fetch the invitations status via AJAX
    fetch(`/groups/invitation-status-group-update/${orgId}/${groupId}/`)
        .then(response => response.json())
        .then(data => {
            loading.style.display = "none";  // Hide loading spinner

            if (data.error) {
                invitationsContainer.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
            } else {
                let invitations = data.invitations;
                invitations.forEach(invitation => {
                    let statusClass = invitation.status === 'accepted' ? 'text-success' : 
                                      invitation.status === 'rejected' ? 'text-danger' : 'text-warning';
                    let profilePic = invitation.profile_picture ? 
                        `<img src="${invitation.profile_picture}" alt="Profile Pic" class="rounded-circle" width="40" height="40">` : 
                        `<img src="default-profile-pic.jpg" alt="Default Profile Pic" class="rounded-circle" width="40" height="40">`;

                    invitationsContainer.innerHTML += `
                        <div class="d-flex align-items-center mb-3">
                            ${profilePic}
                            <div class="ms-3">
                                <h6 class="m-0">${invitation.recipient_email}</h6>
                                <small class="${statusClass}">${invitation.status}</small>
                                <br>
                                <small>Sent at: ${new Date(invitation.invitation_sent_at).toLocaleString()}</small>
                            </div>
                        </div>
                    `;
                });
            }
        })
        .catch(error => {
            loading.style.display = "none";
            invitationsContainer.innerHTML = `<div class="alert alert-danger">Error: ${error.message}</div>`;
        });
});


</script>
</body>
</html>