<h1>Task rendered!</h1>

<!-- üåÄ Group Container -->
<div id="group-list" class="mt-3">
  <p class="text-muted">Loading your groups...</p>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const groupListEl = document.getElementById("group-list");
    const orgId = "{{ organization.id|default:'' }}";

    console.log("üöÄ DOM Loaded | orgId:", orgId);

    if (!groupListEl) {
      console.error("‚ùå #group-list element not found in DOM.");
      return;
    }

    if (!orgId) {
      console.warn("‚ö†Ô∏è Organization ID is missing.");
      groupListEl.innerHTML = "<div class='alert alert-warning'>Organization ID is missing.</div>";
      return;
    }

    const endpoint = `/widgets/get-user-groups-json/?org_id=${orgId}`;
    console.log("üì° Fetching user groups from:", endpoint);

    fetch(endpoint)
      .then(response => {
        console.log("üì• Response received:", response);
        if (!response.ok) throw new Error(`Server returned ${response.status}`);
        return response.json();
      })
      .then(data => {
        console.log("‚úÖ JSON parsed:", data);

        if (data.groups && data.groups.length > 0) {
          console.log(`üéØ Found ${data.groups.length} group(s).`);

          const groupHtml = data.groups.map(group => `
            <div class="border rounded px-3 py-2 mb-2 shadow-sm bg-light">
              <strong>${group.name}</strong>
            </div>
          `).join("");

          groupListEl.innerHTML = groupHtml;
        } else {
          console.warn("‚ÑπÔ∏è No groups returned for user.");
          groupListEl.innerHTML = `<p class="text-muted">No groups found for you in this organization.</p>`;
        }
      })
      .catch(error => {
        console.error("‚ùå Error fetching groups:", error);
        groupListEl.innerHTML = `
          <div class="alert alert-danger">
            Failed to load groups. Please try again later.<br>
            <code>${error.message}</code>
          </div>
        `;
      });
  });
</script>
