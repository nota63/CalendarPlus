<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Impersonation Notice</title>

    <!-- ✅ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- ✅ Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        #session-timer {
            font-family: monospace;
            font-size: 0.875rem;
        }
    </style>
</head>
<body>

    {% if request.impersonating %}
    <div class="alert alert-warning text-center mb-0 rounded-0 flex flex-col md:flex-row justify-center items-center gap-3" style="z-index:9999;">
      <div>
        <strong>Notice:</strong> You are impersonating <b>{{ request.user.username }}</b>.
        <a href="{% url 'stop_impersonation' %}" class="btn btn-sm btn-outline-danger ms-3">Exit Impersonation</a>
      </div>
      <div class="text-sm font-mono text-gray-800 bg-yellow-200 px-3 py-1 rounded">
        Session: <span id="impersonation-timer">00:00:00</span>
      </div>
    </div>
    
    <script>
      // Function to format seconds as HH:MM:SS
      function formatDuration(seconds) {
        const hrs = String(Math.floor(seconds / 3600)).padStart(2, '0');
        const mins = String(Math.floor((seconds % 3600) / 60)).padStart(2, '0');
        const secs = String(seconds % 60).padStart(2, '0');
        return `${hrs}:${mins}:${secs}`;
      }
    
      // Check or set session start time in localStorage
      const STORAGE_KEY = 'impersonationStartTime';
      if (!localStorage.getItem(STORAGE_KEY)) {
        localStorage.setItem(STORAGE_KEY, Date.now());
      }
    
      const startTime = parseInt(localStorage.getItem(STORAGE_KEY), 10);
    
      function updateTimer() {
        const elapsed = Math.floor((Date.now() - startTime) / 1000); // in seconds
        document.getElementById('impersonation-timer').textContent = formatDuration(elapsed);
      }
    
      setInterval(updateTimer, 1000);
      updateTimer(); // initial call
    </script>
    {% endif %}

</body>
</html>
