<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meeting Contacts</title>
    <!-- Bootstrap 5 CSS CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Optional: Font Awesome for icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet">
</head>

<body class="bg-light text-dark">

<!-- CSRF Token Form -->
<form method="post">
    {% csrf_token %}
</form>

<!-- Main Content Container -->
<div class="container my-5">
    <h1 class="text-center text-primary fw-bold mb-5">Contacts for {{ organization.name }}</h1>
    <p class="text-center text-muted mb-5">Users you've had or will have future meetings with are listed here. Add them to your contact list to simplify scheduling!</p>

    <!-- Organization Info Section -->
    <div class="mb-4">
        <h2 class="h4 text-uppercase text-primary mb-3">Organization: {{ organization.name }}</h2>
        <p class="text-muted">These are users with whom you have scheduled meetings.</p>
    </div>

    <!-- User Contacts List -->
    <div class="row">
        {% for user_info in user_details %}
            <div class="col-md-6 col-lg-4 mb-4">
                <div class="card shadow-sm border-0 rounded-3">
                    <div class="card-body">
                        <!-- User Info Section -->
                        <div class="d-flex justify-content-between mb-3">
                            <div>
                                <h5 class="fw-bold">{{ user_info.user.username }}</h5>
                                <p class="text-muted small">{{ user_info.role }}</p>
                            </div>
                            <span class="badge bg-secondary">{{ user_info.organization_name }}</span>
                        </div>

                        <!-- Last Meeting Info Section -->
                        <div class="mb-3">
                            <strong class="h6">Last Meeting:</strong>
                            {% if user_info.last_meeting.date %}
                                <div class="mt-2 text-muted">
                                    <p><strong>Date:</strong> {{ user_info.last_meeting.date }}</p>
                                    <p><strong>Time:</strong> {{ user_info.last_meeting.time }}</p>
                                    <p><strong>Title:</strong> {{ user_info.last_meeting.title }}</p>
                                </div>
                            {% else %}
                                <p class="mt-2 text-muted">No past meetings</p>
                            {% endif %}
                        </div>

                        <!-- Next Meeting Info Section -->
                        <div>
                            <strong class="h6">Next Meeting:</strong>
                            {% if user_info.next_meeting.date %}
                                <div class="mt-2 text-muted">
                                    <p><strong>Date:</strong> {{ user_info.next_meeting.date }}</p>
                                    <p><strong>Time:</strong> {{ user_info.next_meeting.time }}</p>
                                    <p><strong>Title:</strong> {{ user_info.next_meeting.title }}</p>
                                </div>
                            {% else %}
                                <p class="mt-2 text-muted">No upcoming meetings</p>
                            {% endif %}
                        </div>

                        <!-- Add to Contacts Button -->
                        <div class="mt-4 text-center">
                            <button 
                                class="add-contact-btn btn btn-primary btn-sm"
                                data-org-id="{{ organization.id }}" 
                                data-user-id="{{ user_info.user.id }}">
                                <i class="fas fa-user-plus"></i> Add to Contacts
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<!-- Bootstrap 5 JS and Popper.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>

    <script>
        document.querySelectorAll('.add-contact-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const orgId = btn.getAttribute('data-org-id');
                const userId = btn.getAttribute('data-user-id');

                fetch(`/contacts/add_to_contacts/${orgId}/${userId}/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
                    },
                    body: JSON.stringify({
                        'org_id': orgId,
                        'user_id': userId
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.message) {
                        alert(data.message);  // Success message
                    } else if (data.error) {
                        alert(data.error);  // Error message
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('An error occurred while adding the contact.');
                });
            });
        });
    </script>
</body>
</html>















